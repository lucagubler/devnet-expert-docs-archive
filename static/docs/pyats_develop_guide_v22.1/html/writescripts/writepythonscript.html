

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Write a Python script &mdash; pyATS Development Guide  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=83f4edbc" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=7f41d439"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/js/custom.js?v=80dc6f7b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Write a parser" href="../writeparser/writeparser.html" />
    <link rel="prev" title="Everything is Python" href="../quickstart/structureofastatement.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS Development Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Write a script</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart/structureofastatement.html">Everything is Python</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Write a Python script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-write-a-script">Why write a script?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#write-a-basic-script">Write a basic script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sample-script-basic">Sample script - basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#steps-to-write-a-basic-script">Steps to write a basic script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#write-an-advanced-script">Write an advanced script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sample-script-advanced">Sample script - advanced</a></li>
<li class="toctree-l3"><a class="reference internal" href="#steps-to-write-an-advanced-script">Steps to write an advanced script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribute to pyATS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../writeparser/writeparser.html">Write a parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writeapi/writeapi.html">Write an API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writetrigger/writetrigger.html">Write a trigger</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-docs/docs/blitz/index.html">pyATS Blitz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/contribute.html">Contribution guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/keyconcepts.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS Development Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Write a Python script</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style>
.question {background-color: yellow; font-weight:bold; padding: .25em;}
.monospace {font-family: monospace; color: #404040; font-size: 14px;}
.border {border: 1px #404040;}
</style><section id="write-a-python-script">
<span id="write-python-script"></span><h1>Write a Python script<a class="headerlink" href="#write-a-python-script" title="Link to this heading"></a></h1>
<p>As a network engineer or programmer, you can write your own Python scripts that use the <strong>pyATS</strong> libraries to automate your network testing. A script is simply a Python file that lists different actions and lets you run them with a single command. In pyATS terms, a script is an aggregation of <a class="reference internal" href="../quickstart/keyconcepts.html#term-Trigger"><span class="xref std std-term">Triggers</span></a> and <a class="reference internal" href="../quickstart/keyconcepts.html#term-Verification"><span class="xref std std-term">Verifications</span></a>.</p>
<p>This topic describes how to write a basic script and how to add complexity to that script.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Before you run the example scripts provided in this section, make sure you have the latest pyATS Library packages, <strong>version 19.10 or higher</strong>:</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pyats[library]</span> <span class="pre">--upgrade</span></code></p>
</div>
<section id="why-write-a-script">
<h2>Why write a script?<a class="headerlink" href="#why-write-a-script" title="Link to this heading"></a></h2>
<p><em>Automation</em> means that you can programmatically establish connections to your devices and perform operations on them. Scripts automate your network operations — you simply define a list of commands once and then reuse the script as often as required, on-demand or at scheduled intervals.</p>
<p>For example, let’s say that you have a device with over 100 interfaces, and that you need to monitor these daily to make sure they are up. You could, of course, manually execute a show command and then read through hundreds of lines of code to find the state of each interface. This is time consuming, however, and introduces the possibility of human error, which could adversely affect the state of your network.</p>
<p>The pyATS Library provides a better solution!</p>
<ul class="simple">
<li><p>Write a script that automates the process using the <strong>pyATS Library</strong> functionality to connect, configure, and verify the device state.</p></li>
<li><p>Rerun the script as needed, either as a scheduled job or on demand.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember, the pyATS Library gives you <em>structured</em> output that makes reuse possible.</p>
</div>
</section>
<section id="write-a-basic-script">
<span id="write-basic-script"></span><h2>Write a basic script<a class="headerlink" href="#write-a-basic-script" title="Link to this heading"></a></h2>
<p>This example shows you how to write and run a basic script to check the state of a device interface.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example uses pure Python. For information about how to use the pyATS Library command line interface, see the <em>Get Started with pyATS Guide</em> topic <a class="reference external" href="https://pubhub.devnetcloud.com/media/pyats-getting-started/docs/intro/introduction.html#what-is-the-library-cli">What is the pyATS Library CLI?</a>.</p>
</div>
<section id="sample-script-basic">
<h3>Sample script - basic<a class="headerlink" href="#sample-script-basic" title="Link to this heading"></a></h3>
<p>We provide you with an example of a commented script that:</p>
<ul class="simple">
<li><p>checks the status of a network interface</p></li>
<li><p>changes the configuration, and</p></li>
<li><p>re-checks the interface status.</p></li>
</ul>
<p>We also provide you with pre-recorded output so that you can see the results. <a class="reference download internal" download="" href="../_downloads/790f26a04d001d756f0554db91253219/simple_script1.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">the</span> <span class="pre">first</span> <span class="pre">sample</span></code></a> file, and then extract the files to a directory of your choice. Take a look at the <span class="monospace">testbed.yaml</span>, and open <span class="monospace">simple_script1.py</span> in a text editor to see additional <span class="monospace">log.info</span> statements that make the on-screen output clear.</p>
<p>To run the script:</p>
<ol class="arabic">
<li><p>In your Linux terminal, source the environment variables.</p>
<ul>
<li><p>For Bash:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">script1_env</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>For C shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">script1_env</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Run the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">simple_script1</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p>Clear the mock environment variable that you set in step 1.</p>
<ul>
<li><p>For Bash:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unset</span> <span class="n">UNICON_REPLAY</span>
</pre></div>
</div>
</li>
<li><p>For C shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unsetenv</span> <span class="n">UNICON_REPLAY</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="steps-to-write-a-basic-script">
<span id="steps-write-script"></span><h3>Steps to write a basic script<a class="headerlink" href="#steps-to-write-a-basic-script" title="Link to this heading"></a></h3>
<p>The following procedure describes the steps that you take to write the same sample script.</p>
<ol class="arabic">
<li><p>Open a text editor and start a new <span class="monospace">.py</span> file. <br /> <br /></p></li>
<li><p>Import the functionality that you need from Python, pyATS, and the pyATS Library. For a description of the more commonly used functionality that you might want to import, see the topic <a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-docs/docs/userguide/utils/index.html#useful-libraries">Useful Libraries</a>.</p>
<p>Remember that you always need to load the <a class="reference internal" href="../quickstart/keyconcepts.html#term-Testbed-YAML-file"><span class="xref std std-term">Testbed YAML file</span></a>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Enable logger</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Import functionality from the pyATS library</span>
<span class="kn">from</span> <span class="nn">genie.testbed</span> <span class="kn">import</span> <span class="n">load</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>If you’d like your script to display formatted messages as it runs, you can use the <code class="docutils literal notranslate"><span class="pre">banner</span></code> functionality.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats.log.utils</span> <span class="kn">import</span> <span class="n">banner</span>
</pre></div>
</div>
</li>
<li><p>You imported the <code class="docutils literal notranslate"><span class="pre">load</span></code> functionality in step 2, so now you can load the testbed file and display useful messages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">banner</span><span class="p">(</span><span class="s2">&quot;Loading testbed&quot;</span><span class="p">))</span>
<span class="n">testbed</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;testbed.yaml&#39;</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PASS: Successfully loaded testbed &#39;</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testbed</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Now connect to one of the devices in the testbed. In this example, <code class="docutils literal notranslate"><span class="pre">nx-osv-1</span></code> is the hostname of a device in the <a class="reference internal" href="../quickstart/keyconcepts.html#term-Testbed-YAML-file"><span class="xref std std-term">Testbed YAML file</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;nx-osv-1&#39;</span><span class="p">]</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">via</span><span class="o">=</span><span class="s1">&#39;cli&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Check the current state of the interface and parse the output into a data structure that has <a class="reference internal" href="../quickstart/keyconcepts.html#term-Key-value-pair"><span class="xref std std-term">Key-value pairs</span></a>. We expect that the interface <code class="docutils literal notranslate"><span class="pre">Ethernet2/1</span></code> is currently down.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pre_output</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;show interface Ethernet2/1 brief&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>With the data parsed and stored as the <a class="reference internal" href="../quickstart/keyconcepts.html#term-Object"><span class="xref std std-term">Object</span></a> <code class="docutils literal notranslate"><span class="pre">pre_output</span></code>, check the value of the <code class="docutils literal notranslate"><span class="pre">status</span></code> key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pre_status</span> <span class="o">=</span> <span class="n">pre_output</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">][</span><span class="s1">&#39;ethernet&#39;</span><span class="p">][</span><span class="s1">&#39;Ethernet2/1&#39;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">pre_status</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PASS: Interface Ethernet2/1 status is &#39;down&#39; as expected</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">FAIL: Interface Ethernet2/1 status is not &#39;down&#39; as expected</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">exit</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Bring the interface up using the <code class="docutils literal notranslate"><span class="pre">Conf</span></code> module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">device</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;interface Ethernet2/1</span><span class="se">\n</span><span class="s2">&quot;</span>
           <span class="s2">&quot; no shutdown&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">sleep</span></code> to give the configuration time to take effect.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Re-check the interface state – parse the output and store it in the <code class="docutils literal notranslate"><span class="pre">post_output</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">post_output</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;show interface Ethernet2/1 brief&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Verify that the interface is now <span class="monospace">up</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">post_status</span> <span class="o">=</span> <span class="n">post_output</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">][</span><span class="s1">&#39;ethernet&#39;</span><span class="p">][</span><span class="s1">&#39;Ethernet2/1&#39;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">post_status</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PASS: Interface Ethernet2/1 status is &#39;up&#39; as expected</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PASS: Interface Ethernet2/1 status is not &#39;up&#39; as expected</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Save the file as <span class="monospace">myscript1.py</span>.</p></li>
</ol>
<p>And there you have it!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can add a Python debugger to your code at any point that you want to stop and debug:</p>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pdb;</span> <span class="pre">pdb.set_trace()</span></code></p>
</div>
</section>
</section>
<section id="write-an-advanced-script">
<h2>Write an advanced script<a class="headerlink" href="#write-an-advanced-script" title="Link to this heading"></a></h2>
<section id="sample-script-advanced">
<h3>Sample script - advanced<a class="headerlink" href="#sample-script-advanced" title="Link to this heading"></a></h3>
<p>We provide you with an example of a commented script that</p>
<ul class="simple">
<li><p>connects to two devices</p></li>
<li><p>gets the number of established BGP neighbors on the first device</p></li>
<li><p>learns the BGP feature on the first device</p></li>
<li><p>shuts down the BGP neighbor on the first device</p></li>
<li><p>learns the BGP feature again after the configuration change</p></li>
<li><p>uses the pyATS Library <code class="docutils literal notranslate"><span class="pre">Diff</span></code> functionality to verify that the BGP neighbor is down</p></li>
<li><p>restores the BGP neighbor</p></li>
<li><p>learns the BGP feature again after the second configuration change</p></li>
<li><p>uses the pyATS Library <code class="docutils literal notranslate"><span class="pre">Diff</span></code> functionality to verify that there are minimal differences in the device operational state</p></li>
<li><p>verifies the number of BGP neighbors on the first device, and</p></li>
<li><p>checks the interface status of all interfaces on the device.</p></li>
</ul>
<p>We also provide you with pre-recorded output so that you can see the results. <a class="reference download internal" download="" href="../_downloads/8e226fa3e2225604f7f9d1b5b5b84b06/simple_script2.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">the</span> <span class="pre">second</span> <span class="pre">sample</span></code></a> file, and then extract the files to a directory of your choice. In a text editor, open and read through the <span class="monospace">testbed.yaml</span> and <span class="monospace">simple_script2.py</span> files.</p>
<p>To run the script:</p>
<ol class="arabic">
<li><p>In your Linux terminal, source the environment variables.</p>
<ul>
<li><p>For Bash:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">script2_env</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>For C shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">script2_env</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Run the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">simple_script2</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p>Clear the mock environment variable that you set in step 1.</p>
<ul>
<li><p>For Bash:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unset</span> <span class="n">UNICON_REPLAY</span>
</pre></div>
</div>
</li>
<li><p>For C shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unsetenv</span> <span class="n">UNICON_REPLAY</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="steps-to-write-an-advanced-script">
<h3>Steps to write an advanced script<a class="headerlink" href="#steps-to-write-an-advanced-script" title="Link to this heading"></a></h3>
<p>Open the file <span class="monospace">simple_script2.py</span>, and note the following <strong>differences</strong> from the basic script.</p>
<ol class="arabic">
<li><p>This example imports additional functionality so that you can use <code class="docutils literal notranslate"><span class="pre">Diff</span></code> and an API that gets BGP information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">genie.testbed</span> <span class="kn">import</span> <span class="n">load</span>
<span class="kn">from</span> <span class="nn">ats.log.utils</span> <span class="kn">import</span> <span class="n">banner</span>
<span class="kn">from</span> <span class="nn">genie.utils.diff</span> <span class="kn">import</span> <span class="n">Diff</span>
<span class="kn">from</span> <span class="nn">genie.libs.sdk.apis.iosxe.bgp.get</span> <span class="kn">import</span> <span class="n">get_bgp_session_count</span>
</pre></div>
</div>
</li>
<li><p>This script uses the <code class="docutils literal notranslate"><span class="pre">Ops</span></code> module <code class="docutils literal notranslate"><span class="pre">learn</span></code> functionality to learn the BGP feature (issue and parse a series of show commands):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pre_bgp_ops</span> <span class="o">=</span> <span class="n">dev_xe</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="s2">&quot;bgp&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The script uses the learn functionality again later to learn the feature after configuration changes. <br /> <br /></p>
</li>
<li><p>The script uses an API function to get the number of established BGP neighbors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">orig_bgp_estab_nbrs</span> <span class="o">=</span> <span class="n">dev_xe</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_bgp_session_count</span><span class="p">(</span><span class="n">in_state</span><span class="o">=</span><span class="s1">&#39;established&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Make a configuration change in the feature BGP, and then relearn the changes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dev_xe</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;router bgp 65000</span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="s2">&quot; neighbor 10.2.2.2 shutdown&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Diff</span></code> compares the operational state of the device before and after configuration changes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">banner</span><span class="p">(</span><span class="s2">&quot;Use Genie Diff to verify BGP neighbor is shutdown on XE device &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
            <span class="nb">format</span><span class="p">(</span><span class="n">dev_xe</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>

<span class="n">bgp_diff</span> <span class="o">=</span> <span class="n">Diff</span><span class="p">(</span><span class="n">pre_bgp_ops</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">post_bgp_ops1</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<span class="n">bgp_diff</span><span class="o">.</span><span class="n">findDiff</span><span class="p">()</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Genie Diffs observed, BGP neighbor is shutdown/missing:</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bgp_diff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Notice the “for” loop, which checks the status of all interfaces on the XE device:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">intf_output</span> <span class="o">=</span> <span class="n">dev_xe</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;show ip interface brief&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">intf_output</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">]:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">intf_output</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">][</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PASS: Interface </span><span class="si">{intf}</span><span class="s2"> status is: &#39;</span><span class="si">{s}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf</span><span class="o">=</span><span class="n">interface</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">status</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">FAIL: Interface </span><span class="si">{intf}</span><span class="s2"> status is: &#39;</span><span class="si">{s}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf</span><span class="o">=</span><span class="n">interface</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">status</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can add a Python debugger to your code at any point that you want to stop and debug:</p>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pdb;</span> <span class="pre">pdb.set_trace()</span></code></p>
</div>
<p>See also…</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/tutorial/modules.html?highlight=import">How the Python import works</a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/790f26a04d001d756f0554db91253219/simple_script1.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">the</span> <span class="pre">first</span> <span class="pre">sample</span></code></a> zip file</p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/8e226fa3e2225604f7f9d1b5b5b84b06/simple_script2.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">the</span> <span class="pre">second</span> <span class="pre">sample</span></code></a> zip file</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../quickstart/structureofastatement.html" class="btn btn-neutral float-left" title="Everything is Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../writeparser/writeparser.html" class="btn btn-neutral float-right" title="Write a parser" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Cisco Systems Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>