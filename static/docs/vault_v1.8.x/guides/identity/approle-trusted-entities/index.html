<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta property="og:image" content="https://www.vaultproject.io/img/og-image.png"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=16&amp;w=16" type="image/png" sizes="16x16" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=32&amp;w=32" type="image/png" sizes="32x32" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=96&amp;w=96" type="image/png" sizes="96x96" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=192&amp;w=192" type="image/png" sizes="192x192" rel="icon"/><title>AppRole With Terraform &amp; Chef - Guides | Vault by HashiCorp</title><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta property="article:publisher" content="https://www.facebook.com/HashiCorp/"/><meta name="twitter:site" content="@HashiCorp"/><meta name="twitter:card" content="summary_large_image"/><meta name="theme-color" content="#000"/><meta name="description" property="og:description" content="This guide discusses the concepts necessary to help users
understand Vault&#x27;s AppRole authentication pattern and how to use it to
securely introduce a Vault authentication token to a target server,
application, container, etc.x"/><meta property="og:site_name" content="Vault by HashiCorp"/><meta name="next-head-count" content="17"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/css/7246d51e322c1bb7fa92.css" as="style"/><link rel="stylesheet" href="/docs/vault_v1.8.x/_next/static/css/7246d51e322c1bb7fa92.css" data-n-g=""/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/css/fbe3b6b5804634e8fb99.css" as="style"/><link rel="stylesheet" href="/docs/vault_v1.8.x/_next/static/css/fbe3b6b5804634e8fb99.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/framework.3519294afa6a9ab53973.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/2bc72d9a08d5bd816ae6b580871df9fb671d43bb.52fd5ef7a8ab7d8fc0dd.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/9a5be27b89b50ff891e514a88cd42f143404f9a6.033857d62f5a01edf3b3.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/main-b0f1f3f8bd3bddd4e6cd.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/b49b08e2da573413c730dfc51ae423f080a0c275.00ac32ee45240d5b343f.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/b1542cc239bf56c8a14913c0a930efe682b5cf86.32bb900ad80311488529.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/pages/_app-d714c55ad24af91621ba.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/7dbdcaca29374b13a0799a901e26613767d72de2.d088888a4a1113f2bb24.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/92f0085e0e6c1f10382de10b8861ce89d7c192a2.e5495ede8461fc33ed98.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b.5052eda5c7f43583669b.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b_CSS.f6584926f1188e1b5b3e.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/pages/guides/%5B%5B...page%5D%5D-72f9db6e509b49c776de.js" as="script"/></head><body><div id="__next"><div class="g-alert-banner style_vault__1OYha show themed"><a href="https://hashiconf.com/europe" class="link"><span class="g-grid-container has-large-tag"><span class="tag g-type-body-small-x-strong">Thank you</span><span class="text g-type-body-small has-large-tag">HashiConf Europe is a wrap. Watch this year’s sessions on-demand.<!-- --> <span class="link-text g-type-body-small-x-strong">Watch Now</span></span></span></a><button class="close"><div><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 5L5 15M5 5l10 10" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><span class="visually-hidden">Dismiss alert</span></button></div><header class="hashi-stack-menu_hashiStackMenu__2dCgY"><nav class="hashi-stack-menu_nav__3DnqS g-grid-container" aria-label="Primary HashiCorp website navigation"><a aria-label="To main HashiCorp website" href="https://www.hashicorp.com/" class="hashi-stack-menu_logoLink__2cbDW"><div data-testid="root"><svg width="317" height="88" viewBox="0 0 317 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M107.692 64.421V47.4h-14.97v17.02h-7.623V24.06h7.622v16.602h14.971V24.06h7.622v40.36h-7.622zm35.567-.001h-6.053l-.548-1.996a16.137 16.137 0 01-8.789 2.607c-5.397 0-7.699-3.697-7.699-8.79 0-5.998 2.607-8.3 8.606-8.3h7.089v-3.095c0-3.27-.907-4.421-5.633-4.421a41.255 41.255 0 00-8.179.877l-.907-5.634a38.496 38.496 0 0110.122-1.395c9.269 0 11.998 3.27 11.998 10.672l-.007 19.476zm-7.394-11.151h-5.45c-2.424 0-3.087.663-3.087 2.912 0 2.058.663 2.973 2.972 2.973a11.629 11.629 0 005.572-1.525l-.007-4.36zm21.701 11.754a34.776 34.776 0 01-10.183-1.7l1.029-5.633a33.038 33.038 0 008.788 1.273c3.271 0 3.758-.762 3.758-2.973 0-1.814-.366-2.729-5.152-3.88-7.211-1.76-8.058-3.575-8.058-9.269 0-5.938 2.607-8.545 11.03-8.545 2.98.003 5.949.348 8.85 1.03l-.762 5.876a51.98 51.98 0 00-8.118-.846c-3.209 0-3.758.763-3.758 2.546 0 2.363.183 2.546 4.185 3.575 8.263 2.188 9.055 3.278 9.055 9.307 0 5.725-1.761 9.239-10.664 9.239zm32.663-.602V43.84c0-1.578-.663-2.363-2.363-2.363-1.814 0-5.031 1.09-7.699 2.485v20.459h-7.394V22.847l7.394-1.029v15.33a26.045 26.045 0 0110.786-2.852c4.909 0 6.662 3.453 6.662 8.728v21.397h-7.386zm12.844-33.692v-8.545h7.394v8.545h-7.394zm0 33.692V34.906h7.394v29.515h-7.394zM215.62 35.15c0-7.394 4.299-11.693 14.361-11.693 3.697 0 7.38.447 10.969 1.334l-.839 6.601a59.517 59.517 0 00-9.909-1.029c-5.275 0-6.967 1.822-6.967 6.098v15.512c0 4.3 1.7 6.098 6.967 6.098a59.506 59.506 0 009.909-1.029l.846 6.609a45.672 45.672 0 01-10.968 1.334c-10.062 0-14.361-4.3-14.361-11.693l-.008-18.142zm40.499 29.873c-10.123 0-12.844-5.572-12.844-11.632v-7.455c0-6.06 2.728-11.632 12.844-11.632 10.115 0 12.844 5.572 12.844 11.632v7.455c-.023 6.06-2.744 11.632-12.844 11.632zm0-24.392c-3.941 0-5.45 1.76-5.45 5.092v7.912c0 3.331 1.524 5.092 5.45 5.092 3.925 0 5.45-1.76 5.45-5.092v-7.943c-.015-3.33-1.532-5.092-5.45-5.092v.03zm32.457.457a57.835 57.835 0 00-7.821 4.3v19.056h-7.394V34.906h6.243l.488 3.27a33.064 33.064 0 017.76-3.88l.724 6.792zm28.035 13.515c0 6.548-2.911 10.42-9.756 10.42a40.76 40.76 0 01-7.882-.853v12.196l-7.394 1.029V34.906h5.877l.762 2.485a15.535 15.535 0 019.33-3.087c5.938 0 9.086 3.514 9.086 10.245l-.023 10.054zm-17.631 3.331c2.152.474 4.346.73 6.548.763 2.668 0 3.697-1.274 3.697-3.941V44.35c0-2.424-.907-3.758-3.636-3.758a10.46 10.46 0 00-6.609 2.668v14.673zM29.134 7L0 23.808v40.361l10.946 6.32V30.127l18.188-10.504V7z" fill="#000"/><path d="M40.758 7v32.144H29.133V27.147l-10.945 6.319V74.65l10.946 6.335V48.932h11.624v11.914l10.946-6.312V13.32L40.758 7z" fill="#000"/><path d="M40.758 81L69.89 64.192V23.831l-10.946-6.32v40.362L40.758 68.377V81z" fill="#000"/></svg></div></a><ul class="hashi-stack-menu_menu__33a9r"><li class="nav-item_navItem__KPnS0"><button type="button" class="nav-item_buttonReset__WeJA7 nav-item_link__1827H g-type-body-small-strong ">Browse Products<span class="nav-item_visuallyHidden__20aYI">Open this menu</span><img class="nav-item_dropdownCarat__2xha-" alt="" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iNyIgdmlld0JveD0iMCAwIDEwIDciIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTguMDUzIDJsLTMgMy4wMDYtMy0zLjAwNiIgc3Ryb2tlPSJ2YXIoLS1ncmF5LTMpIiBzdHJva2Utd2lkdGg9IjEuMjUiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiLz48L3N2Zz4="/></button><section class="browse-panel_browsePanel__1AT8q "><menu class="stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Infrastructure</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.terraform.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M55.522 32.97l32.96 19.02v38.06l-32.96-19.03V32.97zM92.09 51.99v38.06l32.95-19.03V32.97L92.09 51.99zM18.96 11.73v38.05l32.95 19.03V30.76L18.96 11.73zm36.562 101.51l32.95 19.03V94.22l-32.95-19.03v38.05z" fill="#7B42BC"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">terraform</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.packer.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M35.09 26.38L74.22 49v83.38l-39.13-22.62V26.38z" fill="#02A8EF"/><path d="M93.6 36.13L51.06 11.62v17L80 45.34v51.05l13.61 7.82c8.421 4.86 15.311 2 15.311-6.47V60.28c-.01-8.42-6.92-19.28-15.32-24.15z" fill="#02A8EF"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">packer</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.vagrantup.com" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M110.77 17.55L86.68 31.46V40L72 74.52 57.32 40v-8.54L33.23 17.55l-14.65 8.47v9.83l32.63 79.92 20.79 12 20.79-12 32.63-79.92v-9.83l-14.65-8.47z" fill="#0E67ED"/><path d="M125.42 26.02l-24.09 13.9v8.55L81.77 92.19 72 97.83v29.94l20.79-12 32.63-79.92v-9.83zM57.32 40v-8.54l-14.66 8.46v8.55l19.57 43.72L72 86.55V74.52L57.32 40z" fill="#0850C5"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vagrant</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Networking</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.consul.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72.53 128.7a54.787 54.787 0 01-45.258-23.85 54.784 54.784 0 019.368-72.355 54.78 54.78 0 0172.95 1.125l-13 13.6a36 36 0 100 53.43l13 13.6a54.638 54.638 0 01-37.06 14.45zm44.081-27.401a4.49 4.49 0 114.49-4.49 4.5 4.5 0 01-4.49 4.49z" fill="#E03875"/><path d="M72.18 85.79A11.87 11.87 0 1184 73.93a11.88 11.88 0 01-11.82 11.86zm49.58.21a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.495 4.495 0 012.772 4.148 4.503 4.503 0 01-4.49 4.49zm-13.35-.56a4.488 4.488 0 01-4.4-5.385 4.487 4.487 0 013.555-3.515 4.49 4.49 0 11.845 8.9zm13.35-14.57a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.496 4.496 0 012.772 4.149 4.503 4.503 0 01-4.49 4.49zm-13.35.51a4.493 4.493 0 01-4.148-2.772 4.491 4.491 0 114.148 2.771zm8.461-15.61a4.49 4.49 0 11-.02-8.981 4.49 4.49 0 01.02 8.981z" fill="#E03875"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">consul</span></a></li></ul></li></menu><menu class="stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Security</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.vaultproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.88 21.15L71.8 131.4l55.321-110.25H16.881zm61.46 22.12h6.39v6.4h-6.39v-6.4zM65.61 68.84h-6.39v-6.39h6.39v6.39zm0-9.59h-6.39v-6.39h6.39v6.39zm0-9.58h-6.39v-6.4h6.39v6.4zm9.59 28.76h-6.4V72h6.4v6.43zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.58h-6.4v-6.4h6.4v6.4zm3.14 3.19h6.39v6.39h-6.39v-6.39zm0 16v-6.41h6.39v6.39l-6.39.02z" fill="#000"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vault</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.boundaryproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M44.83 125.83v-8.27h17.18v-5.11h-8.33v-8.32h39.33L74.74 72.49l18.27-31.65H52.7v43.89H31V19.15h74.67l12.46 21.58L99.8 72.49l18.7 32.4-12.09 20.94H44.83z" fill="#F24C53"/><path d="M48.17 104.131h-8.32v8.32h8.32v-8.32zM39.32 117.5H31v8.32h8.32v-8.32z" fill="#F24C53"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">boundary</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Applications</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.nomadproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72 14L21.77 43v58L72 130l50.23-29V43L72 14zm22.38 63.78L81 85.51l-16.17-8.8v18.48l-15.2 9.64V66.19l12.06-7.38 16.73 8.82V48.76l16-9.59-.04 38.61z" fill="#00CA8E"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">nomad</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.waypointproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M143.228 27.66l-17.79 30.81-17.79-30.81h35.58zM48.26 48.23H36.39l29.67 51.4-11.87 20.56L.77 27.66h59.36l29.68 51.41 5.93-10.28L72 27.66h23.74l11.88 20.57 11.87 20.56-29.68 51.4-41.55-71.96z" fill="#14C6CB"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">waypoint</span></a></li></ul></li></menu><menu class="stack-menu-section_stackMenuSectionPlusDivider__1BPy6 stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">HashiCorp Cloud Platform</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://cloud.hashicorp.com/" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72.53 128.7a54.787 54.787 0 01-45.258-23.85 54.784 54.784 0 019.368-72.355 54.78 54.78 0 0172.95 1.125l-13 13.6a36 36 0 100 53.43l13 13.6a54.638 54.638 0 01-37.06 14.45zm44.081-27.401a4.49 4.49 0 114.49-4.49 4.5 4.5 0 01-4.49 4.49z" fill="#E03875"/><path d="M72.18 85.79A11.87 11.87 0 1184 73.93a11.88 11.88 0 01-11.82 11.86zm49.58.21a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.495 4.495 0 012.772 4.148 4.503 4.503 0 01-4.49 4.49zm-13.35-.56a4.488 4.488 0 01-4.4-5.385 4.487 4.487 0 013.555-3.515 4.49 4.49 0 11.845 8.9zm13.35-14.57a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.496 4.496 0 012.772 4.149 4.503 4.503 0 01-4.49 4.49zm-13.35.51a4.493 4.493 0 01-4.148-2.772 4.491 4.491 0 114.148 2.771zm8.461-15.61a4.49 4.49 0 11-.02-8.981 4.49 4.49 0 01.02 8.981z" fill="#E03875"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">consul</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://app.terraform.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M55.522 32.97l32.96 19.02v38.06l-32.96-19.03V32.97zM92.09 51.99v38.06l32.95-19.03V32.97L92.09 51.99zM18.96 11.73v38.05l32.95 19.03V30.76L18.96 11.73zm36.562 101.51l32.95 19.03V94.22l-32.95-19.03v38.05z" fill="#7B42BC"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">terraform</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://cloud.hashicorp.com/" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.88 21.15L71.8 131.4l55.321-110.25H16.881zm61.46 22.12h6.39v6.4h-6.39v-6.4zM65.61 68.84h-6.39v-6.39h6.39v6.39zm0-9.59h-6.39v-6.39h6.39v6.39zm0-9.58h-6.39v-6.4h6.39v6.4zm9.59 28.76h-6.4V72h6.4v6.43zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.58h-6.4v-6.4h6.4v6.4zm3.14 3.19h6.39v6.39h-6.39v-6.39zm0 16v-6.41h6.39v6.39l-6.39.02z" fill="#000"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vault</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Partner Services</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a class="stack-item_itemLink__G2Qmk" href="https://www.hashicorp.com/products/consul/service-on-azure"><span class="stack-item_itemName__1cUxR g-type-body-small-strong">HashiCorp Consul Service (HCS) on Azure</span></a></li></ul></li></menu></section></li></ul></nav></header><nav class="g-subnav" aria-label="vault website navigation"><div class="constrain-width-wrapper  g-grid-container"><div class="g-subnav-inner style_vault__1OYha is-constrained" data-overflow-target="true"><a href="/" data-testid="a-raw" class="title-link brand-vault " title="vault"><div data-testid="root"><svg width="208" height="88" viewBox="0 0 208 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M114.849 23.69h7.92L110.699 64h-11.25l-12-40.28h7.92l9.74 33.57 9.74-33.6zM144.75 64h-6l-.55-2a16.12 16.12 0 01-8.77 2.6c-5.38 0-7.68-3.69-7.68-8.77 0-6 2.6-8.29 8.59-8.29h7.08v-3.1c0-3.27-.91-4.42-5.63-4.42a40.71 40.71 0 00-8.16.91l-.91-5.63a38.678 38.678 0 0110.1-1.39c9.25 0 12 3.27 12 10.65L144.75 64zm-7.37-11.13h-5.45c-2.42 0-3.08.67-3.08 2.91 0 2 .66 3 3 3a11.72 11.72 0 005.57-1.51l-.04-4.4zm18.992-18.35v20.56c0 1.57.66 2.36 2.36 2.36 1.7 0 5-1.09 7.68-2.48V34.52h7.38V64h-5.63l-.72-2.48a29.437 29.437 0 01-11.8 3.09c-4.9 0-6.65-3.45-6.65-8.71V34.52h7.38zM177.719 64V22.48l7.38-1V64h-7.38zm29.388-.57a20.618 20.618 0 01-6.47 1.15c-5.38 0-8.11-2.54-8.11-7.8v-16.4h-4.41v-5.86h4.41V27.2l7.38-1v8.35h7.56l-.48 5.86h-7.08v15.4a2.323 2.323 0 001.596 2.514c.344.11.708.14 1.064.085a13.919 13.919 0 003.69-.61l.85 5.63zM0 12.6l31.85 63.92L63.92 12.6H0zm35.63 12.83h3.71v3.71h-3.71v-3.71zm-7.38 14.82h-3.7v-3.7h3.7v3.7zm0-5.56h-3.7V31h3.7v3.69zm0-5.55h-3.7v-3.71h3.7v3.71zm5.6 16.67h-3.7V42.1h3.7v3.71zm0-5.56h-3.7v-3.7h3.7v3.7zm0-5.56h-3.7V31h3.7v3.69zm0-5.55h-3.7v-3.71h3.7v3.71zM35.63 31h3.71v3.7h-3.71V31zm0 9.26v-3.7h3.71v3.7h-3.71z" fill="#000"/></svg></div></a><ul class="menu-items-default menu-items-align-right"><li><a href="/" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Overview</span></a></li><li><button class="dropdown-trigger g-type-body-small-strong brand-vault style-menu-item is-collapsed"><span class="text brand-vault">Use Cases</span><div data-testid="root"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9l6 6 6-6" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></button><ul class="submenu-modal style-dropdown is-collapsed"><li><a href="/use-cases/secrets-management" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Secrets Management</span></a></li><li><a href="/use-cases/data-encryption" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Data Encryption</span></a></li><li><a href="/use-cases/identity-based-access" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Identity-based Access</span></a></li></ul></li><li><a href="https://www.hashicorp.com/products/vault/enterprise" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Enterprise</span></a></li><li><span class="vertical-divider"></span></li><li><a href="https://learn.hashicorp.com/vault" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Tutorials</span></a></li><li><a href="/docs" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Docs</span></a></li><li><a href="/api-docs" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">API</span></a></li><li><a href="/community" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Community</span></a></li></ul><div class="cta-links "><a href="https://www.github.com/hashicorp/vault" class="github-button"><span class="github"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg><span class="hidden-text">GitHub</span></span></a><a class="g-btn size-small variant-secondary style_vault__1OYha background-light" data-ga-button="try-cloud" href="https://portal.cloud.hashicorp.com/sign-up?utm_source=vault_io&amp;utm_content=top_nav_vault"><span class="text g-type-buttons-and-standalone-links">Try Cloud</span></a><a class="g-btn size-small variant-primary style_vault__1OYha background-light" data-ga-button="download" href="/downloads"><span class="icon at-left is-animated" data-animation="download"><div data-testid="root"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Download icon</title><path d="M3 17v3a2 2 0 002 2h14a2 2 0 002-2v-3" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path data-animation-target="true" d="M8 12l4 4m0 0l4-4m-4 4V2" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></span><span class="text g-type-buttons-and-standalone-links">Download</span></a></div></div></div></nav><div id="p-docs"><div class="content-wrap g-grid-container"><div id="sidebar" role="complementary"><div class="nav docs-nav"><div class="g-docs-sidenav style_root__-H22M style_vault__1OYha"><button class="style_mobileMenuToggle__2iMJX g-type-body-small-strong"><span><div><svg width="20" height="20" fill="none"><path fill="#000" fill-rule="evenodd" d="M3.083 14.411a.847.847 0 00-.267-.183.863.863 0 00-.483-.042c-.05.008-.109.025-.159.042a1.245 1.245 0 00-.266.183 1.01 1.01 0 00-.184.267.864.864 0 00-.058.325c0 .05 0 .108.017.158a.88.88 0 00.041.159c.025.05.05.1.084.141.025.05.066.092.1.125.041.042.082.075.125.108.05.025.091.059.141.075.05.017.109.034.159.05.058.009.107.017.166.017a.829.829 0 00.584-.25.534.534 0 00.108-.125c.025-.042.058-.091.075-.142.025-.05.042-.1.05-.158a1.06 1.06 0 00.017-.158.872.872 0 00-.067-.325.729.729 0 00-.183-.267zm0-5a.846.846 0 00-.267-.183.863.863 0 00-.483-.042 1.11 1.11 0 00-.159.042 1.252 1.252 0 00-.266.183.821.821 0 00-.242.592c0 .108.017.216.058.316a1.01 1.01 0 00.309.375c.05.025.091.05.141.075.05.017.109.034.159.05.058.009.107.017.166.017a.829.829 0 00.584-.25.83.83 0 00.25-.583.871.871 0 00-.067-.325.729.729 0 00-.183-.267zm0-5a.795.795 0 00-.75-.225 1.11 1.11 0 00-.159.042 1.255 1.255 0 00-.266.183.835.835 0 00-.242.592c0 .108.017.217.058.317a1.01 1.01 0 00.309.375c.05.025.091.05.141.075.05.016.109.033.159.05.058.008.107.016.166.016a.83.83 0 00.584-.25.83.83 0 00.25-.583.906.906 0 00-.067-.325.729.729 0 00-.183-.267zm14.414 9.756H6.663a.833.833 0 100 1.667h10.834a.833.833 0 100-1.667zm0-5H6.663a.833.833 0 100 1.667h10.834a.833.833 0 100-1.667zM18.33 5c0 .46-.372.834-.833.834H6.663a.833.833 0 110-1.667h10.834c.46 0 .833.372.833.833z" clip-rule="evenodd"/></svg></div> Documentation Menu</span></button><button type="button" aria-label="Show Search Bar" class="style_searchToggle__226HK"><div><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8.75 15a6.25 6.25 0 100-12.5 6.25 6.25 0 000 12.5z" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.5 17.5l-4.333-4.333" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></button><ul class="style_rootList__1pfEP" data-is-mobile-hidden="true" data-is-mobile-open="false"><button class="style_mobileClose__3BcsD">×</button><input class="style_filterInput__4ecGq" placeholder="Filter..." value=""/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/getting-started/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Getting Started</span></a></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Vault Operations</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/reference-architecture/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Reference Architecture</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/vault-ha-consul/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault HA with Consul</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/production/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Production Hardening</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/generate-root/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Root Token Generation</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/rekeying-and-rotating/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Rekeying & Rotating</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/plugin-backends/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Building Plugin Backends</span></a></li><hr class="style_divider__3H9xA"/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/replication/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Replication Setup & Guidance</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/disaster-recovery/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Disaster Recovery Setup</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/mount-filter/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Mount Filter</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/multi-tenant/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Multi-Tenant: Namespaces</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/autounseal-aws-kms/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Auto-unseal with AWS KMS</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/seal-wrap/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Seal Wrap / FIPS 140-2</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/monitoring/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Cluster Monitoring</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/deployment-guide/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Deployment Guide</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/performance-nodes/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Performance Standby Nodes</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Identity and Access Management</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/secure-intro/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Secure Introduction of Vault Clients</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/policies/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Policies</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/policy-templating/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>ACL Policy Path Templating</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/authentication/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>AppRole Pull Authentication</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/approle-trusted-entities/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>AppRole with Terraform and Chef</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/lease/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Tokens and Leases</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/identity/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Identity - Entities & Groups</span></a></li><hr class="style_divider__3H9xA"/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/sentinel/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Sentinel Policies</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/control-groups/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Control Groups</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Secrets Management</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/static-secrets/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Static Secrets</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/versioned-kv/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Versioned KV Secret Engine</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/dynamic-secrets/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Secret as a Service</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/db-root-rotation/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>DB Root Credential Rotation</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/cubbyhole/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Cubbyhole Response Wrapping</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/ssh-otp/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>One-Time SSH Password</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/pki-engine/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Build Your Own CA</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/app-integration/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Direct Application Integration</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Encryption as a Service</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/transit/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Encryption as a Service</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/spring-demo/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Java Application Demo</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/transit-rewrap/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Transit Secrets Re-wrapping</span></a></li></ul></li></ul></div></div></div><div id="inner" role="main" class=""><article class="g-content g-type-long-body style_vault__1OYha"><div class="g-search"><label id="search-box-label" for="search-box" class="visually-hidden">Search Vault documentation</label><div class="c-search-box"><form novalidate="" action="" role="search"><input type="search" id="search-box" class="g-type-body-strong" placeholder="Search Vault documentation" autoComplete="off" autoCorrect="off" autoCapitalize="off" spellcheck="false" maxLength="512" required="" value="" aria-autocomplete="list" aria-controls="search-results" aria-activedescendant="" data-heap-track="SearchBox"/><button type="submit" title="Submit your search query." class="btn-submit"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8.75 15a6.25 6.25 0 100-12.5 6.25 6.25 0 000 12.5z" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.5 17.5l-4.333-4.333" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button><button type="reset" title="Clear the search query." class="btn-reset"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.915 1.077h13.684v13.684H1.915z"/><path d="M1.915 1.077l13.683 13.684M1.915 14.76L15.598 1.078" stroke="var(--gray-3)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><div class="icon-loading"><svg width="18" height="18" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#444"><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".5" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18" transform="rotate(296.263 18 18)"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform></path></g></g></svg></div><svg class="icon-slash" width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img"><title>Type &#x27;/&#x27; to Search</title><rect x=".5" y=".5" width="23" height="23" rx=".5" stroke="var(--gray-3)"></rect><path d="M9 18l6-12" stroke="var(--gray-3)" stroke-width="1.5"></path></svg></form></div></div><h1 class="g-type-display-2"><a class="__permalink-h" href="#vault-approle-with-terraform-and-chef-demo" aria-label="vault approle with terraform and chef demo permalink">»</a><a class="__target-h" id="vault-approle-with-terraform-and-chef-demo" aria-hidden=""></a>Vault AppRole with Terraform and Chef Demo</h1><p class="g-type-long-body">In the <a href="/guides/identity/authentication#advanced-features">AppRole Pull
Authentication</a> guide,
the question of how best to deliver the Role ID and Secret ID were brought up,
and the role of trusted entities (Terraform, Chef, Nomad, Kubernetes, etc.) was
mentioned.</p><p class="g-type-long-body"><img src="/img/vault-approle-workflow2.png" alt="AppRole auth method workflow"/></p><p class="g-type-long-body">This <em>intermediate</em> Vault guide aims to provide a <strong>simple</strong>, <strong>end-to-end</strong>
example of how to use Vault&#x27;s <a href="/docs/auth/approle">AppRole authentication
method</a>, along with Terraform and Chef, to address the
challenge of the <strong><em>secure introduction</em></strong> of an initial token to a target
system.</p><p class="g-type-long-body">The purpose of this guide is to provide the instruction to reproduce the working
implementation demo introduced in the <a href="https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef">Delivering Secret Zero: Vault AppRole
with Terraform and
Chef</a>
webinar.</p><p class="g-type-long-body"><a href="https://youtu.be/OIcIzFWjThM"><img src="/img/vault-approle-youtube.png" alt="YouTube"/></a></p><div class="alert alert-info g-type-body" role="alert"><p class="g-type-long-body"><strong>NOTE:</strong> This is a proof of concept and <strong>NOT SUITABLE FOR PRODUCTION USE</strong>.</p></div><h2 class="g-type-display-3"><a class="__permalink-h" href="#reference-material" aria-label="reference material permalink">»</a><a class="__target-h" id="reference-material" aria-hidden=""></a>Reference Material</h2><ul><li class="g-type-long-body"><a href="/docs/auth/approle">AppRole Auth Method</a></li><li class="g-type-long-body"><a href="https://www.hashicorp.com/blog/authenticating-applications-with-vault-approle">Authenticating Applications with HashiCorp Vault AppRole</a></li><li class="g-type-long-body"><a href="https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef">Delivering Secret Zero: Vault AppRole with Terraform and
Chef</a></li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#estimated-time-to-complete" aria-label="estimated time to complete permalink">»</a><a class="__target-h" id="estimated-time-to-complete" aria-hidden=""></a>Estimated Time to Complete</h2><p class="g-type-long-body">20 minutes</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#challenge" aria-label="challenge permalink">»</a><a class="__target-h" id="challenge" aria-hidden=""></a>Challenge</h2><p class="g-type-long-body">The goal of the AppRole authentication method is to provide a mechanism for the
secure introduction of secrets to target systems (servers, applications,
containers, etc.).</p><p class="g-type-long-body">The question becomes what systems within our environment do we trust to handle
or deliver the <code>RoleID</code> and <code>SecretID</code> to our target systems.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#solution" aria-label="solution permalink">»</a><a class="__target-h" id="solution" aria-hidden=""></a>Solution</h2><p class="g-type-long-body">Use <em>Trusted Entities</em> to deliver the AppRole authentication values. For
example, use Terraform to deliver your <code>RoleID</code> or embed it into your AMI or
Dockerfile. Then you might use Jenkins or Chef to obtain the
<a href="/guides/secret-mgmt/cubbyhole">response-wrapped</a> <code>SecretID</code> and deliver it
to the target system.</p><p class="g-type-long-body">AppRole allows us to securely introduce the authentication token to the target
system by preventing any single system from having full access to an
authentication token that does not belong to. This helps us maintain the
security principles of <strong>least privilege</strong> and <strong>non-repudiation</strong>.</p><p class="g-type-long-body">The important thing to note here is that regardless of what systems are
considered as <em>Trusted Entities</em>, the same pattern applies.</p><p class="g-type-long-body">For example:</p><ul><li class="g-type-long-body">With Chef, you might use the <a href="https://github.com/hashicorp/vault-ruby">Vault Ruby Gem</a>
for simplified interaction with Vault APIs</li><li class="g-type-long-body">Terraform provides a Vault provider: <a href="https://www.terraform.io/docs/providers/vault/index.html">Provider: Vault - Terraform by HashiCorp</a></li><li class="g-type-long-body">For Jenkins, you might use the Vault CLI or APIs directly, as described here:
<a href="http://nicolas.corrarello.com/general/vault/security/ci/2017/04/23/Reading-Vault-Secrets-in-your-Jenkins-pipeline.html">Reading Vault Secrets in your Jenkins pipeline</a></li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#prerequisites" aria-label="prerequisites permalink">»</a><a class="__target-h" id="prerequisites" aria-hidden=""></a>Prerequisites</h2><p class="g-type-long-body">This guide assumes that you are proficient enough to perform basic Terraform
tasks. If you are not familiar with Terraform, refer to the <a href="https://www.terraform.io/intro/getting-started/install.html">online
documentation</a>.</p><p class="g-type-long-body">The following AWS resources are required to perform this demo:</p><ul><li class="g-type-long-body">An <a href="https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html">Amazon S3 bucket</a></li><li class="g-type-long-body">An <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_change-permissions.html">IAM user credential with administrator permissions</a>
(to be able to create additional IAM policies and instance profiles)</li></ul><h3 class="g-type-display-4"><a class="__permalink-h" href="#download-demo-assets" aria-label="download demo assets permalink">»</a><a class="__target-h" id="download-demo-assets" aria-hidden=""></a>Download demo assets</h3><p class="g-type-long-body">Clone or download the demo assets from the
<a href="https://github.com/hashicorp/vault-guides/tree/master/identity/vault-chef-approle">hashicorp/vault-guides</a>
GitHub repository to perform the steps described in this guide.</p><p class="g-type-long-body">The following assets can be found in the repository:</p><ul><li class="g-type-long-body">Chef cookbook (<strong><code>/chef/cookbooks</code></strong>): A sample cookbook with a recipe that installs NGINX
and demonstrates Vault Ruby Gem functionality used to interact with Vault APIs.</li><li class="g-type-long-body">Terraform configurations (<strong><code>/terraform-aws</code></strong>):<ul><li class="g-type-long-body"><strong><code>/terraform-aws/mgmt-node</code></strong>: Configuration to set up a management
server running both Vault and Chef Server, for demo purposes.</li><li class="g-type-long-body"><strong><code>/terraform-aws/chef-node</code></strong>: Configuration to set up a Chef node and
bootstrap it with the Chef Server, passing in Vault&#x27;s AppRole RoleID and the
appropriate Chef run-list.</li></ul></li><li class="g-type-long-body">Vault configuration (<strong><code>/scripts</code></strong>): Data scripts used to configure the
appropriate mounts and policies in Vault for this demo.</li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#steps" aria-label="steps permalink">»</a><a class="__target-h" id="steps" aria-hidden=""></a>Steps</h2><p class="g-type-long-body">The scenario in this guide uses Terraform and Chef as trusted entities to
deliver <code>RoleID</code> and <code>SecretID</code>.</p><p class="g-type-long-body"><img src="/img/vault-approle-tf-chef.png" alt="AppRole auth method workflow"/></p><p class="g-type-long-body">For the simplicity of the demonstration, both Vault and Chef are installed on
the same node. Terraform provisions the node which contains the <code>RoleID</code> as an
environment variable. Chef pulls the <code>SecretID</code> from Vault.</p><p class="g-type-long-body">Provisioning for this demo happens in 2 phases:</p><ul><li class="g-type-long-body"><a href="#phase1">Phase 1 - Provision our Vault plus Chef Server</a><ul><li class="g-type-long-body"><a href="#step-1-provision-the-vault-and-chef-server">Step 1: Provision the Vault and Chef Server</a></li><li class="g-type-long-body"><a href="#step-2-initialize-and-unseal-vault">Step 2: Initialize and Unseal Vault</a></li><li class="g-type-long-body"><a href="#step-3-approle-setup">Step 3: AppRole Setup</a></li><li class="g-type-long-body"><a href="#step-4-configure-tokens-for-terraform-and-chef">Step 4: Configure Tokens for Terraform and Chef</a></li><li class="g-type-long-body"><a href="#step-5-save-the-token-in-a-chef-data-bag">Step 5: Save the Token in a Chef Data Bag</a></li><li class="g-type-long-body"><a href="#step-6-write-secrets">Step 6: Write Secrets</a></li></ul></li><li class="g-type-long-body"><a href="#phase2">Phase 2 - Provision our Chef Node to Show AppRole Login</a></li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#phase1" aria-label="phase 1 provision our vault chef server permalink">»</a><a class="__target-h __compat" id="phase1" aria-hidden=""></a><a class="__target-h" id="phase-1-provision-our-vault-chef-server" aria-hidden=""></a>Phase 1: Provision our Vault &amp; Chef Server</h2><h3 class="g-type-display-4"><a class="__permalink-h" href="#step-1-provision-the-vault-and-chef-server" aria-label="step 1 provision the vault and chef server permalink">»</a><a class="__target-h" id="step-1-provision-the-vault-and-chef-server" aria-hidden=""></a>Step 1: Provision the Vault and Chef Server</h3><p class="g-type-long-body">This provides a quick and simple Vault and Chef Server configuration to help you
get started.</p><p class="g-type-long-body"><strong>NOTE:</strong> This is done for demonstration purpose and <strong>NOT a recommended
practice</strong> for production.</p><p class="g-type-long-body">In this phase, you use Terraform to spin up a server (and associated AWS
resources) with both Vault and Chef Server installed. Once this server is up and
running, you&#x27;ll complete the appropriate configuration steps in Vault to set up
our AppRole and tokens for use in the demo.</p><div class="alert alert-warning g-type-body" role="alert"><p class="g-type-long-body">If using <em>Terraform Enterprise</em>, <a href="https://www.terraform.io/docs/enterprise/getting-started/workspaces.html">create a
Workspace</a>
for this repo and set the appropriate Terraform/Environment variables using the
<code>terraform.tfvars.example</code> file as a reference. Follow the instructions in the
documentation to perform the appropriate setup in Terraform Enterprise.</p></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#using-terraform-open-source" aria-label="using terraform open source permalink">»</a><a class="__target-h" id="using-terraform-open-source" aria-hidden=""></a>Using Terraform Open Source:</h4><p class="g-type-long-body"><strong>Task 1:</strong> Change the working directory (<code>cd</code>) to
<code>identity/vault-chef-approle/terraform-aws/mgmt-node</code>.</p><div class="g-code-block style_root__3eDLf language-shell style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token builtin class-name">.</span>
<!-- -->├── main.tf<!-- -->
<!-- -->├── outputs.tf<!-- -->
<!-- -->├── templates<!-- -->
<!-- -->│   └── userdata-mgmt-node.tpl<!-- -->
<!-- -->├── terraform.tfvars.example<!-- -->
<!-- -->└── variables.tf<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell"><code class="style_code__2AMYw language-shell"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token builtin class-name">.</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── main.tf</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── outputs.tf</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── templates</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">│   └── userdata-mgmt-node.tpl</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── terraform.tfvars.example</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">└── variables.tf</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>Task 2:</strong> Update the <code>terraform.tfvars.example</code> file to match your account and
rename it to <code>terraform.tfvars</code>.</p><p class="g-type-long-body">At minimum, replace the following variable with appropriate values:</p><ul><li class="g-type-long-body"><strong><code>s3_bucket_name</code></strong></li><li class="g-type-long-body"><strong><code>vpc_id</code></strong></li><li class="g-type-long-body"><strong><code>subnet_id</code></strong></li><li class="g-type-long-body"><strong><code>key_name</code></strong></li><li class="g-type-long-body"><strong><code>ec2_pem</code></strong></li></ul><blockquote><p class="g-type-long-body">NOTE: If your VPC, subnet and EC2 key pair were created on a region other than
<code>us-east-1</code>, be sure to set the <strong><code>aws_region</code></strong> value to match your chosen region.</p></blockquote><p class="g-type-long-body"><strong>Task 3:</strong> Perform a <code>terraform init</code> to pull down the necessary provider resources.
Then <code>terraform plan</code> to verify your changes and the resources that will be
created. If all looks good, then perform a <code>terraform apply</code> to provision the
resources. The Terraform output will display the public IP address to SSH into
your server.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform init</span></span>
<span class="token output">Initializing provider plugins...</span>
<span class="token output">...</span>
<span class="token output">Terraform has been successfully initialized!</span>
<!-- -->
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform plan</span></span>
<span class="token output">...</span>
<span class="token output">Plan: 5 to add, 0 to change, 0 to destroy.</span>
<!-- -->
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform apply</span></span>
<span class="token output">...</span>
<span class="token output">Apply complete! Resources: 5 added, 0 changed, 0 destroyed.</span>
<!-- -->
<span class="token output">Outputs:</span>
<span class="token output">vault-public-ip = 192.0.2.0</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform init</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Initializing provider plugins...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Terraform has been successfully initialized!</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform plan</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Plan: 5 to add, 0 to change, 0 to destroy.</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform apply</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Apply complete! Resources: 5 added, 0 changed, 0 destroyed.</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Outputs:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">vault-public-ip = 192.0.2.0</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The Terraform output will display the public IP address to SSH into
your server.</p><p class="g-type-long-body">For example:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">ssh</span> -i <span class="token string">&quot;/path/to/EC2/private_key.pem&quot;</span> ubuntu@192.0.2.0</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">ssh</span> -i <span class="token string">&quot;/path/to/EC2/private_key.pem&quot;</span> ubuntu@192.0.2.0</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>Task 4:</strong> Initial setup of the Chef server takes several minutes. Once you can
SSH into your mgmt server, run <code>tail -f /var/log/tf-user-data.log</code> to see when
the initial configuration is complete.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">tail</span> -f /var/log/tf-user-data.log</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">tail</span> -f /var/log/tf-user-data.log</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">When you see the following message, the initial setup is complete.</p><div class="g-code-block style_root__3eDLf language-plaintext style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">+ echo &#x27;2018/03/27 21:53:06 /var/lib/cloud/instance/scripts/part-001: Complete&#x27;<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-plaintext"><code class="style_code__2AMYw language-plaintext"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">+ echo &#x27;2018/03/27 21:53:06 /var/lib/cloud/instance/scripts/part-001: Complete&#x27;</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">You can find the following subfolders in
your home directory:</p><ul><li class="g-type-long-body"><strong><code>/home/ubuntu/vault-chef-approle-demo</code></strong>: root of our project</li><li class="g-type-long-body"><strong><code>/home/ubuntu/vault-chef-approle-demo/chef</code></strong>: root of our Chef app; this is
where our <code>knife</code> configuration is located (<code>.chef/knife.rb</code>)</li><li class="g-type-long-body"><strong><code>/home/ubuntu/vault-chef-approle-demo/scripts</code></strong>: there&#x27;s a
<code>vault-approle-setup.sh</code> script located here to help automate the setup of
Vault, or you can follow along in the rest of this README to configure Vault
manually</li></ul><h3 class="g-type-display-4"><a class="__permalink-h" href="#step-2-initialize-and-unseal-vault" aria-label="step 2 initialize and unseal vault permalink">»</a><a class="__target-h" id="step-2-initialize-and-unseal-vault" aria-hidden=""></a>Step 2: Initialize and Unseal Vault</h3><p class="g-type-long-body">Before moving on, set your working environment variables in your mgmt server:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://127.0.0.1:8200</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_SKIP_VERIFY</span><span class="token operator">=</span>true</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://127.0.0.1:8200</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_SKIP_VERIFY</span><span class="token operator">=</span>true</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Before you can do anything in Vault, you need to initialize and unseal it.
Perform <strong><em>one</em></strong> of the following:</p><ul><li class="g-type-long-body"><strong>Option 1:</strong> Run the <code>/home/ubuntu/demo_setup.sh</code> script to get up and running, and proceed to
<a href="#phase2">Phase 2 - Provision our Chef Node to Show AppRole Login</a>.</li><li class="g-type-long-body"><strong>Option 2:</strong> Continue onto <a href="#step-3-approle-setup">Step 3: AppRole Setup</a> to
set up the demo environment <strong><em>manually</em></strong>.</li></ul><h3 class="g-type-display-4"><a class="__permalink-h" href="#step-3-approle-setup" aria-label="step 3 approle setup permalink">»</a><a class="__target-h" id="step-3-approle-setup" aria-hidden=""></a>Step 3: AppRole Setup</h3><p class="g-type-long-body">First, initialize and unseal the Vault server using a shortcut.</p><div class="alert alert-warning g-type-body" role="alert"><p class="g-type-long-body">This is a convenient shortcut for demo. <strong><em>DO NOT DO THIS IN PRODUCTION!!!</em></strong></p></div><p class="g-type-long-body">Refer to the <a href="/intro/getting-started/deploy#initializing-the-vault">online documentation for initializing and unsealing</a> Vault for more details.</p><div class="g-code-block style_root__3eDLf language-shell style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Initialize the Vault server and write out the unseal keys and root token into files</span>
<!-- -->$ <span class="token function">curl</span> --silent<!-- -->
<!-- -->       --request PUT <span class="token punctuation">\</span>
<!-- -->       --data <span class="token string">&#x27;{&quot;secret_shares&quot;: 1, &quot;secret_threshold&quot;: 1}&#x27;</span> <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">${VAULT_ADDR}</span>/v1/sys/init <span class="token operator">|</span> <span class="token function">tee</span> <span class="token punctuation">\</span>
<!-- -->       <span class="token operator">&gt;</span><span class="token punctuation">(</span>jq -r .root_token <span class="token operator">&gt;</span> /home/ubuntu/vault-chef-approle-demo/root-token<span class="token punctuation">)</span> <span class="token punctuation">\</span>
<!-- -->       <span class="token operator">&gt;</span><span class="token punctuation">(</span>jq -r .keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> /home/ubuntu/vault-chef-approle-demo/unseal-key<span class="token punctuation">)</span>
<!-- -->
<span class="token comment"># Unseal vault</span>
<!-- -->$ vault operator unseal <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /home/ubuntu/vault-chef-approle-demo/unseal-key<span class="token variable">)</span></span>
<!-- -->
<span class="token comment"># Set the root token to VAULT_TOKEN env var</span>
<!-- -->$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /home/ubuntu/vault-chef-approle-demo/root-token<span class="token variable">)</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell"><code class="style_code__2AMYw language-shell"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Initialize the Vault server and write out the unseal keys and root token into files</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request PUT <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data <span class="token string">&#x27;{&quot;secret_shares&quot;: 1, &quot;secret_threshold&quot;: 1}&#x27;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">${VAULT_ADDR}</span>/v1/sys/init <span class="token operator">|</span> <span class="token function">tee</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token operator">&gt;</span><span class="token punctuation">(</span>jq -r .root_token <span class="token operator">&gt;</span> /home/ubuntu/vault-chef-approle-demo/root-token<span class="token punctuation">)</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token operator">&gt;</span><span class="token punctuation">(</span>jq -r .keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> /home/ubuntu/vault-chef-approle-demo/unseal-key<span class="token punctuation">)</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Unseal vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault operator unseal <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /home/ubuntu/vault-chef-approle-demo/unseal-key<span class="token variable">)</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Set the root token to VAULT_TOKEN env var</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /home/ubuntu/vault-chef-approle-demo/root-token<span class="token variable">)</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">In the next few steps, you will create a number of policies and tokens within
Vault. Below is a table that summarizes them:</p><table><thead><tr><th>Policy</th><th>Description</th><th>Token Attachment</th></tr></thead><tbody><tr><td><code>app-1-secret-read</code></td><td>Sets the policy for the final token that will be delivered via the AppRole login</td><td>None. This will be delivered to the client upon AppRole login</td></tr><tr><td><code>app-1-approle-roleid-get</code></td><td>Sets the policy for the token that you&#x27;ll give to Terraform to deliver the RoleID (only)</td><td><code>roleid-token</code></td></tr><tr><td><code>terraform-token-create</code></td><td>The Terraform Vault provider doesn&#x27;t use the token supplied to it directly. This is to prevent the token from being exposed in Terraform&#x27;s state file. Instead, the Token given to Terraform needs to have the capability to create child tokens with short TTLs. See <a href="https://www.terraform.io/docs/providers/vault/index.html#token">here</a> for more info</td><td><code>roleid-token</code></td></tr><tr><td><code>app-1-approle-secretid-create</code></td><td>Sets the policy for the token that you&#x27;ll store in the Chef Data Bag. This will only be able to pull our AppRole&#x27;s SecretID</td><td><code>secretid-token</code></td></tr></tbody></table><p class="g-type-long-body">These setups only need to be performed upon initial creation of an AppRole, and
would typically be done by a Vault administrator.</p><p class="g-type-long-body">Now that you have your Vault server unsealed, you can begin to set up necessary
policies, AppRole auth method, and tokens.</p><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-1-set-up-our-approle-policy" aria-label="task 1 set up our approle policy permalink">»</a><a class="__target-h" id="task-1-set-up-our-approle-policy" aria-hidden=""></a>Task 1: Set up our AppRole policy</h4><p class="g-type-long-body">This is the policy that will be attached to <em>secret zero</em> which you are
delivering to our application (<strong>app-1</strong>).</p><p class="g-type-long-body"><strong>API call using cURL</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Policy to apply to AppRole token</span>
<!-- -->$ <span class="token function">tee</span> app-1-secret-read.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>secret/app-1<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>read<span class="token entity" title="\&quot;">\&quot;</span>, <span class="token entity" title="\&quot;">\&quot;</span>list<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-secret-read policy in Vault</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request PUT <span class="token punctuation">\</span>
<!-- -->       --data @app-1-secret-read.json <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/app-1-secret-read<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy to apply to AppRole token</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> app-1-secret-read.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>secret/app-1<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>read<span class="token entity" title="\&quot;">\&quot;</span>, <span class="token entity" title="\&quot;">\&quot;</span>list<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-secret-read policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request PUT <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @app-1-secret-read.json <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/app-1-secret-read</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>CLI command</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Policy to apply to AppRole token</span>
<!-- -->$ <span class="token function">tee</span> app-1-secret-read.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">path &quot;secret/app-1&quot; {</span>
<span class="token string">  capabilities = [&quot;read&quot;, &quot;list&quot;]</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-secret-read policy in Vault</span>
<!-- -->$ vault policy <span class="token function">write</span> app-1-secret-read app-1-secret-read.hcl<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy to apply to AppRole token</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> app-1-secret-read.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">path &quot;secret/app-1&quot; {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  capabilities = [&quot;read&quot;, &quot;list&quot;]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-secret-read policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault policy <span class="token function">write</span> app-1-secret-read app-1-secret-read.hcl</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-2-enable-the-approle-authentication-method" aria-label="task 2 enable the approle authentication method permalink">»</a><a class="__target-h" id="task-2-enable-the-approle-authentication-method" aria-hidden=""></a>Task 2: Enable the AppRole authentication method</h4><p class="g-type-long-body"><strong>API call using cURL</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Payload for invoking sys/auth API endpoint</span>
<!-- -->$ <span class="token function">tee</span> approle.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{</span>
<span class="token string">  &quot;type&quot;: &quot;approle&quot;,</span>
<span class="token string">  &quot;description&quot;: &quot;Demo AppRole auth method&quot;</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Enable AppRole auth backend</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request POST <span class="token punctuation">\</span>
<!-- -->       --data @approle.json <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/sys/auth/approle<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Payload for invoking sys/auth API endpoint</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> approle.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;type&quot;: &quot;approle&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;description&quot;: &quot;Demo AppRole auth method&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Enable AppRole auth backend</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request POST <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @approle.json <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/sys/auth/approle</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>CLI command</strong></p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault auth <span class="token builtin class-name">enable</span> -description<span class="token operator">=</span><span class="token string">&quot;Demo AppRole auth method&quot;</span> approle</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault auth <span class="token builtin class-name">enable</span> -description<span class="token operator">=</span><span class="token string">&quot;Demo AppRole auth method&quot;</span> approle</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-3-configure-the-approle" aria-label="task 3 configure the approle permalink">»</a><a class="__target-h" id="task-3-configure-the-approle" aria-hidden=""></a>Task 3: Configure the AppRole</h4><p class="g-type-long-body">Now, you are going to create an AppRole role named, <strong>app-1</strong>.</p><p class="g-type-long-body"><strong>API call using cURL</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Payload containing AppRole auth method configuration</span>
<span class="token comment"># TTL is set to 10 minutes, and Max TTL to be 30 minutes</span>
<!-- -->$ <span class="token function">tee</span> app-1-approle-role.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{</span>
<span class="token string">    &quot;role_name&quot;: &quot;app-1&quot;,</span>
<span class="token string">    &quot;bind_secret_id&quot;: true,</span>
<span class="token string">    &quot;secret_id_ttl&quot;: &quot;10m&quot;,</span>
<span class="token string">    &quot;secret_id_num_uses&quot;: &quot;1&quot;,</span>
<span class="token string">    &quot;token_ttl&quot;: &quot;10m&quot;,</span>
<span class="token string">    &quot;token_max_ttl&quot;: &quot;30m&quot;,</span>
<span class="token string">    &quot;period&quot;: 0,</span>
<span class="token string">    &quot;policies&quot;: [</span>
<span class="token string">        &quot;app-1-secret-read&quot;</span>
<span class="token string">    ]</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># AppRole backend configuration</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request POST <span class="token punctuation">\</span>
<!-- -->       --data @app-1-approle-role.json <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/auth/approle/role/app-1<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Payload containing AppRole auth method configuration</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># TTL is set to 10 minutes, and Max TTL to be 30 minutes</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> app-1-approle-role.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;role_name&quot;: &quot;app-1&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;bind_secret_id&quot;: true,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;secret_id_ttl&quot;: &quot;10m&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;secret_id_num_uses&quot;: &quot;1&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;token_ttl&quot;: &quot;10m&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;token_max_ttl&quot;: &quot;30m&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;period&quot;: 0,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;policies&quot;: [</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">        &quot;app-1-secret-read&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    ]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># AppRole backend configuration</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request POST <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @app-1-approle-role.json <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/auth/approle/role/app-1</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>CLI command</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># TTL is set to 10 minutes, and Max TTL to be 30 minutes</span>
<!-- -->$ vault <span class="token function">write</span> auth/approle/role/app-1 <span class="token assign-left variable">policies</span><span class="token operator">=</span><span class="token string">&quot;app-1-secret-read&quot;</span> <span class="token assign-left variable">token_ttl</span><span class="token operator">=</span><span class="token string">&quot;10m&quot;</span> <span class="token assign-left variable">token_max_ttl</span><span class="token operator">=</span><span class="token string">&quot;30m&quot;</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># TTL is set to 10 minutes, and Max TTL to be 30 minutes</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault <span class="token function">write</span> auth/approle/role/app-1 <span class="token assign-left variable">policies</span><span class="token operator">=</span><span class="token string">&quot;app-1-secret-read&quot;</span> <span class="token assign-left variable">token_ttl</span><span class="token operator">=</span><span class="token string">&quot;10m&quot;</span> <span class="token assign-left variable">token_max_ttl</span><span class="token operator">=</span><span class="token string">&quot;30m&quot;</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step-4-configure-tokens-for-terraform-and-chef" aria-label="step 4 configure tokens for terraform and chef permalink">»</a><a class="__target-h" id="step-4-configure-tokens-for-terraform-and-chef" aria-hidden=""></a>Step 4: Configure Tokens for Terraform and Chef</h3><p class="g-type-long-body">Now, you&#x27;re ready to configure the policies and tokens to Terraform and Chef to
interact with Vault. Remember, the point here is that you are giving each system
a <em>limited</em> token that is only able to pull either the <code>RoleID</code> or <code>SecretID</code>,
<em>but not both</em>.</p><p class="g-type-long-body"><img src="/img/vault-approle-tf-chef-2.png" alt="AppRole auth method workflow"/></p><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-1-create-a-policy-and-token-for-terraform" aria-label="task 1 create a policy and token for terraform permalink">»</a><a class="__target-h" id="task-1-create-a-policy-and-token-for-terraform" aria-hidden=""></a>Task 1: Create a policy and token for Terraform</h4><p class="g-type-long-body">Create a token with appropriate policies allowing Terraform to pull
the <code>RoleID</code> from Vault:</p><p class="g-type-long-body"><strong>API call using cURL</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Policy file granting to retrieve RoleID from Vault</span>
<!-- -->$ <span class="token function">tee</span> app-1-approle-roleid-get.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>auth/approle/role/app-1/role-id<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>read<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request PUT <span class="token punctuation">\</span>
<!-- -->       --data @app-1-approle-roleid-get.hcl <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/app-1-approle-roleid-get<!-- -->
<!-- -->
<span class="token comment"># For Terraform</span>
<span class="token comment"># See: https://www.terraform.io/docs/providers/vault/index.html#token</span>
<span class="token comment"># Policy granting to create tokens required by Terraform</span>
<!-- -->$ <span class="token function">tee</span> terraform-token-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>/auth/token/create<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>update<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request PUT <span class="token punctuation">\</span>
<!-- -->       --data @terraform-token-create.hcl <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/terraform-token-create<!-- -->
<!-- -->
<span class="token comment"># Payload to configure token for Terraform to pull RoleID</span>
<!-- -->$ <span class="token function">tee</span> roleid-token-config.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{</span>
<span class="token string">  &quot;policies&quot;: [</span>
<span class="token string">    &quot;app-1-approle-roleid-get&quot;,</span>
<span class="token string">    &quot;terraform-token-create&quot;</span>
<span class="token string">  ],</span>
<span class="token string">  &quot;meta&quot;: {</span>
<span class="token string">    &quot;user&quot;: &quot;terraform-demo&quot;</span>
<span class="token string">  },</span>
<span class="token string">  &quot;ttl&quot;: &quot;720h&quot;,</span>
<span class="token string">  &quot;renewable&quot;: true</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Get token and save it in roleid-token.json</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request POST <span class="token punctuation">\</span>
<!-- -->       --data @roleid-token-config.json <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/auth/token/create <span class="token operator">&gt;</span> roleid-token.json<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy file granting to retrieve RoleID from Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> app-1-approle-roleid-get.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>auth/approle/role/app-1/role-id<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>read<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request PUT <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @app-1-approle-roleid-get.hcl <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/app-1-approle-roleid-get</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># For Terraform</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># See: https://www.terraform.io/docs/providers/vault/index.html#token</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy granting to create tokens required by Terraform</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> terraform-token-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>/auth/token/create<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>update<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request PUT <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @terraform-token-create.hcl <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/terraform-token-create</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Payload to configure token for Terraform to pull RoleID</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> roleid-token-config.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;policies&quot;: [</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;app-1-approle-roleid-get&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;terraform-token-create&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  ],</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;meta&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;user&quot;: &quot;terraform-demo&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  },</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;ttl&quot;: &quot;720h&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;renewable&quot;: true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Get token and save it in roleid-token.json</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request POST <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @roleid-token-config.json <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/auth/token/create <span class="token operator">&gt;</span> roleid-token.json</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The token and associated metadata will be written out to the file
<code>roleid-token.json</code>. The <code>client_token</code> value is what you&#x27;ll give to Terraform.
The file should look similar to the following:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> roleid-token.json <span class="token operator">|</span> jq</span></span>
<span class="token output">{</span>
<span class="token output">  &quot;request_id&quot;: &quot;2e1d05eb-988d-4cf7-7b6a-d2668de31536&quot;,</span>
<span class="token output">  &quot;lease_id&quot;: &quot;&quot;,</span>
<span class="token output">  &quot;renewable&quot;: false,</span>
<span class="token output">  &quot;lease_duration&quot;: 0,</span>
<span class="token output">  &quot;data&quot;: null,</span>
<span class="token output">  &quot;wrap_info&quot;: null,</span>
<span class="token output">  &quot;warnings&quot;: null,</span>
<span class="token output">  &quot;auth&quot;: {</span>
<span class="token output">    &quot;client_token&quot;: &quot;6a7ad093-42ab-885e-3d67-6d51a5583da6&quot;,</span>
<span class="token output">    &quot;accessor&quot;: &quot;f6170506-ee0f-5a59-8478-e0aac2d3259f&quot;,</span>
<span class="token output">    &quot;policies&quot;: [</span>
<span class="token output">      &quot;app-1-approle-roleid-get&quot;,</span>
<span class="token output">      &quot;default&quot;,</span>
<span class="token output">      &quot;terraform-token-create&quot;</span>
<span class="token output">    ],</span>
<span class="token output">    &quot;metadata&quot;: {</span>
<span class="token output">      &quot;user&quot;: &quot;terraform-demo&quot;</span>
<span class="token output">    },</span>
<span class="token output">    &quot;lease_duration&quot;: 2592000,</span>
<span class="token output">    &quot;renewable&quot;: true,</span>
<span class="token output">    &quot;entity_id&quot;: &quot;&quot;</span>
<span class="token output">  }</span>
<span class="token output">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> roleid-token.json <span class="token operator">|</span> jq</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;request_id&quot;: &quot;2e1d05eb-988d-4cf7-7b6a-d2668de31536&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;lease_id&quot;: &quot;&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;renewable&quot;: false,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;lease_duration&quot;: 0,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;data&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;wrap_info&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;warnings&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;auth&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;client_token&quot;: &quot;6a7ad093-42ab-885e-3d67-6d51a5583da6&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;accessor&quot;: &quot;f6170506-ee0f-5a59-8478-e0aac2d3259f&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;policies&quot;: [</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">      &quot;app-1-approle-roleid-get&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">      &quot;default&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">      &quot;terraform-token-create&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    ],</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;metadata&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">      &quot;user&quot;: &quot;terraform-demo&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    },</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;lease_duration&quot;: 2592000,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;renewable&quot;: true,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;entity_id&quot;: &quot;&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  }</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>CLI command</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Policy file granting to retrieve RoleID from Vault</span>
<!-- -->$ <span class="token function">tee</span> app-1-approle-roleid-get.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">path &quot;auth/approle/role/app-1/role-id&quot; {</span>
<span class="token string">  capabilities = [ &quot;read&quot; ]</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span>
<!-- -->$ vault policy <span class="token function">write</span> app-1-approle-roleid-get app-1-approle-roleid-get.hcl<!-- -->
<!-- -->
<span class="token comment"># For Terraform</span>
<span class="token comment"># See: https://www.terraform.io/docs/providers/vault/index.html#token</span>
<span class="token comment"># Policy granting to create tokens required by Terraform</span>
<!-- -->$ <span class="token function">tee</span> terraform-token-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">path &quot;auth/token/create&quot; {</span>
<span class="token string">  capabilities = [ &quot;update&quot; ]</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span>
<!-- -->$ vault policy <span class="token function">write</span> terraform-token-create terraform-token-create.hcl<!-- -->
<!-- -->
<span class="token comment"># Get token and save it in roleid-token.txt</span>
<!-- -->$ vault token create -policy<span class="token operator">=</span><span class="token string">&quot;app-1-approle-roleid-get&quot;</span> -policy<span class="token operator">=</span><span class="token string">&quot;terraform-token-create&quot;</span> <span class="token punctuation">\</span>
<!-- -->      -metadata<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">=</span><span class="token string">&quot;terraform-user&quot;</span> <span class="token operator">&gt;</span> roleid-token.txt<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy file granting to retrieve RoleID from Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> app-1-approle-roleid-get.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">path &quot;auth/approle/role/app-1/role-id&quot; {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  capabilities = [ &quot;read&quot; ]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault policy <span class="token function">write</span> app-1-approle-roleid-get app-1-approle-roleid-get.hcl</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># For Terraform</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># See: https://www.terraform.io/docs/providers/vault/index.html#token</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy granting to create tokens required by Terraform</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> terraform-token-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">path &quot;auth/token/create&quot; {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  capabilities = [ &quot;update&quot; ]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-approle-roleid-get policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault policy <span class="token function">write</span> terraform-token-create terraform-token-create.hcl</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Get token and save it in roleid-token.txt</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault token create -policy<span class="token operator">=</span><span class="token string">&quot;app-1-approle-roleid-get&quot;</span> -policy<span class="token operator">=</span><span class="token string">&quot;terraform-token-create&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      -metadata<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">=</span><span class="token string">&quot;terraform-user&quot;</span> <span class="token operator">&gt;</span> roleid-token.txt</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The token and associated metadata will be written out to the file
<code>roleid-token.txt</code>. The <code>token</code> value is what you&#x27;ll give to Terraform.
The file should look similar to the following:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> roleid-token.txt</span></span>
<span class="token output">Key                Value</span>
<span class="token output">---                -----</span>
<span class="token output">token              2600aeda-6385-c163-7171-543b1e1fabcf</span>
<span class="token output">token_accessor     6ef835e3-4948-8c61-1e89-3625ca31fd84</span>
<span class="token output">token_duration     768h</span>
<span class="token output">token_renewable    true</span>
<span class="token output">token_policies     [app-1-approle-roleid-get default terraform-token-create]</span>
<span class="token output">token_meta_user    terraform-demo</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> roleid-token.txt</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Key                Value</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">---                -----</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token              2600aeda-6385-c163-7171-543b1e1fabcf</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_accessor     6ef835e3-4948-8c61-1e89-3625ca31fd84</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_duration     768h</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_renewable    true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_policies     [app-1-approle-roleid-get default terraform-token-create]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_meta_user    terraform-demo</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-2-create-a-policy-and-token-for-chef" aria-label="task 2 create a policy and token for chef permalink">»</a><a class="__target-h" id="task-2-create-a-policy-and-token-for-chef" aria-hidden=""></a>Task 2: Create a policy and token for Chef</h4><p class="g-type-long-body">Create a token with appropriate policies allowing Chef to pull the <code>SecretID</code>
from Vault:</p><p class="g-type-long-body"><strong>API call using cURL</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Policy file granting to retrieve SecretID</span>
<!-- -->$ <span class="token function">tee</span> app-1-approle-secretid-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>auth/approle/role/app-1/secret-id<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>update<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-approle-secretid-create policy in Vault</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->    --location <span class="token punctuation">\</span>
<!-- -->    --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->    --request PUT <span class="token punctuation">\</span>
<!-- -->    --data @app-1-approle-secretid-create.hcl <span class="token punctuation">\</span>
<!-- -->    <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/app-1-approle-secretid-create<!-- -->
<!-- -->
<span class="token comment"># Payload to invoke auth/token/create endpoint</span>
<!-- -->$ <span class="token function">tee</span> secretid-token-config.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">{</span>
<span class="token string">  &quot;policies&quot;: [</span>
<span class="token string">    &quot;app-1-approle-secretid-create&quot;</span>
<span class="token string">  ],</span>
<span class="token string">  &quot;meta&quot;: {</span>
<span class="token string">    &quot;user&quot;: &quot;chef-demo&quot;</span>
<span class="token string">  },</span>
<span class="token string">  &quot;ttl&quot;: &quot;720h&quot;,</span>
<span class="token string">  &quot;renewable&quot;: true</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Get token for Chef to get SecretID from Vault and store it in secretid-token.json</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request POST <span class="token punctuation">\</span>
<!-- -->       --data @secretid-token-config.json <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/auth/token/create <span class="token operator">&gt;</span> secretid-token.json<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy file granting to retrieve SecretID</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> app-1-approle-secretid-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{&quot;policy&quot;:&quot;path <span class="token entity" title="\&quot;">\&quot;</span>auth/approle/role/app-1/secret-id<span class="token entity" title="\&quot;">\&quot;</span> {capabilities = [<span class="token entity" title="\&quot;">\&quot;</span>update<span class="token entity" title="\&quot;">\&quot;</span>]}&quot;}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-approle-secretid-create policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    --request PUT <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    --data @app-1-approle-secretid-create.hcl <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token variable">$VAULT_ADDR</span>/v1/sys/policy/app-1-approle-secretid-create</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Payload to invoke auth/token/create endpoint</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> secretid-token-config.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;policies&quot;: [</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;app-1-approle-secretid-create&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  ],</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;meta&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">    &quot;user&quot;: &quot;chef-demo&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  },</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;ttl&quot;: &quot;720h&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;renewable&quot;: true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Get token for Chef to get SecretID from Vault and store it in secretid-token.json</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request POST <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @secretid-token-config.json <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/auth/token/create <span class="token operator">&gt;</span> secretid-token.json</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The resulting file should look like this:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> secretid-token.json <span class="token operator">|</span> jq</span></span>
<span class="token output">{</span>
<span class="token output">  &quot;request_id&quot;: &quot;6f6ad8a1-fedb-b838-60ce-87999f01aff6&quot;,</span>
<span class="token output">  &quot;lease_id&quot;: &quot;&quot;,</span>
<span class="token output">  &quot;renewable&quot;: false,</span>
<span class="token output">  &quot;lease_duration&quot;: 0,</span>
<span class="token output">  &quot;data&quot;: null,</span>
<span class="token output">  &quot;wrap_info&quot;: null,</span>
<span class="token output">  &quot;warnings&quot;: null,</span>
<span class="token output">  &quot;auth&quot;: {</span>
<span class="token output">    &quot;client_token&quot;: &quot;cdfdb7a0-d7a6-3769-927d-0ace297726ea&quot;,</span>
<span class="token output">    &quot;accessor&quot;: &quot;88e8aaca-1584-4881-3368-d9cb5cd7ddae&quot;,</span>
<span class="token output">    &quot;policies&quot;: [</span>
<span class="token output">      &quot;app-1-approle-secretid-create&quot;,</span>
<span class="token output">      &quot;default&quot;</span>
<span class="token output">    ],</span>
<span class="token output">    &quot;metadata&quot;: {</span>
<span class="token output">      &quot;user&quot;: &quot;chef-demo&quot;</span>
<span class="token output">    },</span>
<span class="token output">    &quot;lease_duration&quot;: 2592000,</span>
<span class="token output">    &quot;renewable&quot;: true,</span>
<span class="token output">    &quot;entity_id&quot;: &quot;&quot;</span>
<span class="token output">  }</span>
<span class="token output">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> secretid-token.json <span class="token operator">|</span> jq</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;request_id&quot;: &quot;6f6ad8a1-fedb-b838-60ce-87999f01aff6&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;lease_id&quot;: &quot;&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;renewable&quot;: false,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;lease_duration&quot;: 0,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;data&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;wrap_info&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;warnings&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;auth&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;client_token&quot;: &quot;cdfdb7a0-d7a6-3769-927d-0ace297726ea&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;accessor&quot;: &quot;88e8aaca-1584-4881-3368-d9cb5cd7ddae&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;policies&quot;: [</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">      &quot;app-1-approle-secretid-create&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">      &quot;default&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    ],</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;metadata&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">      &quot;user&quot;: &quot;chef-demo&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    },</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;lease_duration&quot;: 2592000,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;renewable&quot;: true,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    &quot;entity_id&quot;: &quot;&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  }</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>CLI command</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Policy file granting to retrieve SecretID</span>
<!-- -->$ <span class="token function">tee</span> app-1-approle-secretid-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="token string">path &quot;auth/approle/role/app-1/secret-id&quot; {</span>
<span class="token string">  capabilities = [ &quot;update&quot; ]</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<span class="token comment"># Create the app-1-approle-secretid-create policy in Vault</span>
<!-- -->$ vault policy <span class="token function">write</span> app-1-approle-secretid-create app-1-approle-secretid-create.hcl<!-- -->
<!-- -->
<span class="token comment"># Get token for Chef to get SecretID from Vault and store it in secretid-token.txt</span>
<!-- -->$ vault token create -policy<span class="token operator">=</span><span class="token string">&quot;app-1-approle-secretid-create&quot;</span> <span class="token punctuation">\</span>
<!-- -->      -metadata<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">=</span><span class="token string">&quot;chef-demo&quot;</span> <span class="token operator">&gt;</span> secretid-token.txt<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Policy file granting to retrieve SecretID</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> app-1-approle-secretid-create.hcl <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">path &quot;auth/approle/role/app-1/secret-id&quot; {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  capabilities = [ &quot;update&quot; ]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create the app-1-approle-secretid-create policy in Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault policy <span class="token function">write</span> app-1-approle-secretid-create app-1-approle-secretid-create.hcl</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Get token for Chef to get SecretID from Vault and store it in secretid-token.txt</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault token create -policy<span class="token operator">=</span><span class="token string">&quot;app-1-approle-secretid-create&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      -metadata<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">=</span><span class="token string">&quot;chef-demo&quot;</span> <span class="token operator">&gt;</span> secretid-token.txt</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The resulting file should look like this:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> secretid-token.txt</span></span>
<span class="token output">Key                Value</span>
<span class="token output">---                -----</span>
<span class="token output">token              20d69183-59cb-c953-6dea-34f5f1bbe5f7</span>
<span class="token output">token_accessor     a17e7a43-c14a-b96a-0014-9149d218e74a</span>
<span class="token output">token_duration     768h</span>
<span class="token output">token_renewable    true</span>
<span class="token output">token_policies     [app-1-approle-secretid-create default]</span>
<span class="token output">token_meta_user    chef-demo</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> secretid-token.txt</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Key                Value</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">---                -----</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token              20d69183-59cb-c953-6dea-34f5f1bbe5f7</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_accessor     a17e7a43-c14a-b96a-0014-9149d218e74a</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_duration     768h</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_renewable    true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_policies     [app-1-approle-secretid-create default]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_meta_user    chef-demo</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step-5-save-the-token-in-a-chef-data-bag" aria-label="step 5 save the token in a chef data bag permalink">»</a><a class="__target-h" id="step-5-save-the-token-in-a-chef-data-bag" aria-hidden=""></a>Step 5: Save the Token in a Chef Data Bag</h3><p class="g-type-long-body">At this point, you have a client token generated for Terraform and another for
Chef server to log into Vault. For the sake of simplicity, you can put the
Chef&#x27;s client token (<code>secretid-token.json</code>) in a <a href="https://docs.chef.io/data_bags.html">Data
Bag</a> which is fine because this token can
<strong><em>only</em></strong> retrieve <code>SecretID</code> from Vault which is not much of a use without a
corresponding <code>RoleID</code>.</p><p class="g-type-long-body">Now, create a Chef Data Bag and put the <code>SecretID</code> token (<code>secretid-token.json</code>)
along with the rest of its metadata.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">cd</span> /home/ubuntu/vault-chef-approle-demo/chef/</span></span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Use the path <span class="token keyword">for</span> where you created this <span class="token function">file</span> <span class="token keyword">in</span> the previous step</span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">You<span class="token string">&#x27;re just adding an &#x27;</span><span class="token function">id</span><span class="token string">&#x27; field to the file as that&#x27;</span>s a required field <span class="token keyword">for</span> data bags</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> /home/ubuntu/secretid-token.json <span class="token operator">|</span> jq --arg <span class="token function">id</span> approle-secretid-token <span class="token string">&#x27;. + {id: <span class="token variable">$id</span>}&#x27;</span> <span class="token operator">&gt;</span> secretid-token.json</span></span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag create secretid-token</span></span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag from <span class="token function">file</span> secretid-token secretid-token.json</span></span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag list</span></span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag show secretid-token</span></span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag show secretid-token approle-secretid-token</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">cd</span> /home/ubuntu/vault-chef-approle-demo/chef/</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Use the path <span class="token keyword">for</span> where you created this <span class="token function">file</span> <span class="token keyword">in</span> the previous step</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">You<span class="token string">&#x27;re just adding an &#x27;</span><span class="token function">id</span><span class="token string">&#x27; field to the file as that&#x27;</span>s a required field <span class="token keyword">for</span> data bags</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> /home/ubuntu/secretid-token.json <span class="token operator">|</span> jq --arg <span class="token function">id</span> approle-secretid-token <span class="token string">&#x27;. + {id: <span class="token variable">$id</span>}&#x27;</span> <span class="token operator">&gt;</span> secretid-token.json</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag create secretid-token</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag from <span class="token function">file</span> secretid-token secretid-token.json</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag list</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag show secretid-token</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag show secretid-token approle-secretid-token</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The last step should show the following output:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag show secretid-token approle-secretid-token</span></span>
<span class="token output">WARNING: Unencrypted data bag detected, ignoring any provided secret options.</span>
<span class="token output">auth:</span>
<span class="token output">  accessor:       88e8aaca-1584-4881-3368-d9cb5cd7ddae</span>
<span class="token output">  client_token:   cdfdb7a0-d7a6-3769-927d-0ace297726ea</span>
<span class="token output">  entity_id:</span>
<span class="token output">  lease_duration: 2592000</span>
<span class="token output">  metadata:</span>
<span class="token output">  policies:</span>
<span class="token output">    app-1-approle-secretid-create</span>
<span class="token output">    default</span>
<span class="token output">  renewable:      true</span>
<span class="token output">data:</span>
<span class="token output">id:             approle-secretid-token</span>
<span class="token output">lease_duration: 0</span>
<span class="token output">lease_id:</span>
<span class="token output">renewable:      false</span>
<span class="token output">request_id:     6f6ad8a1-fedb-b838-60ce-87999f01aff6</span>
<span class="token output">warnings:</span>
<span class="token output">wrap_info:</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">knife data bag show secretid-token approle-secretid-token</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">WARNING: Unencrypted data bag detected, ignoring any provided secret options.</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">auth:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  accessor:       88e8aaca-1584-4881-3368-d9cb5cd7ddae</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  client_token:   cdfdb7a0-d7a6-3769-927d-0ace297726ea</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  entity_id:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  lease_duration: 2592000</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  metadata:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  policies:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    app-1-approle-secretid-create</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">    default</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  renewable:      true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">data:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">id:             approle-secretid-token</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">lease_duration: 0</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">lease_id:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">renewable:      false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">request_id:     6f6ad8a1-fedb-b838-60ce-87999f01aff6</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">warnings:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">wrap_info:</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step-6-write-secrets" aria-label="step 6 write secrets permalink">»</a><a class="__target-h" id="step-6-write-secrets" aria-hidden=""></a>Step 6: Write Secrets</h3><p class="g-type-long-body">Let&#x27;s write some test data in the <code>secret/app-1</code> path so that the target app
will have some secret to retrieve from Vault at a later step.</p><p class="g-type-long-body"><strong>API call using cURL</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Write some demo secrets</span>
<!-- -->$ <span class="token function">tee</span> demo-secrets.json <span class="token operator">&lt;&lt;</span><span class="token string">&#x27;EOF&#x27;</span>
<span class="token string">{</span>
<span class="token string">  &quot;username&quot;: &quot;app-1-user&quot;,</span>
<span class="token string">  &quot;password&quot;: &quot;$up3r$3cr3t!&quot;</span>
<span class="token string">}</span>
<span class="token string">EOF</span>
<!-- -->
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request POST <span class="token punctuation">\</span>
<!-- -->       --data @demo-secrets.json <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/secret/app-1<!-- -->
<!-- -->
<span class="token comment"># Verify that you can read back the data:</span>
<!-- -->$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span>
<!-- -->       --location <span class="token punctuation">\</span>
<!-- -->       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span>
<!-- -->       --request GET <span class="token punctuation">\</span>
<!-- -->       <span class="token variable">$VAULT_ADDR</span>/v1/secret/app-1 <span class="token operator">|</span> jq<!-- -->
<span class="token punctuation">{</span>
<!-- -->  <span class="token string">&quot;request_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1f73c7ee-27fa-bad0-9c77-b330eef1ea88&quot;</span>,<!-- -->
<!-- -->  <span class="token string">&quot;lease_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,<!-- -->
<!-- -->  <span class="token string">&quot;renewable&quot;</span><span class="token builtin class-name">:</span> false,<!-- -->
<!-- -->  <span class="token string">&quot;lease_duration&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2764800</span>,<!-- -->
<!-- -->  <span class="token string">&quot;data&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
<!-- -->    <span class="token string">&quot;password&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;<span class="token variable">$up3r</span><span class="token variable">$3cr3t</span>!&quot;</span>,<!-- -->
<!-- -->    <span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;app-1-user&quot;</span>
<!-- -->  <span class="token punctuation">}</span>,<!-- -->
<!-- -->  <span class="token string">&quot;wrap_info&quot;</span><span class="token builtin class-name">:</span> null,<!-- -->
<!-- -->  <span class="token string">&quot;warnings&quot;</span><span class="token builtin class-name">:</span> null,<!-- -->
<!-- -->  <span class="token string">&quot;auth&quot;</span><span class="token builtin class-name">:</span> null<!-- -->
<span class="token punctuation">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Write some demo secrets</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">tee</span> demo-secrets.json <span class="token operator">&lt;&lt;</span><span class="token string">&#x27;EOF&#x27;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;username&quot;: &quot;app-1-user&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">  &quot;password&quot;: &quot;$up3r$3cr3t!&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token string">EOF</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request POST <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --data @demo-secrets.json <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/secret/app-1</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Verify that you can read back the data:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --silent <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --location <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --header <span class="token string">&quot;X-Vault-Token: <span class="token variable">$VAULT_TOKEN</span>&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       --request GET <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">       <span class="token variable">$VAULT_ADDR</span>/v1/secret/app-1 <span class="token operator">|</span> jq</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;request_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1f73c7ee-27fa-bad0-9c77-b330eef1ea88&quot;</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;lease_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;renewable&quot;</span><span class="token builtin class-name">:</span> false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;lease_duration&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2764800</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;data&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;password&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;<span class="token variable">$up3r</span><span class="token variable">$3cr3t</span>!&quot;</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;app-1-user&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token punctuation">}</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;wrap_info&quot;</span><span class="token builtin class-name">:</span> null,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;warnings&quot;</span><span class="token builtin class-name">:</span> null,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;auth&quot;</span><span class="token builtin class-name">:</span> null</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>CLI command</strong></p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Write some demo secrets</span>
<!-- -->$ vault <span class="token function">write</span> secret/app-1 <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">&quot;app-1-user&quot;</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;\<span class="token variable">$up3r</span>\<span class="token variable">$3cr3t</span>!&quot;</span>
<!-- -->
<span class="token comment"># Verify that you can read back the data:</span>
<!-- -->$ vault <span class="token builtin class-name">read</span> secret/app-1<!-- -->
<!-- -->Key                 Value<!-- -->
<!-- -->---                 -----<!-- -->
<!-- -->refresh_interval    768h<!-- -->
<!-- -->password            <span class="token variable">$up3r</span><span class="token variable">$3cr3t</span><span class="token operator">!</span>
<!-- -->username            app-1-user<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Write some demo secrets</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault <span class="token function">write</span> secret/app-1 <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">&quot;app-1-user&quot;</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;\<span class="token variable">$up3r</span>\<span class="token variable">$3cr3t</span>!&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Verify that you can read back the data:</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault <span class="token builtin class-name">read</span> secret/app-1</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Key                 Value</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">---                 -----</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">refresh_interval    768h</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">password            <span class="token variable">$up3r</span><span class="token variable">$3cr3t</span><span class="token operator">!</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">username            app-1-user</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><div class="alert alert-info g-type-body" role="alert"><p class="g-type-long-body">At this point, just about all the pieces are in place. Remember, these setup
steps will only need to be performed upon initial creation of an AppRole, and
would typically be done by a Vault administrator.</p></div><h2 class="g-type-display-3"><a class="__permalink-h" href="#phase2" aria-label="phase 2 provision our chef node to show approle login permalink">»</a><a class="__target-h __compat" id="phase2" aria-hidden=""></a><a class="__target-h" id="phase-2-provision-our-chef-node-to-show-approle-login" aria-hidden=""></a>Phase 2: Provision our Chef Node to Show AppRole Login</h2><p class="g-type-long-body">To complete the demo, run the <strong><code>chef-node</code></strong> Terraform configuration to see how
everything talks to each other.</p><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-1-change-the-working-directory" aria-label="task 1 change the working directory permalink">»</a><a class="__target-h" id="task-1-change-the-working-directory" aria-hidden=""></a>Task 1: Change the working directory</h4><p class="g-type-long-body">Open another terminal on your host machine (<strong>not</strong> the <code>mgmt-node</code>)
and <code>cd</code> into the <code>identity/vault-chef-approle/terraform-aws/chef-node</code>
directory:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">cd</span> identity/vault-chef-approle/terraform-aws/chef-node</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">cd</span> identity/vault-chef-approle/terraform-aws/chef-node</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-2-update-terraform-tfvars-example" aria-label="task 2 update terraform tfvars example permalink">»</a><a class="__target-h" id="task-2-update-terraform-tfvars-example" aria-hidden=""></a>Task 2: Update terraform.tfvars.example</h4><p class="g-type-long-body">Replace the variable values in <code>terraform.tfvars.example</code> to match your
environment and save it as <code>terraform.tfvars</code> like you have done at <a href="#step-1-provision-the-vault-and-chef-server">Step 1</a>.</p><p class="g-type-long-body">Note the following:</p><ul><li class="g-type-long-body">Update the <strong><code>vault_address</code></strong> and <strong><code>chef_server_address</code></strong> variables with
the IP address of our <code>mgmt-node</code> from above.</li><li class="g-type-long-body">Update the <strong><code>vault_token</code></strong> variable with the <code>RoleID</code> token from <strong>Task 1</strong>
in <a href="#step-4-configure-tokens-for-terraform-and-chef">Step 4</a>.<ul><li class="g-type-long-body">If you ran the <code>demo-setup.sh</code> script (<em>Option 1</em>), retrieve the
<code>client_token</code> in the <code>/home/ubuntu/vault-chef-approle-demo/roleid-token.json</code>
file:</li></ul></li></ul><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> ~/vault-chef-approle-demo/roleid-token.json <span class="token operator">|</span> jq <span class="token string">&quot;.auth.client_token&quot;</span></span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> ~/vault-chef-approle-demo/roleid-token.json <span class="token operator">|</span> jq <span class="token string">&quot;.auth.client_token&quot;</span></span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-3-run-terraform" aria-label="task 3 run terraform permalink">»</a><a class="__target-h" id="task-3-run-terraform" aria-hidden=""></a>Task 3: Run Terraform</h4><p class="g-type-long-body">Perform a <code>terraform init</code> to pull down the necessary provider
resources. Then <code>terraform plan</code> to verify your changes and the resources that
will be created. If all looks good, then perform a <code>terraform apply</code> to
provision the resources.</p><p class="g-type-long-body">The Terraform output will display the public IP address to SSH into your
server.</p><blockquote><p class="g-type-long-body"><strong>NOTE:</strong> If the <code>terraform apply</code> fails with &quot;<code>io: read/write on closed pipe</code>&quot;
error, this is a <a href="https://github.com/hashicorp/terraform/issues/17638">known
issue</a> with Terraform
0.11.4 and 0.11.5. Please try again with another Terraform version.</p></blockquote><p class="g-type-long-body">At this point, Terraform will perform the following actions:</p><ul><li class="g-type-long-body">Pull a <code>RoleID</code> from our Vault server</li><li class="g-type-long-body">Provision an AWS instance</li><li class="g-type-long-body">Write the <code>RoleID</code> to the AWS instance as an environment variable</li><li class="g-type-long-body">Run the Chef provisioner to bootstrap the AWS instance with our Chef Server</li><li class="g-type-long-body">Run our Chef recipe which will install NGINX, perform our AppRole login, get
our secrets, and output them to our <code>index.html</code> file</li></ul><p class="g-type-long-body"><img src="/img/vault-approle-tf-chef-3.png" alt="AppRole auth method workflow"/></p><p class="g-type-long-body">The Chef recipe can be found at
<code>identity/vault-chef-approle/chef/cookbooks/vault_chef_approle_demo/recipes/default.rb</code>.</p><div class="g-code-block style_root__3eDLf language-shell style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token punctuation">..</span>.<!-- -->
<span class="token comment"># Configure address for Vault Gem</span>
<!-- -->Vault.address <span class="token operator">=</span> ENV<span class="token punctuation">[</span><span class="token string">&#x27;VAULT_ADDR&#x27;</span><span class="token punctuation">]</span>
<!-- -->
<span class="token comment"># Get AppRole RoleID from our environment variables (delivered via Terraform)</span>
<!-- -->var_role_id <span class="token operator">=</span> ENV<span class="token punctuation">[</span><span class="token string">&#x27;APPROLE_ROLEID&#x27;</span><span class="token punctuation">]</span>
<!-- -->
<span class="token comment"># Get Vault token from data bag (used to retrieve the SecretID)</span>
<!-- -->vault_token_data <span class="token operator">=</span> data_bag_item<span class="token punctuation">(</span><span class="token string">&#x27;secretid-token&#x27;</span>, <span class="token string">&#x27;approle-secretid-token&#x27;</span><span class="token punctuation">)</span>
<!-- -->
<span class="token comment"># Set Vault token (used to retrieve the SecretID)</span>
<!-- -->Vault.token <span class="token operator">=</span> vault_token_data<span class="token punctuation">[</span><span class="token string">&#x27;auth&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#x27;client_token&#x27;</span><span class="token punctuation">]</span>
<!-- -->
<span class="token comment"># Get AppRole SecretID from Vault</span>
<!-- -->var_secret_id <span class="token operator">=</span> Vault.approle.create_secret_id<span class="token punctuation">(</span><span class="token string">&#x27;app-1&#x27;</span><span class="token punctuation">)</span>.data<span class="token punctuation">[</span>:secret_id<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell"><code class="style_code__2AMYw language-shell"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">..</span>.</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Configure address for Vault Gem</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Vault.address <span class="token operator">=</span> ENV<span class="token punctuation">[</span><span class="token string">&#x27;VAULT_ADDR&#x27;</span><span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Get AppRole RoleID from our environment variables (delivered via Terraform)</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">var_role_id <span class="token operator">=</span> ENV<span class="token punctuation">[</span><span class="token string">&#x27;APPROLE_ROLEID&#x27;</span><span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Get Vault token from data bag (used to retrieve the SecretID)</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">vault_token_data <span class="token operator">=</span> data_bag_item<span class="token punctuation">(</span><span class="token string">&#x27;secretid-token&#x27;</span>, <span class="token string">&#x27;approle-secretid-token&#x27;</span><span class="token punctuation">)</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Set Vault token (used to retrieve the SecretID)</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Vault.token <span class="token operator">=</span> vault_token_data<span class="token punctuation">[</span><span class="token string">&#x27;auth&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#x27;client_token&#x27;</span><span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Get AppRole SecretID from Vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">var_secret_id <span class="token operator">=</span> Vault.approle.create_secret_id<span class="token punctuation">(</span><span class="token string">&#x27;app-1&#x27;</span><span class="token punctuation">)</span>.data<span class="token punctuation">[</span>:secret_id<span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">..</span>.</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#task-4-verification" aria-label="task 4 verification permalink">»</a><a class="__target-h" id="task-4-verification" aria-hidden=""></a>Task 4: Verification</h4><p class="g-type-long-body">Once Terraform completes the <code>apply</code> operation, it will output the public IP
address of our new server. You can plug that IP address into a browser to see
the output. It should look similar to the following:</p><div class="g-code-block style_root__3eDLf language-plaintext style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">Role ID:<!-- -->
<!-- -->f6286b97-246e-9fb4-4d9f-0c9465451851<!-- -->
<!-- -->
<!-- -->Secret ID:<!-- -->
<!-- -->72f4b60c-26d0-d947-5026-153943174831<!-- -->
<!-- -->
<!-- -->AppRole Token:<!-- -->
<!-- -->d11d81e4-0ba1-fefc-03f8-e5f06793b60d<!-- -->
<!-- -->
<!-- -->Read Our Secrets:<!-- -->
<!-- -->{:password=&gt;&quot;$up3r$3cr3t!&quot;, :username=&gt;&quot;app-1-user&quot;}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-plaintext"><code class="style_code__2AMYw language-plaintext"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Role ID:</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">f6286b97-246e-9fb4-4d9f-0c9465451851</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Secret ID:</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">72f4b60c-26d0-d947-5026-153943174831</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">AppRole Token:</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">d11d81e4-0ba1-fefc-03f8-e5f06793b60d</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Read Our Secrets:</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{:password=&gt;&quot;$up3r$3cr3t!&quot;, :username=&gt;&quot;app-1-user&quot;}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h2 class="g-type-display-3"><a class="__permalink-h" href="#additional-references" aria-label="additional references permalink">»</a><a class="__target-h" id="additional-references" aria-hidden=""></a>Additional References</h2><p class="g-type-long-body">The following is a curated list of webinars, blogs and GitHub repositories that
add additional context to fill out the concepts discussed in the webinar and
demonstrated in the code:</p><ul><li class="g-type-long-body"><a href="https://www.youtube.com/watch?v=skENC9aXgco">Managing Secrets in a Container Environment by Jeff Mitchell</a></li><li class="g-type-long-body"><a href="https://www.hashicorp.com/blog/using-hashicorps-vault-with-chef">Using HashiCorp&#x27;s Vault with Chef written by Seth Vargo</a></li><li class="g-type-long-body"><a href="https://blog.chef.io/2016/12/12/manage-secrets-with-chef-and-hashicorps-vault/">Manage Secrets with Chef and HashiCorps Vault by Seth Vargo &amp; JJ Asghar</a><ul><li class="g-type-long-body"><a href="https://github.com/sethvargo/vault-chef-webinar">Associated GitHub repository</a></li></ul></li><li class="g-type-long-body"><a href="http://blog.alanthatcher.io/vault-approle-authentication/">Vault AppRole Authentication written by Alan Thatcher</a></li><li class="g-type-long-body"><a href="http://blog.alanthatcher.io/integrating-chef-and-hashicorp-vault/">Integrating Chef and HashiCorp Vault written by Alan Thatcher</a></li><li class="g-type-long-body"><a href="https://github.com/hashicorp/vault-ruby">Vault Ruby Client</a></li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#next-steps" aria-label="next steps permalink">»</a><a class="__target-h" id="next-steps" aria-hidden=""></a>Next Steps</h2><p class="g-type-long-body">Watch the video recording of the <a href="https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef">Delivering Secret Zero: Vault AppRole with
Terraform and
Chef</a>
webinar which talks about the usage of AppRole with Terraform and Chef as its
trusted entities.</p></article></div></div><div id="edit-this-page" class="g-container"><a href="https://github.com/hashicorp/vault/blob/main/website/content/guides/identity/approle-trusted-entities.mdx"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjMiIGhlaWdodD0iMjIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTExLjYwOC4zNDJDNS41MzUuMzQyLjYxIDUuMTYyLjYxIDExLjEwOGMwIDQuNzU3IDMuMTUyIDguNzkyIDcuNTIzIDEwLjIxNS41NS4xLjc1MS0uMjMzLjc1MS0uNTE4IDAtLjI1Ni0uMDEtLjkzMy0uMDE1LTEuODMxLTMuMDYuNjUtMy43MDUtMS40NDQtMy43MDUtMS40NDQtLjUtMS4yNDMtMS4yMjItMS41NzQtMS4yMjItMS41NzQtLjk5OC0uNjY4LjA3Ni0uNjU1LjA3Ni0uNjU1IDEuMTA0LjA3NiAxLjY4NSAxLjExIDEuNjg1IDEuMTEuOTgxIDEuNjQ1IDIuNTc1IDEuMTcgMy4yMDEuODk0LjEtLjY5NS4zODUtMS4xNy42OTktMS40MzktMi40NDMtLjI3MS01LjAxMS0xLjE5NS01LjAxMS01LjMyIDAtMS4xNzYuNDI5LTIuMTM3IDEuMTMyLTIuODktLjExMy0uMjcyLS40OS0xLjM2Ny4xMDgtMi44NDkgMCAwIC45MjQtLjI4OSAzLjAyNSAxLjEwNC44NzctLjI0IDEuODE5LS4zNTggMi43NTQtLjM2My45MzQuMDA1IDEuODc1LjEyNCAyLjc1NC4zNjMgMi4xLTEuMzkzIDMuMDIyLTEuMTA0IDMuMDIyLTEuMTA0LjYgMS40ODIuMjIyIDIuNTc3LjExIDIuODUuNzA1Ljc1MiAxLjEzIDEuNzEzIDEuMTMgMi44ODggMCA0LjEzNi0yLjU3MiA1LjA0Ni01LjAyMiA1LjMxMy4zOTQuMzMyLjc0Ni45OS43NDYgMS45OTQgMCAxLjQzOC0uMDEzIDIuNi0uMDEzIDIuOTUzIDAgLjI4OC4xOTguNjIzLjc1Ni41MTggNC4zNjgtMS40MjcgNy41MTYtNS40NiA3LjUxNi0xMC4yMTUgMC01Ljk0Ni00LjkyNS0xMC43NjYtMTEtMTAuNzY2IiBmaWxsPSIjMTYxNTE0IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=" alt="github logo"/><span>Edit this page</span></a></div></div><footer class="g-footer"><div class="g-container"><div class="left"><a href="/docs/vault_v1.8.x/docs/">Docs</a><a href="/docs/vault_v1.8.x/api/">API</a><a href="https://learn.hashicorp.com/vault">Learn</a><a href="/docs/vault_v1.8.x/community/">Community</a><a href="https://hashicorp.com/privacy">Privacy</a><a href="/docs/vault_v1.8.x/security/">Security</a><a href="/docs/vault_v1.8.x/files/press-kit.zip">Press Kit</a><a>Consent Manager</a></div></div></footer><div id="g-consent-manager"></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"currentPath":"identity/approle-trusted-entities","frontMatter":{"layout":"guides","page_title":"AppRole With Terraform \u0026 Chef - Guides","description":"This guide discusses the concepts necessary to help users\nunderstand Vault's AppRole authentication pattern and how to use it to\nsecurely introduce a Vault authentication token to a target server,\napplication, container, etc.x"},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/identity/approle-trusted-entities.mdx","mdxSource":{"compiledSource":"var i=Object.defineProperty;var o=Object.prototype.hasOwnProperty;var p=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable;var l=(a,n,t)=\u003en in a?i(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=\u003e{for(var t in n||(n={}))o.call(n,t)\u0026\u0026l(a,t,n[t]);if(p)for(var t of p(n))r.call(n,t)\u0026\u0026l(a,t,n[t]);return a};var m=(a,n)=\u003e{var t={};for(var s in a)o.call(a,s)\u0026\u0026n.indexOf(s)\u003c0\u0026\u0026(t[s]=a[s]);if(a!=null\u0026\u0026p)for(var s of p(a))n.indexOf(s)\u003c0\u0026\u0026r.call(a,s)\u0026\u0026(t[s]=a[s]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:a}=s,n=m(s,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#vault-approle-with-terraform-and-chef-demo\",\"aria-label\":\"vault approle with terraform and chef demo permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"vault-approle-with-terraform-and-chef-demo\",\"aria-hidden\":\"\"})),\"Vault AppRole with Terraform and Chef Demo\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"In the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/identity/authentication#advanced-features\"}),`AppRole Pull\nAuthentication`),` guide,\nthe question of how best to deliver the Role ID and Secret ID were brought up,\nand the role of trusted entities (Terraform, Chef, Nomad, Kubernetes, etc.) was\nmentioned.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-workflow2.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This \",mdx(\"em\",{parentName:\"p\"},\"intermediate\"),\" Vault guide aims to provide a \",mdx(\"strong\",{parentName:\"p\"},\"simple\"),\", \",mdx(\"strong\",{parentName:\"p\"},\"end-to-end\"),`\nexample of how to use Vault's `,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/auth/approle\"}),`AppRole authentication\nmethod`),`, along with Terraform and Chef, to address the\nchallenge of the `,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"secure introduction\")),` of an initial token to a target\nsystem.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The purpose of this guide is to provide the instruction to reproduce the working\nimplementation demo introduced in the `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef\"}),`Delivering Secret Zero: Vault AppRole\nwith Terraform and\nChef`),`\nwebinar.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"p\"},{href:\"https://youtu.be/OIcIzFWjThM\"}),mdx(\"img\",e({parentName:\"a\"},{src:\"/img/vault-approle-youtube.png\",alt:\"YouTube\"})))),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This is a proof of concept and \",mdx(\"strong\",{parentName:\"p\"},\"NOT SUITABLE FOR PRODUCTION USE\"),\".\")),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-material\",\"aria-label\":\"reference material permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-material\",\"aria-hidden\":\"\"})),\"Reference Material\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/auth/approle\"}),\"AppRole Auth Method\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.hashicorp.com/blog/authenticating-applications-with-vault-approle\"}),\"Authenticating Applications with HashiCorp Vault AppRole\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef\"}),`Delivering Secret Zero: Vault AppRole with Terraform and\nChef`))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"20 minutes\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#challenge\",\"aria-label\":\"challenge permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"challenge\",\"aria-hidden\":\"\"})),\"Challenge\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The goal of the AppRole authentication method is to provide a mechanism for the\nsecure introduction of secrets to target systems (servers, applications,\ncontainers, etc.).`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The question becomes what systems within our environment do we trust to handle\nor deliver the `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\" to our target systems.\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#solution\",\"aria-label\":\"solution permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"solution\",\"aria-hidden\":\"\"})),\"Solution\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Use \",mdx(\"em\",{parentName:\"p\"},\"Trusted Entities\"),` to deliver the AppRole authentication values. For\nexample, use Terraform to deliver your `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),` or embed it into your AMI or\nDockerfile. Then you might use Jenkins or Chef to obtain the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/secret-mgmt/cubbyhole\"}),\"response-wrapped\"),\" \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),` and deliver it\nto the target system.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`AppRole allows us to securely introduce the authentication token to the target\nsystem by preventing any single system from having full access to an\nauthentication token that does not belong to. This helps us maintain the\nsecurity principles of `,mdx(\"strong\",{parentName:\"p\"},\"least privilege\"),\" and \",mdx(\"strong\",{parentName:\"p\"},\"non-repudiation\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The important thing to note here is that regardless of what systems are\nconsidered as `,mdx(\"em\",{parentName:\"p\"},\"Trusted Entities\"),\", the same pattern applies.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"For example:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"With Chef, you might use the \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/hashicorp/vault-ruby\"}),\"Vault Ruby Gem\"),`\nfor simplified interaction with Vault APIs`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Terraform provides a Vault provider: \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.terraform.io/docs/providers/vault/index.html\"}),\"Provider: Vault - Terraform by HashiCorp\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),`For Jenkins, you might use the Vault CLI or APIs directly, as described here:\n`,mdx(\"a\",e({parentName:\"li\"},{href:\"http://nicolas.corrarello.com/general/vault/security/ci/2017/04/23/Reading-Vault-Secrets-in-your-Jenkins-pipeline.html\"}),\"Reading Vault Secrets in your Jenkins pipeline\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This guide assumes that you are proficient enough to perform basic Terraform\ntasks. If you are not familiar with Terraform, refer to the `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.terraform.io/intro/getting-started/install.html\"}),`online\ndocumentation`),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The following AWS resources are required to perform this demo:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"An \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html\"}),\"Amazon S3 bucket\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"An \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_change-permissions.html\"}),\"IAM user credential with administrator permissions\"),`\n(to be able to create additional IAM policies and instance profiles)`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#download-demo-assets\",\"aria-label\":\"download demo assets permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"download-demo-assets\",\"aria-hidden\":\"\"})),\"Download demo assets\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Clone or download the demo assets from the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault-guides/tree/master/identity/vault-chef-approle\"}),\"hashicorp/vault-guides\"),`\nGitHub repository to perform the steps described in this guide.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The following assets can be found in the repository:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Chef cookbook (\",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/chef/cookbooks\")),`): A sample cookbook with a recipe that installs NGINX\nand demonstrates Vault Ruby Gem functionality used to interact with Vault APIs.`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Terraform configurations (\",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/terraform-aws\")),\"):\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/terraform-aws/mgmt-node\")),`: Configuration to set up a management\nserver running both Vault and Chef Server, for demo purposes.`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/terraform-aws/chef-node\")),`: Configuration to set up a Chef node and\nbootstrap it with the Chef Server, passing in Vault's AppRole RoleID and the\nappropriate Chef run-list.`))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Vault configuration (\",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/scripts\")),`): Data scripts used to configure the\nappropriate mounts and policies in Vault for this demo.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The scenario in this guide uses Terraform and Chef as trusted entities to\ndeliver `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-tf-chef.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`For the simplicity of the demonstration, both Vault and Chef are installed on\nthe same node. Terraform provisions the node which contains the `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),` as an\nenvironment variable. Chef pulls the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\" from Vault.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Provisioning for this demo happens in 2 phases:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#phase1\"}),\"Phase 1 - Provision our Vault plus Chef Server\"),mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-1-provision-the-vault-and-chef-server\"}),\"Step 1: Provision the Vault and Chef Server\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-2-initialize-and-unseal-vault\"}),\"Step 2: Initialize and Unseal Vault\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-3-approle-setup\"}),\"Step 3: AppRole Setup\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-4-configure-tokens-for-terraform-and-chef\"}),\"Step 4: Configure Tokens for Terraform and Chef\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-5-save-the-token-in-a-chef-data-bag\"}),\"Step 5: Save the Token in a Chef Data Bag\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-6-write-secrets\"}),\"Step 6: Write Secrets\")))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#phase2\"}),\"Phase 2 - Provision our Chef Node to Show AppRole Login\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#phase1\",\"aria-label\":\"phase 1 provision our vault chef server permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h __compat\",id:\"phase1\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"phase-1-provision-our-vault-chef-server\",\"aria-hidden\":\"\"})),\"Phase 1: Provision our Vault \u0026 Chef Server\"),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-1-provision-the-vault-and-chef-server\",\"aria-label\":\"step 1 provision the vault and chef server permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-provision-the-vault-and-chef-server\",\"aria-hidden\":\"\"})),\"Step 1: Provision the Vault and Chef Server\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This provides a quick and simple Vault and Chef Server configuration to help you\nget started.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This is done for demonstration purpose and \",mdx(\"strong\",{parentName:\"p\"},`NOT a recommended\npractice`),\" for production.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`In this phase, you use Terraform to spin up a server (and associated AWS\nresources) with both Vault and Chef Server installed. Once this server is up and\nrunning, you'll complete the appropriate configuration steps in Vault to set up\nour AppRole and tokens for use in the demo.`),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"If using \",mdx(\"em\",{parentName:\"p\"},\"Terraform Enterprise\"),\", \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.terraform.io/docs/enterprise/getting-started/workspaces.html\"}),`create a\nWorkspace`),`\nfor this repo and set the appropriate Terraform/Environment variables using the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars.example\"),` file as a reference. Follow the instructions in the\ndocumentation to perform the appropriate setup in Terraform Enterprise.`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#using-terraform-open-source\",\"aria-label\":\"using terraform open source permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"using-terraform-open-source\",\"aria-hidden\":\"\"})),\"Using Terraform Open Source:\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 1:\"),\" Change the working directory (\",mdx(\"inlineCode\",{parentName:\"p\"},\"cd\"),`) to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"identity/vault-chef-approle/terraform-aws/mgmt-node\"),\".\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\".\"),`\n`,\"\\u251C\\u2500\\u2500 main.tf\",`\n`,\"\\u251C\\u2500\\u2500 outputs.tf\",`\n`,\"\\u251C\\u2500\\u2500 templates\",`\n`,\"\\u2502\\xA0\\xA0 \\u2514\\u2500\\u2500 userdata-mgmt-node.tpl\",`\n`,\"\\u251C\\u2500\\u2500 terraform.tfvars.example\",`\n`,\"\\u2514\\u2500\\u2500 variables.tf\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 2:\"),\" Update the \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars.example\"),` file to match your account and\nrename it to `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"At minimum, replace the following variable with appropriate values:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"s3_bucket_name\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vpc_id\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"subnet_id\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"key_name\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"ec2_pem\")))),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`NOTE: If your VPC, subnet and EC2 key pair were created on a region other than\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"us-east-1\"),\", be sure to set the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"aws_region\")),\" value to match your chosen region.\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 3:\"),\" Perform a \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform init\"),` to pull down the necessary provider resources.\nThen `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform plan\"),` to verify your changes and the resources that will be\ncreated. If all looks good, then perform a `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform apply\"),` to provision the\nresources. The Terraform output will display the public IP address to SSH into\nyour server.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"terraform init\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Initializing provider plugins...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Terraform has been successfully initialized!\"),`\n`,`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"terraform plan\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Plan: 5 to add, 0 to change, 0 to destroy.\"),`\n`,`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"terraform apply\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Apply complete! Resources: 5 added, 0 changed, 0 destroyed.\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Outputs:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"vault-public-ip = 192.0.2.0\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Terraform output will display the public IP address to SSH into\nyour server.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"For example:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"ssh\"),\" -i \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"/path/to/EC2/private_key.pem\"'),\" ubuntu@192.0.2.0\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 4:\"),` Initial setup of the Chef server takes several minutes. Once you can\nSSH into your mgmt server, run `,mdx(\"inlineCode\",{parentName:\"p\"},\"tail -f /var/log/tf-user-data.log\"),` to see when\nthe initial configuration is complete.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"tail\"),\" -f /var/log/tf-user-data.log\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"When you see the following message, the initial setup is complete.\"),mdx(\"pre\",e({},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"+ echo '2018/03/27 21:53:06 /var/lib/cloud/instance/scripts/part-001: Complete'\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`You can find the following subfolders in\nyour home directory:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/home/ubuntu/vault-chef-approle-demo\")),\": root of our project\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/home/ubuntu/vault-chef-approle-demo/chef\")),`: root of our Chef app; this is\nwhere our `,mdx(\"inlineCode\",{parentName:\"li\"},\"knife\"),\" configuration is located (\",mdx(\"inlineCode\",{parentName:\"li\"},\".chef/knife.rb\"),\")\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/home/ubuntu/vault-chef-approle-demo/scripts\")),`: there's a\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"vault-approle-setup.sh\"),` script located here to help automate the setup of\nVault, or you can follow along in the rest of this README to configure Vault\nmanually`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-2-initialize-and-unseal-vault\",\"aria-label\":\"step 2 initialize and unseal vault permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-initialize-and-unseal-vault\",\"aria-hidden\":\"\"})),\"Step 2: Initialize and Unseal Vault\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Before moving on, set your working environment variables in your mgmt server:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_ADDR\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"http://127.0.0.1:8200\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_SKIP_VERIFY\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"true\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Before you can do anything in Vault, you need to initialize and unseal it.\nPerform `,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"one\")),\" of the following:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"Option 1:\"),\" Run the \",mdx(\"inlineCode\",{parentName:\"li\"},\"/home/ubuntu/demo_setup.sh\"),` script to get up and running, and proceed to\n`,mdx(\"a\",e({parentName:\"li\"},{href:\"#phase2\"}),\"Phase 2 - Provision our Chef Node to Show AppRole Login\"),\".\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"Option 2:\"),\" Continue onto \",mdx(\"a\",e({parentName:\"li\"},{href:\"#step-3-approle-setup\"}),\"Step 3: AppRole Setup\"),` to\nset up the demo environment `,mdx(\"strong\",{parentName:\"li\"},mdx(\"em\",{parentName:\"strong\"},\"manually\")),\".\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-3-approle-setup\",\"aria-label\":\"step 3 approle setup permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-approle-setup\",\"aria-hidden\":\"\"})),\"Step 3: AppRole Setup\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"First, initialize and unseal the Vault server using a shortcut.\"),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"This is a convenient shortcut for demo. \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"DO NOT DO THIS IN PRODUCTION!!!\")))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Refer to the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/intro/getting-started/deploy#initializing-the-vault\"}),\"online documentation for initializing and unsealing\"),\" Vault for more details.\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Initialize the Vault server and write out the unseal keys and root token into files\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent\",`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),`'{\"secret_shares\": 1, \"secret_threshold\": 1}'`),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"${VAULT_ADDR}\"),\"/v1/sys/init \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"jq -r .root_token \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),\" /home/ubuntu/vault-chef-approle-demo/root-token\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"jq -r .keys\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"0\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),\" /home/ubuntu/vault-chef-approle-demo/unseal-key\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Unseal vault\"),`\n`,\"$ vault operator unseal \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$(\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" /home/ubuntu/vault-chef-approle-demo/unseal-key\",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\")\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Set the root token to VAULT_TOKEN env var\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"VAULT_TOKEN\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$(\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" /home/ubuntu/vault-chef-approle-demo/root-token\",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\")\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`In the next few steps, you will create a number of policies and tokens within\nVault. Below is a table that summarizes them:`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Policy\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Description\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Token Attachment\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"app-1-secret-read\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Sets the policy for the final token that will be delivered via the AppRole login\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"None. This will be delivered to the client upon AppRole login\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"app-1-approle-roleid-get\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Sets the policy for the token that you'll give to Terraform to deliver the RoleID (only)\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"roleid-token\"))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"terraform-token-create\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"The Terraform Vault provider doesn't use the token supplied to it directly. This is to prevent the token from being exposed in Terraform's state file. Instead, the Token given to Terraform needs to have the capability to create child tokens with short TTLs. See \",mdx(\"a\",e({parentName:\"td\"},{href:\"https://www.terraform.io/docs/providers/vault/index.html#token\"}),\"here\"),\" for more info\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"roleid-token\"))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"app-1-approle-secretid-create\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Sets the policy for the token that you'll store in the Chef Data Bag. This will only be able to pull our AppRole's SecretID\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"secretid-token\"))))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`These setups only need to be performed upon initial creation of an AppRole, and\nwould typically be done by a Vault administrator.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Now that you have your Vault server unsealed, you can begin to set up necessary\npolicies, AppRole auth method, and tokens.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-1-set-up-our-approle-policy\",\"aria-label\":\"task 1 set up our approle policy permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-1-set-up-our-approle-policy\",\"aria-hidden\":\"\"})),\"Task 1: Set up our AppRole policy\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This is the policy that will be attached to \",mdx(\"em\",{parentName:\"p\"},\"secret zero\"),` which you are\ndelivering to our application (`,mdx(\"strong\",{parentName:\"p\"},\"app-1\"),\").\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy to apply to AppRole token\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-secret-read.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"secret/app-1\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"read\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\", \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"list\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-secret-read policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @app-1-secret-read.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/app-1-secret-read\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy to apply to AppRole token\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-secret-read.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"secret/app-1\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [\"read\", \"list\"]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-secret-read policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" app-1-secret-read app-1-secret-read.hcl\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-2-enable-the-approle-authentication-method\",\"aria-label\":\"task 2 enable the approle authentication method permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-2-enable-the-approle-authentication-method\",\"aria-hidden\":\"\"})),\"Task 2: Enable the AppRole authentication method\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload for invoking sys/auth API endpoint\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" approle.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"type\": \"approle\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"description\": \"Demo AppRole auth method\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Enable AppRole auth backend\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @approle.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/auth/approle\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault auth \",mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"enable\"),\" -description\",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"Demo AppRole auth method\"'),\" approle\")),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-3-configure-the-approle\",\"aria-label\":\"task 3 configure the approle permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-3-configure-the-approle\",\"aria-hidden\":\"\"})),\"Task 3: Configure the AppRole\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Now, you are going to create an AppRole role named, \",mdx(\"strong\",{parentName:\"p\"},\"app-1\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload containing AppRole auth method configuration\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# TTL is set to 10 minutes, and Max TTL to be 30 minutes\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-role.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"role_name\": \"app-1\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"bind_secret_id\": true,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"secret_id_ttl\": \"10m\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"secret_id_num_uses\": \"1\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"token_ttl\": \"10m\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"token_max_ttl\": \"30m\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"period\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'        \"app-1-secret-read\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"    ]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# AppRole backend configuration\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @app-1-approle-role.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/auth/approle/role/app-1\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# TTL is set to 10 minutes, and Max TTL to be 30 minutes\"),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" auth/approle/role/app-1 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"policies\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-secret-read\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"token_ttl\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"10m\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"token_max_ttl\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"30m\"'),`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-4-configure-tokens-for-terraform-and-chef\",\"aria-label\":\"step 4 configure tokens for terraform and chef permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-configure-tokens-for-terraform-and-chef\",\"aria-hidden\":\"\"})),\"Step 4: Configure Tokens for Terraform and Chef\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Now, you're ready to configure the policies and tokens to Terraform and Chef to\ninteract with Vault. Remember, the point here is that you are giving each system\na `,mdx(\"em\",{parentName:\"p\"},\"limited\"),\" token that is only able to pull either the \",mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" or \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),`,\n`,mdx(\"em\",{parentName:\"p\"},\"but not both\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-tf-chef-2.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-1-create-a-policy-and-token-for-terraform\",\"aria-label\":\"task 1 create a policy and token for terraform permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-1-create-a-policy-and-token-for-terraform\",\"aria-hidden\":\"\"})),\"Task 1: Create a policy and token for Terraform\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Create a token with appropriate policies allowing Terraform to pull\nthe `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" from Vault:\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve RoleID from Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-roleid-get.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"auth/approle/role/app-1/role-id\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"read\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @app-1-approle-roleid-get.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/app-1-approle-roleid-get\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# For Terraform\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# See: https://www.terraform.io/docs/providers/vault/index.html#token\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy granting to create tokens required by Terraform\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" terraform-token-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"/auth/token/create\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"update\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @terraform-token-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/terraform-token-create\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload to configure token for Terraform to pull RoleID\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" roleid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"app-1-approle-roleid-get\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"terraform-token-create\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"meta\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"user\": \"terraform-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"ttl\": \"720h\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"renewable\": true'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token and save it in roleid-token.json\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @roleid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/auth/token/create \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),\" roleid-token.json\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The token and associated metadata will be written out to the file\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"roleid-token.json\"),\". The \",mdx(\"inlineCode\",{parentName:\"p\"},\"client_token\"),` value is what you'll give to Terraform.\nThe file should look similar to the following:`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" roleid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"request_id\": \"2e1d05eb-988d-4cf7-7b6a-d2668de31536\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_id\": \"\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_duration\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"data\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"wrap_info\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"warnings\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"auth\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"client_token\": \"6a7ad093-42ab-885e-3d67-6d51a5583da6\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"accessor\": \"f6170506-ee0f-5a59-8478-e0aac2d3259f\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"app-1-approle-roleid-get\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"default\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"terraform-token-create\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"metadata\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"user\": \"terraform-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"lease_duration\": 2592000,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"renewable\": true,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"entity_id\": \"\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  }\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve RoleID from Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-roleid-get.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"auth/approle/role/app-1/role-id\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [ \"read\" ]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" app-1-approle-roleid-get app-1-approle-roleid-get.hcl\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# For Terraform\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# See: https://www.terraform.io/docs/providers/vault/index.html#token\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy granting to create tokens required by Terraform\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" terraform-token-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"auth/token/create\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [ \"update\" ]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" terraform-token-create terraform-token-create.hcl\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token and save it in roleid-token.txt\"),`\n`,\"$ vault token create -policy\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-approle-roleid-get\"'),\" -policy\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"terraform-token-create\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      -metadata\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"user\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"terraform-user\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),\" roleid-token.txt\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The token and associated metadata will be written out to the file\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"roleid-token.txt\"),\". The \",mdx(\"inlineCode\",{parentName:\"p\"},\"token\"),` value is what you'll give to Terraform.\nThe file should look similar to the following:`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" roleid-token.txt\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Key                Value\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"---                -----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token              2600aeda-6385-c163-7171-543b1e1fabcf\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_accessor     6ef835e3-4948-8c61-1e89-3625ca31fd84\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_duration     768h\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_renewable    true\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_policies     [app-1-approle-roleid-get default terraform-token-create]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_meta_user    terraform-demo\"),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-2-create-a-policy-and-token-for-chef\",\"aria-label\":\"task 2 create a policy and token for chef permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-2-create-a-policy-and-token-for-chef\",\"aria-hidden\":\"\"})),\"Task 2: Create a policy and token for Chef\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Create a token with appropriate policies allowing Chef to pull the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),`\nfrom Vault:`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve SecretID\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-secretid-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"auth/approle/role/app-1/secret-id\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"update\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-secretid-create policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --data @app-1-approle-secretid-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/app-1-approle-secretid-create\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload to invoke auth/token/create endpoint\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" secretid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"app-1-approle-secretid-create\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"meta\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"user\": \"chef-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"ttl\": \"720h\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"renewable\": true'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token for Chef to get SecretID from Vault and store it in secretid-token.json\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @secretid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/auth/token/create \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),\" secretid-token.json\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The resulting file should look like this:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" secretid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"request_id\": \"6f6ad8a1-fedb-b838-60ce-87999f01aff6\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_id\": \"\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_duration\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"data\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"wrap_info\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"warnings\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"auth\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"client_token\": \"cdfdb7a0-d7a6-3769-927d-0ace297726ea\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"accessor\": \"88e8aaca-1584-4881-3368-d9cb5cd7ddae\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"app-1-approle-secretid-create\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"default\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"metadata\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"user\": \"chef-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"lease_duration\": 2592000,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"renewable\": true,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"entity_id\": \"\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  }\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve SecretID\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-secretid-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"auth/approle/role/app-1/secret-id\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [ \"update\" ]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-secretid-create policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" app-1-approle-secretid-create app-1-approle-secretid-create.hcl\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token for Chef to get SecretID from Vault and store it in secretid-token.txt\"),`\n`,\"$ vault token create -policy\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-approle-secretid-create\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      -metadata\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"user\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"chef-demo\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),\" secretid-token.txt\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The resulting file should look like this:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" secretid-token.txt\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Key                Value\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"---                -----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token              20d69183-59cb-c953-6dea-34f5f1bbe5f7\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_accessor     a17e7a43-c14a-b96a-0014-9149d218e74a\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_duration     768h\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_renewable    true\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_policies     [app-1-approle-secretid-create default]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_meta_user    chef-demo\"),`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-5-save-the-token-in-a-chef-data-bag\",\"aria-label\":\"step 5 save the token in a chef data bag permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-5-save-the-token-in-a-chef-data-bag\",\"aria-hidden\":\"\"})),\"Step 5: Save the Token in a Chef Data Bag\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`At this point, you have a client token generated for Terraform and another for\nChef server to log into Vault. For the sake of simplicity, you can put the\nChef's client token (`,mdx(\"inlineCode\",{parentName:\"p\"},\"secretid-token.json\"),\") in a \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.chef.io/data_bags.html\"}),`Data\nBag`),` which is fine because this token can\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"only\")),\" retrieve \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),` from Vault which is not much of a use without a\ncorresponding `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Now, create a Chef Data Bag and put the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\" token (\",mdx(\"inlineCode\",{parentName:\"p\"},\"secretid-token.json\"),`)\nalong with the rest of its metadata.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"cd\"),\" /home/ubuntu/vault-chef-approle-demo/chef/\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"#\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"Use the path \",mdx(\"span\",e({parentName:\"span\"},{className:\"token keyword\"}),\"for\"),\" where you created this \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"file\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token keyword\"}),\"in\"),\" the previous step\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"#\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"You\",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"'re just adding an '\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"id\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"' field to the file as that'\"),\"s a required field \",mdx(\"span\",e({parentName:\"span\"},{className:\"token keyword\"}),\"for\"),\" data bags\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" /home/ubuntu/secretid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq --arg \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"id\"),\" approle-secretid-token \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"'. + {id: \",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$id\"),\"}'\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"\u003e\"),\" secretid-token.json\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag create secretid-token\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag from \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"file\"),\" secretid-token secretid-token.json\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag list\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag show secretid-token\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag show secretid-token approle-secretid-token\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The last step should show the following output:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag show secretid-token approle-secretid-token\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"WARNING: Unencrypted data bag detected, ignoring any provided secret options.\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"auth:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  accessor:       88e8aaca-1584-4881-3368-d9cb5cd7ddae\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  client_token:   cdfdb7a0-d7a6-3769-927d-0ace297726ea\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  entity_id:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  lease_duration: 2592000\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  metadata:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  policies:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    app-1-approle-secretid-create\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    default\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  renewable:      true\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"data:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"id:             approle-secretid-token\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"lease_duration: 0\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"lease_id:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"renewable:      false\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"request_id:     6f6ad8a1-fedb-b838-60ce-87999f01aff6\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"warnings:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"wrap_info:\"),`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-6-write-secrets\",\"aria-label\":\"step 6 write secrets permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-6-write-secrets\",\"aria-hidden\":\"\"})),\"Step 6: Write Secrets\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Let's write some test data in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"secret/app-1\"),` path so that the target app\nwill have some secret to retrieve from Vault at a later step.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Write some demo secrets\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" demo-secrets.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\u003c\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'EOF'\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"username\": \"app-1-user\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"password\": \"$up3r$3cr3t!\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @demo-secrets.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/secret/app-1\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Verify that you can read back the data:\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request GET \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/secret/app-1 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" jq\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"request_id\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"1f73c7ee-27fa-bad0-9c77-b330eef1ea88\"'),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"lease_id\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"\"'),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"renewable\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" false,\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"lease_duration\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"2764800\"),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"data\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"password\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$up3r\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$3cr3t\"),'!\"'),\",\",`\n`,\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"username\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-user\"'),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"wrap_info\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null,\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"warnings\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null,\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"auth\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Write some demo secrets\"),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" secret/app-1 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"username\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-user\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"password\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"\\\\',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$up3r\"),\"\\\\\",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$3cr3t\"),'!\"'),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Verify that you can read back the data:\"),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"read\"),\" secret/app-1\",`\n`,\"Key                 Value\",`\n`,\"---                 -----\",`\n`,\"refresh_interval    768h\",`\n`,\"password            \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$up3r\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$3cr3t\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"!\"),`\n`,\"username            app-1-user\",`\n`)),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),`At this point, just about all the pieces are in place. Remember, these setup\nsteps will only need to be performed upon initial creation of an AppRole, and\nwould typically be done by a Vault administrator.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#phase2\",\"aria-label\":\"phase 2 provision our chef node to show approle login permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h __compat\",id:\"phase2\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"phase-2-provision-our-chef-node-to-show-approle-login\",\"aria-hidden\":\"\"})),\"Phase 2: Provision our Chef Node to Show AppRole Login\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"To complete the demo, run the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"chef-node\")),` Terraform configuration to see how\neverything talks to each other.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-1-change-the-working-directory\",\"aria-label\":\"task 1 change the working directory permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-1-change-the-working-directory\",\"aria-hidden\":\"\"})),\"Task 1: Change the working directory\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Open another terminal on your host machine (\",mdx(\"strong\",{parentName:\"p\"},\"not\"),\" the \",mdx(\"inlineCode\",{parentName:\"p\"},\"mgmt-node\"),`)\nand `,mdx(\"inlineCode\",{parentName:\"p\"},\"cd\"),\" into the \",mdx(\"inlineCode\",{parentName:\"p\"},\"identity/vault-chef-approle/terraform-aws/chef-node\"),`\ndirectory:`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"cd\"),\" identity/vault-chef-approle/terraform-aws/chef-node\")),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-2-update-terraform-tfvars-example\",\"aria-label\":\"task 2 update terraform tfvars example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-2-update-terraform-tfvars-example\",\"aria-hidden\":\"\"})),\"Task 2: Update terraform.tfvars.example\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Replace the variable values in \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars.example\"),` to match your\nenvironment and save it as `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars\"),\" like you have done at \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step-1-provision-the-vault-and-chef-server\"}),\"Step 1\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Note the following:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Update the \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vault_address\")),\" and \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"chef_server_address\")),` variables with\nthe IP address of our `,mdx(\"inlineCode\",{parentName:\"li\"},\"mgmt-node\"),\" from above.\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Update the \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vault_token\")),\" variable with the \",mdx(\"inlineCode\",{parentName:\"li\"},\"RoleID\"),\" token from \",mdx(\"strong\",{parentName:\"li\"},\"Task 1\"),`\nin `,mdx(\"a\",e({parentName:\"li\"},{href:\"#step-4-configure-tokens-for-terraform-and-chef\"}),\"Step 4\"),\".\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"If you ran the \",mdx(\"inlineCode\",{parentName:\"li\"},\"demo-setup.sh\"),\" script (\",mdx(\"em\",{parentName:\"li\"},\"Option 1\"),`), retrieve the\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"client_token\"),\" in the \",mdx(\"inlineCode\",{parentName:\"li\"},\"/home/ubuntu/vault-chef-approle-demo/roleid-token.json\"),`\nfile:`)))),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" ~/vault-chef-approle-demo/roleid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\".auth.client_token\"'))),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-3-run-terraform\",\"aria-label\":\"task 3 run terraform permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-3-run-terraform\",\"aria-hidden\":\"\"})),\"Task 3: Run Terraform\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Perform a \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform init\"),` to pull down the necessary provider\nresources. Then `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform plan\"),` to verify your changes and the resources that\nwill be created. If all looks good, then perform a `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform apply\"),` to\nprovision the resources.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Terraform output will display the public IP address to SSH into your\nserver.`),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" If the \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform apply\"),' fails with \"',mdx(\"inlineCode\",{parentName:\"p\"},\"io: read/write on closed pipe\"),`\"\nerror, this is a `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/terraform/issues/17638\"}),`known\nissue`),` with Terraform\n0.11.4 and 0.11.5. Please try again with another Terraform version.`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"At this point, Terraform will perform the following actions:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Pull a \",mdx(\"inlineCode\",{parentName:\"li\"},\"RoleID\"),\" from our Vault server\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Provision an AWS instance\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Write the \",mdx(\"inlineCode\",{parentName:\"li\"},\"RoleID\"),\" to the AWS instance as an environment variable\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Run the Chef provisioner to bootstrap the AWS instance with our Chef Server\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),`Run our Chef recipe which will install NGINX, perform our AppRole login, get\nour secrets, and output them to our `,mdx(\"inlineCode\",{parentName:\"li\"},\"index.html\"),\" file\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-tf-chef-3.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Chef recipe can be found at\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"identity/vault-chef-approle/chef/cookbooks/vault_chef_approle_demo/recipes/default.rb\"),\".\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Configure address for Vault Gem\"),`\n`,\"Vault.address \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" ENV\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'VAULT_ADDR'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get AppRole RoleID from our environment variables (delivered via Terraform)\"),`\n`,\"var_role_id \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" ENV\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'APPROLE_ROLEID'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get Vault token from data bag (used to retrieve the SecretID)\"),`\n`,\"vault_token_data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" data_bag_item\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'secretid-token'\"),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'approle-secretid-token'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Set Vault token (used to retrieve the SecretID)\"),`\n`,\"Vault.token \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" vault_token_data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'auth'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'client_token'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get AppRole SecretID from Vault\"),`\n`,\"var_secret_id \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" Vault.approle.create_secret_id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'app-1'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\".data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\":secret_id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-4-verification\",\"aria-label\":\"task 4 verification permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-4-verification\",\"aria-hidden\":\"\"})),\"Task 4: Verification\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Once Terraform completes the \",mdx(\"inlineCode\",{parentName:\"p\"},\"apply\"),` operation, it will output the public IP\naddress of our new server. You can plug that IP address into a browser to see\nthe output. It should look similar to the following:`),mdx(\"pre\",e({},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"Role ID:\",`\n`,\"f6286b97-246e-9fb4-4d9f-0c9465451851\",`\n`,`\n`,\"Secret ID:\",`\n`,\"72f4b60c-26d0-d947-5026-153943174831\",`\n`,`\n`,\"AppRole Token:\",`\n`,\"d11d81e4-0ba1-fefc-03f8-e5f06793b60d\",`\n`,`\n`,\"Read Our Secrets:\",`\n`,'{:password=\u003e\"$up3r$3cr3t!\", :username=\u003e\"app-1-user\"}',`\n`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#additional-references\",\"aria-label\":\"additional references permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"additional-references\",\"aria-hidden\":\"\"})),\"Additional References\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The following is a curated list of webinars, blogs and GitHub repositories that\nadd additional context to fill out the concepts discussed in the webinar and\ndemonstrated in the code:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.youtube.com/watch?v=skENC9aXgco\"}),\"Managing Secrets in a Container Environment by Jeff Mitchell\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.hashicorp.com/blog/using-hashicorps-vault-with-chef\"}),\"Using HashiCorp's Vault with Chef written by Seth Vargo\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://blog.chef.io/2016/12/12/manage-secrets-with-chef-and-hashicorps-vault/\"}),\"Manage Secrets with Chef and HashiCorps Vault by Seth Vargo \u0026 JJ Asghar\"),mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/sethvargo/vault-chef-webinar\"}),\"Associated GitHub repository\")))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"http://blog.alanthatcher.io/vault-approle-authentication/\"}),\"Vault AppRole Authentication written by Alan Thatcher\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"http://blog.alanthatcher.io/integrating-chef-and-hashicorp-vault/\"}),\"Integrating Chef and HashiCorp Vault written by Alan Thatcher\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/hashicorp/vault-ruby\"}),\"Vault Ruby Client\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Watch the video recording of the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef\"}),`Delivering Secret Zero: Vault AppRole with\nTerraform and\nChef`),`\nwebinar which talks about the usage of AppRole with Terraform and Chef as its\ntrusted entities.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying \u0026 Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup \u0026 Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities \u0026 Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true},"page":"/guides/[[...page]]","query":{"page":["identity","approle-trusted-entities"]},"buildId":"pcCu12fyWK7PoQNj4BZ7-","assetPrefix":"/docs/vault_v1.8.x","isFallback":false,"gsp":true}</script><script nomodule="" src="/docs/vault_v1.8.x/_next/static/chunks/polyfills-e4c38ea28892f36667af.js"></script><script src="/docs/vault_v1.8.x/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/framework.3519294afa6a9ab53973.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/2bc72d9a08d5bd816ae6b580871df9fb671d43bb.52fd5ef7a8ab7d8fc0dd.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/9a5be27b89b50ff891e514a88cd42f143404f9a6.033857d62f5a01edf3b3.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/main-b0f1f3f8bd3bddd4e6cd.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/b49b08e2da573413c730dfc51ae423f080a0c275.00ac32ee45240d5b343f.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/b1542cc239bf56c8a14913c0a930efe682b5cf86.32bb900ad80311488529.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/pages/_app-d714c55ad24af91621ba.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/7dbdcaca29374b13a0799a901e26613767d72de2.d088888a4a1113f2bb24.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/92f0085e0e6c1f10382de10b8861ce89d7c192a2.e5495ede8461fc33ed98.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b.5052eda5c7f43583669b.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b_CSS.f6584926f1188e1b5b3e.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/pages/guides/%5B%5B...page%5D%5D-72f9db6e509b49c776de.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/pcCu12fyWK7PoQNj4BZ7-/_buildManifest.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/pcCu12fyWK7PoQNj4BZ7-/_ssgManifest.js" async=""></script><script nomodule="">window.MSInputMethodContext && document.documentMode && document.write('<script src="/ie-custom-properties.js"><\x2fscript>');</script></body></html>