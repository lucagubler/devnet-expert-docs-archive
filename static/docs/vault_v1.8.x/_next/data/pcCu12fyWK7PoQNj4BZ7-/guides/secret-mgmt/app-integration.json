{"pageProps":{"currentPath":"secret-mgmt/app-integration","frontMatter":{"layout":"guides","page_title":"Direct Application Integration - Guides","description":"This guide demonstrates the use of Consul Template and Envconsul tools. To\nunderstand the difference between the two tools, you are going to retrieve the\nsame information from Vault."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/secret-mgmt/app-integration.mdx","mdxSource":{"compiledSource":"var m=Object.defineProperty;var o=Object.prototype.hasOwnProperty;var p=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable;var l=(a,n,t)=>n in a?m(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=>{for(var t in n||(n={}))o.call(n,t)&&l(a,t,n[t]);if(p)for(var t of p(n))r.call(n,t)&&l(a,t,n[t]);return a};var i=(a,n)=>{var t={};for(var s in a)o.call(a,s)&&n.indexOf(s)<0&&(t[s]=a[s]);if(a!=null&&p)for(var s of p(a))n.indexOf(s)<0&&r.call(a,s)&&(t[s]=a[s]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:a}=s,n=i(s,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#direct-application-integration\",\"aria-label\":\"direct application integration permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"direct-application-integration\",\"aria-hidden\":\"\"})),\"Direct Application Integration\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`A modern system requires access to a multitude of secrets: database credentials,\nAPI keys for external services, credentials for service-oriented architecture\ncommunication, etc. Vault steps in to provide a centralized secret management\nsystem. The next step is to decide how your applications acquire the secrets\nfrom Vault.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This guide introduces \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"Consul Template\")),\" and \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"Envconsul\")),` to help you\ndetermine if these tools speed up the integration of your applications once\nsecrets are securely managed by Vault.`),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" Both \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/consul-template\"}),\"Consul Template\"),`\nand `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/consul-template\"}),\"Envconsul\"),` are open source\ntools.`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#consul-template\",\"aria-label\":\"consul template permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"consul-template\",\"aria-hidden\":\"\"})),\"Consul Template\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Despite its name, Consul Template does \",mdx(\"strong\",{parentName:\"p\"},\"not\"),` require a Consul cluster to\noperate. It retrieves secrets from Vault and manages the acquisition and renewal\nlifecycle.`),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#envconsul\",\"aria-label\":\"envconsul permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"envconsul\",\"aria-hidden\":\"\"})),\"Envconsul\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Envconsul launches a subprocess which dynamically populates environment\nvariables from secrets read from Vault. Your applications then read those\nenvironment variables. Despite its name, Envconsul does `,mdx(\"strong\",{parentName:\"p\"},\"not\"),` require a\nConsul cluster to operate. It enables flexibility and portability for\napplications across systems.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-material\",\"aria-label\":\"reference material permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-material\",\"aria-hidden\":\"\"})),\"Reference Material\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/hashicorp/consul-template\"}),\"Consul Template\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/hashicorp/consul-template\"}),\"Envconsul\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/guides/secret-mgmt/dynamic-secrets\"}),\"Secret as a Service: Dynamic Secrets\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"10 minutes\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#challenge\",\"aria-label\":\"challenge permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"challenge\",\"aria-hidden\":\"\"})),\"Challenge\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`If your application code or script contains some secrets (e.g. database\ncredentials), it makes a good sense to manage the secrets using Vault. However,\nit means that your application will need to retrieve the secrets at runtime.\nDoes that mean the application developers must make some code change?`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Is there an easy way to retrieve the secrets from Vault and populate the\napplication code or script with secrets as needed?`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#solution\",\"aria-label\":\"solution permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"solution\",\"aria-hidden\":\"\"})),\"Solution\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Both \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"Consul Template\")),\" and \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"Envconsul\")),` provide first-class support for\nVault. Leveraging these tools can minimize the level of changes introduced to\nyour applications. Depending on the current application design, you may not need\nto make minimal to no code change.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"To perform the tasks described in this guide, you need:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"A \",mdx(\"a\",e({parentName:\"li\"},{href:\"/intro/getting-started/install\"}),\"Vault environment\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://releases.hashicorp.com/consul-template/\"}),\"Consul Template\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://releases.hashicorp.com/envconsul/\"}),\"Envconsul\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#postgresql\"}),\"PostgreSQL\"))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#postgresql\",\"aria-label\":\"postgresql permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"postgresql\",\"aria-hidden\":\"\"})),\"PostgreSQL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This guide uses the database secrets engine to demonstrate the use of Consul\nTemplate and Envconsul. Therefore, you need a\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.postgresql.org/download/\"}),\"PostgreSQL\"),\" server to connect to.\"),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Complete the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/secret-mgmt/dynamic-secrets\"}),`Secret as a Service: Dynamic\nSecrets`),` guide first if you are not\nfamiliar with `,mdx(\"inlineCode\",{parentName:\"p\"},\"database\"),\" secrets engine.\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#policy-requirements\",\"aria-label\":\"policy requirements permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"policy-requirements\",\"aria-hidden\":\"\"})),\"Policy requirements\"),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" For the purpose of this guide, you can use \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"root\")),` token to work\nwith Vault. However, it is recommended that root tokens are only used for just\nenough initial setup or in emergencies. As a best practice, use tokens with\nappropriate set of policies based on your role in the organization.`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To perform all tasks demonstrated in this guide, your policy must include the\nfollowing permissions:`),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),'# Enable database secrets engines at \"database/\" path'),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sys/mounts/database\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Configure the database secret engine and create roles\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"database/*\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Write ACL policies\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sys/policy/*\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Manage tokens for Consul Template & Envconsul to use\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"auth/token/create\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sudo\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`If you are not familiar with policies, complete the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/identity/policies\"}),\"policies\"),\" guide.\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This guide demonstrates the use of Consul Template and Envconsul tools. To\nunderstand the difference between the two tools, you are going to retrieve the\nsame information from Vault.`),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step1\"}),\"Setup Database Secrets Engine\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step2\"}),\"Generate Client Token\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step3\"}),\"Use Consul Template to Populate DB Credentials\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step4\"}),\"Use Envconsul to Retrieve DB Credentials\"))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step1\",\"aria-label\":\"step 1 setup database secrets engine permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step1\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-setup-database-secrets-engine\",\"aria-hidden\":\"\"})),\"Step 1: Setup Database Secrets Engine\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"In this step, you are going to enable and configure the \",mdx(\"inlineCode\",{parentName:\"p\"},\"database\"),` secrets\nengine using `,mdx(\"inlineCode\",{parentName:\"p\"},\"postgresql-database-plugin\"),` where the database connection URL is\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"postgresql://root:rootpassword@localhost:5432/myapp\"),\".\"),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` Your database connection URL is most likely different from this\nexample. Be sure to use the correct `,mdx(\"a\",e({parentName:\"p\"},{href:\"/api/secret/databases/postgresql#connection_url\"}),\"connection URL\"),` to\nmatch your environment.`)),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Refer to the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/secrets/databases/postgresql\"}),`PostgreSQL Database Secrets\nEngine`),\" documentation or \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/secret-mgmt/dynamic-secrets\"}),`Secret as a\nService: Dynamic Secrets`),` guide if you\nare not familiar with `,mdx(\"inlineCode\",{parentName:\"p\"},\"database\"),` secrets engine. The detailed description of\nworking with `,mdx(\"inlineCode\",{parentName:\"p\"},\"database\"),\" secrets engine is out of scope for this guide.\")),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# First, enable the database secrets engine\"),`\n`,\"$ vault secrets \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"enable\"),\" database\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Configure the secret engine with appropriate parameter values\"),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" database/config/postgresql \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"plugin_name\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"postgresql-database-plugin \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"allowed_roles\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"* \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"connection_url\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"postgresql://root:rootpassword@localhost:5432/myapp\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create readonly.sql to define a role permission in SQL\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" readonly.sql \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),`CREATE ROLE \"{{name}}\" WITH LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}';`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'GRANT SELECT ON ALL TABLES IN SCHEMA public TO \"{{name}}\";'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),'# Create a role, \"readonly\"'),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" database/roles/readonly \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"db_name\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"postgresql \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"creation_statements\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"@readonly.sql \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"default_ttl\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"1h \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"max_ttl\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"24h\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Enable `database` secret engine using `/sys/mounts` endpoint\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),`'{\"type\":\"database\"}'`),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       https://127.0.0.1:8200/v1/sys/mounts/database\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Specify the database connection URL according to your environment\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" payload.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"plugin_name\": \"postgresql-database-plugin\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"allowed_roles\": \"*\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"connection_url\": \"postgresql://root:rootpassword@localhost:5432/myapp\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Configure the database secrets engine by passing the request payload\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @payload.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       http://127.0.0.1:8200/v1/database/config/postgresql\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the request payload to create a role\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" payload.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"db_name\": \"postgres\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"creation_statements\": [\"CREATE ROLE ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"{{name}}\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" WITH LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}';\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"   GRANT SELECT ON ALL TABLES IN SCHEMA public TO \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"{{name}}\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),';\"],'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"default_ttl\": \"1h\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"max_ttl\": \"24h\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create a role named, readonly\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @payload.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       http://127.0.0.1:8200/v1/database/roles/readonly\",`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step2\",\"aria-label\":\"step 2 generate client token permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step2\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-generate-client-token\",\"aria-hidden\":\"\"})),\"Step 2: Generate Client Token\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Consul Template tool itself is a Vault client. Therefore, it must have a valid\ntoken with policies permitting it to retrieve secrets from `,mdx(\"inlineCode\",{parentName:\"p\"},\"database\"),` secret\nengine you just configured in `,mdx(\"a\",e({parentName:\"p\"},{href:\"#step1\"}),\"Step 1\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"First, create a policy definition file, \",mdx(\"inlineCode\",{parentName:\"p\"},\"db_creds.hcl\"),`. This policy allows read\noperation on the `,mdx(\"inlineCode\",{parentName:\"p\"},\"database/creds/readonly\"),` path to obtain the dynamically\ngenerated username and password to access the PostgreSQL database. In addition,\nthe policy allows renewal of the lease if necessary.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"db_creds.hcl\")),\":\"),mdx(\"pre\",e({},{className:\"language-hcl\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-hcl\"}),\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"database/creds/readonly\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"capabilities\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"/sys/leases/renew\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"capabilities\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Now, create a policy named, \",mdx(\"inlineCode\",{parentName:\"p\"},\"db_creds\"),` and generate a token with this policy\nattached.`),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#cli-command-1\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"cli-command-1\",\"aria-hidden\":\"\"})),\"CLI Command\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create a `db_creds` policy\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" db_creds db_creds.hcl\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create a token with db_creds policy:\"),`\n`,\"$ vault token create -policy\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"db_creds\"'),`\n`,\"Key                  Value\",`\n`,\"---                  -----\",`\n`,\"token                89956bf1-6f4d-435d-4cf3-7496e9520a87\",`\n`,\"token_accessor       319eddff-42a1-eb2b-801e-dd8a0c0b07b4\",`\n`,\"token_duration       768h\",`\n`,\"token_renewable      \",mdx(\"span\",e({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"token_policies       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"db_creds\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"default\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"identity_policies    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"policies             \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"db_creds\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"default\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` This is the token that Consul Template uses to talk to Vault.\nCopy the `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"token\")),\" value and proceed to \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step3\"}),\"Step 3\"),\".\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-1\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-1\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create an API request payload\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" payload.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"policy\": \"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"database/creds/readonly\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\n\"}),\"\\\\n\"),\" capabilities = [ \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"read\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" ]\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\n\"}),\"\\\\n\"),\" } \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\n\"}),\"\\\\n\"),\" path \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"sys/leases/renew\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\n\"}),\"\\\\n\"),\" capabilities = [ \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"update\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" ] \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\n\"}),\"\\\\n\"),'}\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create db_creds policy\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @payload.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       http://127.0.0.1:8200/v1/sys/policy/db_creds\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Generate a new token with db_creds policy\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),`'{\"policies\": [\"db_creds\"]}'`),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       http://127.0.0.1:8200/v1/auth/token/create \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" jq\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`,\"   \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"auth\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"     \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"client_token\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"37413eca-96aa-1d47-d09d-d1cad322c419\"'),\",\",`\n`,\"     \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"accessor\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"a05aa3ce-b5d6-9e82-da7f-181d78d475e4\"'),\",\",`\n`,\"     \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"policies\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"db_creds\"'),\",\",`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"default\"'),`\n`,\"     \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\",\",`\n`,\"     \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"token_policies\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"db_creds\"'),\",\",`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"default\"'),`\n`,\"     \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\",\",`\n`,\"     \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` This is the token that Consul Template uses to talk to Vault.\nCopy the `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"client_token\")),\" value and proceed to \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step3\"}),\"Step 3\"),\".\"),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step3\",\"aria-label\":\"step 3 use consul template to populate db credentials permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step3\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-use-consul-template-to-populate-db-credentials\",\"aria-hidden\":\"\"})),\"Step 3: Use Consul Template to Populate DB Credentials\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Assume that your application requires PostgreSQL database credentials to read\ndata. Its configuration file, `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"config.yml\")),\" looks like:\"),mdx(\"pre\",e({},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'username: \"<DB_USRENAME>\"',`\n`,'password: \"<DB_PASSWORD>\"',`\n`,'database: \"myapp\"',`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"To have Consul Template to populate the \",mdx(\"inlineCode\",{parentName:\"p\"},\"<DB_USRENAME>\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"<DB_PASSWORD>\"),`, you\nneed to create a template file with Consul Template `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/consul-template/blob/master/docs/templating-language.md\"}),`templating\nlanguage`),\".\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Create a template file by replacing the username and password with\nConsul Template syntax and save it as `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"config.yml.tpl\")),`. The file should\ncontain the following:`),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"---\",`\n`,'{{- with secret \"database/creds/readonly\" }}',`\n`,'username: \"{{ .Data.username }}\"',`\n`,'password: \"{{ .Data.password }}\"',`\n`,'database: \"myapp\"',`\n`,\"{{- end }}\",`\n`)),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This template reads secrets from \",mdx(\"inlineCode\",{parentName:\"p\"},\"database/creds/readonly\"),`\npath in Vault. Set the `,mdx(\"inlineCode\",{parentName:\"p\"},\"username\"),' parameter value to \"',mdx(\"inlineCode\",{parentName:\"p\"},\".Data.username\"),`\" of\nthe secret output. Similarly, set the `,mdx(\"inlineCode\",{parentName:\"p\"},\"password\"),' to \"',mdx(\"inlineCode\",{parentName:\"p\"},\".Data.password\"),'\" value.'))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Execute the \",mdx(\"inlineCode\",{parentName:\"p\"},\"consul-template\"),\" command to populate \",mdx(\"inlineCode\",{parentName:\"p\"},\"config.yml\"),\" file.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"The Consul Template command is: \",mdx(\"inlineCode\",{parentName:\"p\"},'consul-template -template=\"<input_file>:<output_file>\"')),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"The input file is the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"config.yml.tpl\")),` and specify the desired output\nfile name to be `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"config.yml\")),\":\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ VAULT_TOKEN=<token> consul-template -template=\"config.yml.tpl:config.yml\" -once',`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"While \",mdx(\"inlineCode\",{parentName:\"p\"},\"<token>\"),\" is the token you copied at \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step2\"}),\"Step 2\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Open the generated \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"config.yml\")),` file to verify its content. It should\nlook similar to:`),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ cat config.yml\",`\n`,\"---\",`\n`,'username: \"v-token-readonly-tu17xrtz345uz643980r-1527630039\"',`\n`,'password: \"A1a-7s0z9y223x2rp6v9\"',`\n`,'database: \"myapp\"',`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"username\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"password\"),` were retrieved from Vault and populated in the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"config.yml\"),\" file.\"))),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Summary\"),`: You need to create a templated version of your application\nscripts to leverage Consul Template. However, it requires minimum effort to do\nso in comparison to writing an application which invokes Vault API to accomplish\nthe same.`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step4\",\"aria-label\":\"step 4 use envconsul to retrieve db credentials permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step4\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-use-envconsul-to-retrieve-db-credentials\",\"aria-hidden\":\"\"})),\"Step 4: Use Envconsul to Retrieve DB Credentials\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Create a file named, \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"app.sh\")),\" containing the following:\"),mdx(\"pre\",e({},{className:\"language-hcl\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"#!/usr/bin/env bash\"),`\n`,`\n`,\"cat \",mdx(\"span\",e({parentName:\"code\"},{className:\"token heredoc string\"}),\"<<EOT\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token heredoc string\"}),\"My connection info is:\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token heredoc string\"}),'username: \"${DATABASE_CREDS_READONLY_USERNAME}\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token heredoc string\"}),'password: \"${DATABASE_CREDS_READONLY_PASSWORD}\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token heredoc string\"}),'database: \"my-app\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token heredoc string\"}),\"EOT\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The main difference here is that the \",mdx(\"inlineCode\",{parentName:\"p\"},\"app.sh\"),\" is reading \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},`environment\nvariables`)),\" to set \",mdx(\"inlineCode\",{parentName:\"p\"},\"username\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"password\"),` values; therefore, no templating\nis involved.`),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Notice that the environment variable name is derived from the secret \",mdx(\"em\",{parentName:\"p\"},\"path\"),`\nwith key name.`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Run the Envconsul tool using the Vault token you generated at \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step2\"}),\"Step 2\"),\".\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_TOKEN\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"))),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"<token> envconsul -upcase -secret database/creds/readonly ./app.sh\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"My connection info is:\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'username: \"v-token-readonly-ww1tq33s7z5uprpxxy68-1527631219\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'password: \"A1a-u54wut0v605qwz95\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'database: \"my-app\"'),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The output should display the \",mdx(\"inlineCode\",{parentName:\"p\"},\"username\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"password\"),\" populated.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"-upcase\"),` flag tells Envconsul to convert all environment variable keys to\nuppercase. Otherwise, the default uses lowercase (e.g. `,mdx(\"inlineCode\",{parentName:\"p\"},\"database_creds_readonly_username\"),\").\"),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Summary:\"),` If your application is designed to read secrets from environment\nvariables, Envconsul requires minimal to no code change to integrate with Vault.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`If the integration option is to directly invoke Vault API within your\napplication, refer to the `,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/identity/authentication\"}),mdx(\"em\",{parentName:\"a\"},`AppRole Pull\nAuthentication`)),` guide to learn about the\nAppRole auth method which is designed for applications.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}