{"pageProps":{"currentPath":"secret-mgmt/db-root-rotation","frontMatter":{"layout":"guides","page_title":"DB Root Credential Rotation - Guides","description":"Vault enables the combined database secret engines to automate the rotation of\nroot credentials."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/secret-mgmt/db-root-rotation.mdx","mdxSource":{"compiledSource":"var c=Object.defineProperty;var o=Object.prototype.hasOwnProperty;var p=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable;var l=(e,s,n)=>s in e?c(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,a=(e,s)=>{for(var n in s||(s={}))o.call(s,n)&&l(e,n,s[n]);if(p)for(var n of p(s))r.call(s,n)&&l(e,n,s[n]);return e};var m=(e,s)=>{var n={};for(var t in e)o.call(e,t)&&s.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&p)for(var t of p(e))s.indexOf(t)<0&&r.call(e,t)&&(n[t]=e[t]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var t=n,{components:e}=t,s=m(t,[\"components\"]);return mdx(MDXLayout,a(a(a({},layoutProps),s),{components:e,mdxType:\"MDXLayout\"}),mdx(\"h1\",a({},{className:\"g-type-display-2\"}),mdx(\"a\",a({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#database-root-credential-rotation\",\"aria-label\":\"database root credential rotation permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h1\"},{className:\"__target-h\",id:\"database-root-credential-rotation\",\"aria-hidden\":\"\"})),\"Database Root Credential Rotation\"),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#database-secrets-engine\",\"aria-label\":\"database secrets engine permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"database-secrets-engine\",\"aria-hidden\":\"\"})),\"Database Secrets Engine\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Vault's \",mdx(\"a\",a({parentName:\"p\"},{href:\"/docs/secrets/databases\"}),\"database secrets engine\"),` provides a\ncentralized workflow for managing credentials for various database systems. By\nleveraging this, every service instance gets a unique set of database\ncredentials instead of sharing one. Having those credentials tied directly to\neach service instance and live only for the life of the service, any abnormal\naccess pattern can be mapped to a specific service instance and its credential\ncan be revoked immediately.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`This reduces the manual tasks performed by the database administrator and make\nthe access to the database to be more efficient and secure.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The \",mdx(\"a\",a({parentName:\"p\"},{href:\"/guides/secret-mgmt/dynamic-secrets\"}),\"Secret as a Service: Dynamic Secrets\"),`\nguide demonstrates the primary workflow.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-material\",\"aria-label\":\"reference material permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-material\",\"aria-hidden\":\"\"})),\"Reference Material\"),mdx(\"ul\",null,mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"/guides/secret-mgmt/dynamic-secrets\"}),\"Secret as a Service: Dynamic Secrets\")),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"/api/secret/databases#rotate-root-credentials\"}),\"Database Secret Engine (API)\")),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"/api/secret/databases/postgresql\"}),\"PostgreSQL Database Plugin HTTP API\"))),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"10 minutes\"),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#challenge\",\"aria-label\":\"challenge permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"challenge\",\"aria-hidden\":\"\"})),\"Challenge\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Because Vault is managing the database credentials on behalf of the database\nadministrator, it must also be given a set of highly privileged credentials\nwhich can grant and revoke access to the database system. Therefore, it is very\ncommon to give Vault the `,mdx(\"strong\",{parentName:\"p\"},\"root\"),\" credentials.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`However, these credentials are often long-lived and never change once configured\non Vault. This may violate the `,mdx(\"em\",{parentName:\"p\"},\"Governance, Risk and Compliance\"),` (GRC)\nsurrounding that data stored in the database.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#solution\",\"aria-label\":\"solution permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"solution\",\"aria-hidden\":\"\"})),\"Solution\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Use the Vault's \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/database/rotate-root/:name\")),` API endpoint to rotate the\nroot credentials stored for the database connection.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"img\",a({parentName:\"p\"},{src:\"/img/vault-db-root-rotation.png\",alt:\"DB Root Credentials\"}))),mdx(\"div\",a({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Best Practice:\"),` Use this feature to rotate the root credentials\nimmediately after the initial configuration of each database.`)),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`To perform the tasks described in this guide, you need to have a Vault\nenvironment. Refer to the `,mdx(\"a\",a({parentName:\"p\"},{href:\"/intro/getting-started/install\"}),`Getting\nStarted`),` guide to install Vault. Make sure\nthat your Vault server has been `,mdx(\"a\",a({parentName:\"p\"},{href:\"/intro/getting-started/deploy\"}),`initialized and\nunsealed`),\".\"),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#postgresql\",\"aria-label\":\"postgresql permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"postgresql\",\"aria-hidden\":\"\"})),\"PostgreSQL\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`This guide requires that you have a PostgreSQL server to connect to. If you\ndon't have one, install `,mdx(\"a\",a({parentName:\"p\"},{href:\"https://www.postgresql.org/download/\"}),\"PostgreSQL\"),\".\"),mdx(\"ul\",null,mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Refer to the \",mdx(\"a\",a({parentName:\"li\"},{href:\"https://www.postgresql.org/docs/online-resources/\"}),\"PostgreSQL documentation\"),\" for details\"),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"https://wiki.postgresql.org/wiki/First_steps\"}),\"PostgreSQL Wiki\"),` gives you a\nsummary of basic commands to get started.`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#policy-requirements\",\"aria-label\":\"policy requirements permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"policy-requirements\",\"aria-hidden\":\"\"})),\"Policy requirements\"),mdx(\"div\",a({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" For the purpose of this guide, you can use \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"root\")),` token to work\nwith Vault. However, it is recommended that root tokens are only used for just\nenough initial setup or in emergencies. As a best practice, use tokens with\nappropriate set of policies based on your role in the organization.`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`To perform all tasks demonstrated in this guide, your policy must include the\nfollowing permissions:`),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Mount secret engines\"),`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sys/mounts/*\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Configure the database secret engine and create roles\"),`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"database/*\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If you are not familiar with policies, complete the\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"/guides/identity/policies\"}),\"policies\"),\" guide.\"),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Using Vault, you can easily rotate the root credentials for your database\nthrough the `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"database/rotate-root/:name\")),\" endpoint.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`This guide demonstrates the overall workflow to manage the database credentials\nincluding the root.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"You are going to perform the following:\"),mdx(\"ol\",null,mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step1\"}),\"Enable the database secret engine\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step2\"}),\"Configure PostgreSQL secret engine\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step3\"}),\"Verify the configuration (\",mdx(\"strong\",{parentName:\"a\"},mdx(\"em\",{parentName:\"strong\"},\"Optional\")),\")\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step4\"}),\"Rotate the root credentials\"))),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step1\",\"aria-label\":\"step 1 enable the database secret engine permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step1\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-enable-the-database-secret-engine\",\"aria-hidden\":\"\"})),\"Step 1: Enable the database secret engine\"),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Enable a database secret engine:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault secrets \",mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"enable\"),\" database\")),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This example enables the database secret engine at the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/database\")),`\npath in Vault.`),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To enable a database secret engine, use the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/sys/mounts\")),\" endpoint.\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"type\":\"database\"}' \\\\`),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/sys/mounts/database\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This example mounts database secret engine at \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/database\")),`,\nand passes the secret engine type (\"`,mdx(\"inlineCode\",{parentName:\"p\"},\"database\"),'\") in the request payload.'),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step2\",\"aria-label\":\"step 2 configure postgresql secret engine permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step2\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-configure-postgresql-secret-engine\",\"aria-hidden\":\"\"})),\"Step 2: Configure PostgreSQL secret engine\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"In the \",mdx(\"a\",a({parentName:\"p\"},{href:\"/guides/secret-mgmt/dynamic-secrets#step2\"}),`Secret as a Service: Dynamic\nSecrets`),` guide, the PostgreSQL\nplugin was configured with its root credentials embedded in the `,mdx(\"inlineCode\",{parentName:\"p\"},\"connection_url\"),`\n(`,mdx(\"inlineCode\",{parentName:\"p\"},\"root\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"rootpassword\"),\") as below:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" database/config/postgresql \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"      plugin_name=postgresql-database-plugin \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'      allowed_roles=\"*\" \\\\'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"      connection_url=postgresql://root:rootpassword@postgres.host.address:5432/postgres\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`The username and password can be templated using the format,\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"{{<field-name>}}\")),\".\"),mdx(\"div\",a({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),`In order to leverage the database root credential rotation feature, you must\nuse the templated credentials: `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"{{username}}\")),\" and \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"{{password}}\")),\".\")),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-1\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-1\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" database/config/postgresql \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"     plugin_name=postgresql-database-plugin \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     connection_url=\"postgresql://{{username}}:{{password}}@postgres.host.address:5432/postgres\" \\\\'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     allowed_roles=\"*\" \\\\'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     username=\"root\" \\\\'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     password=\"rootpassword\"'),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Notice that the \",mdx(\"inlineCode\",{parentName:\"p\"},\"connection_url\"),` value contains the templated credentials, and\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"username\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"password\"),\" parameters are also passed to initiate the connection.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Create a role, \",mdx(\"inlineCode\",{parentName:\"p\"},\"readonly\"),\":\"),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Create readonly.sql defining the role privilege\"),`\n`,\"$ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" readonly.sql \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`CREATE ROLE \"{{name}}\" WITH LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}';`),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'GRANT SELECT ON ALL TABLES IN SCHEMA public TO \"{{name}}\";'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Create a role named 'readonly' with TTL of 1 hr\"),`\n`,\"$ vault \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" database/roles/readonly \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"db_name\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"postgresql \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"creation_statements\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"@readonly.sql \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"default_ttl\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"1h \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"max_ttl\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"24h\",`\n`)),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-1\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-1\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"tee\"),\" payload.json \",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),\"EOF\"))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),\"{\"))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'    \"plugin_name\": \"postgresql-database-plugin\",'))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'    \"connection_url\": \"postgresql://{{username}}:{{password}}@postgres.host.address:5432/postgres\",'))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'    \"allowed_roles\": \"readonly\",'))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'    \"username\": \"root\",'))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'    \"password\": \"rootpassword\"'))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),\"}\"))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),\"EOF\"))),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'))),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --data @payload.json \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       http://127.0.0.1:8200/v1/database/config/postgresql\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Notice that the \",mdx(\"inlineCode\",{parentName:\"p\"},\"connection_url\"),` value contains the templated credentials, and\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"username\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"password\"),\" parameters are also passed to initiate the connection.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Create a role, \",mdx(\"inlineCode\",{parentName:\"p\"},\"readonly\"),\":\"),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Create the request payload\"),`\n`,\"$ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" payload.json \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'    \"db_name\": \"postgres\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`    \"creation_statements\": \"CREATE ROLE '{{name}}' WITH LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}';`),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`  GRANT SELECT ON ALL TABLES IN SCHEMA public TO '{{name}}';\",`),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'    \"default_ttl\": \"1h\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'    \"max_ttl\": \"24h\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,\"$ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),`\n`,\"       --request POST \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @payload.json \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       http://127.0.0.1:8200/v1/database/roles/readonly\",`\n`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-3-verify-the-configuration-_optional_\",\"aria-label\":\"step 3 verify the configuration _optional_ permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-verify-the-configuration-_optional_\",\"aria-hidden\":\"\"})),\"Step 3: Verify the configuration (\",mdx(\"strong\",{parentName:\"h3\"},mdx(\"em\",{parentName:\"strong\"},\"Optional\")),\") ((#step3))\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Before rotate the root credentials, make sure that the secret engine was\nconfigured correctly.`),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-2\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-2\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Get a new set of credentials\"),`\n`,\"$ vault \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"read\"),\" database/creds/readonly\",`\n`,\"Key                Value\",`\n`,\"---                -----\",`\n`,\"lease_id           database/creds/readonly/999c43f0-f79e-ba90-24a8-4de5af33a2e9\",`\n`,\"lease_duration     1h\",`\n`,\"lease_renewable    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"password           A1a-u7wxtrpx09xp40yq\",`\n`,\"username           v-root-readonly-x6q809467q98yp4yx4z4-1525378026e\",`\n`,`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Make sure that you can connect to the database using the Vault generated credentials\"),`\n`,\"$ psql -h postgres.host.address -p \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"5432\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       -U v-root-readonly-x6q809467q98yp4yx4z4-1525378026e postgres\",`\n`,\"Password \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"for\"),\" user v-root-readonly-x6q809467q98yp4yx4z4-1525378026:\",`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"postgres\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),\"du\",`\n`,\"Role name                                       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\"                         Attributes                         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" Member of\",`\n`,\"------------------------------------------------+------------------------------------------------------------+----------\",`\n`,\"postgres                                        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" Superuser, Create role, Create DB, Replication, Bypass RLS \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"v-root-readonly-x6q809467q98yp4yx4z4-1525378026 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" Password valid \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"until\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"2018\"),\"-05-03 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"21\"),\":07:11+00                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"postgres\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),\"q\",`\n`)),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-2\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-2\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Get a new set of credentials\"),`\n`,\"$ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: 1c97b03a-6098-31cf-9d8b-b404e52dcb4a\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       http://127.0.0.1:8200/v1/database/creds/readonly \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" jq\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"request_id\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"527970fd-f5e8-4de5-d4ed-1b7970eaef0b\"'),\",\",`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"lease_id\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"database/creds/readonly/ac79265e-668c-242f-4f67-1dae33da094c\"'),\",\",`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"renewable\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" true,\",`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"lease_duration\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"3600\"),\",\",`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"data\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"     \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"password\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"A1a-0tr8u15y0us2u08v\"'),\",\",`\n`,\"     \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"username\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"v-root-readonly-x7v65y1xuprzxv9vpt80-1525378873\"'),`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\",\",`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"wrap_info\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null,\",`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"warnings\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null,\",`\n`,\"   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"auth\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Make sure that you can connect to the database using the Vault generated credentials\"),`\n`,\"$ psql -h postgres.host.address -p \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"5432\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       -U v-root-readonly-x6q809467q98yp4yx4z4-1525378026e postgres\",`\n`,\"Password \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"for\"),\" user v-root-readonly-x6q809467q98yp4yx4z4-1525378026:\",`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"postgres\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),\"du\",`\n`,\"Role name                                       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\"                         Attributes                         \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" Member of\",`\n`,\"------------------------------------------------+------------------------------------------------------------+----------\",`\n`,\"postgres                                        \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" Superuser, Create role, Create DB, Replication, Bypass RLS \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"v-root-readonly-x6q809467q98yp4yx4z4-1525378026 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" Password valid \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"until\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"2018\"),\"-05-03 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"21\"),\":07:11+00                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,\"v-root-readonly-x7v65y1xuprzxv9vpt80-1525378873 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" Password valid \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"until\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"2018\"),\"-05-03 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"21\"),\":21:18+00                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"postgres\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),\"q\",`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`This confirms that the Vault successfully connected to your PostgreSQL server\nand created a new user based on the privilege defined by `,mdx(\"inlineCode\",{parentName:\"p\"},\"readonly.sql\"),\".\"),mdx(\"blockquote\",null,mdx(\"p\",a({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`The user credentials generated by the Vault has a limited TTL based on your\nconfiguration (`,mdx(\"inlineCode\",{parentName:\"p\"},\"default_ttl\"),\"). In addition, you can revoke them if necessary.\")),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step4\",\"aria-label\":\"step 4 rotate the root credentials permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step4\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-rotate-the-root-credentials\",\"aria-hidden\":\"\"})),\"Step 4: Rotate the root credentials\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Vault provides an API endpoint to easily rotate the root database credentials.\"),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-3\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-3\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" -force database/rotate-root/postgresql\")),`\n`)),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-3\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-3\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       http://127.0.0.1:8200/v1/database/rotate-root/postgresql\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"This is all you need to do.\"),mdx(\"hr\",null),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Repeat \",mdx(\"a\",a({parentName:\"p\"},{href:\"#step3\"}),\"Step 3\"),` to verify that Vault continues to generate database\ncredentials after the root credential rotation.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To verify that the root credential was rotated:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"psql -h postgres.host.address -p \",mdx(\"span\",a({parentName:\"span\"},{className:\"token number\"}),\"5432\"),\" -U root postgres\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Password for user root:\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Entering the initial password (e.g. \",mdx(\"inlineCode\",{parentName:\"p\"},\"rootpassword\"),\") will \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"not\")),` work since\nthe password was rotated by the Vault.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"You can invoke the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"database/rotate-root/:name\")),` endpoint periodically to\nsecure the root credential.`),mdx(\"div\",a({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` Once the root credential was rotated, only the Vault knows the new\nroot password. This is the same for all root database credentials given to Vault.\nTherefore, you should create a separate superuser dedicated to the Vault usage\nwhich is not used for other purposes.`)),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next steps\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"In this guide, you learned how to rotate the root database credentials.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Read the \",mdx(\"a\",a({parentName:\"p\"},{href:\"/guides/identity/authentication\"}),\"AppRole Pull Authentication\"),`\nguide to learn about generating a client token for your app so that it can\nrequest database credentials from Vault.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}