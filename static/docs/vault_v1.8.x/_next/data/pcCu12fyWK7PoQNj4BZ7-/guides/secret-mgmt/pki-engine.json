{"pageProps":{"currentPath":"secret-mgmt/pki-engine","frontMatter":{"layout":"guides","page_title":"Build Your Own Certificate Authority - Guides","description":"The PKI secrets engine generates dynamic X.509 certificates. With this secrets\nengine, services can get certificates without going through the usual manual\nprocess of generating a private key and CSR, submitting to a CA, and waiting\nfor a verification and signing process to complete. Vault's built-in\nauthentication and authorization mechanisms provide the verification\nfunctionality."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/secret-mgmt/pki-engine.mdx","mdxSource":{"compiledSource":"var m=Object.defineProperty;var p=Object.prototype.hasOwnProperty;var l=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable;var r=(a,t,n)=>t in a?m(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,e=(a,t)=>{for(var n in t||(t={}))p.call(t,n)&&r(a,n,t[n]);if(l)for(var n of l(t))o.call(t,n)&&r(a,n,t[n]);return a};var i=(a,t)=>{var n={};for(var s in a)p.call(a,s)&&t.indexOf(s)<0&&(n[s]=a[s]);if(a!=null&&l)for(var s of l(a))t.indexOf(s)<0&&o.call(a,s)&&(n[s]=a[s]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var s=n,{components:a}=s,t=i(s,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),t),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#build-your-own-certificate-authority-ca\",\"aria-label\":\"build your own certificate authority ca permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"build-your-own-certificate-authority-ca\",\"aria-hidden\":\"\"})),\"Build Your Own Certificate Authority (CA)\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Vault's PKI secrets engine can dynamically generate X.509 certificates on\ndemand. This allows services to acquire certificates without going through the\nusual manual process of generating a private key and Certificates Signing\nRequest (CSR), submitting to a CA, and then wait for the verification and\nsigning process to complete.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-material\",\"aria-label\":\"reference material permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-material\",\"aria-hidden\":\"\"})),\"Reference Material\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/secrets/pki\"}),\"PKI (Certificates) Secrets Engine\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/api/secret/pki\"}),\"PKI Secrets Engine (API)\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://tools.ietf.org/html/rfc5280\"}),`RFC 5280 Internet X.509 Public Key Infrastructure Certificate and Certificate\nRevocation List (CRL) Profile`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.openssl.org/docs/man1.1.0/apps/x509.html\"}),\"OpenSSL x509 Man Pages\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"15 minutes\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#personas\",\"aria-label\":\"personas permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"personas\",\"aria-hidden\":\"\"})),\"Personas\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The steps described in this guide are typically performed by \",mdx(\"strong\",{parentName:\"p\"},`security\nengineer`),\".\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#challenge\",\"aria-label\":\"challenge permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"challenge\",\"aria-hidden\":\"\"})),\"Challenge\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Organizations should protect their website; however, the Traditional PKI process\nworkflow takes a long time which motivates organizations to create certificates\nwhich do not expire for a year or more.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#solution\",\"aria-label\":\"solution permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"solution\",\"aria-hidden\":\"\"})),\"Solution\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Use Vault to create X509 certificates for usage in MTLS or other arbitrary PKI\nencryption. While this can be used to create web server certificates. If\nusers do not import the CA chains, the browser will complain about self-signed\ncertificates.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Creating PKI certificates is generally a cumbersome process using traditional\ntools like `,mdx(\"inlineCode\",{parentName:\"p\"},\"openssl\"),` or even more advanced frameworks like CFSSL. These tools\nalso require a human component to verify certificate distribution meets\norganizational security policies.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Vault PKI secrets engine makes this a lot simpler. The PKI secrets engine can\nbe an Intermediate-Only certificate authority which potentially allows for\nhigher levels of security.`),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Store CA outside the Vault (air gapped)\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Create CSRs for the intermediates\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Sign CSR outside Vault and import intermediate\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Issue leaf certificates from the Intermediate CA\")),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To perform the tasks described in this guide, you need to have a Vault\nenvironment. Refer to the `,mdx(\"a\",e({parentName:\"p\"},{href:\"/intro/getting-started/install\"}),`Getting\nStarted`),\" guide to install Vault.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Alternatively, you can use the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.katacoda.com/hashicorp/scenarios/vault-playground\"}),`Vault\nPlayground`),`\nenvironment.`),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#policy\",\"aria-label\":\"policy requirements permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"policy\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"policy-requirements\",\"aria-hidden\":\"\"})),\"Policy requirements\"),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" For the purpose of this guide, you can use \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"root\")),` token to work\nwith Vault. However, it is recommended that root tokens are only used for just\nenough initial setup or in emergencies. As a best practice, use tokens with\nappropriate set of policies based on your role in the organization.`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To perform all tasks demonstrated in this guide, your policy must include the\nfollowing permissions:`),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Enable secrets engine\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sys/mounts/*\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# List enabled secrets engine\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sys/mounts\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Work with pki secrets engine\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"pki*\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sudo\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`If you are not familiar with policies, complete the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/identity/policies\"}),\"policies\"),\" guide.\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`In this guide, you are going to first generate a self-signed root certificate.\nThen you are going to generate an intermediate certificate which is signed by\nthe root. Finally, you are going to generate a certificate for\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"test.example.com\"),\" domain.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-pki-4.png\",alt:\"Overview\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"In this guide, you perform the following:\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step1\"}),\"Generate Root CA\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step2\"}),\"Generate Intermediate CA\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step3\"}),\"Create a Role\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step4\"}),\"Request Certificates\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step5\"}),\"Revoke Certificates\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step6\"}),\"Remove Expired Certificates\"))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step1\",\"aria-label\":\"step 1 generate root ca permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step1\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-generate-root-ca\",\"aria-hidden\":\"\"})),\"Step 1: Generate Root CA\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`In this step, you are going to generate a self-signed root certificate using\nPKI secrets engine.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"First, enable the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" secrets engine at \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" path:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault secrets enable pki\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Tune the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" secrets engine to issue certificates with a maximum time-to-live (TTL) of 87600 hours.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault secrets tune -max-lease-ttl=87600h pki\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Generate the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"root\")),\" certificate and save the certificate in \",mdx(\"inlineCode\",{parentName:\"p\"},\"CA_cert.crt\"),\".\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ vault write -field=certificate pki/root/generate/internal common_name=\"example.com\" \\\\',`\n`,\"        ttl=87600h > CA_cert.crt\",`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`This generates a new self-signed CA certificate and private key. Vault will\n`,mdx(\"em\",{parentName:\"p\"},\"automatically\"),` revoke the generated root at the end of its lease period\n(TTL); the CA certificate will sign its own Certificate Revocation List\n(CRL).`)),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Configure the CA and CRL URLs:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault write pki/config/urls \\\\\",`\n`,'        issuing_certificates=\"http://127.0.0.1:8200/v1/pki/ca\" \\\\',`\n`,'        crl_distribution_points=\"http://127.0.0.1:8200/v1/pki/crl\"',`\n`)))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"First, enable the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" secrets engine at \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" path using \",mdx(\"inlineCode\",{parentName:\"p\"},\"/sys/mounts\"),\" endpoint:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ curl --header \"X-Vault-Token: <TOKEN>\" \\\\',`\n`,\"       --request POST \\\\\",`\n`,\"       --data <PARAMETERS> \\\\\",`\n`,\"       <VAULT_ADDRESS>/v1/sys/mounts/<PATH>\",`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Where \",mdx(\"inlineCode\",{parentName:\"p\"},\"<TOKEN>\"),\" is your valid token, and \",mdx(\"inlineCode\",{parentName:\"p\"},\"<PARAMETERS>\"),\" holds \",mdx(\"a\",e({parentName:\"p\"},{href:\"/api/system/mounts#enable-secrets-engine\"}),`configuration\nparameters`),\" of the secret engine.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"The following example mounts \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" secret engine.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"       --request POST \\\\\",`\n`,`       --data '{\"type\":\"pki\"}' \\\\`,`\n`,\"       https://127.0.0.1:8200/v1/sys/mounts/pki\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Tune the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),` secrets engine to issue certificates with a maximum\ntime-to-live (TTL) of 87600 hours.`),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"        --request POST \\\\\",`\n`,`        --data '{\"max_lease_ttl\":\"87600h\"}' \\\\`,`\n`,\"        https://127.0.0.1:8200/v1/sys/mounts/pki/tune\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Generate the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"root\")),` certificate and extract the CA certificate and save\nit as `,mdx(\"inlineCode\",{parentName:\"p\"},\"CA_cert.crt\"),\".\"),mdx(\"blockquote\",{parentName:\"li\"},mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" The following command uses \",mdx(\"inlineCode\",{parentName:\"p\"},\"jq\"),` tool to parse the output JSON.\nYou can install `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://stedolan.github.io/jq/download/\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"jq\")),` or manually\ncopy and paste the certificate in a file, `,mdx(\"inlineCode\",{parentName:\"p\"},\"CA_cert.crt\"),\".\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload.json <<EOF\",`\n`,\"{\",`\n`,'  \"common_name\": \"example.com\",',`\n`,'  \"ttl\": \"87600h\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"        --request POST \\\\\",`\n`,\"        --data @payload.json \\\\\",`\n`,\"        https://127.0.0.1:8200/v1/pki/root/generate/internal \\\\\",`\n`,'        | jq -r \".data.certificate\" > CA_cert.crt',`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`This generates a new self-signed CA certificate and private key. Vault will\n`,mdx(\"em\",{parentName:\"p\"},\"automatically\"),` revoke the generated root at the end of its lease period\n(TTL); the CA certificate will sign its own Certificate Revocation List\n(CRL).`)),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Configure the CA and CRL URLs:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload-url.json <<EOF\",`\n`,\"{\",`\n`,'  \"issuing_certificates\": \"http://127.0.0.1:8200/v1/pki/ca\",',`\n`,'  \"crl_distribution_points\": \"http://127.0.0.1:8200/v1/pki/crl\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"       --request POST \\\\\",`\n`,\"       --data @payload-url.json \\\\\",`\n`,\"       https://127.0.0.1:8200/v1/pki/config/urls\",`\n`)))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Open a web browser and launch the Vault UI (e.g. \",mdx(\"a\",e({parentName:\"p\"},{href:\"http://127.0.0.1:8200/ui\"}),\"http://127.0.0.1:8200/ui\"),`) and\nthen login.`),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Enable new engine\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"PKI\"),\" from the \",mdx(\"strong\",{parentName:\"li\"},\"Secrets engine type\"),\" drop-down list.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"More options\"),\" to expand and set the \",mdx(\"strong\",{parentName:\"li\"},\"Maximum lease TTL\"),\" to \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"87600 hours\")),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Enable Engine\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Configure\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Configure CA\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Leave \",mdx(\"strong\",{parentName:\"li\"},\"CA Type\"),\" as \",mdx(\"strong\",{parentName:\"li\"},\"root\"),\", and \",mdx(\"strong\",{parentName:\"li\"},\"Type\"),\" to be \",mdx(\"strong\",{parentName:\"li\"},\"internal\"),`. Enter\n`,mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example.com\")),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"Common Name\"),\" field.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Options\"),\" and then set \",mdx(\"strong\",{parentName:\"li\"},\"TTL\"),\" field to be \",mdx(\"strong\",{parentName:\"li\"},\"87600 hours\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Save\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Copy Certificate\"),\" and save it in a file named, \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"CA_cert.crt\")),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click the \",mdx(\"strong\",{parentName:\"li\"},\"URLs\"),\" tab, and then set:\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Issuing certificates: \",mdx(\"inlineCode\",{parentName:\"li\"},\"http://127.0.0.1:8200/v1/pki/ca\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"CRL Distribution Points: \",mdx(\"inlineCode\",{parentName:\"li\"},\"http://127.0.0.1:8200/v1/pki/crl\"),mdx(\"img\",e({parentName:\"li\"},{src:\"/img/vault-pki-1.png\",alt:\"Configure URL\"}))))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Save\"),\".\")),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` To examine the generated root certificate, you can use\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.openssl.org/source/\"}),\"OpenSSL\"),\".\")),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Print the certificate in text form\"),`\n`,\"$ openssl x509 -in CA_cert.crt -text\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Print the validity dates\"),`\n`,\"$ openssl x509 -in CA_cert.crt -noout -dates\",`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step2\",\"aria-label\":\"step 2 generate intermediate ca permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step2\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-generate-intermediate-ca\",\"aria-hidden\":\"\"})),\"Step 2: Generate Intermediate CA\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Now, you are going to create an intermediate CA using the root CA you regenerate\nin the previous step.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-1\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-1\",\"aria-hidden\":\"\"})),\"CLI Command\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"First, enable the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" secrets engine at \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"pki_int\")),\" path:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault secrets enable -path=pki_int pki\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Tune the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki_int\"),` secrets engine to issue certificates with a maximum\ntime-to-live (TTL) of 43800 hours.`),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault secrets tune -max-lease-ttl=43800h pki_int\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Execute the following command to generate an intermediate and save the CSR as\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"pki_intermediate.csr\"),\":\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault write -format=json pki_int/intermediate/generate/internal \\\\\",`\n`,'        common_name=\"example.com Intermediate Authority\" ttl=\"43800h\" \\\\',`\n`,\"        | jq -r '.data.csr' > pki_intermediate.csr\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Sign the intermediate certificate with the root certificate and save the\ngenerated certificate as `,mdx(\"inlineCode\",{parentName:\"p\"},\"intermediate.cert.pem\"),\":\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault write -format=json pki/root/sign-intermediate csr=@pki_intermediate.csr \\\\\",`\n`,'        format=pem_bundle ttl=\"43800h\" \\\\',`\n`,\"        | jq -r '.data.certificate' > intermediate.cert.pem\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Once the CSR is signed and the root CA returns a certificate, it can be\nimported back into Vault:`),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault write pki_int/intermediate/set-signed certificate=@intermediate.cert.pem\",`\n`)))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-1\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-1\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"First, enable the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki\"),\" secrets engine at \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"pki_int\")),\" path:\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"       --request POST \\\\\",`\n`,`       --data '{\"type\":\"pki\"}' \\\\`,`\n`,\"       https://127.0.0.1:8200/v1/sys/mounts/pki_int\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Tune the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pki_int\"),` secrets engine to issue certificates with a maximum\ntime-to-live (TTL) of 43800 hours.`),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"        --request POST \\\\\",`\n`,`        --data '{\"max_lease_ttl\":\"43800h\"}' \\\\`,`\n`,\"        https://127.0.0.1:8200/v1/sys/mounts/pki_int/tune\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Generate an intermediate using the \",mdx(\"inlineCode\",{parentName:\"p\"},\"/pki_int/intermediate/generate/internal\"),`\nendpoint.`),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload-int.json <<EOF\",`\n`,\"{\",`\n`,'  \"common_name\": \"example.com Intermediate Authority\",',`\n`,'  \"ttl\": \"43800h\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"        --request POST \\\\\",`\n`,\"        --data @payload-int.json \\\\\",`\n`,\"        https://127.0.0.1:8200/v1/pki_int/intermediate/generate/internal | jq\",`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Copy the generated CSR.\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Sign the intermediate certificate with the root certificate and save the\ncertificate as `,mdx(\"inlineCode\",{parentName:\"p\"},\"intermediate.cert.pem\"),\".\"),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" The API request payload should contain the CSR you obtained.\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload-int-cert.json <<EOF\",`\n`,\"{\",`\n`,'  \"csr\": \"...\",',`\n`,'  \"format\": \"pem_bundle\",',`\n`,'  \"ttl\": \"43800h\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"        --request POST \\\\\",`\n`,\"        --data @payload-int-cert.json \\\\\",`\n`,\"        https://127.0.0.1:8200/v1/pki/root/sign-intermediate | jq\",`\n`)),mdx(\"blockquote\",{parentName:\"li\"},mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" The \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"format\")),` in the payload specifies the format of the\nreturned data. When `,mdx(\"inlineCode\",{parentName:\"p\"},\"pem_bundle\"),`, the certificate field will contain the\ncertificate.`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Copy the generated certificate.\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Once the CSR is signed and the root CA returns a certificate, it can be\nimported back into Vault using the `,mdx(\"inlineCode\",{parentName:\"p\"},\"/pki_int/intermediate/set-signed\"),\" endpoint.\"),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` The API request payload should contain the certificate you\nobtained.`)),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload-signed.json <<EOF\",`\n`,\"{\",`\n`,'  \"certificate\": \"...\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"        --request POST \\\\\",`\n`,\"        --data @payload-signed.json \\\\\",`\n`,\"        https://127.0.0.1:8200/v1/pki_int/intermediate/set-signed\",`\n`)))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-1\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-1\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Enable new engine\"),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"Secrets\"),\" tab.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"PKI\"),\" from the \",mdx(\"strong\",{parentName:\"li\"},\"Secrets engine type\"),\" drop-down list.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Enter \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"pki_int\")),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"Path\"),\" field.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"More options\"),\" to expand and set the \",mdx(\"strong\",{parentName:\"li\"},\"Maximum lease TTL\"),\" to \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"43800 hours\")),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Enable Engine\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Configure\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Configure CA\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"intermediate\"),\" from \",mdx(\"strong\",{parentName:\"li\"},\"CA Type\"),\" drop-down list.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Enter \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example.com Intermediate Authority\")),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"Common Name\"),\" field.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Enter \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"43800\")),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"TTL\"),\" field, choose \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"hours\")),\" and then click \",mdx(\"strong\",{parentName:\"li\"},\"Save\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Copy CSR\"),\" and save it in a file, \",mdx(\"inlineCode\",{parentName:\"li\"},\"pki_intermediate.csr\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"pki\"),\" from the \",mdx(\"strong\",{parentName:\"li\"},\"Secrets\"),\" tab to return to the root CA.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Configure\"),\" and then click \",mdx(\"strong\",{parentName:\"li\"},\"Sign intermediate\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Paste in the CSR in the \",mdx(\"strong\",{parentName:\"li\"},\"Certificate Signing Request (CSR)\"),\" field.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Enter \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example.com\")),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"Common Name\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"pem_bundle\"),\" from the \",mdx(\"strong\",{parentName:\"li\"},\"Format\"),` drop-down list, and then click\n`,mdx(\"strong\",{parentName:\"li\"},\"Save\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Copy Certificate\"),\" and save the generated certificate in a file, \",mdx(\"inlineCode\",{parentName:\"li\"},\"intermediate.cert.pem\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"pki_int\"),\" from the \",mdx(\"strong\",{parentName:\"li\"},\"Secrets\"),\" tab to return to the intermediate CA.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Configure\"),\" and then click \",mdx(\"strong\",{parentName:\"li\"},\"Set signed intermediate\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Paste in the certificate in the \",mdx(\"strong\",{parentName:\"li\"},\"Signed Intermediate Certificate\"),` field and\nthen click `,mdx(\"strong\",{parentName:\"li\"},\"Save\"),\".\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step3\",\"aria-label\":\"step 3 create a role permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step3\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-create-a-role\",\"aria-hidden\":\"\"})),\"Step 3: Create a Role\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`A role is a logical name that maps to a policy used to generate those\ncredentials. It allows `,mdx(\"a\",e({parentName:\"p\"},{href:\"/api/secret/pki#create-update-role\"}),`configuration\nparameters`),` to control\ncertificate common names, alternate names, the key usages that they are valid\nfor, and more.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Calling out some of the parameters:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"allowed_domains\")),` - specifies the domains of the role (used with\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"allow_bare_domains\"),\" and \",mdx(\"inlineCode\",{parentName:\"li\"},\"allow-subdomains\"),\" options)\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"allow_bare_domains\")),` - specifies if clients can request certificates\nmatching the value of the actual domains themselves`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"allow_subdomains\")),` - specifies if clients can request certificates with\nCNs that are subdomains of the CNs allowed by the other role options (NOTE: This\nincludes wildcard subdomains.)`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"allow_glob_domains\")),` - allows names specified in allowed_domains to\ncontain glob patterns (e.g. ftp`,\"*\",\".example.com)\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"In this step, you are going to create a role named, \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example-dot-com\")),\".\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-2\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-2\",\"aria-hidden\":\"\"})),\"CLI Command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Create a role named \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example-dot-com\")),\" which allows subdomains.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" pki_int/roles/example-dot-com \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'        allowed_domains=\"example.com\" \\\\'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"        allow_subdomains=true \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'        max_ttl=\"720h\"'),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-2\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-2\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Create a role named \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example-dot-com\")),\" which allows subdomains.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"tee\"),\" payload-role.json \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"<<EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"allowed_domains\": \"example.com\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"allow_subdomains\": true,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"max_ttl\": \"720h\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --data @payload-role.json \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/pki_int/roles/example-dot-com\"),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-2\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-2\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Create a role named \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example-dot-com\")),\" which allows subdomains.\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"pki_int\"),\" and then select \",mdx(\"strong\",{parentName:\"li\"},\"Create role\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Enter \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example-dot-com\")),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"Role name\"),\" field.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Options\"),\" to expand, and then set the \",mdx(\"strong\",{parentName:\"li\"},\"Max TTL\"),\" to \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"43800 hours\")),\". Select \",mdx(\"strong\",{parentName:\"li\"},\"Hide Options\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Domain Handling\"),\" to expand, and then select the \",mdx(\"strong\",{parentName:\"li\"},`Allow\nsubdomains`),\" check-box. Enter \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"example.com\")),\" in the \",mdx(\"strong\",{parentName:\"li\"},\"Allowed domains\"),`\nfield.\n`,mdx(\"img\",e({parentName:\"li\"},{src:\"/img/vault-pki-2.png\",alt:\"Create Role\"}))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Create role\"),\".\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step4\",\"aria-label\":\"step 4 request certificates permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step4\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-request-certificates\",\"aria-hidden\":\"\"})),\"Step 4: Request Certificates\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Keep certificate lifetimes to be short to align with Vault's philosophy of\nshort-lived secrets.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-3\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-3\",\"aria-hidden\":\"\"})),\"CLI Command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Execute the following command to request a new certificate for \",mdx(\"inlineCode\",{parentName:\"p\"},\"test.example.com\"),`\ndomain based on the `,mdx(\"inlineCode\",{parentName:\"p\"},\"example-dot-com\"),\" role:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" pki_int/issue/example-dot-com \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"common_name\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"test.example.com\"'),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"ttl\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"24h\"'))),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Key                 Value\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"---                 -----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"certificate         -----BEGIN CERTIFICATE-----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"MIIDwzCCAqugAwIBAgIUTQABMCAsXjG6ExFTX8201xKVH4IwDQYJKoZIhvcNAQEL\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"BQAwGjEYMBYGA1UEAxMPd3d3LmV4YW1wbGUuY29tMB4XDTE4MDcyNDIxMTMxOVoX\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"             ...\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"-----END CERTIFICATE-----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"issuing_ca          -----BEGIN CERTIFICATE-----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"MIIDQTCCAimgAwIBAgIUbMYp39mdj7dKX033ZjK18rx05x8wDQYJKoZIhvcNAQEL\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"             ...\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"-----END CERTIFICATE-----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"private_key         -----BEGIN RSA PRIVATE KEY-----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"MIIEowIBAAKCAQEAte1fqy2Ekj+EFqKV6N5QJlBgMo/U4IIxwLZI6a87yAC/rDhm\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"W58liadXrwjzRgWeqVOoCRr/B5JnRLbyIKBVp6MMFwZVkynEPzDmy0ynuomSfJkM\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"             ...\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"-----END RSA PRIVATE KEY-----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"private_key_type    rsa\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"serial_number       4d:00:01:30:20:2c:5e:31:ba:13:11:53:5f:cd:b4:d7:12:95:1f:82\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The response contains the PEM-encoded private key, key type and certificate\nserial number.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-3\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-3\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Invoke the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/pki_int/issue/<role_name>\")),\" endpoint to request a new certificate.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Request a certificate for \",mdx(\"inlineCode\",{parentName:\"p\"},\"test.example.com\"),` domain based on the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"example-dot-com\"),\" role:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"common_name\": \"test.example.com\", \"ttl\": \"24h\"}' \\\\`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/pki_int/issue/example-dot-com | jq\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"request_id\": \"6fa8d77d-0758-33ae-b5ea-8b3d15014fd1\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"lease_id\": \"\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"lease_duration\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"data\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"certificate\": \"-----BEGIN CERTIFICATE-----\\\\nMIIDvzCCAqegAwIBAgIUG7H0Pzpqm+...-----END CERTIFICATE-----\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"issuing_ca\": \"-----BEGIN CERTIFICATE-----\\\\nMIIDNTCCAh2gAwIBAgIUQhIX9D...-----END CERTIFICATE-----\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"private_key\": \"-----BEGIN RSA PRIVATE KEY-----\\\\nMIIEpAIBAAKCAQEAr6IsROOW5...-----END RSA PRIVATE KEY-----\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"private_key_type\": \"rsa\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"serial_number\": \"1b:b1:f4:3f:3a:6a:9b:e8:33:af:f7:1b:b1:4d:57:7f:65:65:39:c1\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\" },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"wrap_info\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"warnings\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),' \"auth\": null'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The response contains the PEM-encoded private key, key type and certificate\nserial number.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-3\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-3\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Secrets\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"pki_int\"),\" from the \",mdx(\"strong\",{parentName:\"p\"},\"Secrets Engines\"),\" list.\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"example-dot-com\"),\" under \",mdx(\"strong\",{parentName:\"p\"},\"Roles\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Enter \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"test.example.com\")),\" in the \",mdx(\"strong\",{parentName:\"p\"},\"Common Name\"),\" field.\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Options\"),\" to expand, and then set the \",mdx(\"strong\",{parentName:\"p\"},\"TTL\"),\" to \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"24 hours\")),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Hide Options\"),\" and then click \",mdx(\"strong\",{parentName:\"p\"},\"Generate\"),`.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-pki-3.png\",alt:\"Issue Certificate\"}))),mdx(\"blockquote\",{parentName:\"li\"},mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`The response contains the PEM-encoded private key, key type and certificate\nserial number.`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Copy credentials\"),\" and save it in a file.\"))),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` A certificate can be rotated at any time by simply issuing a new\ncertificate with the same CN.`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step5\",\"aria-label\":\"step 5 revoke certificates permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step5\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-5-revoke-certificates\",\"aria-hidden\":\"\"})),\"Step 5: Revoke Certificates\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`If a certificate must be revoked, you can easily perform the revocation action\nwhich will cause the CRL to be regenerated. When the CRL is regenerated, any\nexpired certificates are removed from the CRL.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-4\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-4\",\"aria-hidden\":\"\"})),\"CLI Command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"In a certain circumstances, you may wish to revoke an issued certificate.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"To revoke:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" pki_int/revoke \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"serial_number\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"))),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"<serial_number>\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" pki_int/revoke \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"serial_number\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"48:97:82:dd:f0:d3:d9:7e:53:25:ba:fd:f6:77:3e:89:e5:65:cc:e7\"'))),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Key                        Value\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"---                        -----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"revocation_time            1532539632\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"revocation_time_rfc3339    2018-07-25T17:27:12.165206399Z\"),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-4\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-4\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Invoke the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/pki_int/revoke\")),` endpoint to invoke a certificate using its\nserial number.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"serial_number\": \"48:97:82:dd:f0:d3:d9:7e:53:25:ba:fd:f6:77:3e:89:e5:65:cc:e7\"}' \\\\`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/pki_int/revoke\"),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-4\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-4\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Secrets\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"pki_int\"),\" from the \",mdx(\"strong\",{parentName:\"li\"},\"Secrets Engines\"),\" list.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select the \",mdx(\"strong\",{parentName:\"li\"},\"eCertificates\"),\" tab.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select the serial number for the certificate you wish to revoke.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Revoke\"),\". At the confirmation, click \",mdx(\"strong\",{parentName:\"li\"},\"Revoke\"),\" again.\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step6\",\"aria-label\":\"step 6 remove expired certificates permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step6\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-6-remove-expired-certificates\",\"aria-hidden\":\"\"})),\"Step 6: Remove Expired Certificates\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Keep the storage backend and CRL by periodically removing certificates that have\nexpired and are past a certain buffer period beyond their expiration time.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-5\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-5\",\"aria-hidden\":\"\"})),\"CLI Command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"To remove revoked certificate and clean the CRL.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" pki_int/tidy \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"tidy_cert_store\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"true \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"tidy_revoked_certs\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"true\")),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-5\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-5\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Invoke the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/pki_int/tidy\")),` endpoint to remove revoked certificate and clean\nthe CRL.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"tidy_cert_store\": true, \"tidy_revoked_certs\": true}' \\\\`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/pki_int/tidy\"),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-5\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-5\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Secrets\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"pki_int\"),\" from the \",mdx(\"strong\",{parentName:\"li\"},\"Secrets Engines\"),\" list.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"li\"},\"Configure\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select the \",mdx(\"strong\",{parentName:\"li\"},\"Tidy\"),\" tab.\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Select the check-box for \",mdx(\"strong\",{parentName:\"li\"},\"Tidy the Certificate Store\"),\" and \",mdx(\"strong\",{parentName:\"li\"},\"Tidy the Revocation List (CRL)\"),\".\"),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"li\"},\"Save\"),\".\")),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Check out the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.hashicorp.com/resources/streamline-certificate-management-with-vault\"}),`Streamline Certificate Management with HashiCorp\nVault`),`\nwebinar recording.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}