{"pageProps":{"currentPath":"operations/disaster-recovery","frontMatter":{"layout":"guides","page_title":"Vault Disaster Recovery Replication Setup - Guides","description":"This guide demonstrates step-by-step instruction of setting up a disaster\nrecovery (DR) replications."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/operations/disaster-recovery.mdx","mdxSource":{"compiledSource":"var m=Object.defineProperty;var o=Object.prototype.hasOwnProperty;var l=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable;var p=(a,t,n)=>t in a?m(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,e=(a,t)=>{for(var n in t||(t={}))o.call(t,n)&&p(a,n,t[n]);if(l)for(var n of l(t))s.call(t,n)&&p(a,n,t[n]);return a};var i=(a,t)=>{var n={};for(var r in a)o.call(a,r)&&t.indexOf(r)<0&&(n[r]=a[r]);if(a!=null&&l)for(var r of l(a))t.indexOf(r)<0&&s.call(a,r)&&(n[r]=a[r]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var r=n,{components:a}=r,t=i(r,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),t),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#vault-disaster-recovery-replication\",\"aria-label\":\"vault disaster recovery replication permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"vault-disaster-recovery-replication\",\"aria-hidden\":\"\"})),\"Vault Disaster Recovery Replication\"),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Enterprise Only:\"),\" Disaster Recovery Replication is a part of \",mdx(\"em\",{parentName:\"p\"},\"Vault Enterprise Pro\"),\".\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`It is inevitable for organizations to have a disaster recovery (DR) strategy to\nprotect their Vault deployment against catastrophic failure of an entire\ncluster. Vault Enterprise supports multi-datacenter deployment where you can\nreplicate data across datacenters for performance as well as disaster recovery.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`A cluster is the basic unit of Vault Enterprise replication which follows the\nleader-follower model. A leader cluster is referred to as the `,mdx(\"strong\",{parentName:\"p\"},\"primary\"),`\ncluster and is considered the `,mdx(\"em\",{parentName:\"p\"},\"system of record\"),`. Data is streamed from the\nprimary cluster to all `,mdx(\"strong\",{parentName:\"p\"},\"secondary\"),\" (follower) clusters.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-ref-arch-8.png\",alt:\"Replication Pattern\"}))),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Important:\"),\" In DR replication, secondary clusters \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"do not forward\")),`\nservice read or write requests until they are promoted and become a new primary`)),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"they essentially act as a warm standby cluster.\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/operations/mount-filter\"}),\"Mount Filter\"),` guide provides step-by-step\ninstructions on setting up performance replication. This guide focuses on DR\nreplication setup.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-materials\",\"aria-label\":\"reference materials permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-materials\",\"aria-hidden\":\"\"})),\"Reference Materials\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/enterprise/replication#performance-replication-and-disaster-recovery-dr-replication\"}),\"Performance Replication and Disaster Recovery (DR) Replication\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/api/system/replication/replication-dr\"}),\"DR Replication API\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/guides/operations/replication\"}),\"Replication Setup & Guidance\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/guides/operations/vault-ha-consul\"}),\"Vault HA guide\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"10 minutes\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This intermediate Vault operations guide assumes that you have some working\nknowledge of Vault.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"You need two Vault Enterprise clusters: one behaves as the \",mdx(\"strong\",{parentName:\"p\"},\"primary cluster\"),`,\nand another becomes the `,mdx(\"strong\",{parentName:\"p\"},\"secondary\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-0.png\",alt:\"DR Prerequisites\"}))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This guide walk through the following operations:\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step1\"}),\"Enable DR Primary Replication\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step2\"}),\"Enable DR Secondary Replication\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step3\"}),\"Promote DR Secondary to Primary\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step4\"}),\"Demote DR Primary to Secondary\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step5\"}),\"Disable DR Primary\"))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step1\",\"aria-label\":\"step 1 enable dr primary replication permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step1\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-enable-dr-primary-replication\",\"aria-hidden\":\"\"})),\"Step 1: Enable DR Primary Replication\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Enable DR replication on the \",mdx(\"strong\",{parentName:\"p\"},\"primary\"),\" cluster.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault write -f sys/replication/dr/primary/enable\",`\n`,\"WARNING! The following warnings were returned from Vault:\",`\n`,`\n`,\"* This cluster is being enabled as a primary for replication. Vault will be\",`\n`,\"unavailable for a brief period and will resume service shortly.\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Generate a secondary token.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ vault write sys/replication/dr/primary/secondary-token id=\"secondary\"',`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"The output should look similar to:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"Key                              Value\",`\n`,\"---                              -----\",`\n`,\"wrapping_token:                  eyJhbGciOiJFUzUxMiIsInR5cCI6IkpXVCJ9.eyJhZGRyIjoiaHR0cDovLzEzLjU3LjIwLjQxOjgyMDAiLCJleHAiOjE1MjkzMzkzMzEsImlhdCI6MTUyOTMzNzUzMSwianRpIjoiZDZmMmMzZTItMTZjNS1mNTU0LWYxMzAtNzMzZDE0OWNiNTIzIiwidHlwZSI6IndyYXBwaW5nIn0.MIGIAkIArsC3s1x7GYnEbaYwAbYUj-Wgp4B3Q3kVXL0BbaKvsECySV4Pwtm--i24OSQfI9zAlsG8ZypOWJdngRa59wlhWdQCQgG22-I-aNWPehjsqmwwEADU-u37LUrR6O0MsUCqtfWYwIM9o7PFP1wMZ4JwDGftQXUH6hIrkXZDxnnGsSCJ1Vl75w\",`\n`,\"wrapping_accessor:               bab0ea36-23f6-d21d-4ca6-a9c3673766a3\",`\n`,\"wrapping_token_ttl:              30m\",`\n`,\"wrapping_token_creation_time:    2018-06-18 15:58:51.645117216 +0000 UTC\",`\n`,\"wrapping_token_creation_path:    sys/replication/dr/primary/secondary-token\",`\n`)),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Copy the generated \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"wrapping_token\")),` which you will need to enable the DR\nsecondary cluster.`)))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Enable DR replication on the \",mdx(\"strong\",{parentName:\"p\"},\"primary\"),\" cluster by invoking \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/sys/replication/dr/primary/enable\")),\" endpoint.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"       --request POST \\\\\",`\n`,\"       --data '{}' \\\\\",`\n`,\"       https://cluster-A.example.com:8200/v1/sys/replication/dr/primary/enable\",`\n`,\" {\",`\n`,'   \"request_id\": \"ef38af20-9c1f-138a-2d03-bbb6410fb0fc\",',`\n`,'   \"lease_id\": \"\",',`\n`,'   \"renewable\": false,',`\n`,'   \"lease_duration\": 0,',`\n`,'   \"data\": null,',`\n`,'   \"wrap_info\": null,',`\n`,'   \"warnings\": [',`\n`,'     \"This cluster is being enabled as a primary for replication. Vault will be',`\n`,'     unavailable for a brief period and will resume service shortly.\"',`\n`,\"   ],\",`\n`,'   \"auth\": null',`\n`,\" }\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Generate a secondary token by invoking \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/sys/replication/dr/primary/secondary-token\")),\" endpoint.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"       --request POST \\\\\",`\n`,`       --data '{ \"id\": \"secondary\"}' \\\\`,`\n`,\"       https://cluster-A.example.com:8200/v1/sys/replication/dr/primary/secondary-token | jq\",`\n`,\" {\",`\n`,'   \"request_id\": \"\",',`\n`,'   \"lease_id\": \"\",',`\n`,'   \"renewable\": false,',`\n`,'   \"lease_duration\": 0,',`\n`,'   \"data\": null,',`\n`,'   \"wrap_info\": {',`\n`,'     \"token\": \"eyJhbGciOiJFUzUxMiIsInR5cCI6IkpXVCJ9.eyJhZGRyIjoiaHR0cDovLzEzLjU3LjIwLjQxOjgyMDAiLCJleHAiOjE1MjkzNDQzMjcsImlhdCI6MTUyOTM0MjUyNywianRpIjoiYmRiZTJiNzEtODgwMS05YjZjLTNjMTQtMzVkNDI3NDQ3MjEzIiwidHlwZSI6IndyYXBwaW5nIn0.MIGIAkIBmESVVq_83l9hixTN7Ot0v5XQMsQfi1zV9APooZWkLvbS2olBWSQnskykQQH6GskMOi-ypOlAabqxWmfoCLA8-TICQgHRdkbJGgAQtWmjc8Z-ZEgymMv8YZq6qQxbUtPXloyM-cf_1Y1qmdGDYWtjPqoF5m1Bt_WkAJl9MguVb04QMWSotw\",',`\n`,'     \"accessor\": \"7e56e9da-178c-119d-1d01-807a203fa0b3\",',`\n`,'     \"ttl\": 1800,',`\n`,'     \"creation_time\": \"2018-06-18T17:22:07.129747708Z\",',`\n`,'     \"creation_path\": \"sys/replication/dr/primary/secondary-token\"',`\n`,\"   },\",`\n`,'   \"warnings\": null,',`\n`,'   \"auth\": null',`\n`,\" }\",`\n`)),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Copy the generated \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"token\")),` which you will need to enable the DR\nsecondary cluster.`)))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Open a web browser and launch the Vault UI (e.g.\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://cluster-A.example.com:8200/ui\"}),\"https://cluster-A.example.com:8200/ui\"),\") and then login.\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Replication\"),\" and check the \",mdx(\"strong\",{parentName:\"p\"},\"Disaster Recovery (DR)\"),` radio button.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-1.png\",alt:\"DR Replication - primary\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Enable replication\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select the \",mdx(\"strong\",{parentName:\"p\"},\"Secondaries\"),\" tab, and then click \",mdx(\"strong\",{parentName:\"p\"},\"Add\"),`.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-2.png\",alt:\"DR Replication - primary\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Populate the \",mdx(\"strong\",{parentName:\"p\"},\"Secondary ID\"),\" field, and click \",mdx(\"strong\",{parentName:\"p\"},\"Generate token\"),`.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-3.png\",alt:\"DR Replication - primary\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Copy\"),` to copy the token which you will need to enable the DR secondary cluster.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-4.png\",alt:\"DR Replication - primary\"}))))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step2\",\"aria-label\":\"step 2 enable dr secondary replication permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step2\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-enable-dr-secondary-replication\",\"aria-hidden\":\"\"})),\"Step 2: Enable DR Secondary Replication\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The following operations must be performed on the DR secondary cluster.\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-1\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-1\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Enable DR replication on the \",mdx(\"strong\",{parentName:\"p\"},\"secondary\"),\" cluster.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),'$ vault write sys/replication/dr/secondary/enable token=\"...\"',`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Where the \",mdx(\"inlineCode\",{parentName:\"p\"},\"token\"),\" is the \",mdx(\"inlineCode\",{parentName:\"p\"},\"wrapping_token\"),\" obtained from the primary cluster.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Expected output:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"WARNING! The following warnings were returned from Vault:\",`\n`,`\n`,\"* Vault has successfully found secondary information; it may take a while to\",`\n`,\"perform setup tasks. Vault will be unavailable until these tasks and initial\",`\n`,\"sync complete.\",`\n`)),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-danger g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This will immediately clear all data in the secondary cluster.\")))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-1\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-1\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Enable DR replication on the \",mdx(\"strong\",{parentName:\"p\"},\"secondary\"),\" cluster.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload.json <<EOF\",`\n`,\"{\",`\n`,'  \"token\": \"...\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"       --request POST \\\\\",`\n`,\"       --data @payload.json \\\\\",`\n`,\"       https://cluster-B.example.com:8200/v1/sys/replication/dr/secondary/enable | jq\",`\n`,\"{\",`\n`,'   \"request_id\": \"7a9730c1-b6fc-6557-5c0a-081e1f89ed2d\",',`\n`,'   \"lease_id\": \"\",',`\n`,'   \"renewable\": false,',`\n`,'   \"lease_duration\": 0,',`\n`,'   \"data\": null,',`\n`,'   \"wrap_info\": null,',`\n`,'   \"warnings\": [',`\n`,'     \"Vault has successfully found secondary information; it may take a while',`\n`,\"     to perform setup tasks. Vault will be unavailable until these tasks and\",`\n`,'     initial sync complete.\"',`\n`,\"   ],\",`\n`,'   \"auth\": null',`\n`,\" }\",`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Where the \",mdx(\"inlineCode\",{parentName:\"p\"},\"token\"),\" in \",mdx(\"inlineCode\",{parentName:\"p\"},\"payload.json\"),` is the token obtained from the primary\ncluster.`),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-danger g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This will immediately clear all data in the secondary cluster.\")))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-1\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-1\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Now, launch the Vault UI for the \",mdx(\"strong\",{parentName:\"p\"},\"secondary\"),\" cluster (e.g. \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://cluster-B.example.com:8200/ui\"}),\"https://cluster-B.example.com:8200/ui\"),\") and click \",mdx(\"strong\",{parentName:\"p\"},\"Replication\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Check the \",mdx(\"strong\",{parentName:\"p\"},\"Disaster Recovery (DR)\"),\" radio button and select \",mdx(\"strong\",{parentName:\"p\"},\"secondary\"),\" under the \",mdx(\"strong\",{parentName:\"p\"},\"Cluster mode\"),\". Paste the token you copied from the primary in the \",mdx(\"strong\",{parentName:\"p\"},\"Secondary activation token\"),` field.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-5.png\",alt:\"DR Replication - secondary\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Enable replication\"),`.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-5.2.png\",alt:\"DR Replication - secondary\"}))))),mdx(\"div\",e({},{className:\"alert alert-danger g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This will immediately clear all data in the secondary cluster.\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step3\",\"aria-label\":\"step 3 promote dr secondary to primary permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step3\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-promote-dr-secondary-to-primary\",\"aria-hidden\":\"\"})),\"Step 3: Promote DR Secondary to Primary\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This step walks you through the promotion of the secondary cluster to become the\nnew primary when a catastrophic failure causes the primary cluster to be\ninoperable. Refer to the `,mdx(\"a\",e({parentName:\"p\"},{href:\"#important\"}),mdx(\"em\",{parentName:\"a\"},`Important Note about Automated DR\nFailover`)),\" section for more background information.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"First, you must generate a \",mdx(\"strong\",{parentName:\"p\"},\"DR operation token\"),` which you need to promote the\nsecondary cluster. The process, outlined below using API calls, is the similar to `,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/operations/generate-root\"}),mdx(\"em\",{parentName:\"a\"},\"Generating a Root Token (via CLI)\")),\".\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#from-terminal\",\"aria-label\":\"from terminal permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"from-terminal\",\"aria-hidden\":\"\"})),\"From Terminal\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Generate an one time password (OTP) to use:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault operator generate-root -dr-token -generate-otp\",`\n`,\"HenFLWmt0AgrjWJp/RECzQ==\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Start the DR operation token generation process by invoking \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/sys/replication/dr/secondary/generate-operation-token/attempt\")),\" endpoint.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload.json <<EOF\",`\n`,\"{\",`\n`,'  \"otp\": \"HenFLWmt0AgrjWJp/RECzQ==\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,\"$ curl --request PUT \\\\\",`\n`,\"     --data @payload.json \\\\\",`\n`,\"     https://cluster-B.example.com:8200/v1/sys/replication/dr/secondary/generate-operation-token/attempt | jq\",`\n`,\" {\",`\n`,'   \"nonce\": \"455bf989-6575-1262-c0d0-a94eaf60bdd0\",',`\n`,'   \"started\": true,',`\n`,'   \"progress\": 0,',`\n`,'   \"required\": 3,',`\n`,'   \"complete\": false,',`\n`,'   \"encoded_token\": \"\",',`\n`,'   \"encoded_root_token\": \"\",',`\n`,'   \"pgp_fingerprint\": \"\"',`\n`,\" }\",`\n`)),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Distribute the generated \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"nonce\")),\" to each unseal key holder.\"))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`In order to generate a DR operation token, a quorum of unseal keys must be\nentered by each key holder via `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/sys/replication/dr/secondary/generate-operation-token/update\")),\" endpoint.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload_key1.json <<EOF\",`\n`,\"{\",`\n`,'  \"key\": \"<primary_unseal_key_1>\",',`\n`,'  \"nonce\": \"455bf989-6575-1262-c0d0-a94eaf60bdd0\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,\"$ curl --request PUT \\\\\",`\n`,\"        --data @payload_key1.json \\\\\",`\n`,\"        https://cluster-B.example.com:8200/v1/sys/replication/dr/secondary/generate-operation-token/update | jq\",`\n`,\"  {\",`\n`,'    \"nonce\": \"455bf989-6575-1262-c0d0-a94eaf60bdd0\",',`\n`,'    \"started\": true,',`\n`,'    \"progress\": 1,',`\n`,'    \"required\": 3,',`\n`,'    \"complete\": false,',`\n`,'    \"encoded_token\": \"\",',`\n`,'    \"encoded_root_token\": \"\",',`\n`,'    \"pgp_fingerprint\": \"\"',`\n`,\"  }\",`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`This operation must be executed by each unseal key holder. Once the quorum\nhas been reached, the output contains the encoded DR operation token\n(`,mdx(\"inlineCode\",{parentName:\"p\"},\"encoded_token\"),\").\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ curl --request PUT \\\\\",`\n`,\"      --data @payload_key3.json \\\\\",`\n`,\"      https://cluster-B.example.com:8200/v1/sys/replication/dr/secondary/generate-operation-token/update | jq\",`\n`,\"{\",`\n`,'  \"nonce\": \"455bf989-6575-1262-c0d0-a94eaf60bdd0\",',`\n`,'  \"started\": true,',`\n`,'  \"progress\": 3,',`\n`,'  \"required\": 3,',`\n`,'  \"complete\": true,',`\n`,'  \"encoded_token\": \"dKNQqNmh3JfJcSZdGlkttQ==\",',`\n`,'  \"encoded_root_token\": \"\",',`\n`,'  \"pgp_fingerprint\": \"\"',`\n`,\"}\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Decode the generated DR operation token (\",mdx(\"inlineCode\",{parentName:\"p\"},\"encoded_token\"),\").\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ vault operator generate-root -dr-token \\\\\",`\n`,'        -decode=\"dKNQqNmh3JfJcSZdGlkttQ==\" \\\\',`\n`,'        -otp=\"HenFLWmt0AgrjWJp/RECzQ==\"',`\n`,`\n`,\"23e02f22-2ae6-94cc-d93f-5ee295e03e9d\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Finally, promote the DR secondary to become the primary by invoking the\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"sys/replication/dr/secondary/promote\")),` endpoint. The request payload must\ncontains the DR operation token.`),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ tee payload.json <<EOF\",`\n`,\"{\",`\n`,'      \"dr_operation_token\": \"23e02f22-2ae6-94cc-d93f-5ee295e03e9d\"',`\n`,\"}\",`\n`,\"EOF\",`\n`,`\n`,'$ curl --header \"X-Vault-Token: ...\" \\\\',`\n`,\"          --request POST \\\\\",`\n`,\"          --data @payload.json \\\\\",`\n`,\"          https://cluster-B.example.com:8200/v1/sys/replication/dr/secondary/promote | jq\",`\n`,\"{\",`\n`,'  \"request_id\": \"3879546b-1dc7-8490-521b-80104ad761b5\",',`\n`,'  \"lease_id\": \"\",',`\n`,'  \"renewable\": false,',`\n`,'  \"lease_duration\": 0,',`\n`,'  \"data\": null,',`\n`,'  \"wrap_info\": null,',`\n`,'  \"warnings\": [',`\n`,'    \"This cluster is being promoted to a replication primary. Vault will be unavailable',`\n`,'    for a brief period and will resume service shortly.\"',`\n`,\"  ],\",`\n`,'  \"auth\": null',`\n`,\"}\",`\n`)))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-2\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-2\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click on \",mdx(\"strong\",{parentName:\"p\"},\"Generate OTP\"),\" to generate an OTP. Then click \",mdx(\"strong\",{parentName:\"p\"},\"Copy OTP\"),`.\n`,mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-6.png\",alt:\"DR Replication - secondary\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Generate Operation Token\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`A quorum of unseal keys must be entered to create a new operation token for\nthe DR secondary.`),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-7.png\",alt:\"DR Replication - secondary\"}))),mdx(\"div\",e({parentName:\"li\"},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"This operation must be performed by each unseal-key holder.\"))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Once the quorum has been reached, the output displays the encoded DR operation token. Click \",mdx(\"strong\",{parentName:\"p\"},\"Copy CLI command\"),\".\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-8.png\",alt:\"DR Replication - secondary\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Execute the CLI command from a terminal to generate a DR operation token\nusing the OTP generated earlier. (Be sure to enter your OTP in the command.)`),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",{parentName:\"li\"},mdx(\"code\",e({parentName:\"pre\"},{}),\"$ vault operator generate-root -dr-token \\\\\",`\n`,'        -otp=\"vZpZZf5UI1nvB3A5/7Xq9A==\" \\\\',`\n`,'        -decode=\"cuplaFGYduDEY6ZVC5IfaA==\"',`\n`,`\n`,\"cf703c0d-afcc-55b9-2b64-d66cf427f59c\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Now, click \",mdx(\"strong\",{parentName:\"p\"},\"Promote\"),\" tab, and then enter the generated DR operation token.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-9-1.png\",alt:\"DR Replication - secondary\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Promote cluster\"),\".\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),'When you prompted, \"',mdx(\"em\",{parentName:\"p\"},\"Are you sure you want to promote this cluster?\"),'\", click ',mdx(\"strong\",{parentName:\"p\"},\"Promote cluster\"),\" again to complete.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-9.png\",alt:\"DR Replication - secondary\"}))))),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`Once the secondary cluster was successfully promoted, you should be able to\nlog in using the original primary cluster's root token or via configured\nauthentication method. If desired, generate a `,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/operations/generate-root\"}),`new root\ntoken`),\".\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step4\",\"aria-label\":\"step 4 demote dr primary to secondary permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step4\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-demote-dr-primary-to-secondary\",\"aria-hidden\":\"\"})),\"Step 4: Demote DR Primary to Secondary\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"If the \",mdx(\"em\",{parentName:\"p\"},\"original\"),` DR primary cluster becomes operational again, you may want to\nutilize the cluster by making it a DR secondary cluster. This step explains how\nto demote the original DR primary cluster to a secondary.`),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Remember that there is only \",mdx(\"strong\",{parentName:\"p\"},\"one\"),` primary cluster available to the clients\nin DR replication.`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-2\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-2\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Execute the following command to demote the original DR primary cluster to a\nsecondary.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" -f sys/replication/dr/primary/demote\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"WARNING! The following warnings were returned from Vault:\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  * This cluster is being demoted to a replication secondary. Vault will be\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  unavailable for a brief period and will resume service shortly.\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This secondary cluster will not attempt to connect to a primary (see the\nupdate-primary call), but will maintain knowledge of its cluster ID and can be\nreconnected to the same DR replication set without wiping local storage.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-2\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-2\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Invoke the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"sys/replication/dr/secondary/enable\")),` endpoint to demote the\noriginal DR primary cluster to a secondary.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://cluster-A.example.com:8200/v1/sys/replication/dr/primary/demote | jq\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"request_id\": \"8a40adac-6eb7-c798-48d0-f7cdd25fdd6f\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"lease_id\": \"\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"lease_duration\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"data\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"wrap_info\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"warnings\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'     \"This cluster is being demoted to a replication secondary. Vault will be unavailable for a brief period and will resume service shortly.\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"   ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"auth\": null'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This secondary cluster will not attempt to connect to a primary (see the\nupdate-primary call), but will maintain knowledge of its cluster ID and can be\nreconnected to the same DR replication set without wiping local storage.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-3\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-3\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Replication\"),\" and click \",mdx(\"strong\",{parentName:\"p\"},\"Demote cluster\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-10.png\",alt:\"DR Replication - demotion\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),'When you prompted, \"',mdx(\"em\",{parentName:\"p\"},\"Are you sure you want to demote this cluster?\"),`\", click\n`,mdx(\"strong\",{parentName:\"p\"},\"Demote cluster\"),\" again to complete.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-12.png\",alt:\"DR Replication - demotion\"}))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step5\",\"aria-label\":\"step 5 disable dr primary permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step5\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-5-disable-dr-primary\",\"aria-hidden\":\"\"})),\"Step 5: Disable DR Primary\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Once the DR secondary cluster was promoted to be the \",mdx(\"strong\",{parentName:\"p\"},\"new primary\"),`, you may\nwant to disable the DR replication on the `,mdx(\"em\",{parentName:\"p\"},\"original\"),` primary when it becomes\noperational again.`),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Remember that there is only \",mdx(\"strong\",{parentName:\"p\"},\"one\"),` primary cluster available to the clients\nin DR replication.`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-3\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-3\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Execute the following command to disable DR replication.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" -f sys/replication/dr/primary/disable\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"WARNING! The following warnings were returned from Vault:\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  * This cluster is having replication disabled. Vault will be unavailable for\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    a brief period and will resume service shortly.\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Any secondaries will no longer be able to connect.\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-3\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-3\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Invoke the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"sys/replication/dr/primary/disable\")),` endpoint to disable DR\nreplication.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://cluster-A.example.com:8200/v1/sys/replication/dr/primary/disable | jq\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"request_id\": \"92a5f57a-2f7b-11be-b9dd-0f028396fba8\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"lease_id\": \"\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"lease_duration\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"data\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"wrap_info\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"warnings\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'     \"This cluster is having replication disabled. Vault will be unavailable for a brief period and will resume service shortly.\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"   ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"auth\": null'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Any secondaries will no longer be able to connect.\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-4\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-4\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Replication\"),\" and click \",mdx(\"strong\",{parentName:\"p\"},\"Disable replication\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-11.png\",alt:\"DR Replication - demotion\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),'When you prompted, \"',mdx(\"em\",{parentName:\"p\"},`Are you sure you want to disable replication on this\ncluster?`),'\", click ',mdx(\"strong\",{parentName:\"p\"},\"Disable\"),\" again to complete.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-dr-13.png\",alt:\"DR Replication - demotion\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Any secondaries will no longer be able to connect.\"),mdx(\"div\",e({},{className:\"alert alert-danger g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Caution:\"),` Once this is done, re-enabling the DR replication as a primary\nwill change the cluster's ID. Its connecting secondaries will require a wipe of\nthe underlying storage even if they have connected before. If re-enabling DR\nreplication as a secondary, its underlying storage will be wiped when connected\nto a primary.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#important\",\"aria-label\":\"important note about automated dr failover permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h __compat\",id:\"important\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"important-note-about-automated-dr-failover\",\"aria-hidden\":\"\"})),\"Important Note about Automated DR Failover\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Vault does not support an automatic failover/promotion of a DR secondary\ncluster, and this is a deliberate choice due to the difficulty in accurately\nevaluating why a failover should or shouldn't happen. For example, imagine a\nDR secondary loses its connection to the primary. Is it because the primary is\ndown, or is it because networking between the two has failed?`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`If the DR secondary promotes itself and clients start connecting to it, you now\nhave two active clusters whose data sets will immediately start diverging.\nThere's no way to understand simply from one perspective or the other which one\nof them is right.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Vault's API supports programmatically performing various replication operations\nwhich allows the customer to write their own logic about automating some of\nthese operations based on experience within their own environments. You can\nreview the available replication APIs at the following links:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/api/system/replication\"}),\"Vault Replication API\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/api/system/replication/replication-dr\"}),\"DR Replication API\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/api/system/replication/replication-performance\"}),\"Performance Replication API\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Read \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/operations/production\"}),\"Production Hardening\"),` to learn more\nabout the guidance on hardening the production deployments of Vault.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}