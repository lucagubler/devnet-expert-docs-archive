{"pageProps":{"currentPath":"operations/production","frontMatter":{"layout":"guides","page_title":"Production Hardening - Guides","description":"This guide provides guidance on best practices for a production hardened deployment of HashiCorp Vault."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/operations/production.mdx","mdxSource":{"compiledSource":"var d=Object.defineProperty;var i=Object.prototype.hasOwnProperty;var s=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable;var l=(a,t,n)=>t in a?d(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,e=(a,t)=>{for(var n in t||(t={}))i.call(t,n)&&l(a,n,t[n]);if(s)for(var n of s(t))r.call(t,n)&&l(a,n,t[n]);return a};var p=(a,t)=>{var n={};for(var o in a)i.call(a,o)&&t.indexOf(o)<0&&(n[o]=a[o]);if(a!=null&&s)for(var o of s(a))t.indexOf(o)<0&&r.call(a,o)&&(n[o]=a[o]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var o=n,{components:a}=o,t=p(o,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),t),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#production-hardening\",\"aria-label\":\"production hardening permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"production-hardening\",\"aria-hidden\":\"\"})),\"Production Hardening\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This guide provides guidance on best practices for a production hardened\ndeployment of Vault. The recommendations are based on the `,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/internals/security\"}),`security\nmodel`),\" and focus on defense in depth.\"),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"Apply When Possible!\"),` This guide is meant to provide guidance for an\n`,mdx(\"em\",{parentName:\"p\"},\"ideal\"),` deployment of Vault, not to document requirements. It is entirely\npossible to use Vault without applying any of the following recommendations.\nThese are best practice recommendations that should be applied when possible\nand practical.`)),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#recommendations\",\"aria-label\":\"recommendations permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"recommendations\",\"aria-hidden\":\"\"})),\"Recommendations\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"End-to-End TLS\"),`. Vault should always be used with TLS in production. If\nintermediate load balancers or reverse proxies are used to front Vault, they\nshould `,mdx(\"em\",{parentName:\"p\"},\"not\"),` terminate TLS. This way traffic is always encrypted in transit\nto Vault and minimizes risks introduced by intermediate layers.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Single Tenancy\"),`. Vault should be the only main process running on a\nmachine. This reduces the risk that another process running on the same\nmachine is compromised and can interact with Vault. Similarly, running on\nbare metal should be preferred to a VM, and a VM preferred to a container.\nThis reduces the surface area introduced by additional layers of abstraction\nand other tenants of the hardware. Both VM and container based deployments\nwork, but should be avoided when possible to minimize risk.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Firewall traffic\"),`. Vault listens on well known ports, use a local firewall\nto restrict all incoming and outgoing traffic to Vault and essential system\nservices like NTP. This includes restricting incoming traffic to permitted\nsubnets and outgoing traffic to services Vault needs to connect to, such as\ndatabases.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Disable SSH / Remote Desktop\"),`. When running a Vault as a single tenant\napplication, users should never access the machine directly. Instead, they\nshould access Vault through its API over the network. Use a centralized\nlogging and telemetry solution for debugging. Be sure to restrict access to\nlogs as need to know.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Disable Swap\"),`. Vault encrypts data in transit and at rest, however it must\nstill have sensitive data in memory to function. Risk of exposure should be\nminimized by disabling swap to prevent the operating system from paging\nsensitive data to disk. Vault attempts to `,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/configuration#disable_mlock\"}),`\"memory lock\" to physical memory\nautomatically`),`, but disabling\nswap adds another layer of defense.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Don't Run as Root\"),`. Vault is designed to run as an unprivileged user, and\nthere is no reason to run Vault with root or Administrator privileges, which\ncan expose the Vault process memory and allow access to Vault encryption\nkeys. Running Vault as a regular user reduces its privilege. Configuration\nfiles for Vault should have permissions set to restrict access to only the\nVault user.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Turn Off Core Dumps\"),`. A user or administrator that can force a core dump\nand has access to the resulting file can potentially access Vault encryption\nkeys. Preventing core dumps is a platform-specific process; on Linux setting\nthe resource limit `,mdx(\"inlineCode\",{parentName:\"p\"},\"RLIMIT_CORE\"),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},\"0\"),` disables core dumps. This can be\nperformed by process managers and is also exposed by various shells; in Bash\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ulimit -c 0\"),\" will accomplish this.\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Immutable Upgrades\"),`. Vault relies on an external storage backend for\npersistence, and this decoupling allows the servers running Vault to be\nmanaged immutably. When upgrading to new versions, new servers with the\nupgraded version of Vault are brought online. They are attached to the same\nshared storage backend and unsealed. Then the old servers are destroyed. This\nreduces the need for remote access and upgrade orchestration which may\nintroduce security gaps.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Avoid Root Tokens\"),`. Vault provides a root token when it is first\ninitialized. This token should be used to setup the system initially,\nparticularly setting up auth methods so that users may\nauthenticate. We recommend treating Vault `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.hashicorp.com/blog/codifying-vault-policies-and-configuration/\"}),`configuration as\ncode`),`,\nand using version control to manage policies. Once setup, the root token\nshould be revoked to eliminate the risk of exposure. Root tokens can be\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/operations/generate-root\"}),\"generated when needed\"),`, and should be\nrevoked as soon as possible.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Enable Auditing\"),`. Vault supports several auditing backends. Enabling\nauditing provides a history of all operations performed by Vault and provides\na forensics trail in the case of misuse or compromise. Audit logs `,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/audit\"}),`securely\nhash`),` any sensitive data, but access should still be\nrestricted to prevent any unintended disclosures.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Upgrade Frequently\"),`. Vault is actively developed, and updating frequently\nis important to incorporate security fixes and any changes in default\nsettings such as key lengths or cipher suites. Subscribe to the `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://groups.google.com/forum/#!forum/vault-tool\"}),`Vault\nmailing list`),\" and \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault/blob/master/CHANGELOG.md\"}),`GitHub\nCHANGELOG`),` for\nupdates.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Configure SELinux / AppArmor\"),`. Using additional mechanisms like SELinux\nand AppArmor can help provide additional layers of security when using Vault.\nWhile Vault can run on many operating systems, we recommend Linux due to the\nvarious security primitives mentioned here.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Restrict Storage Access\"),`. Vault encrypts all data at rest, regardless of\nwhich storage backend is used. Although the data is encrypted, an `,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/internals/security\"}),`attacker\nwith arbitrary control`),` can cause data\ncorruption or loss by modifying or deleting keys. Access to the storage\nbackend should be restricted to only Vault to avoid unauthorized access or\noperations.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Disable Shell Command History\"),\". You may want the \",mdx(\"inlineCode\",{parentName:\"p\"},\"vault\"),` command itself to\nnot appear in history at all. Refer to `,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/secret-mgmt/static-secrets#additional-discussion\"}),\"additional methods\"),`\nfor guidance.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Tweak ulimits\"),\". It is possible that your Linux distribution has strict process \",mdx(\"inlineCode\",{parentName:\"p\"},\"ulimits\"),`.\nConsider to review `,mdx(\"inlineCode\",{parentName:\"p\"},\"ulimits\"),` for maximum amount of open files, connections, etc. before\ngoing into production; they may need increasing.`)),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Docker Containers\"),\". To leverage the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/configuration#disable_mlock\"}),'\"memory lock\"'),`\nfeature inside the Vault container you will likely need to use the `,mdx(\"inlineCode\",{parentName:\"p\"},\"overlayfs2\"),\" or another supporting driver.\"))))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}