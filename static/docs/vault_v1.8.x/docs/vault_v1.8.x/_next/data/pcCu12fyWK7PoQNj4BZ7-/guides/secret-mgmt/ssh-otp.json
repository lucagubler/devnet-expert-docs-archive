{"pageProps":{"currentPath":"secret-mgmt/ssh-otp","frontMatter":{"layout":"guides","page_title":"One-Time SSH Password - Guides","description":"The one-time SSH password secrets engine allows Vault to issue a one-time\npassword (OTP) every time a client wants to SSH into a remote host using a\nhelper command on the remote host to perform verification."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/secret-mgmt/ssh-otp.mdx","mdxSource":{"compiledSource":"var i=Object.defineProperty;var o=Object.prototype.hasOwnProperty;var p=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable;var r=(a,s,n)=>s in a?i(a,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[s]=n,e=(a,s)=>{for(var n in s||(s={}))o.call(s,n)&&r(a,n,s[n]);if(p)for(var n of p(s))l.call(s,n)&&r(a,n,s[n]);return a};var m=(a,s)=>{var n={};for(var t in a)o.call(a,t)&&s.indexOf(t)<0&&(n[t]=a[t]);if(a!=null&&p)for(var t of p(a))s.indexOf(t)<0&&l.call(a,t)&&(n[t]=a[t]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var t=n,{components:a}=t,s=m(t,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),s),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#vault-ssh-secrets-engine-one-time-ssh-password\",\"aria-label\":\"vault ssh secrets engine one time ssh password permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"vault-ssh-secrets-engine-one-time-ssh-password\",\"aria-hidden\":\"\"})),\"Vault SSH Secrets Engine: One-Time SSH Password\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`In a distributed cloud environment, tenant and system is increasingly\nimportant part of the online security. If an attacker gains access to your\nvirtual machines, they can get control of most running applications, local data\nas well as its connected machines and systems.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Vault SSH secrets engine provides secure authentication and authorization\nfor access to machines via the SSH protocol. It supports `,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/secrets/ssh/signed-ssh-certificates\"}),`signed SSH\ncertificate`),` and one-time SSH\npassword modes. This guide demonstrates the one-time SSH password mode.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-material\",\"aria-label\":\"reference material permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-material\",\"aria-hidden\":\"\"})),\"Reference Material\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/secrets/ssh/one-time-ssh-passwords\"}),\"One-Time SSH Passwords\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/api/secret/ssh\"}),\"SSH Secrets Engine (API)\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/hashicorp/vault-ssh-helper\"}),\"Vault SSH Helper\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"10 minutes\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#personas\",\"aria-label\":\"personas permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"personas\",\"aria-hidden\":\"\"})),\"Personas\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The end-to-end scenario described in this guide involves two personas:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"operations\")),\" with privileged permissions to setup SSH secrets engine\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"client\")),\" trusted entity to request SSH OTP from Vault\")),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#challenge\",\"aria-label\":\"challenge permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"challenge\",\"aria-hidden\":\"\"})),\"Challenge\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`By default, SSH servers use password authentication with optional public key\nauthentication. If any user on the system has a fairly weak password, this\nallows an attacker to hijack the SSH connection.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#solution\",\"aria-label\":\"solution permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"solution\",\"aria-hidden\":\"\"})),\"Solution\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Vault can create a one-time password (OTP) for SSH authentication on a network\nevery time a client wants to SSH into a remote host using a helper command on\nthe remote host to perform verification.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-ssh-otp-1.png\",alt:\"SSH OTP Workflow\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`An authenticated client requests an OTP from the Vault server. If the client is\nauthorized, Vault issues and returns an OTP. The client uses this OTP during the\nSSH authentication to connect to the desired target host.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`When the client establishes an SSH connection, the OTP is received by the\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"Vault helper\")),` which validates the OTP with the Vault server. The Vault\nserver then deletes this OTP, ensuring that it is `,mdx(\"strong\",{parentName:\"p\"},\"only used once\"),\".\"),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),`Since the Vault server is contacted during SSH connection establishment, every\nlogin attempt and the correlating Vault lease information is logged to the audit\nsecrets engine.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To perform the tasks described in this guide, you need to have a Vault\nenvironment. Refer to the `,mdx(\"a\",e({parentName:\"p\"},{href:\"/intro/getting-started/install\"}),`Getting\nStarted`),\" guide to install Vault.\"),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#policy-requirements\",\"aria-label\":\"policy requirements permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"policy-requirements\",\"aria-hidden\":\"\"})),\"Policy requirements\"),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" For the purpose of this guide, you can use \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"root\")),` token to work\nwith Vault. However, it is recommended that root tokens are only used for\ninitial setup or in emergencies. As a best practice, use tokens with\nappropriate set of policies based on your role in the organization.`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To perform all tasks demonstrated in this guide, your policy must include the\nfollowing permissions:`),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# To view in Web UI\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sys/mounts\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# To configure the SSH secrets engine\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"ssh/*\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# To enable secret engines\"),`\n`,\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"sys/mounts/*\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`If you are not familiar with policies, complete the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/identity/policies\"}),\"policies\"),\" guide.\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"You will perform the following:\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step1\"}),\"Install vault-ssh-helper\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step2\"}),\"Setup the SSH Secrets Engine\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step3\"}),\"Request an OTP\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step4\"}),\"Establish an SSH session\"))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step1\",\"aria-label\":\"step 1 install vault ssh helper permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step1\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-install-vault-ssh-helper\",\"aria-hidden\":\"\"})),\"Step 1: Install vault-ssh-helper\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" operations)\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The SSH secrets engine uses \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault-ssh-helper\"}),`Vault SSH\nHelper`),` to verify the OTP used\nduring the SSH authentication. Therefore, the helper agent must be installed\nonto every `,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"target host\")),\".\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Download and install the latest version of \",mdx(\"inlineCode\",{parentName:\"p\"},\"vault-ssh-helper\"),` from\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://releases.hashicorp.com/vault-ssh-helper\"}),\"releases.hashicorp.com\"),\".\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Download the vault-ssh-helper\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"wget\"),\" https://releases.hashicorp.com/vault-ssh-helper/0.1.4/vault-ssh-helper_0.1.4_linux_amd64.zip\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Unzip the vault-ssh-helper in /user/local/bin\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"sudo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"unzip\"),\" -q vault-ssh-helper_0.1.4_linux_amd64.zip -d /usr/local/bin\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Make sure that vault-ssh-helper is executable\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"sudo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"chmod\"),\" 0755 /usr/local/bin/vault-ssh-helper\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Set the usr and group of vault-ssh-helper to root\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"sudo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"chown\"),\" root:root /usr/local/bin/vault-ssh-helper\",`\n`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`Create a Vault SSH Helper configuration file,\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/etc/vault-ssh-helper.d/config.hcl\")),\".\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-hcl\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"vault_addr\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"<VAULT_ADDRESS>\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"ssh_mount_point\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"ssh\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"ca_cert\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"/etc/vault-ssh-helper.d/vault.crt\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"tls_skip_verify\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"allowed_roles\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"*\"'),`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Where the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"<VAULT_ADDRESS>\")),\" is the address of the Vault server generating the OTP.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-hcl\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"vault_addr\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"https://198.51.100.10:8200\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"ssh_mount_point\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"ssh\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"ca_cert\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"/etc/vault-ssh-helper.d/vault.crt\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"tls_skip_verify\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"allowed_roles\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"*\"'),`\n`)),mdx(\"blockquote\",{parentName:\"li\"},mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),\"Refer to the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault-ssh-helper#vault-ssh-helper-configuration\"}),\"documentation\"),`\nfor the entire list of configuration properties.`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Modify the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/etc/pam.d/sshd\")),\" file as follows:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# PAM configuration for the Secure Shell service\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Standard Un*x authentication.\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"#@include common-auth\"),`\n`,\"auth requisite pam_exec.so quiet expose_authtok \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"log\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"/tmp/vaultssh.log /usr/local/bin/vault-ssh-helper -dev -config\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"/etc/vault-ssh-helper.d/config.hcl\",`\n`,\"auth optional pam_unix.so not_set_pass use_first_pass nodelay\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" \",mdx(\"inlineCode\",{parentName:\"p\"},\"common-auth\"),` is the standard Linux authentication module which is\ncommented out in favor of using our custom configuration.`),mdx(\"blockquote\",{parentName:\"li\"},mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`Refer to the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault-ssh-helper#pam-configuration\"}),\"documentation\"),`\nfor details about these parameter settings.`))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Modify the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/etc/ssh/sshd_config\")),\" file.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"ChallengeResponseAuthentication yes\",`\n`,\"PasswordAuthentication no\",`\n`,\"UsePAM yes\",`\n`)),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),`This enables the keyboard-interactive authentication and PAM authentication\nmodules. The password authentication is disabled.`)),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Restart the SSH service:\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"$ sudo systemctl restart sshd\",`\n`)))),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"This step must be performed on \",mdx(\"strong\",{parentName:\"p\"},\"all\"),` target hosts that you wish to connect\nusing the Vault's one-time SSH password.`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step2\",\"aria-label\":\"step 2 setup the ssh secrets engine permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step2\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-setup-the-ssh-secrets-engine\",\"aria-hidden\":\"\"})),\"Step 2: Setup the SSH Secrets Engine\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" operations)\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"On the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"Vault server\")),`, you must enable the SSH secrets engine before you can\nperform the operation. Then you are going to create a role named,\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"otp_key_role\"),\".\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"First, enable the SSH secrets engine.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault secrets \",mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"enable\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"ssh\"))),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Next, create a role.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" ssh/roles/otp_key_role \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"key_type\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"otp \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"        default_user=ubuntu \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"        cidr_list=0.0.0.0/0\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This creates \",mdx(\"inlineCode\",{parentName:\"p\"},\"otp_key_role\"),\" with \",mdx(\"inlineCode\",{parentName:\"p\"},\"ubuntu\"),` as its default username for which a\ncredential will be generated.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Enable \",mdx(\"inlineCode\",{parentName:\"p\"},\"ssh\"),\" secret engine using \",mdx(\"inlineCode\",{parentName:\"p\"},\"/sys/mounts\"),\" endpoint:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: <TOKEN>\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --data <PARAMETERS> \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       <VAULT_ADDRESS>/v1/sys/mounts/<PATH>\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Where \",mdx(\"inlineCode\",{parentName:\"p\"},\"<TOKEN>\"),\" is your valid token, and \",mdx(\"inlineCode\",{parentName:\"p\"},\"<PARAMETERS>\"),\" holds \",mdx(\"a\",e({parentName:\"p\"},{href:\"/api/system/mounts#enable-secrets-engine\"}),`configuration\nparameters`),\" of the secret engine.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The following example enables SSH secret engine at \",mdx(\"inlineCode\",{parentName:\"p\"},\"sys/mounts/ssh\"),`\npath, and passed the secret engine type (`,mdx(\"inlineCode\",{parentName:\"p\"},\"ssh\"),\") in the request payload.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"type\":\"ssh\"}' \\\\`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/sys/mounts/ssh\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Now, create a role using the \",mdx(\"inlineCode\",{parentName:\"p\"},\"ssh/roles/otp_key_role\"),\" endpoint.\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"tee\"),\" payload.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"EOF\"))),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"{\"))),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'  \"key_type\": \"otp\",'))),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'  \"default_user\": \"ubuntu\",'))),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'  \"cidr_list\": \"0.0.0.0/0\"'))),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"}\"))),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"EOF\"))),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --data @payload.json\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/ssh/roles/otp_key_role\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This creates \",mdx(\"inlineCode\",{parentName:\"p\"},\"otp_key_role\"),\" with \",mdx(\"inlineCode\",{parentName:\"p\"},\"ubuntu\"),` as its default username for which a\ncredential will be generated.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Open a web browser and launch the Vault UI (e.g. \",mdx(\"inlineCode\",{parentName:\"p\"},\"http://127.0.0.1:8200/ui\"),`) and\nthen login.`),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Enable new engine\"),\" and select \",mdx(\"strong\",{parentName:\"p\"},\"SSH\"),\" from \",mdx(\"strong\",{parentName:\"p\"},\"Secrets engine type\"),`\ndrop-down list.`)),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Enable Engine\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"Create role\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Enter \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"otp_key_role\")),\" in the \",mdx(\"strong\",{parentName:\"p\"},\"Role name\"),\" field, select \",mdx(\"strong\",{parentName:\"p\"},\"otp\"),` from the\n`,mdx(\"strong\",{parentName:\"p\"},\"Key type\"),\" drop-down list, and then enter \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"ubuntu\")),\" in the \",mdx(\"strong\",{parentName:\"p\"},\"Default user\"),`\nfield.`)),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"More options\"),` to expand the optional parameter fields, and then\nenter `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"0.0.0.0/0\")),\" in the \",mdx(\"strong\",{parentName:\"p\"},\"CIDR list\"),\" field.\"),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-ssh-otp-2.png\",alt:\"Create Role\"})))),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Create role\"),\".\"))),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),` Its recommended to create individual roles for each username to\nensure absolute isolation between usernames. This is required for Dynamic Key\ntype and OTP type. For the purpose of this guide, the `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"cidr_list\")),` will be\nset to `,mdx(\"inlineCode\",{parentName:\"p\"},\"0.0.0.0/0\"),`. For production, be sure to set this parameter to be as\ngranular as you can since there is no need to keep this role open to the world.`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step3\",\"aria-label\":\"step 3 request an otp permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step3\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-request-an-otp\",\"aria-hidden\":\"\"})),\"Step 3: Request an OTP\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" client)\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The client must have the following permission to request an OTP for\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"otp_key_role\"),\".\"),mdx(\"pre\",e({},{className:\"language-hcl\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-hcl\"}),\"path \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"ssh/creds/otp_key_role\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token property\"}),\"capabilities\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-1\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-1\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To generate an OTP credential for an IP of the remote host belongs to the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"otp_key_role\"),\":\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" ssh/creds/otp_key_role \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"ip\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"))),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"<REMOTE_HOST_IP>\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" ssh/creds/otp_key_role \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"ip\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token number\"}),\"192.0\"),\".2.10\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Key                Value\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"---                -----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"lease_id           ssh/creds/otp_key_role/234bb081-d22e-3762-3ae5-744110ea4d0a\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"lease_duration     768h\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"lease_renewable    false\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"ip                 192.0.2.10\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"key                f1cb47ad-6255-0be8-6bd8-5c4b3b01c8df\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"key_type           otp\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"port               22\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"username           ubuntu\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"key\")),\" value is the OTP to use during SSH authentication.\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-1\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-1\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To generate an OTP credential for an IP of the remote host belongs to the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"otp_key_role\"),\":\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"ip\": \"<REMOTE_HOST_IP>\"}'`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/ssh/creds/otp_key_role\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"ip\": \"192.0.2.10\"}'`),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"       https://127.0.0.1:8200/v1/ssh/creds/otp_key_role  | jq\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"request_id\": \"83327e6b-cffb-ce77-c4e1-74a60dd69436\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"lease_id\": \"ssh/creds/otp_key_role/aebd080e-51a1-0fc6-ef5c-1e1c95ca729a\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"lease_duration\": 2764800,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'   \"data\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'     \"ip\": \"192.0.20.10\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'     \"key\": \"6e472878-721a-b066-2cec-1bed0127ad44\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'     \"key_type\": \"otp\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'     \"port\": 22,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'     \"username\": \"ubuntu\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"   },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"   ...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"key\")),\" value is the OTP to use during SSH authentication.\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#web-ui-1\",\"aria-label\":\"web ui permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"web-ui-1\",\"aria-hidden\":\"\"})),\"Web UI\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`To generate an OTP credential for an IP of the remote host belongs to the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"otp_key_role\"),\":\"),mdx(\"ol\",null,mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"ssh\")),\" under \",mdx(\"strong\",{parentName:\"p\"},\"Secrets Engines\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Select \",mdx(\"strong\",{parentName:\"p\"},\"otp_key_role\"),\" and enter \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"ubuntu\")),\" in the \",mdx(\"strong\",{parentName:\"p\"},\"Username\"),` field, and\nenter the target host's IP address (e.g. `,mdx(\"inlineCode\",{parentName:\"p\"},\"192.0.2.10\"),\") in the \",mdx(\"strong\",{parentName:\"p\"},\"IP Address\"),`\nfield.`)),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Generate\"),\".\")),mdx(\"li\",e({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),\"Click \",mdx(\"strong\",{parentName:\"p\"},\"Copy credentials\"),\". This copies the OTP (\",mdx(\"inlineCode\",{parentName:\"p\"},\"key\"),\" value).\"))),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step4\",\"aria-label\":\"step 4 establish an ssh session permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step4\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-establish-an-ssh-session\",\"aria-hidden\":\"\"})),\"Step 4: Establish an SSH session\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Simply, use the OTP generated at \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step3\"}),\"Step 3\"),\" to authenticate:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"ssh\"),\" ubuntu@192.0.2.10\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Password: <Enter OTP>\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" If \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://gist.github.com/arunoda/7790979\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"sshpass\")),` is installed,\nyou can create a new OTP and SSH into the target host with single line of CLI\ncommand:`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"ssh\"),\" -role otp_key_role -mode otp -strict-host-key-checking\",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"no ubuntu@192.0.2.10\")),`\n`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Read the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/secrets/ssh/signed-ssh-certificates\"}),`Signed SSH\nCertificates`),` documentation if\nyou want to use signed SSH certificate so that the clients can use their local\nSSH keys to connect to the target hosts.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}