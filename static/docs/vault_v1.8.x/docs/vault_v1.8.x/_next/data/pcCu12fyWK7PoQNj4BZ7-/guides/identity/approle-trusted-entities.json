{"pageProps":{"currentPath":"identity/approle-trusted-entities","frontMatter":{"layout":"guides","page_title":"AppRole With Terraform & Chef - Guides","description":"This guide discusses the concepts necessary to help users\nunderstand Vault's AppRole authentication pattern and how to use it to\nsecurely introduce a Vault authentication token to a target server,\napplication, container, etc.x"},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/identity/approle-trusted-entities.mdx","mdxSource":{"compiledSource":"var i=Object.defineProperty;var o=Object.prototype.hasOwnProperty;var p=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable;var l=(a,n,t)=>n in a?i(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=>{for(var t in n||(n={}))o.call(n,t)&&l(a,t,n[t]);if(p)for(var t of p(n))r.call(n,t)&&l(a,t,n[t]);return a};var m=(a,n)=>{var t={};for(var s in a)o.call(a,s)&&n.indexOf(s)<0&&(t[s]=a[s]);if(a!=null&&p)for(var s of p(a))n.indexOf(s)<0&&r.call(a,s)&&(t[s]=a[s]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:a}=s,n=m(s,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#vault-approle-with-terraform-and-chef-demo\",\"aria-label\":\"vault approle with terraform and chef demo permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"vault-approle-with-terraform-and-chef-demo\",\"aria-hidden\":\"\"})),\"Vault AppRole with Terraform and Chef Demo\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"In the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/identity/authentication#advanced-features\"}),`AppRole Pull\nAuthentication`),` guide,\nthe question of how best to deliver the Role ID and Secret ID were brought up,\nand the role of trusted entities (Terraform, Chef, Nomad, Kubernetes, etc.) was\nmentioned.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-workflow2.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This \",mdx(\"em\",{parentName:\"p\"},\"intermediate\"),\" Vault guide aims to provide a \",mdx(\"strong\",{parentName:\"p\"},\"simple\"),\", \",mdx(\"strong\",{parentName:\"p\"},\"end-to-end\"),`\nexample of how to use Vault's `,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/auth/approle\"}),`AppRole authentication\nmethod`),`, along with Terraform and Chef, to address the\nchallenge of the `,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"secure introduction\")),` of an initial token to a target\nsystem.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The purpose of this guide is to provide the instruction to reproduce the working\nimplementation demo introduced in the `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef\"}),`Delivering Secret Zero: Vault AppRole\nwith Terraform and\nChef`),`\nwebinar.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"p\"},{href:\"https://youtu.be/OIcIzFWjThM\"}),mdx(\"img\",e({parentName:\"a\"},{src:\"/img/vault-approle-youtube.png\",alt:\"YouTube\"})))),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This is a proof of concept and \",mdx(\"strong\",{parentName:\"p\"},\"NOT SUITABLE FOR PRODUCTION USE\"),\".\")),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-material\",\"aria-label\":\"reference material permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-material\",\"aria-hidden\":\"\"})),\"Reference Material\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/auth/approle\"}),\"AppRole Auth Method\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.hashicorp.com/blog/authenticating-applications-with-vault-approle\"}),\"Authenticating Applications with HashiCorp Vault AppRole\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef\"}),`Delivering Secret Zero: Vault AppRole with Terraform and\nChef`))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"20 minutes\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#challenge\",\"aria-label\":\"challenge permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"challenge\",\"aria-hidden\":\"\"})),\"Challenge\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The goal of the AppRole authentication method is to provide a mechanism for the\nsecure introduction of secrets to target systems (servers, applications,\ncontainers, etc.).`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The question becomes what systems within our environment do we trust to handle\nor deliver the `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\" to our target systems.\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#solution\",\"aria-label\":\"solution permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"solution\",\"aria-hidden\":\"\"})),\"Solution\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Use \",mdx(\"em\",{parentName:\"p\"},\"Trusted Entities\"),` to deliver the AppRole authentication values. For\nexample, use Terraform to deliver your `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),` or embed it into your AMI or\nDockerfile. Then you might use Jenkins or Chef to obtain the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/secret-mgmt/cubbyhole\"}),\"response-wrapped\"),\" \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),` and deliver it\nto the target system.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`AppRole allows us to securely introduce the authentication token to the target\nsystem by preventing any single system from having full access to an\nauthentication token that does not belong to. This helps us maintain the\nsecurity principles of `,mdx(\"strong\",{parentName:\"p\"},\"least privilege\"),\" and \",mdx(\"strong\",{parentName:\"p\"},\"non-repudiation\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The important thing to note here is that regardless of what systems are\nconsidered as `,mdx(\"em\",{parentName:\"p\"},\"Trusted Entities\"),\", the same pattern applies.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"For example:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"With Chef, you might use the \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/hashicorp/vault-ruby\"}),\"Vault Ruby Gem\"),`\nfor simplified interaction with Vault APIs`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Terraform provides a Vault provider: \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.terraform.io/docs/providers/vault/index.html\"}),\"Provider: Vault - Terraform by HashiCorp\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),`For Jenkins, you might use the Vault CLI or APIs directly, as described here:\n`,mdx(\"a\",e({parentName:\"li\"},{href:\"http://nicolas.corrarello.com/general/vault/security/ci/2017/04/23/Reading-Vault-Secrets-in-your-Jenkins-pipeline.html\"}),\"Reading Vault Secrets in your Jenkins pipeline\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This guide assumes that you are proficient enough to perform basic Terraform\ntasks. If you are not familiar with Terraform, refer to the `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.terraform.io/intro/getting-started/install.html\"}),`online\ndocumentation`),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The following AWS resources are required to perform this demo:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"An \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html\"}),\"Amazon S3 bucket\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"An \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_change-permissions.html\"}),\"IAM user credential with administrator permissions\"),`\n(to be able to create additional IAM policies and instance profiles)`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#download-demo-assets\",\"aria-label\":\"download demo assets permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"download-demo-assets\",\"aria-hidden\":\"\"})),\"Download demo assets\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Clone or download the demo assets from the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault-guides/tree/master/identity/vault-chef-approle\"}),\"hashicorp/vault-guides\"),`\nGitHub repository to perform the steps described in this guide.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The following assets can be found in the repository:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Chef cookbook (\",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/chef/cookbooks\")),`): A sample cookbook with a recipe that installs NGINX\nand demonstrates Vault Ruby Gem functionality used to interact with Vault APIs.`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Terraform configurations (\",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/terraform-aws\")),\"):\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/terraform-aws/mgmt-node\")),`: Configuration to set up a management\nserver running both Vault and Chef Server, for demo purposes.`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/terraform-aws/chef-node\")),`: Configuration to set up a Chef node and\nbootstrap it with the Chef Server, passing in Vault's AppRole RoleID and the\nappropriate Chef run-list.`))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Vault configuration (\",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/scripts\")),`): Data scripts used to configure the\nappropriate mounts and policies in Vault for this demo.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The scenario in this guide uses Terraform and Chef as trusted entities to\ndeliver `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-tf-chef.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`For the simplicity of the demonstration, both Vault and Chef are installed on\nthe same node. Terraform provisions the node which contains the `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),` as an\nenvironment variable. Chef pulls the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\" from Vault.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Provisioning for this demo happens in 2 phases:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#phase1\"}),\"Phase 1 - Provision our Vault plus Chef Server\"),mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-1-provision-the-vault-and-chef-server\"}),\"Step 1: Provision the Vault and Chef Server\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-2-initialize-and-unseal-vault\"}),\"Step 2: Initialize and Unseal Vault\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-3-approle-setup\"}),\"Step 3: AppRole Setup\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-4-configure-tokens-for-terraform-and-chef\"}),\"Step 4: Configure Tokens for Terraform and Chef\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-5-save-the-token-in-a-chef-data-bag\"}),\"Step 5: Save the Token in a Chef Data Bag\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step-6-write-secrets\"}),\"Step 6: Write Secrets\")))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#phase2\"}),\"Phase 2 - Provision our Chef Node to Show AppRole Login\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#phase1\",\"aria-label\":\"phase 1 provision our vault chef server permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h __compat\",id:\"phase1\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"phase-1-provision-our-vault-chef-server\",\"aria-hidden\":\"\"})),\"Phase 1: Provision our Vault & Chef Server\"),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-1-provision-the-vault-and-chef-server\",\"aria-label\":\"step 1 provision the vault and chef server permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-provision-the-vault-and-chef-server\",\"aria-hidden\":\"\"})),\"Step 1: Provision the Vault and Chef Server\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This provides a quick and simple Vault and Chef Server configuration to help you\nget started.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" This is done for demonstration purpose and \",mdx(\"strong\",{parentName:\"p\"},`NOT a recommended\npractice`),\" for production.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`In this phase, you use Terraform to spin up a server (and associated AWS\nresources) with both Vault and Chef Server installed. Once this server is up and\nrunning, you'll complete the appropriate configuration steps in Vault to set up\nour AppRole and tokens for use in the demo.`),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"If using \",mdx(\"em\",{parentName:\"p\"},\"Terraform Enterprise\"),\", \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.terraform.io/docs/enterprise/getting-started/workspaces.html\"}),`create a\nWorkspace`),`\nfor this repo and set the appropriate Terraform/Environment variables using the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars.example\"),` file as a reference. Follow the instructions in the\ndocumentation to perform the appropriate setup in Terraform Enterprise.`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#using-terraform-open-source\",\"aria-label\":\"using terraform open source permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"using-terraform-open-source\",\"aria-hidden\":\"\"})),\"Using Terraform Open Source:\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 1:\"),\" Change the working directory (\",mdx(\"inlineCode\",{parentName:\"p\"},\"cd\"),`) to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"identity/vault-chef-approle/terraform-aws/mgmt-node\"),\".\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\".\"),`\n`,\"\\u251C\\u2500\\u2500 main.tf\",`\n`,\"\\u251C\\u2500\\u2500 outputs.tf\",`\n`,\"\\u251C\\u2500\\u2500 templates\",`\n`,\"\\u2502\\xA0\\xA0 \\u2514\\u2500\\u2500 userdata-mgmt-node.tpl\",`\n`,\"\\u251C\\u2500\\u2500 terraform.tfvars.example\",`\n`,\"\\u2514\\u2500\\u2500 variables.tf\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 2:\"),\" Update the \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars.example\"),` file to match your account and\nrename it to `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"At minimum, replace the following variable with appropriate values:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"s3_bucket_name\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vpc_id\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"subnet_id\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"key_name\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"ec2_pem\")))),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`NOTE: If your VPC, subnet and EC2 key pair were created on a region other than\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"us-east-1\"),\", be sure to set the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"aws_region\")),\" value to match your chosen region.\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 3:\"),\" Perform a \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform init\"),` to pull down the necessary provider resources.\nThen `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform plan\"),` to verify your changes and the resources that will be\ncreated. If all looks good, then perform a `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform apply\"),` to provision the\nresources. The Terraform output will display the public IP address to SSH into\nyour server.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"terraform init\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Initializing provider plugins...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Terraform has been successfully initialized!\"),`\n`,`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"terraform plan\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Plan: 5 to add, 0 to change, 0 to destroy.\"),`\n`,`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"terraform apply\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Apply complete! Resources: 5 added, 0 changed, 0 destroyed.\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Outputs:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"vault-public-ip = 192.0.2.0\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Terraform output will display the public IP address to SSH into\nyour server.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"For example:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"ssh\"),\" -i \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"/path/to/EC2/private_key.pem\"'),\" ubuntu@192.0.2.0\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Task 4:\"),` Initial setup of the Chef server takes several minutes. Once you can\nSSH into your mgmt server, run `,mdx(\"inlineCode\",{parentName:\"p\"},\"tail -f /var/log/tf-user-data.log\"),` to see when\nthe initial configuration is complete.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"tail\"),\" -f /var/log/tf-user-data.log\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"When you see the following message, the initial setup is complete.\"),mdx(\"pre\",e({},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"+ echo '2018/03/27 21:53:06 /var/lib/cloud/instance/scripts/part-001: Complete'\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`You can find the following subfolders in\nyour home directory:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/home/ubuntu/vault-chef-approle-demo\")),\": root of our project\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/home/ubuntu/vault-chef-approle-demo/chef\")),`: root of our Chef app; this is\nwhere our `,mdx(\"inlineCode\",{parentName:\"li\"},\"knife\"),\" configuration is located (\",mdx(\"inlineCode\",{parentName:\"li\"},\".chef/knife.rb\"),\")\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/home/ubuntu/vault-chef-approle-demo/scripts\")),`: there's a\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"vault-approle-setup.sh\"),` script located here to help automate the setup of\nVault, or you can follow along in the rest of this README to configure Vault\nmanually`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-2-initialize-and-unseal-vault\",\"aria-label\":\"step 2 initialize and unseal vault permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-initialize-and-unseal-vault\",\"aria-hidden\":\"\"})),\"Step 2: Initialize and Unseal Vault\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Before moving on, set your working environment variables in your mgmt server:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_ADDR\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"http://127.0.0.1:8200\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_SKIP_VERIFY\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"true\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Before you can do anything in Vault, you need to initialize and unseal it.\nPerform `,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"one\")),\" of the following:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"Option 1:\"),\" Run the \",mdx(\"inlineCode\",{parentName:\"li\"},\"/home/ubuntu/demo_setup.sh\"),` script to get up and running, and proceed to\n`,mdx(\"a\",e({parentName:\"li\"},{href:\"#phase2\"}),\"Phase 2 - Provision our Chef Node to Show AppRole Login\"),\".\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"Option 2:\"),\" Continue onto \",mdx(\"a\",e({parentName:\"li\"},{href:\"#step-3-approle-setup\"}),\"Step 3: AppRole Setup\"),` to\nset up the demo environment `,mdx(\"strong\",{parentName:\"li\"},mdx(\"em\",{parentName:\"strong\"},\"manually\")),\".\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-3-approle-setup\",\"aria-label\":\"step 3 approle setup permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-approle-setup\",\"aria-hidden\":\"\"})),\"Step 3: AppRole Setup\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"First, initialize and unseal the Vault server using a shortcut.\"),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"This is a convenient shortcut for demo. \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"DO NOT DO THIS IN PRODUCTION!!!\")))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Refer to the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/intro/getting-started/deploy#initializing-the-vault\"}),\"online documentation for initializing and unsealing\"),\" Vault for more details.\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Initialize the Vault server and write out the unseal keys and root token into files\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent\",`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),`'{\"secret_shares\": 1, \"secret_threshold\": 1}'`),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"${VAULT_ADDR}\"),\"/v1/sys/init \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"jq -r .root_token \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" /home/ubuntu/vault-chef-approle-demo/root-token\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"jq -r .keys\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"0\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" /home/ubuntu/vault-chef-approle-demo/unseal-key\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Unseal vault\"),`\n`,\"$ vault operator unseal \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$(\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" /home/ubuntu/vault-chef-approle-demo/unseal-key\",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\")\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Set the root token to VAULT_TOKEN env var\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"VAULT_TOKEN\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$(\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" /home/ubuntu/vault-chef-approle-demo/root-token\",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\")\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`In the next few steps, you will create a number of policies and tokens within\nVault. Below is a table that summarizes them:`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Policy\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Description\"),mdx(\"th\",e({parentName:\"tr\"},{align:null}),\"Token Attachment\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"app-1-secret-read\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Sets the policy for the final token that will be delivered via the AppRole login\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"None. This will be delivered to the client upon AppRole login\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"app-1-approle-roleid-get\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Sets the policy for the token that you'll give to Terraform to deliver the RoleID (only)\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"roleid-token\"))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"terraform-token-create\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"The Terraform Vault provider doesn't use the token supplied to it directly. This is to prevent the token from being exposed in Terraform's state file. Instead, the Token given to Terraform needs to have the capability to create child tokens with short TTLs. See \",mdx(\"a\",e({parentName:\"td\"},{href:\"https://www.terraform.io/docs/providers/vault/index.html#token\"}),\"here\"),\" for more info\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"roleid-token\"))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"app-1-approle-secretid-create\")),mdx(\"td\",e({parentName:\"tr\"},{align:null}),\"Sets the policy for the token that you'll store in the Chef Data Bag. This will only be able to pull our AppRole's SecretID\"),mdx(\"td\",e({parentName:\"tr\"},{align:null}),mdx(\"inlineCode\",{parentName:\"td\"},\"secretid-token\"))))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`These setups only need to be performed upon initial creation of an AppRole, and\nwould typically be done by a Vault administrator.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Now that you have your Vault server unsealed, you can begin to set up necessary\npolicies, AppRole auth method, and tokens.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-1-set-up-our-approle-policy\",\"aria-label\":\"task 1 set up our approle policy permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-1-set-up-our-approle-policy\",\"aria-hidden\":\"\"})),\"Task 1: Set up our AppRole policy\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This is the policy that will be attached to \",mdx(\"em\",{parentName:\"p\"},\"secret zero\"),` which you are\ndelivering to our application (`,mdx(\"strong\",{parentName:\"p\"},\"app-1\"),\").\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy to apply to AppRole token\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-secret-read.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"secret/app-1\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"read\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\", \",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"list\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-secret-read policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @app-1-secret-read.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/app-1-secret-read\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy to apply to AppRole token\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-secret-read.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"secret/app-1\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [\"read\", \"list\"]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-secret-read policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" app-1-secret-read app-1-secret-read.hcl\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-2-enable-the-approle-authentication-method\",\"aria-label\":\"task 2 enable the approle authentication method permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-2-enable-the-approle-authentication-method\",\"aria-hidden\":\"\"})),\"Task 2: Enable the AppRole authentication method\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload for invoking sys/auth API endpoint\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" approle.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"type\": \"approle\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"description\": \"Demo AppRole auth method\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Enable AppRole auth backend\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @approle.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/auth/approle\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault auth \",mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"enable\"),\" -description\",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\"Demo AppRole auth method\"'),\" approle\")),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-3-configure-the-approle\",\"aria-label\":\"task 3 configure the approle permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-3-configure-the-approle\",\"aria-hidden\":\"\"})),\"Task 3: Configure the AppRole\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Now, you are going to create an AppRole role named, \",mdx(\"strong\",{parentName:\"p\"},\"app-1\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload containing AppRole auth method configuration\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# TTL is set to 10 minutes, and Max TTL to be 30 minutes\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-role.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"role_name\": \"app-1\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"bind_secret_id\": true,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"secret_id_ttl\": \"10m\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"secret_id_num_uses\": \"1\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"token_ttl\": \"10m\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"token_max_ttl\": \"30m\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"period\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'        \"app-1-secret-read\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"    ]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# AppRole backend configuration\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @app-1-approle-role.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/auth/approle/role/app-1\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# TTL is set to 10 minutes, and Max TTL to be 30 minutes\"),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" auth/approle/role/app-1 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"policies\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-secret-read\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"token_ttl\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"10m\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"token_max_ttl\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"30m\"'),`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-4-configure-tokens-for-terraform-and-chef\",\"aria-label\":\"step 4 configure tokens for terraform and chef permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-configure-tokens-for-terraform-and-chef\",\"aria-hidden\":\"\"})),\"Step 4: Configure Tokens for Terraform and Chef\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Now, you're ready to configure the policies and tokens to Terraform and Chef to\ninteract with Vault. Remember, the point here is that you are giving each system\na `,mdx(\"em\",{parentName:\"p\"},\"limited\"),\" token that is only able to pull either the \",mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" or \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),`,\n`,mdx(\"em\",{parentName:\"p\"},\"but not both\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-tf-chef-2.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-1-create-a-policy-and-token-for-terraform\",\"aria-label\":\"task 1 create a policy and token for terraform permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-1-create-a-policy-and-token-for-terraform\",\"aria-hidden\":\"\"})),\"Task 1: Create a policy and token for Terraform\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Create a token with appropriate policies allowing Terraform to pull\nthe `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\" from Vault:\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve RoleID from Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-roleid-get.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"auth/approle/role/app-1/role-id\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"read\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @app-1-approle-roleid-get.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/app-1-approle-roleid-get\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# For Terraform\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# See: https://www.terraform.io/docs/providers/vault/index.html#token\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy granting to create tokens required by Terraform\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" terraform-token-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"/auth/token/create\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"update\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @terraform-token-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/terraform-token-create\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload to configure token for Terraform to pull RoleID\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" roleid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"app-1-approle-roleid-get\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"terraform-token-create\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"meta\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"user\": \"terraform-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"ttl\": \"720h\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"renewable\": true'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token and save it in roleid-token.json\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @roleid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/auth/token/create \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" roleid-token.json\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The token and associated metadata will be written out to the file\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"roleid-token.json\"),\". The \",mdx(\"inlineCode\",{parentName:\"p\"},\"client_token\"),` value is what you'll give to Terraform.\nThe file should look similar to the following:`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" roleid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"request_id\": \"2e1d05eb-988d-4cf7-7b6a-d2668de31536\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_id\": \"\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_duration\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"data\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"wrap_info\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"warnings\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"auth\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"client_token\": \"6a7ad093-42ab-885e-3d67-6d51a5583da6\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"accessor\": \"f6170506-ee0f-5a59-8478-e0aac2d3259f\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"app-1-approle-roleid-get\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"default\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"terraform-token-create\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"metadata\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"user\": \"terraform-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"lease_duration\": 2592000,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"renewable\": true,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"entity_id\": \"\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  }\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve RoleID from Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-roleid-get.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"auth/approle/role/app-1/role-id\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [ \"read\" ]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" app-1-approle-roleid-get app-1-approle-roleid-get.hcl\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# For Terraform\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# See: https://www.terraform.io/docs/providers/vault/index.html#token\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy granting to create tokens required by Terraform\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" terraform-token-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"auth/token/create\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [ \"update\" ]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-roleid-get policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" terraform-token-create terraform-token-create.hcl\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token and save it in roleid-token.txt\"),`\n`,\"$ vault token create -policy\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-approle-roleid-get\"'),\" -policy\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"terraform-token-create\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      -metadata\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"user\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"terraform-user\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" roleid-token.txt\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The token and associated metadata will be written out to the file\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"roleid-token.txt\"),\". The \",mdx(\"inlineCode\",{parentName:\"p\"},\"token\"),` value is what you'll give to Terraform.\nThe file should look similar to the following:`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" roleid-token.txt\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Key                Value\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"---                -----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token              2600aeda-6385-c163-7171-543b1e1fabcf\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_accessor     6ef835e3-4948-8c61-1e89-3625ca31fd84\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_duration     768h\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_renewable    true\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_policies     [app-1-approle-roleid-get default terraform-token-create]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_meta_user    terraform-demo\"),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-2-create-a-policy-and-token-for-chef\",\"aria-label\":\"task 2 create a policy and token for chef permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-2-create-a-policy-and-token-for-chef\",\"aria-hidden\":\"\"})),\"Task 2: Create a policy and token for Chef\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Create a token with appropriate policies allowing Chef to pull the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),`\nfrom Vault:`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve SecretID\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-secretid-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'{\"policy\":\"path ',mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"auth/approle/role/app-1/secret-id\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\" {capabilities = [\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),\"update\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:'\\\\\"'}),'\\\\\"'),']}\"}'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-secretid-create policy in Vault\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --request PUT \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    --data @app-1-approle-secretid-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/sys/policy/app-1-approle-secretid-create\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Payload to invoke auth/token/create endpoint\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" secretid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"app-1-approle-secretid-create\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"meta\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'    \"user\": \"chef-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"  },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"ttl\": \"720h\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"renewable\": true'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token for Chef to get SecretID from Vault and store it in secretid-token.json\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @secretid-token-config.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/auth/token/create \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" secretid-token.json\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The resulting file should look like this:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" secretid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"request_id\": \"6f6ad8a1-fedb-b838-60ce-87999f01aff6\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_id\": \"\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"renewable\": false,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"lease_duration\": 0,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"data\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"wrap_info\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"warnings\": null,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'  \"auth\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"client_token\": \"cdfdb7a0-d7a6-3769-927d-0ace297726ea\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"accessor\": \"88e8aaca-1584-4881-3368-d9cb5cd7ddae\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"policies\": ['),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"app-1-approle-secretid-create\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"default\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    ],\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"metadata\": {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'      \"user\": \"chef-demo\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    },\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"lease_duration\": 2592000,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"renewable\": true,'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),'    \"entity_id\": \"\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  }\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Policy file granting to retrieve SecretID\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" app-1-approle-secretid-create.hcl \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'path \"auth/approle/role/app-1/secret-id\" {'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  capabilities = [ \"update\" ]'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Create the app-1-approle-secretid-create policy in Vault\"),`\n`,\"$ vault policy \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" app-1-approle-secretid-create app-1-approle-secretid-create.hcl\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get token for Chef to get SecretID from Vault and store it in secretid-token.txt\"),`\n`,\"$ vault token create -policy\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-approle-secretid-create\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      -metadata\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"user\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"chef-demo\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" secretid-token.txt\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The resulting file should look like this:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" secretid-token.txt\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"Key                Value\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"---                -----\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token              20d69183-59cb-c953-6dea-34f5f1bbe5f7\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_accessor     a17e7a43-c14a-b96a-0014-9149d218e74a\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_duration     768h\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_renewable    true\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_policies     [app-1-approle-secretid-create default]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"token_meta_user    chef-demo\"),`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-5-save-the-token-in-a-chef-data-bag\",\"aria-label\":\"step 5 save the token in a chef data bag permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-5-save-the-token-in-a-chef-data-bag\",\"aria-hidden\":\"\"})),\"Step 5: Save the Token in a Chef Data Bag\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`At this point, you have a client token generated for Terraform and another for\nChef server to log into Vault. For the sake of simplicity, you can put the\nChef's client token (`,mdx(\"inlineCode\",{parentName:\"p\"},\"secretid-token.json\"),\") in a \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.chef.io/data_bags.html\"}),`Data\nBag`),` which is fine because this token can\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"only\")),\" retrieve \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),` from Vault which is not much of a use without a\ncorresponding `,mdx(\"inlineCode\",{parentName:\"p\"},\"RoleID\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Now, create a Chef Data Bag and put the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SecretID\"),\" token (\",mdx(\"inlineCode\",{parentName:\"p\"},\"secretid-token.json\"),`)\nalong with the rest of its metadata.`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"cd\"),\" /home/ubuntu/vault-chef-approle-demo/chef/\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"#\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"Use the path \",mdx(\"span\",e({parentName:\"span\"},{className:\"token keyword\"}),\"for\"),\" where you created this \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"file\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token keyword\"}),\"in\"),\" the previous step\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"#\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"You\",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"'re just adding an '\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"id\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"' field to the file as that'\"),\"s a required field \",mdx(\"span\",e({parentName:\"span\"},{className:\"token keyword\"}),\"for\"),\" data bags\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" /home/ubuntu/secretid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq --arg \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"id\"),\" approle-secretid-token \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"'. + {id: \",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$id\"),\"}'\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\">\"),\" secretid-token.json\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag create secretid-token\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag from \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"file\"),\" secretid-token secretid-token.json\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag list\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag show secretid-token\")),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag show secretid-token approle-secretid-token\")),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The last step should show the following output:\"),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),\"knife data bag show secretid-token approle-secretid-token\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"WARNING: Unencrypted data bag detected, ignoring any provided secret options.\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"auth:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  accessor:       88e8aaca-1584-4881-3368-d9cb5cd7ddae\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  client_token:   cdfdb7a0-d7a6-3769-927d-0ace297726ea\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  entity_id:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  lease_duration: 2592000\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  metadata:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  policies:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    app-1-approle-secretid-create\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"    default\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"  renewable:      true\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"data:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"id:             approle-secretid-token\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"lease_duration: 0\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"lease_id:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"renewable:      false\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"request_id:     6f6ad8a1-fedb-b838-60ce-87999f01aff6\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"warnings:\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token output\"}),\"wrap_info:\"),`\n`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step-6-write-secrets\",\"aria-label\":\"step 6 write secrets permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-6-write-secrets\",\"aria-hidden\":\"\"})),\"Step 6: Write Secrets\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Let's write some test data in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"secret/app-1\"),` path so that the target app\nwill have some secret to retrieve from Vault at a later step.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"API call using cURL\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Write some demo secrets\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"tee\"),\" demo-secrets.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"<<\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'EOF'\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"{\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"username\": \"app-1-user\",'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'  \"password\": \"$up3r$3cr3t!\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"EOF\"),`\n`,`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request POST \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --data @demo-secrets.json \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/secret/app-1\",`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Verify that you can read back the data:\"),`\n`,\"$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --silent \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --location \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --header \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$VAULT_TOKEN\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       --request GET \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"       \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$VAULT_ADDR\"),\"/v1/secret/app-1 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" jq\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"request_id\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"1f73c7ee-27fa-bad0-9c77-b330eef1ea88\"'),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"lease_id\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"\"'),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"renewable\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" false,\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"lease_duration\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"2764800\"),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"data\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"password\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$up3r\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$3cr3t\"),'!\"'),\",\",`\n`,\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"username\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-user\"'),`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\",\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"wrap_info\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null,\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"warnings\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null,\",`\n`,\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"auth\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" null\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"CLI command\")),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Write some demo secrets\"),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" secret/app-1 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"username\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"app-1-user\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"password\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"\\\\',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$up3r\"),\"\\\\\",mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$3cr3t\"),'!\"'),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Verify that you can read back the data:\"),`\n`,\"$ vault \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"read\"),\" secret/app-1\",`\n`,\"Key                 Value\",`\n`,\"---                 -----\",`\n`,\"refresh_interval    768h\",`\n`,\"password            \",mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$up3r\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),\"$3cr3t\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"!\"),`\n`,\"username            app-1-user\",`\n`)),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),`At this point, just about all the pieces are in place. Remember, these setup\nsteps will only need to be performed upon initial creation of an AppRole, and\nwould typically be done by a Vault administrator.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#phase2\",\"aria-label\":\"phase 2 provision our chef node to show approle login permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h __compat\",id:\"phase2\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"phase-2-provision-our-chef-node-to-show-approle-login\",\"aria-hidden\":\"\"})),\"Phase 2: Provision our Chef Node to Show AppRole Login\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"To complete the demo, run the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"chef-node\")),` Terraform configuration to see how\neverything talks to each other.`),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-1-change-the-working-directory\",\"aria-label\":\"task 1 change the working directory permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-1-change-the-working-directory\",\"aria-hidden\":\"\"})),\"Task 1: Change the working directory\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Open another terminal on your host machine (\",mdx(\"strong\",{parentName:\"p\"},\"not\"),\" the \",mdx(\"inlineCode\",{parentName:\"p\"},\"mgmt-node\"),`)\nand `,mdx(\"inlineCode\",{parentName:\"p\"},\"cd\"),\" into the \",mdx(\"inlineCode\",{parentName:\"p\"},\"identity/vault-chef-approle/terraform-aws/chef-node\"),`\ndirectory:`),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"cd\"),\" identity/vault-chef-approle/terraform-aws/chef-node\")),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-2-update-terraform-tfvars-example\",\"aria-label\":\"task 2 update terraform tfvars example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-2-update-terraform-tfvars-example\",\"aria-hidden\":\"\"})),\"Task 2: Update terraform.tfvars.example\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Replace the variable values in \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars.example\"),` to match your\nenvironment and save it as `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform.tfvars\"),\" like you have done at \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step-1-provision-the-vault-and-chef-server\"}),\"Step 1\"),\".\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Note the following:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Update the \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vault_address\")),\" and \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"chef_server_address\")),` variables with\nthe IP address of our `,mdx(\"inlineCode\",{parentName:\"li\"},\"mgmt-node\"),\" from above.\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Update the \",mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vault_token\")),\" variable with the \",mdx(\"inlineCode\",{parentName:\"li\"},\"RoleID\"),\" token from \",mdx(\"strong\",{parentName:\"li\"},\"Task 1\"),`\nin `,mdx(\"a\",e({parentName:\"li\"},{href:\"#step-4-configure-tokens-for-terraform-and-chef\"}),\"Step 4\"),\".\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"If you ran the \",mdx(\"inlineCode\",{parentName:\"li\"},\"demo-setup.sh\"),\" script (\",mdx(\"em\",{parentName:\"li\"},\"Option 1\"),`), retrieve the\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"client_token\"),\" in the \",mdx(\"inlineCode\",{parentName:\"li\"},\"/home/ubuntu/vault-chef-approle-demo/roleid-token.json\"),`\nfile:`)))),mdx(\"pre\",e({},{className:\"language-shell-session\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" ~/vault-chef-approle-demo/roleid-token.json \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" jq \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),'\".auth.client_token\"'))),`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-3-run-terraform\",\"aria-label\":\"task 3 run terraform permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-3-run-terraform\",\"aria-hidden\":\"\"})),\"Task 3: Run Terraform\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Perform a \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform init\"),` to pull down the necessary provider\nresources. Then `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform plan\"),` to verify your changes and the resources that\nwill be created. If all looks good, then perform a `,mdx(\"inlineCode\",{parentName:\"p\"},\"terraform apply\"),` to\nprovision the resources.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Terraform output will display the public IP address to SSH into your\nserver.`),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" If the \",mdx(\"inlineCode\",{parentName:\"p\"},\"terraform apply\"),' fails with \"',mdx(\"inlineCode\",{parentName:\"p\"},\"io: read/write on closed pipe\"),`\"\nerror, this is a `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/terraform/issues/17638\"}),`known\nissue`),` with Terraform\n0.11.4 and 0.11.5. Please try again with another Terraform version.`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"At this point, Terraform will perform the following actions:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Pull a \",mdx(\"inlineCode\",{parentName:\"li\"},\"RoleID\"),\" from our Vault server\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Provision an AWS instance\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Write the \",mdx(\"inlineCode\",{parentName:\"li\"},\"RoleID\"),\" to the AWS instance as an environment variable\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Run the Chef provisioner to bootstrap the AWS instance with our Chef Server\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),`Run our Chef recipe which will install NGINX, perform our AppRole login, get\nour secrets, and output them to our `,mdx(\"inlineCode\",{parentName:\"li\"},\"index.html\"),\" file\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-approle-tf-chef-3.png\",alt:\"AppRole auth method workflow\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Chef recipe can be found at\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"identity/vault-chef-approle/chef/cookbooks/vault_chef_approle_demo/recipes/default.rb\"),\".\"),mdx(\"pre\",e({},{className:\"language-shell\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Configure address for Vault Gem\"),`\n`,\"Vault.address \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" ENV\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'VAULT_ADDR'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get AppRole RoleID from our environment variables (delivered via Terraform)\"),`\n`,\"var_role_id \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" ENV\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'APPROLE_ROLEID'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get Vault token from data bag (used to retrieve the SecretID)\"),`\n`,\"vault_token_data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" data_bag_item\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'secretid-token'\"),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'approle-secretid-token'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Set Vault token (used to retrieve the SecretID)\"),`\n`,\"Vault.token \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" vault_token_data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'auth'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'client_token'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Get AppRole SecretID from Vault\"),`\n`,\"var_secret_id \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" Vault.approle.create_secret_id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'app-1'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\".data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\":secret_id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#task-4-verification\",\"aria-label\":\"task 4 verification permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"task-4-verification\",\"aria-hidden\":\"\"})),\"Task 4: Verification\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Once Terraform completes the \",mdx(\"inlineCode\",{parentName:\"p\"},\"apply\"),` operation, it will output the public IP\naddress of our new server. You can plug that IP address into a browser to see\nthe output. It should look similar to the following:`),mdx(\"pre\",e({},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"Role ID:\",`\n`,\"f6286b97-246e-9fb4-4d9f-0c9465451851\",`\n`,`\n`,\"Secret ID:\",`\n`,\"72f4b60c-26d0-d947-5026-153943174831\",`\n`,`\n`,\"AppRole Token:\",`\n`,\"d11d81e4-0ba1-fefc-03f8-e5f06793b60d\",`\n`,`\n`,\"Read Our Secrets:\",`\n`,'{:password=>\"$up3r$3cr3t!\", :username=>\"app-1-user\"}',`\n`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#additional-references\",\"aria-label\":\"additional references permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"additional-references\",\"aria-hidden\":\"\"})),\"Additional References\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The following is a curated list of webinars, blogs and GitHub repositories that\nadd additional context to fill out the concepts discussed in the webinar and\ndemonstrated in the code:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.youtube.com/watch?v=skENC9aXgco\"}),\"Managing Secrets in a Container Environment by Jeff Mitchell\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.hashicorp.com/blog/using-hashicorps-vault-with-chef\"}),\"Using HashiCorp's Vault with Chef written by Seth Vargo\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://blog.chef.io/2016/12/12/manage-secrets-with-chef-and-hashicorps-vault/\"}),\"Manage Secrets with Chef and HashiCorps Vault by Seth Vargo & JJ Asghar\"),mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/sethvargo/vault-chef-webinar\"}),\"Associated GitHub repository\")))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"http://blog.alanthatcher.io/vault-approle-authentication/\"}),\"Vault AppRole Authentication written by Alan Thatcher\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"http://blog.alanthatcher.io/integrating-chef-and-hashicorp-vault/\"}),\"Integrating Chef and HashiCorp Vault written by Alan Thatcher\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/hashicorp/vault-ruby\"}),\"Vault Ruby Client\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Watch the video recording of the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.hashicorp.com/resources/delivering-secret-zero-vault-approle-terraform-chef\"}),`Delivering Secret Zero: Vault AppRole with\nTerraform and\nChef`),`\nwebinar which talks about the usage of AppRole with Terraform and Chef as its\ntrusted entities.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}