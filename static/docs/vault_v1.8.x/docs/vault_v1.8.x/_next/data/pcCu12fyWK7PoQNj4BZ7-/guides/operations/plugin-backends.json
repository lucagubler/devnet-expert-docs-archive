{"pageProps":{"currentPath":"operations/plugin-backends","frontMatter":{"layout":"guides","page_title":"Plugin Backends - Guides","description":"Learn how to build, register, and mount a custom plugin backend."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/operations/plugin-backends.mdx","mdxSource":{"compiledSource":"var c=Object.defineProperty;var l=Object.prototype.hasOwnProperty;var t=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable;var m=(e,s,n)=>s in e?c(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,a=(e,s)=>{for(var n in s||(s={}))l.call(s,n)&&m(e,n,s[n]);if(t)for(var n of t(s))o.call(s,n)&&m(e,n,s[n]);return e};var r=(e,s)=>{var n={};for(var p in e)l.call(e,p)&&s.indexOf(p)<0&&(n[p]=e[p]);if(e!=null&&t)for(var p of t(e))s.indexOf(p)<0&&o.call(e,p)&&(n[p]=e[p]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var p=n,{components:e}=p,s=r(p,[\"components\"]);return mdx(MDXLayout,a(a(a({},layoutProps),s),{components:e,mdxType:\"MDXLayout\"}),mdx(\"h1\",a({},{className:\"g-type-display-2\"}),mdx(\"a\",a({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#introduction\",\"aria-label\":\"introduction permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h1\"},{className:\"__target-h\",id:\"introduction\",\"aria-hidden\":\"\"})),\"Introduction\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Plugin backends utilize the \",mdx(\"a\",a({parentName:\"p\"},{href:\"/docs/internals/plugins\"}),\"plugin system\"),` to enable third-party\nsecrets engines and auth methods.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"It is worth noting that even though \",mdx(\"a\",a({parentName:\"p\"},{href:\"/docs/secrets/databases\"}),\"database secrets engines\"),`\noperate under the same underlying plugin mechanism, they are slightly different\nin design than plugin backends demonstrated in this guide. The database secrets\nengine manages multiple plugins under the same backend mount point, whereas\nplugin backends are kv backends that function as either secret or auth methods.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`This guide provides steps to build, register, and mount non-database external\nplugin backends.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#setup-vault\",\"aria-label\":\"setup vault permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"setup-vault\",\"aria-hidden\":\"\"})),\"Setup Vault\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Set \",mdx(\"inlineCode\",{parentName:\"p\"},\"plugin_directory\"),` to the desired path in the Vault configuration file.\nThe path should exist and have proper lockdown on access permissions.`),mdx(\"pre\",a({},{className:\"language-hcl\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-hcl\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# /etc/vault/config.d/plugins.hcl\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),\"plugin_directory\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/etc/vault/vault_plugins\"'),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If the Vault server is already running, you will need to tell it to reload its\nconfiguration by sending SIGHUP. If you stop and start the Vault server, you\nwill need to unseal it again.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#compile-plugin\",\"aria-label\":\"compile plugin permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"compile-plugin\",\"aria-hidden\":\"\"})),\"Compile Plugin\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Build the custom binary, and move it inside the \",mdx(\"inlineCode\",{parentName:\"p\"},\"plugin_directory\"),` path\nconfigured above. This guide uses `,mdx(\"inlineCode\",{parentName:\"p\"},\"mock-plugin\"),` that comes from Vault's\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault/tree/master/logical/plugin/mock/mock-plugin\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"logical/plugin/mock\")),\" package.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Download the source (you would probably use your own plugin):\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"go get -f -u -d github.com/hashicorp/vault\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"#\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"..\"),\".\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"cd\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$GOPATH\"),\"/src/github.com/hashicorp/vault/sdk/plugin/mock/mock-plugin\")),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Compile the plugin:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"go build -o my-mock-plugin\")),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Put the plugin in the directory:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"mv\"),\" my-mock-plugin /etc/vault/vault_plugins\")),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Alternatively, if you wanted a custom version of a plugin built into Vault, such as AppRole:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"cd\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$GOPATH\"),\"/src/github.com/hashicorp/vault/builtin/credential/approle/cmd/approle\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"go build\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"mv\"),\" approle /etc/vault/vault_plugins\")),`\n`)),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#register-in-plugin-catalog\",\"aria-label\":\"register in plugin catalog permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"register-in-plugin-catalog\",\"aria-hidden\":\"\"})),\"Register in Plugin Catalog\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Calculate the SHA256 sum of the compiled plugin binary, and use that to register\nthe plugin into Vault's plugin catalog:`),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"shasum -a \",mdx(\"span\",a({parentName:\"span\"},{className:\"token number\"}),\"256\"),\" /etc/vault/vault_plugins/my-mock-plugin\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"2c071aafa1b30897e60b79643e77592cb9d1e8f803025d44a7f9bbfa4779d615  /etc/vault/vault_plugins/my-mock-plugin\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" sys/plugins/catalog/secret/my-mock-plugin \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"    sha256=2c071aafa1b30897e60b79643e77592cb9d1e8f803025d44a7f9bbfa4779d615 \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"    command=my-mock-plugin\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Success! Data written to: sys/plugins/catalog/secret/my-mock-plugin\"),`\n`)),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#enable-plugin\",\"aria-label\":\"enable plugin permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"enable-plugin\",\"aria-hidden\":\"\"})),\"Enable Plugin\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Enabling the plugin varies depending on if it's a secrets engine or auth method:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault secrets \",mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"enable\"),\" -path\",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"my-secrets-plugin my-mock-plugin\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Success! Enabled the my-mock-plugin plugin at: my-secrets-plugin/\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If you try to mount this particular plugin as an auth method instead of a\nsecrets engine, you will get an error:`),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault auth \",mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"enable\"),\" -path\",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"my-auth-plugin my-mock-plugin\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"#\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"..\"),\".\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"* cannot mount 'my-mock-plugin' of type 'secret' as an auth method\"),`\n`)),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#perform-operations\",\"aria-label\":\"perform operations permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"perform-operations\",\"aria-hidden\":\"\"})),\"Perform Operations\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Each plugin responds to read, write, list, and delete as its own behavior.\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" my-secrets-plugin/kv/foo \",mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"value\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"bar\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Key      Value\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"---      -----\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"value    bar\"),`\n`)),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#disable-plugin\",\"aria-label\":\"disable plugin permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"disable-plugin\",\"aria-hidden\":\"\"})),\"Disable Plugin\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"When you are done using the plugin, disable it.\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault secrets disable my-secrets-plugin\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Success! Disabled the secrets engine (if it existed) at: my-secrets-plugin/\"),`\n`)))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying & Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup & Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities & Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true}