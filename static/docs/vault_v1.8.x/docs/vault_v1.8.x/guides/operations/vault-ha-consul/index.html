<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta property="og:image" content="https://www.vaultproject.io/img/og-image.png"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=16&amp;w=16" type="image/png" sizes="16x16" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=32&amp;w=32" type="image/png" sizes="32x32" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=96&amp;w=96" type="image/png" sizes="96x96" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=192&amp;w=192" type="image/png" sizes="192x192" rel="icon"/><title>Vault HA with Consul - Guides | Vault by HashiCorp</title><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta property="article:publisher" content="https://www.facebook.com/HashiCorp/"/><meta name="twitter:site" content="@HashiCorp"/><meta name="twitter:card" content="summary_large_image"/><meta name="theme-color" content="#000"/><meta name="description" property="og:description" content="This guide will walk you through a simple Vault Highly Available (HA) cluster
implementation. While this is not an exhaustive or prescriptive guide that
can be used as a drop-in production example, it covers the basics enough to
inform your own production setup."/><meta property="og:site_name" content="Vault by HashiCorp"/><meta name="next-head-count" content="17"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/css/7246d51e322c1bb7fa92.css" as="style"/><link rel="stylesheet" href="/docs/vault_v1.8.x/_next/static/css/7246d51e322c1bb7fa92.css" data-n-g=""/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/css/fbe3b6b5804634e8fb99.css" as="style"/><link rel="stylesheet" href="/docs/vault_v1.8.x/_next/static/css/fbe3b6b5804634e8fb99.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/framework.3519294afa6a9ab53973.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/2bc72d9a08d5bd816ae6b580871df9fb671d43bb.52fd5ef7a8ab7d8fc0dd.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/9a5be27b89b50ff891e514a88cd42f143404f9a6.033857d62f5a01edf3b3.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/main-b0f1f3f8bd3bddd4e6cd.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/b49b08e2da573413c730dfc51ae423f080a0c275.00ac32ee45240d5b343f.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/b1542cc239bf56c8a14913c0a930efe682b5cf86.32bb900ad80311488529.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/pages/_app-d714c55ad24af91621ba.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/7dbdcaca29374b13a0799a901e26613767d72de2.d088888a4a1113f2bb24.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/92f0085e0e6c1f10382de10b8861ce89d7c192a2.e5495ede8461fc33ed98.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b.5052eda5c7f43583669b.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b_CSS.f6584926f1188e1b5b3e.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/pages/guides/%5B%5B...page%5D%5D-72f9db6e509b49c776de.js" as="script"/></head><body><div id="__next"><div class="g-alert-banner style_vault__1OYha show themed"><a href="https://hashiconf.com/europe" class="link"><span class="g-grid-container has-large-tag"><span class="tag g-type-body-small-x-strong">Thank you</span><span class="text g-type-body-small has-large-tag">HashiConf Europe is a wrap. Watch this year’s sessions on-demand.<!-- --> <span class="link-text g-type-body-small-x-strong">Watch Now</span></span></span></a><button class="close"><div><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 5L5 15M5 5l10 10" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><span class="visually-hidden">Dismiss alert</span></button></div><header class="hashi-stack-menu_hashiStackMenu__2dCgY"><nav class="hashi-stack-menu_nav__3DnqS g-grid-container" aria-label="Primary HashiCorp website navigation"><a aria-label="To main HashiCorp website" href="https://www.hashicorp.com/" class="hashi-stack-menu_logoLink__2cbDW"><div data-testid="root"><svg width="317" height="88" viewBox="0 0 317 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M107.692 64.421V47.4h-14.97v17.02h-7.623V24.06h7.622v16.602h14.971V24.06h7.622v40.36h-7.622zm35.567-.001h-6.053l-.548-1.996a16.137 16.137 0 01-8.789 2.607c-5.397 0-7.699-3.697-7.699-8.79 0-5.998 2.607-8.3 8.606-8.3h7.089v-3.095c0-3.27-.907-4.421-5.633-4.421a41.255 41.255 0 00-8.179.877l-.907-5.634a38.496 38.496 0 0110.122-1.395c9.269 0 11.998 3.27 11.998 10.672l-.007 19.476zm-7.394-11.151h-5.45c-2.424 0-3.087.663-3.087 2.912 0 2.058.663 2.973 2.972 2.973a11.629 11.629 0 005.572-1.525l-.007-4.36zm21.701 11.754a34.776 34.776 0 01-10.183-1.7l1.029-5.633a33.038 33.038 0 008.788 1.273c3.271 0 3.758-.762 3.758-2.973 0-1.814-.366-2.729-5.152-3.88-7.211-1.76-8.058-3.575-8.058-9.269 0-5.938 2.607-8.545 11.03-8.545 2.98.003 5.949.348 8.85 1.03l-.762 5.876a51.98 51.98 0 00-8.118-.846c-3.209 0-3.758.763-3.758 2.546 0 2.363.183 2.546 4.185 3.575 8.263 2.188 9.055 3.278 9.055 9.307 0 5.725-1.761 9.239-10.664 9.239zm32.663-.602V43.84c0-1.578-.663-2.363-2.363-2.363-1.814 0-5.031 1.09-7.699 2.485v20.459h-7.394V22.847l7.394-1.029v15.33a26.045 26.045 0 0110.786-2.852c4.909 0 6.662 3.453 6.662 8.728v21.397h-7.386zm12.844-33.692v-8.545h7.394v8.545h-7.394zm0 33.692V34.906h7.394v29.515h-7.394zM215.62 35.15c0-7.394 4.299-11.693 14.361-11.693 3.697 0 7.38.447 10.969 1.334l-.839 6.601a59.517 59.517 0 00-9.909-1.029c-5.275 0-6.967 1.822-6.967 6.098v15.512c0 4.3 1.7 6.098 6.967 6.098a59.506 59.506 0 009.909-1.029l.846 6.609a45.672 45.672 0 01-10.968 1.334c-10.062 0-14.361-4.3-14.361-11.693l-.008-18.142zm40.499 29.873c-10.123 0-12.844-5.572-12.844-11.632v-7.455c0-6.06 2.728-11.632 12.844-11.632 10.115 0 12.844 5.572 12.844 11.632v7.455c-.023 6.06-2.744 11.632-12.844 11.632zm0-24.392c-3.941 0-5.45 1.76-5.45 5.092v7.912c0 3.331 1.524 5.092 5.45 5.092 3.925 0 5.45-1.76 5.45-5.092v-7.943c-.015-3.33-1.532-5.092-5.45-5.092v.03zm32.457.457a57.835 57.835 0 00-7.821 4.3v19.056h-7.394V34.906h6.243l.488 3.27a33.064 33.064 0 017.76-3.88l.724 6.792zm28.035 13.515c0 6.548-2.911 10.42-9.756 10.42a40.76 40.76 0 01-7.882-.853v12.196l-7.394 1.029V34.906h5.877l.762 2.485a15.535 15.535 0 019.33-3.087c5.938 0 9.086 3.514 9.086 10.245l-.023 10.054zm-17.631 3.331c2.152.474 4.346.73 6.548.763 2.668 0 3.697-1.274 3.697-3.941V44.35c0-2.424-.907-3.758-3.636-3.758a10.46 10.46 0 00-6.609 2.668v14.673zM29.134 7L0 23.808v40.361l10.946 6.32V30.127l18.188-10.504V7z" fill="#000"/><path d="M40.758 7v32.144H29.133V27.147l-10.945 6.319V74.65l10.946 6.335V48.932h11.624v11.914l10.946-6.312V13.32L40.758 7z" fill="#000"/><path d="M40.758 81L69.89 64.192V23.831l-10.946-6.32v40.362L40.758 68.377V81z" fill="#000"/></svg></div></a><ul class="hashi-stack-menu_menu__33a9r"><li class="nav-item_navItem__KPnS0"><button type="button" class="nav-item_buttonReset__WeJA7 nav-item_link__1827H g-type-body-small-strong ">Browse Products<span class="nav-item_visuallyHidden__20aYI">Open this menu</span><img class="nav-item_dropdownCarat__2xha-" alt="" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iNyIgdmlld0JveD0iMCAwIDEwIDciIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTguMDUzIDJsLTMgMy4wMDYtMy0zLjAwNiIgc3Ryb2tlPSJ2YXIoLS1ncmF5LTMpIiBzdHJva2Utd2lkdGg9IjEuMjUiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiLz48L3N2Zz4="/></button><section class="browse-panel_browsePanel__1AT8q "><menu class="stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Infrastructure</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.terraform.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M55.522 32.97l32.96 19.02v38.06l-32.96-19.03V32.97zM92.09 51.99v38.06l32.95-19.03V32.97L92.09 51.99zM18.96 11.73v38.05l32.95 19.03V30.76L18.96 11.73zm36.562 101.51l32.95 19.03V94.22l-32.95-19.03v38.05z" fill="#7B42BC"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">terraform</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.packer.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M35.09 26.38L74.22 49v83.38l-39.13-22.62V26.38z" fill="#02A8EF"/><path d="M93.6 36.13L51.06 11.62v17L80 45.34v51.05l13.61 7.82c8.421 4.86 15.311 2 15.311-6.47V60.28c-.01-8.42-6.92-19.28-15.32-24.15z" fill="#02A8EF"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">packer</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.vagrantup.com" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M110.77 17.55L86.68 31.46V40L72 74.52 57.32 40v-8.54L33.23 17.55l-14.65 8.47v9.83l32.63 79.92 20.79 12 20.79-12 32.63-79.92v-9.83l-14.65-8.47z" fill="#0E67ED"/><path d="M125.42 26.02l-24.09 13.9v8.55L81.77 92.19 72 97.83v29.94l20.79-12 32.63-79.92v-9.83zM57.32 40v-8.54l-14.66 8.46v8.55l19.57 43.72L72 86.55V74.52L57.32 40z" fill="#0850C5"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vagrant</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Networking</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.consul.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72.53 128.7a54.787 54.787 0 01-45.258-23.85 54.784 54.784 0 019.368-72.355 54.78 54.78 0 0172.95 1.125l-13 13.6a36 36 0 100 53.43l13 13.6a54.638 54.638 0 01-37.06 14.45zm44.081-27.401a4.49 4.49 0 114.49-4.49 4.5 4.5 0 01-4.49 4.49z" fill="#E03875"/><path d="M72.18 85.79A11.87 11.87 0 1184 73.93a11.88 11.88 0 01-11.82 11.86zm49.58.21a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.495 4.495 0 012.772 4.148 4.503 4.503 0 01-4.49 4.49zm-13.35-.56a4.488 4.488 0 01-4.4-5.385 4.487 4.487 0 013.555-3.515 4.49 4.49 0 11.845 8.9zm13.35-14.57a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.496 4.496 0 012.772 4.149 4.503 4.503 0 01-4.49 4.49zm-13.35.51a4.493 4.493 0 01-4.148-2.772 4.491 4.491 0 114.148 2.771zm8.461-15.61a4.49 4.49 0 11-.02-8.981 4.49 4.49 0 01.02 8.981z" fill="#E03875"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">consul</span></a></li></ul></li></menu><menu class="stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Security</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.vaultproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.88 21.15L71.8 131.4l55.321-110.25H16.881zm61.46 22.12h6.39v6.4h-6.39v-6.4zM65.61 68.84h-6.39v-6.39h6.39v6.39zm0-9.59h-6.39v-6.39h6.39v6.39zm0-9.58h-6.39v-6.4h6.39v6.4zm9.59 28.76h-6.4V72h6.4v6.43zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.58h-6.4v-6.4h6.4v6.4zm3.14 3.19h6.39v6.39h-6.39v-6.39zm0 16v-6.41h6.39v6.39l-6.39.02z" fill="#000"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vault</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.boundaryproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M44.83 125.83v-8.27h17.18v-5.11h-8.33v-8.32h39.33L74.74 72.49l18.27-31.65H52.7v43.89H31V19.15h74.67l12.46 21.58L99.8 72.49l18.7 32.4-12.09 20.94H44.83z" fill="#F24C53"/><path d="M48.17 104.131h-8.32v8.32h8.32v-8.32zM39.32 117.5H31v8.32h8.32v-8.32z" fill="#F24C53"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">boundary</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Applications</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.nomadproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72 14L21.77 43v58L72 130l50.23-29V43L72 14zm22.38 63.78L81 85.51l-16.17-8.8v18.48l-15.2 9.64V66.19l12.06-7.38 16.73 8.82V48.76l16-9.59-.04 38.61z" fill="#00CA8E"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">nomad</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.waypointproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M143.228 27.66l-17.79 30.81-17.79-30.81h35.58zM48.26 48.23H36.39l29.67 51.4-11.87 20.56L.77 27.66h59.36l29.68 51.41 5.93-10.28L72 27.66h23.74l11.88 20.57 11.87 20.56-29.68 51.4-41.55-71.96z" fill="#14C6CB"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">waypoint</span></a></li></ul></li></menu><menu class="stack-menu-section_stackMenuSectionPlusDivider__1BPy6 stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">HashiCorp Cloud Platform</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://cloud.hashicorp.com/" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72.53 128.7a54.787 54.787 0 01-45.258-23.85 54.784 54.784 0 019.368-72.355 54.78 54.78 0 0172.95 1.125l-13 13.6a36 36 0 100 53.43l13 13.6a54.638 54.638 0 01-37.06 14.45zm44.081-27.401a4.49 4.49 0 114.49-4.49 4.5 4.5 0 01-4.49 4.49z" fill="#E03875"/><path d="M72.18 85.79A11.87 11.87 0 1184 73.93a11.88 11.88 0 01-11.82 11.86zm49.58.21a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.495 4.495 0 012.772 4.148 4.503 4.503 0 01-4.49 4.49zm-13.35-.56a4.488 4.488 0 01-4.4-5.385 4.487 4.487 0 013.555-3.515 4.49 4.49 0 11.845 8.9zm13.35-14.57a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.496 4.496 0 012.772 4.149 4.503 4.503 0 01-4.49 4.49zm-13.35.51a4.493 4.493 0 01-4.148-2.772 4.491 4.491 0 114.148 2.771zm8.461-15.61a4.49 4.49 0 11-.02-8.981 4.49 4.49 0 01.02 8.981z" fill="#E03875"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">consul</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://app.terraform.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M55.522 32.97l32.96 19.02v38.06l-32.96-19.03V32.97zM92.09 51.99v38.06l32.95-19.03V32.97L92.09 51.99zM18.96 11.73v38.05l32.95 19.03V30.76L18.96 11.73zm36.562 101.51l32.95 19.03V94.22l-32.95-19.03v38.05z" fill="#7B42BC"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">terraform</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://cloud.hashicorp.com/" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.88 21.15L71.8 131.4l55.321-110.25H16.881zm61.46 22.12h6.39v6.4h-6.39v-6.4zM65.61 68.84h-6.39v-6.39h6.39v6.39zm0-9.59h-6.39v-6.39h6.39v6.39zm0-9.58h-6.39v-6.4h6.39v6.4zm9.59 28.76h-6.4V72h6.4v6.43zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.58h-6.4v-6.4h6.4v6.4zm3.14 3.19h6.39v6.39h-6.39v-6.39zm0 16v-6.41h6.39v6.39l-6.39.02z" fill="#000"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vault</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Partner Services</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a class="stack-item_itemLink__G2Qmk" href="https://www.hashicorp.com/products/consul/service-on-azure"><span class="stack-item_itemName__1cUxR g-type-body-small-strong">HashiCorp Consul Service (HCS) on Azure</span></a></li></ul></li></menu></section></li></ul></nav></header><nav class="g-subnav" aria-label="vault website navigation"><div class="constrain-width-wrapper  g-grid-container"><div class="g-subnav-inner style_vault__1OYha is-constrained" data-overflow-target="true"><a href="/" data-testid="a-raw" class="title-link brand-vault " title="vault"><div data-testid="root"><svg width="208" height="88" viewBox="0 0 208 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M114.849 23.69h7.92L110.699 64h-11.25l-12-40.28h7.92l9.74 33.57 9.74-33.6zM144.75 64h-6l-.55-2a16.12 16.12 0 01-8.77 2.6c-5.38 0-7.68-3.69-7.68-8.77 0-6 2.6-8.29 8.59-8.29h7.08v-3.1c0-3.27-.91-4.42-5.63-4.42a40.71 40.71 0 00-8.16.91l-.91-5.63a38.678 38.678 0 0110.1-1.39c9.25 0 12 3.27 12 10.65L144.75 64zm-7.37-11.13h-5.45c-2.42 0-3.08.67-3.08 2.91 0 2 .66 3 3 3a11.72 11.72 0 005.57-1.51l-.04-4.4zm18.992-18.35v20.56c0 1.57.66 2.36 2.36 2.36 1.7 0 5-1.09 7.68-2.48V34.52h7.38V64h-5.63l-.72-2.48a29.437 29.437 0 01-11.8 3.09c-4.9 0-6.65-3.45-6.65-8.71V34.52h7.38zM177.719 64V22.48l7.38-1V64h-7.38zm29.388-.57a20.618 20.618 0 01-6.47 1.15c-5.38 0-8.11-2.54-8.11-7.8v-16.4h-4.41v-5.86h4.41V27.2l7.38-1v8.35h7.56l-.48 5.86h-7.08v15.4a2.323 2.323 0 001.596 2.514c.344.11.708.14 1.064.085a13.919 13.919 0 003.69-.61l.85 5.63zM0 12.6l31.85 63.92L63.92 12.6H0zm35.63 12.83h3.71v3.71h-3.71v-3.71zm-7.38 14.82h-3.7v-3.7h3.7v3.7zm0-5.56h-3.7V31h3.7v3.69zm0-5.55h-3.7v-3.71h3.7v3.71zm5.6 16.67h-3.7V42.1h3.7v3.71zm0-5.56h-3.7v-3.7h3.7v3.7zm0-5.56h-3.7V31h3.7v3.69zm0-5.55h-3.7v-3.71h3.7v3.71zM35.63 31h3.71v3.7h-3.71V31zm0 9.26v-3.7h3.71v3.7h-3.71z" fill="#000"/></svg></div></a><ul class="menu-items-default menu-items-align-right"><li><a href="/" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Overview</span></a></li><li><button class="dropdown-trigger g-type-body-small-strong brand-vault style-menu-item is-collapsed"><span class="text brand-vault">Use Cases</span><div data-testid="root"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9l6 6 6-6" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></button><ul class="submenu-modal style-dropdown is-collapsed"><li><a href="/use-cases/secrets-management" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Secrets Management</span></a></li><li><a href="/use-cases/data-encryption" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Data Encryption</span></a></li><li><a href="/use-cases/identity-based-access" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Identity-based Access</span></a></li></ul></li><li><a href="https://www.hashicorp.com/products/vault/enterprise" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Enterprise</span></a></li><li><span class="vertical-divider"></span></li><li><a href="https://learn.hashicorp.com/vault" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Tutorials</span></a></li><li><a href="/docs" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Docs</span></a></li><li><a href="/api-docs" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">API</span></a></li><li><a href="/community" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Community</span></a></li></ul><div class="cta-links "><a href="https://www.github.com/hashicorp/vault" class="github-button"><span class="github"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg><span class="hidden-text">GitHub</span></span></a><a class="g-btn size-small variant-secondary style_vault__1OYha background-light" data-ga-button="try-cloud" href="https://portal.cloud.hashicorp.com/sign-up?utm_source=vault_io&amp;utm_content=top_nav_vault"><span class="text g-type-buttons-and-standalone-links">Try Cloud</span></a><a class="g-btn size-small variant-primary style_vault__1OYha background-light" data-ga-button="download" href="/downloads"><span class="icon at-left is-animated" data-animation="download"><div data-testid="root"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Download icon</title><path d="M3 17v3a2 2 0 002 2h14a2 2 0 002-2v-3" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path data-animation-target="true" d="M8 12l4 4m0 0l4-4m-4 4V2" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></span><span class="text g-type-buttons-and-standalone-links">Download</span></a></div></div></div></nav><div id="p-docs"><div class="content-wrap g-grid-container"><div id="sidebar" role="complementary"><div class="nav docs-nav"><div class="g-docs-sidenav style_root__-H22M style_vault__1OYha"><button class="style_mobileMenuToggle__2iMJX g-type-body-small-strong"><span><div><svg width="20" height="20" fill="none"><path fill="#000" fill-rule="evenodd" d="M3.083 14.411a.847.847 0 00-.267-.183.863.863 0 00-.483-.042c-.05.008-.109.025-.159.042a1.245 1.245 0 00-.266.183 1.01 1.01 0 00-.184.267.864.864 0 00-.058.325c0 .05 0 .108.017.158a.88.88 0 00.041.159c.025.05.05.1.084.141.025.05.066.092.1.125.041.042.082.075.125.108.05.025.091.059.141.075.05.017.109.034.159.05.058.009.107.017.166.017a.829.829 0 00.584-.25.534.534 0 00.108-.125c.025-.042.058-.091.075-.142.025-.05.042-.1.05-.158a1.06 1.06 0 00.017-.158.872.872 0 00-.067-.325.729.729 0 00-.183-.267zm0-5a.846.846 0 00-.267-.183.863.863 0 00-.483-.042 1.11 1.11 0 00-.159.042 1.252 1.252 0 00-.266.183.821.821 0 00-.242.592c0 .108.017.216.058.316a1.01 1.01 0 00.309.375c.05.025.091.05.141.075.05.017.109.034.159.05.058.009.107.017.166.017a.829.829 0 00.584-.25.83.83 0 00.25-.583.871.871 0 00-.067-.325.729.729 0 00-.183-.267zm0-5a.795.795 0 00-.75-.225 1.11 1.11 0 00-.159.042 1.255 1.255 0 00-.266.183.835.835 0 00-.242.592c0 .108.017.217.058.317a1.01 1.01 0 00.309.375c.05.025.091.05.141.075.05.016.109.033.159.05.058.008.107.016.166.016a.83.83 0 00.584-.25.83.83 0 00.25-.583.906.906 0 00-.067-.325.729.729 0 00-.183-.267zm14.414 9.756H6.663a.833.833 0 100 1.667h10.834a.833.833 0 100-1.667zm0-5H6.663a.833.833 0 100 1.667h10.834a.833.833 0 100-1.667zM18.33 5c0 .46-.372.834-.833.834H6.663a.833.833 0 110-1.667h10.834c.46 0 .833.372.833.833z" clip-rule="evenodd"/></svg></div> Documentation Menu</span></button><button type="button" aria-label="Show Search Bar" class="style_searchToggle__226HK"><div><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8.75 15a6.25 6.25 0 100-12.5 6.25 6.25 0 000 12.5z" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.5 17.5l-4.333-4.333" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></button><ul class="style_rootList__1pfEP" data-is-mobile-hidden="true" data-is-mobile-open="false"><button class="style_mobileClose__3BcsD">×</button><input class="style_filterInput__4ecGq" placeholder="Filter..." value=""/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/getting-started/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Getting Started</span></a></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Vault Operations</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/reference-architecture/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Reference Architecture</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/vault-ha-consul/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault HA with Consul</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/production/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Production Hardening</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/generate-root/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Root Token Generation</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/rekeying-and-rotating/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Rekeying & Rotating</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/plugin-backends/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Building Plugin Backends</span></a></li><hr class="style_divider__3H9xA"/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/replication/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Replication Setup & Guidance</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/disaster-recovery/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Disaster Recovery Setup</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/mount-filter/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Mount Filter</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/multi-tenant/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Multi-Tenant: Namespaces</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/autounseal-aws-kms/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Auto-unseal with AWS KMS</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/seal-wrap/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Seal Wrap / FIPS 140-2</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/monitoring/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Cluster Monitoring</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/deployment-guide/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Deployment Guide</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/performance-nodes/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Performance Standby Nodes</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Identity and Access Management</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/secure-intro/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Secure Introduction of Vault Clients</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/policies/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Policies</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/policy-templating/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>ACL Policy Path Templating</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/authentication/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>AppRole Pull Authentication</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/approle-trusted-entities/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>AppRole with Terraform and Chef</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/lease/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Tokens and Leases</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/identity/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Identity - Entities & Groups</span></a></li><hr class="style_divider__3H9xA"/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/sentinel/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Sentinel Policies</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/control-groups/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Control Groups</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Secrets Management</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/static-secrets/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Static Secrets</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/versioned-kv/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Versioned KV Secret Engine</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/dynamic-secrets/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Secret as a Service</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/db-root-rotation/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>DB Root Credential Rotation</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/cubbyhole/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Cubbyhole Response Wrapping</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/ssh-otp/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>One-Time SSH Password</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/pki-engine/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Build Your Own CA</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/app-integration/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Direct Application Integration</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Encryption as a Service</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/transit/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Encryption as a Service</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/spring-demo/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Java Application Demo</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/transit-rewrap/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Transit Secrets Re-wrapping</span></a></li></ul></li></ul></div></div></div><div id="inner" role="main" class=""><article class="g-content g-type-long-body style_vault__1OYha"><div class="g-search"><label id="search-box-label" for="search-box" class="visually-hidden">Search Vault documentation</label><div class="c-search-box"><form novalidate="" action="" role="search"><input type="search" id="search-box" class="g-type-body-strong" placeholder="Search Vault documentation" autoComplete="off" autoCorrect="off" autoCapitalize="off" spellcheck="false" maxLength="512" required="" value="" aria-autocomplete="list" aria-controls="search-results" aria-activedescendant="" data-heap-track="SearchBox"/><button type="submit" title="Submit your search query." class="btn-submit"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8.75 15a6.25 6.25 0 100-12.5 6.25 6.25 0 000 12.5z" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.5 17.5l-4.333-4.333" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button><button type="reset" title="Clear the search query." class="btn-reset"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.915 1.077h13.684v13.684H1.915z"/><path d="M1.915 1.077l13.683 13.684M1.915 14.76L15.598 1.078" stroke="var(--gray-3)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><div class="icon-loading"><svg width="18" height="18" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#444"><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".5" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18" transform="rotate(296.263 18 18)"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform></path></g></g></svg></div><svg class="icon-slash" width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img"><title>Type &#x27;/&#x27; to Search</title><rect x=".5" y=".5" width="23" height="23" rx=".5" stroke="var(--gray-3)"></rect><path d="M9 18l6-12" stroke="var(--gray-3)" stroke-width="1.5"></path></svg></form></div></div><h1 class="g-type-display-2"><a class="__permalink-h" href="#vault-high-availability-ha" aria-label="vault high availability ha permalink">»</a><a class="__target-h" id="vault-high-availability-ha" aria-hidden=""></a>Vault High Availability (HA)</h1><p class="g-type-long-body">Vault can run in a high availability (HA) mode to protect against outages by
running multiple Vault servers. Vault is typically bound by the IO limits of the
storage backend rather than the compute requirements. Certain storage backends,
such as Consul, provide additional coordination functions that enable Vault to
run in an HA configuration while others provide a more robust backup and
restoration process.</p><p class="g-type-long-body">When running in HA mode, Vault servers have two additional states: <strong><em>standby</em></strong>
and <strong><em>active</em></strong>. Within a Vault cluster, only a single instance will be
<em>active</em> and handles all requests (reads and writes) and all <em>standby</em> nodes
redirect requests to the <em>active</em> node.</p><p class="g-type-long-body"><img src="/img/vault-ha-consul-3.png" alt="Reference Architecture"/></p><blockquote><p class="g-type-long-body"><strong>NOTE:</strong> As of version <strong>0.11</strong>, those standby nodes can handle most
read-only requests and behave as read-replica nodes. This <strong>Performance Standby
Nodes</strong> feature is included in <em>Vault Enterprise Premium</em>, and also available
for <em>Vault Enterprise Pro</em> with additional fee. This is particularly useful for
processing high volume Encryption as a Service (<a href="/docs/secrets/transit">Transit secrets
engine</a>) requests. Read <a href="/docs/enterprise/performance-standby">Performance Standby
Nodes</a> documentation and a <a href="/guides/operations/performance-nodes">guide</a> for more details.</p></blockquote><div class="alert alert-warning g-type-body" role="alert"><p class="g-type-long-body">This guide will walk you through a simple Vault Highly Available (HA) cluster
implementation. While this is not an exhaustive or prescriptive guide that can
be used as a drop-in production example, it covers the <strong>basics</strong> enough to
inform your own production setup.</p></div><h2 class="g-type-display-3"><a class="__permalink-h" href="#reference-materials" aria-label="reference materials permalink">»</a><a class="__target-h" id="reference-materials" aria-hidden=""></a>Reference Materials</h2><ul><li class="g-type-long-body"><a href="/docs/concepts/ha">High Availability Mode</a></li><li class="g-type-long-body"><a href="/docs/configuration/storage/consul">Consul Storage Backend</a></li><li class="g-type-long-body"><a href="/docs/configuration#high-availability-parameters">High Availability Parameters</a></li><li class="g-type-long-body"><a href="https://www.consul.io/docs/agent/options.html">Consul Agent Configuration</a></li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#estimated-time-to-complete" aria-label="estimated time to complete permalink">»</a><a class="__target-h" id="estimated-time-to-complete" aria-hidden=""></a>Estimated Time to Complete</h2><p class="g-type-long-body">25 minutes</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#prerequisites" aria-label="prerequisites permalink">»</a><a class="__target-h" id="prerequisites" aria-hidden=""></a>Prerequisites</h2><p class="g-type-long-body">This intermediate Vault operations guide assumes that you have some working
knowledge of Vault and Consul.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#steps" aria-label="steps permalink">»</a><a class="__target-h" id="steps" aria-hidden=""></a>Steps</h2><p class="g-type-long-body">Our goal in following this guide is to arrive at a Vault HA setup
consisting of the following:</p><ul><li class="g-type-long-body">2 Vault servers: 1 active and 1 standby</li><li class="g-type-long-body">Cluster of 3 Consul servers</li></ul><h3 class="g-type-display-4"><a class="__permalink-h" href="#reference-diagram" aria-label="reference diagram permalink">»</a><a class="__target-h" id="reference-diagram" aria-hidden=""></a>Reference Diagram</h3><p class="g-type-long-body">This diagram lays out the simple architecture details for reference:</p><p class="g-type-long-body"><img src="/img/vault-ha-consul.png" alt="Reference Architecture"/></p><p class="g-type-long-body">You perform the following:</p><ul><li class="g-type-long-body"><a href="#step1">Step 1: Setup a Consul Server Cluster</a></li><li class="g-type-long-body"><a href="#step2">Step 2: Start and Verify the Consul Cluster State</a></li><li class="g-type-long-body"><a href="#step3">Step 3: Setup Consul Client Agents on Vault Nodes</a></li><li class="g-type-long-body"><a href="#step4">Step 4: Configure the Vault Servers</a></li><li class="g-type-long-body"><a href="#step5">Step 5: Start Vault and Verify the State</a></li></ul><div class="alert alert-info g-type-body" role="alert"><p class="g-type-long-body">For the purpose of this guide, we will use the open source software editions of
Vault and Consul; however, the setup is the same for Enterprise editions.</p></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step1" aria-label="step 1 setup a consul server cluster permalink">»</a><a class="__target-h __compat" id="step1" aria-hidden=""></a><a class="__target-h" id="step-1-setup-a-consul-server-cluster" aria-hidden=""></a>Step 1: Setup a Consul Server Cluster</h3><p class="g-type-long-body">Our Consul servers in this guide will be defined by IP address only, but also
referenced by a label:</p><ul><li class="g-type-long-body"><strong><code>consul_s1: 10.1.42.101</code></strong></li><li class="g-type-long-body"><strong><code>consul_s2: 10.1.42.102</code></strong></li><li class="g-type-long-body"><strong><code>consul_s3: 10.1.42.103</code></strong></li></ul><p class="g-type-long-body">The <a href="https://www.consul.io/downloads.html">Consul binary</a> is presumed to be
located in <strong><code>/usr/local/bin/consul</code></strong>, but if your case differs, you can adjust the
path references accordingly.</p><p class="g-type-long-body">With that in mind, here is a basic Consul server configuration starting point:</p><div class="g-code-block style_root__3eDLf language-plaintext style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">{<!-- -->
<!-- -->  &quot;server&quot;: true,<!-- -->
<!-- -->  &quot;node_name&quot;: &quot;$NODE_NAME&quot;,<!-- -->
<!-- -->  &quot;datacenter&quot;: &quot;dc1&quot;,<!-- -->
<!-- -->  &quot;data_dir&quot;: &quot;$CONSUL_DATA_PATH&quot;,<!-- -->
<!-- -->  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;advertise_addr&quot;: &quot;$ADVERTISE_ADDR&quot;,<!-- -->
<!-- -->  &quot;bootstrap_expect&quot;: 3,<!-- -->
<!-- -->  &quot;retry_join&quot;: [&quot;$JOIN1&quot;, &quot;$JOIN2&quot;, &quot;$JOIN3&quot;],<!-- -->
<!-- -->  &quot;ui&quot;: true,<!-- -->
<!-- -->  &quot;log_level&quot;: &quot;DEBUG&quot;,<!-- -->
<!-- -->  &quot;enable_syslog&quot;: true,<!-- -->
<!-- -->  &quot;acl_enforce_version_8&quot;: false<!-- -->
<!-- -->}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-plaintext"><code class="style_code__2AMYw language-plaintext"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;server&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;node_name&quot;: &quot;$NODE_NAME&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;data_dir&quot;: &quot;$CONSUL_DATA_PATH&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;advertise_addr&quot;: &quot;$ADVERTISE_ADDR&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bootstrap_expect&quot;: 3,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;retry_join&quot;: [&quot;$JOIN1&quot;, &quot;$JOIN2&quot;, &quot;$JOIN3&quot;],</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;ui&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;log_level&quot;: &quot;DEBUG&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;enable_syslog&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;acl_enforce_version_8&quot;: false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Note that some values contain variable placeholders while the rest have
reasonable defaults. You should replace the following values in your own Consul
server configuration based on the example:</p><ul><li class="g-type-long-body"><strong>\$NODE_NAME</strong> this is a unique label for the node; in our case, this will be
<code>consul_s1</code>, <code>consul_s2</code>, and <code>consul_s3</code> respectively.</li><li class="g-type-long-body"><strong>\$CONSUL_DATA_PATH</strong>: absolute path to Consul data directory; ensure that
this directory is writable by the Consul process user.</li><li class="g-type-long-body"><strong>\$ADVERTISE_ADDR</strong>: set to address that you prefer the Consul
servers advertise to the other servers in the cluster and should not be set to
<code>0.0.0.0</code>; for this guide, it should be set to the Consul server’s IP address in
each instance of the configuration file, or <code>10.1.42.101</code>,<code>10.1.42.102</code>, and
<code>10.1.42.103</code> respectively.</li><li class="g-type-long-body"><strong>\$JOIN1</strong>, <strong>\$JOIN2</strong>, <strong>\$JOIN3</strong>: This example uses the <code>retry_join</code>
method of joining the server agents to form a cluster; as such, the values for
this guide would be <code>10.1.42.101</code>, <code>10.1.42.102</code>, and <code>10.1.42.103</code> respectively.</li></ul><p class="g-type-long-body">Note that the web user interface is enabled (<code>&quot;ui&quot;: true</code>), and Consul will be
logging at DEBUG level to the system log (<code>&quot;log_level&quot;: &quot;DEBUG&quot;</code>). For the
purpose of this guide, the <strong><code>acl_enforce_version_8</code></strong> is set to <code>false</code> so that
we do not need to be concerned with ACLs in this guide. However, you would want
to enable ACLs in a production environment and follow the <a href="https://www.consul.io/docs/guides/acl.html#acl-agent-master-token">Consul ACL Guide</a> for
details.</p><p class="g-type-long-body">Create a configuration file for each Vault server and save it as
<strong><code>/usr/local/etc/consul/client_agent.json</code></strong>.</p><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul_s1-json-example" aria-label="consul_s1 json example permalink">»</a><a class="__target-h" id="consul_s1-json-example" aria-hidden=""></a><code>consul_s1.json</code> Example</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">{<!-- -->
<!-- -->  &quot;server&quot;: true,<!-- -->
<!-- -->  &quot;node_name&quot;: &quot;consul_s1&quot;,<!-- -->
<!-- -->  &quot;datacenter&quot;: &quot;dc1&quot;,<!-- -->
<!-- -->  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,<!-- -->
<!-- -->  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;advertise_addr&quot;: &quot;10.1.42.101&quot;,<!-- -->
<!-- -->  &quot;bootstrap_expect&quot;: 3,<!-- -->
<!-- -->  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],<!-- -->
<!-- -->  &quot;ui&quot;: true,<!-- -->
<!-- -->  &quot;log_level&quot;: &quot;DEBUG&quot;,<!-- -->
<!-- -->  &quot;enable_syslog&quot;: true,<!-- -->
<!-- -->  &quot;acl_enforce_version_8&quot;: false<!-- -->
<!-- -->}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;server&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;node_name&quot;: &quot;consul_s1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;advertise_addr&quot;: &quot;10.1.42.101&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bootstrap_expect&quot;: 3,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;ui&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;log_level&quot;: &quot;DEBUG&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;enable_syslog&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;acl_enforce_version_8&quot;: false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul_s2-json-example" aria-label="consul_s2 json example permalink">»</a><a class="__target-h" id="consul_s2-json-example" aria-hidden=""></a><code>consul_s2.json</code> Example</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">{<!-- -->
<!-- -->  &quot;server&quot;: true,<!-- -->
<!-- -->  &quot;node_name&quot;: &quot;consul_s2&quot;,<!-- -->
<!-- -->  &quot;datacenter&quot;: &quot;dc1&quot;,<!-- -->
<!-- -->  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,<!-- -->
<!-- -->  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;advertise_addr&quot;: &quot;10.1.42.102&quot;,<!-- -->
<!-- -->  &quot;bootstrap_expect&quot;: 3,<!-- -->
<!-- -->  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],<!-- -->
<!-- -->  &quot;ui&quot;: true,<!-- -->
<!-- -->  &quot;log_level&quot;: &quot;DEBUG&quot;,<!-- -->
<!-- -->  &quot;enable_syslog&quot;: true,<!-- -->
<!-- -->  &quot;acl_enforce_version_8&quot;: false<!-- -->
<!-- -->}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;server&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;node_name&quot;: &quot;consul_s2&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;advertise_addr&quot;: &quot;10.1.42.102&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bootstrap_expect&quot;: 3,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;ui&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;log_level&quot;: &quot;DEBUG&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;enable_syslog&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;acl_enforce_version_8&quot;: false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul_s3-json-example" aria-label="consul_s3 json example permalink">»</a><a class="__target-h" id="consul_s3-json-example" aria-hidden=""></a><code>consul_s3.json</code> Example</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">{<!-- -->
<!-- -->  &quot;server&quot;: true,<!-- -->
<!-- -->  &quot;node_name&quot;: &quot;consul_s3&quot;,<!-- -->
<!-- -->  &quot;datacenter&quot;: &quot;dc1&quot;,<!-- -->
<!-- -->  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,<!-- -->
<!-- -->  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,<!-- -->
<!-- -->  &quot;advertise_addr&quot;: &quot;10.1.42.103&quot;,<!-- -->
<!-- -->  &quot;bootstrap_expect&quot;: 3,<!-- -->
<!-- -->  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],<!-- -->
<!-- -->  &quot;ui&quot;: true,<!-- -->
<!-- -->  &quot;log_level&quot;: &quot;DEBUG&quot;,<!-- -->
<!-- -->  &quot;enable_syslog&quot;: true,<!-- -->
<!-- -->  &quot;acl_enforce_version_8&quot;: false<!-- -->
<!-- -->}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;server&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;node_name&quot;: &quot;consul_s3&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bind_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;advertise_addr&quot;: &quot;10.1.42.103&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bootstrap_expect&quot;: 3,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;ui&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;log_level&quot;: &quot;DEBUG&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;enable_syslog&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;acl_enforce_version_8&quot;: false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul-server-systemd-unit-file" aria-label="consul server systemd unit file permalink">»</a><a class="__target-h" id="consul-server-systemd-unit-file" aria-hidden=""></a>Consul Server <code>systemd</code> Unit file</h4><p class="g-type-long-body">You have Consul binaries and a reasonably basic configuration and now you just
need to start Consul on each server instance; <code>systemd</code> is popular in most
contemporary Linux distributions, so with that in mind, here is an example
<code>systemd</code> unit file:</p><div class="g-code-block style_root__3eDLf language-plaintext style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">### BEGIN INIT INFO<!-- -->
<!-- --># Provides:          consul<!-- -->
<!-- --># Required-Start:    $local_fs $remote_fs<!-- -->
<!-- --># Required-Stop:     $local_fs $remote_fs<!-- -->
<!-- --># Default-Start:     2 3 4 5<!-- -->
<!-- --># Default-Stop:      0 1 6<!-- -->
<!-- --># Short-Description: Consul agent<!-- -->
<!-- --># Description:       Consul service discovery framework<!-- -->
<!-- -->### END INIT INFO<!-- -->
<!-- -->
<!-- -->[Unit]<!-- -->
<!-- -->Description=Consul server agent<!-- -->
<!-- -->Requires=network-online.target<!-- -->
<!-- -->After=network-online.target<!-- -->
<!-- -->
<!-- -->[Service]<!-- -->
<!-- -->User=consul<!-- -->
<!-- -->Group=consul<!-- -->
<!-- -->PIDFile=/var/run/consul/consul.pid<!-- -->
<!-- -->PermissionsStartOnly=true<!-- -->
<!-- -->ExecStartPre=-/bin/mkdir -p /var/run/consul<!-- -->
<!-- -->ExecStartPre=/bin/chown -R consul:consul /var/run/consul<!-- -->
<!-- -->ExecStart=/usr/local/bin/consul agent \<!-- -->
<!-- -->    -config-file=/usr/local/etc/consul/client_agent.json \<!-- -->
<!-- -->    -pid-file=/var/run/consul/consul.pid<!-- -->
<!-- -->ExecReload=/bin/kill -HUP $MAINPID<!-- -->
<!-- -->KillMode=process<!-- -->
<!-- -->KillSignal=SIGTERM<!-- -->
<!-- -->Restart=on-failure<!-- -->
<!-- -->RestartSec=42s<!-- -->
<!-- -->
<!-- -->[Install]<!-- -->
<!-- -->WantedBy=multi-user.target<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-plaintext"><code class="style_code__2AMYw language-plaintext"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">### BEGIN INIT INFO</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Provides:          consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Required-Start:    $local_fs $remote_fs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Required-Stop:     $local_fs $remote_fs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Default-Start:     2 3 4 5</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Default-Stop:      0 1 6</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Short-Description: Consul agent</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Description:       Consul service discovery framework</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">### END INIT INFO</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Unit]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Description=Consul server agent</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Requires=network-online.target</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">After=network-online.target</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Service]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">User=consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Group=consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">PIDFile=/var/run/consul/consul.pid</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">PermissionsStartOnly=true</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecStartPre=-/bin/mkdir -p /var/run/consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecStartPre=/bin/chown -R consul:consul /var/run/consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecStart=/usr/local/bin/consul agent \</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    -config-file=/usr/local/etc/consul/client_agent.json \</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    -pid-file=/var/run/consul/consul.pid</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecReload=/bin/kill -HUP $MAINPID</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">KillMode=process</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">KillSignal=SIGTERM</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Restart=on-failure</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">RestartSec=42s</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Install]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">WantedBy=multi-user.target</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Note that you might be interested in changing the values of the following
depending on style, file system hierarchy standard adherence level, and so on:</p><ul><li class="g-type-long-body"><strong><code>-config-file</code></strong></li><li class="g-type-long-body"><strong><code>-pid-file</code></strong></li></ul><p class="g-type-long-body">Once the unit file is defined and saved (e.g.
<code>/etc/systemd/system/consul.service</code>), be sure to perform a <code>systemctl daemon-reload</code>
and then you can start your Consul service on each server.</p><h3 class="g-type-display-4"><a class="__permalink-h" href="#step2" aria-label="step 2 start and verify the consul cluster state permalink">»</a><a class="__target-h __compat" id="step2" aria-hidden=""></a><a class="__target-h" id="step-2-start-and-verify-the-consul-cluster-state" aria-hidden=""></a>Step 2: Start and Verify the Consul Cluster State</h3><p class="g-type-long-body">Be sure that the ownership and permissions are correct on the directory you
specified for the value of <code>data_dir</code>, and then start the Consul service on each
system and verify the status:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">$ sudo systemctl start consul<!-- -->
<!-- -->$ sudo systemctl status consul<!-- -->
<!-- -->● consul.service - Consul server agent<!-- -->
<!-- -->   Loaded: loaded (/etc/systemd/system/consul.service; enabled; vendor preset: enabled)<!-- -->
<!-- -->   Active: active (running) since Mon 2018-03-19 17:33:14 UTC; 24h ago<!-- -->
<!-- --> Main PID: 2068 (consul)<!-- -->
<!-- -->    Tasks: 13<!-- -->
<!-- -->   Memory: 13.6M<!-- -->
<!-- -->      CPU: 0m 52.784s<!-- -->
<!-- -->   CGroup: /system.slice/consul.service<!-- -->
<!-- -->           └─2068 /usr/local/bin/consul agent -config-file=/usr/local/etc/consul/client_agent.json -pid-file=/var/run/consul/consul.pid<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ sudo systemctl start consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ sudo systemctl status consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">● consul.service - Consul server agent</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Loaded: loaded (/etc/systemd/system/consul.service; enabled; vendor preset: enabled)</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Active: active (running) since Mon 2018-03-19 17:33:14 UTC; 24h ago</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"> Main PID: 2068 (consul)</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    Tasks: 13</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Memory: 13.6M</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      CPU: 0m 52.784s</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   CGroup: /system.slice/consul.service</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">           └─2068 /usr/local/bin/consul agent -config-file=/usr/local/etc/consul/client_agent.json -pid-file=/var/run/consul/consul.pid</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">After starting all Consul server agents, let’s check the Consul cluster status:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">$consul members<!-- -->
<!-- -->Node       Address           Status  Type    Build  Protocol  DC    Segment<!-- -->
<!-- -->consul_s1  10.1.42.101:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;<!-- -->
<!-- -->consul_s2  10.1.42.102:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;<!-- -->
<!-- -->consul_s3  10.1.42.103:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$consul members</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Node       Address           Status  Type    Build  Protocol  DC    Segment</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s1  10.1.42.101:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s2  10.1.42.102:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s3  10.1.42.103:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The cluster looks good and all 3 servers are shown; let’s make sure we have a
leader before proceeding:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">$consul operator raft list-peers<!-- -->
<!-- -->Node                   ID                                    Address           State     Voter  RaftProtocol<!-- -->
<!-- -->consul_s2              536b721f-645d-544a-c10d-85c2ca24e4e4  10.1.42.102:8300  follower  true   3<!-- -->
<!-- -->consul_s1              e10ba554-a4f9-6a8c-f662-81c8bb2a04f5  10.1.42.101:8300  follower  true   3<!-- -->
<!-- -->consul_s3              56370ec8-da25-e7dc-dfc6-bf5f27978a7a  10.1.42.103:8300  leader    true   3<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$consul operator raft list-peers</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Node                   ID                                    Address           State     Voter  RaftProtocol</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s2              536b721f-645d-544a-c10d-85c2ca24e4e4  10.1.42.102:8300  follower  true   3</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s1              e10ba554-a4f9-6a8c-f662-81c8bb2a04f5  10.1.42.101:8300  follower  true   3</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s3              56370ec8-da25-e7dc-dfc6-bf5f27978a7a  10.1.42.103:8300  leader    true   3</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The above output shows that <strong><code>consul_s3</code></strong> is the current cluster leader in
this example. Now, you are good to move on to the Vault server configuration.</p><h3 class="g-type-display-4"><a class="__permalink-h" href="#step3" aria-label="step 3 setup consul client agents on vault nodes permalink">»</a><a class="__target-h __compat" id="step3" aria-hidden=""></a><a class="__target-h" id="step-3-setup-consul-client-agents-on-vault-nodes" aria-hidden=""></a>Step 3: Setup Consul Client Agents on Vault Nodes</h3><p class="g-type-long-body">The Vault server nodes require <strong>both</strong> the Consul and Vault binaries on each node. Consul will be configured as a <strong>client</strong> agent and Vault will be configured as a server.</p><p class="g-type-long-body"><img src="/img/vault-ha-consul-2.png" alt="Reference Architecture"/></p><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul-client-agent-configuration" aria-label="consul client agent configuration permalink">»</a><a class="__target-h" id="consul-client-agent-configuration" aria-hidden=""></a>Consul Client Agent Configuration</h4><p class="g-type-long-body">Since Consul is used to provide a highly available storage backend, you need to
configure local Consul client agents on the Vault servers which will communicate
with the Consul server cluster for registering health checks, service discovery, and cluster HA failover coordination (cluster leadership).</p><div class="alert alert-warning g-type-body" role="alert"><p class="g-type-long-body">Note that <a href="/docs/configuration/storage/consul#address">it is not recommended to connect the Vault servers directly to the
Consul servers</a>.</p></div><p class="g-type-long-body">The Consul client agents will be using the same address as the Vault servers for
network communication to the Consul server cluster, but they will be binding the
<strong><code>client_address</code></strong> only to the loopback interface such that Vault can connect to
it over the loopback interface.</p><p class="g-type-long-body">Here is the example configuration for the Consul client agent:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">{<!-- -->
<!-- -->  &quot;server&quot;: false,<!-- -->
<!-- -->  &quot;datacenter&quot;: &quot;dc1&quot;,<!-- -->
<!-- -->  &quot;node_name&quot;: &quot;$NODE_NAME&quot;,<!-- -->
<!-- -->  &quot;data_dir&quot;: &quot;$CONSUL_DATA_PATH&quot;,<!-- -->
<!-- -->  &quot;bind_addr&quot;: &quot;$BIND_ADDR&quot;,<!-- -->
<!-- -->  &quot;client_addr&quot;: &quot;127.0.0.1&quot;,<!-- -->
<!-- -->  &quot;retry_join&quot;: [&quot;$JOIN1&quot;, &quot;$JOIN2&quot;, &quot;$JOIN3&quot;],<!-- -->
<!-- -->  &quot;log_level&quot;: &quot;DEBUG&quot;,<!-- -->
<!-- -->  &quot;enable_syslog&quot;: true,<!-- -->
<!-- -->  &quot;acl_enforce_version_8&quot;: false<!-- -->
<!-- -->}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;server&quot;: false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;node_name&quot;: &quot;$NODE_NAME&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;data_dir&quot;: &quot;$CONSUL_DATA_PATH&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bind_addr&quot;: &quot;$BIND_ADDR&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;client_addr&quot;: &quot;127.0.0.1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;retry_join&quot;: [&quot;$JOIN1&quot;, &quot;$JOIN2&quot;, &quot;$JOIN3&quot;],</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;log_level&quot;: &quot;DEBUG&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;enable_syslog&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;acl_enforce_version_8&quot;: false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Similar to what you have done in <a href="#step1">Step 1</a>, replace the following values
in your own Consul client agent configuration accordingly:</p><ul><li class="g-type-long-body"><strong>\$NODE_NAME</strong> this is a unique label for the node; in
our case, this will be <code>consul_c1</code> and <code>consul_c2</code> respectively.</li><li class="g-type-long-body"><strong>\$CONSUL_DATA_PATH</strong>: absolute path to Consul data directory; ensure that this
directory is writable by the Consul process user.</li><li class="g-type-long-body"><strong>\$BIND_ADDR</strong>: this should be set
to address that you prefer the Consul servers advertise to the other servers in
the cluster and should not be set to <code>0.0.0.0</code>; for this guide, it should be set
to the Vault server’s IP address in each instance of the configuration file, or
<code>10.1.42.201</code> and <code>10.1.42.202</code> respectively.</li><li class="g-type-long-body"><strong>\$JOIN1</strong>, <strong>\$JOIN2</strong>, <strong>\$JOIN3</strong>: This example uses the <code>retry_join</code> method of
joining the server agents to form a cluster; as such, the values for this guide
would be <code>10.1.42.101</code>, <code>10.1.42.102</code>, and <code>10.1.42.103</code> respectively.</li></ul><p class="g-type-long-body">Create a configuration file for each Vault server and save it as
<strong><code>/usr/local/etc/consul/client_agent.json</code></strong>.</p><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul_c1-json-example" aria-label="consul_c1 json example permalink">»</a><a class="__target-h" id="consul_c1-json-example" aria-hidden=""></a><code>consul_c1.json</code> Example</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">{<!-- -->
<!-- -->  &quot;server&quot;: false,<!-- -->
<!-- -->  &quot;datacenter&quot;: &quot;dc1&quot;,<!-- -->
<!-- -->  &quot;node_name&quot;: &quot;consul_c1&quot;,<!-- -->
<!-- -->  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,<!-- -->
<!-- -->  &quot;bind_addr&quot;: &quot;10.1.42.201&quot;,<!-- -->
<!-- -->  &quot;client_addr&quot;: &quot;127.0.0.1&quot;,<!-- -->
<!-- -->  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],<!-- -->
<!-- -->  &quot;log_level&quot;: &quot;DEBUG&quot;,<!-- -->
<!-- -->  &quot;enable_syslog&quot;: true,<!-- -->
<!-- -->  &quot;acl_enforce_version_8&quot;: false<!-- -->
<!-- -->}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;server&quot;: false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;node_name&quot;: &quot;consul_c1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bind_addr&quot;: &quot;10.1.42.201&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;client_addr&quot;: &quot;127.0.0.1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;log_level&quot;: &quot;DEBUG&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;enable_syslog&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;acl_enforce_version_8&quot;: false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul_c2-json-example" aria-label="consul_c2 json example permalink">»</a><a class="__target-h" id="consul_c2-json-example" aria-hidden=""></a><code>consul_c2.json</code> Example</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">{<!-- -->
<!-- -->  &quot;server&quot;: false,<!-- -->
<!-- -->  &quot;datacenter&quot;: &quot;dc1&quot;,<!-- -->
<!-- -->  &quot;node_name&quot;: &quot;consul_c2&quot;,<!-- -->
<!-- -->  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,<!-- -->
<!-- -->  &quot;bind_addr&quot;: &quot;10.1.42.202&quot;,<!-- -->
<!-- -->  &quot;client_addr&quot;: &quot;127.0.0.1&quot;,<!-- -->
<!-- -->  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],<!-- -->
<!-- -->  &quot;log_level&quot;: &quot;DEBUG&quot;,<!-- -->
<!-- -->  &quot;enable_syslog&quot;: true,<!-- -->
<!-- -->  &quot;acl_enforce_version_8&quot;: false<!-- -->
<!-- -->}<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">{</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;server&quot;: false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;node_name&quot;: &quot;consul_c2&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;data_dir&quot;: &quot;/var/consul/data&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;bind_addr&quot;: &quot;10.1.42.202&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;client_addr&quot;: &quot;127.0.0.1&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;retry_join&quot;: [&quot;10.1.42.101&quot;, &quot;10.1.42.102&quot;, &quot;10.1.42.103&quot;],</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;log_level&quot;: &quot;DEBUG&quot;,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;enable_syslog&quot;: true,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  &quot;acl_enforce_version_8&quot;: false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#consul-server-systemd-unit-file-1" aria-label="consul server systemd unit file permalink">»</a><a class="__target-h" id="consul-server-systemd-unit-file-1" aria-hidden=""></a>Consul Server <code>systemd</code> Unit file</h4><p class="g-type-long-body">You have Consul binaries and a reasonably basic client agent configuration and
now you just need to start Consul on each of the Vault server instances. Here
is an example <code>systemd</code> unit file:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">### BEGIN INIT INFO<!-- -->
<!-- --># Provides:          consul<!-- -->
<!-- --># Required-Start:    $local_fs $remote_fs<!-- -->
<!-- --># Required-Stop:     $local_fs $remote_fs<!-- -->
<!-- --># Default-Start:     2 3 4 5<!-- -->
<!-- --># Default-Stop:      0 1 6<!-- -->
<!-- --># Short-Description: Consul agent<!-- -->
<!-- --># Description:       Consul service discovery framework<!-- -->
<!-- -->### END INIT INFO<!-- -->
<!-- -->
<!-- -->[Unit]<!-- -->
<!-- -->Description=Consul client agent<!-- -->
<!-- -->Requires=network-online.target<!-- -->
<!-- -->After=network-online.target<!-- -->
<!-- -->
<!-- -->[Service]<!-- -->
<!-- -->User=consul<!-- -->
<!-- -->Group=consul<!-- -->
<!-- -->PIDFile=/var/run/consul/consul.pid<!-- -->
<!-- -->PermissionsStartOnly=true<!-- -->
<!-- -->ExecStartPre=-/bin/mkdir -p /var/run/consul<!-- -->
<!-- -->ExecStartPre=/bin/chown -R consul:consul /var/run/consul<!-- -->
<!-- -->ExecStart=/usr/local/bin/consul agent \<!-- -->
<!-- -->    -config-file=/usr/local/etc/consul/client_agent.json \<!-- -->
<!-- -->    -pid-file=/var/run/consul/consul.pid<!-- -->
<!-- -->ExecReload=/bin/kill -HUP $MAINPID<!-- -->
<!-- -->KillMode=process<!-- -->
<!-- -->KillSignal=SIGTERM<!-- -->
<!-- -->Restart=on-failure<!-- -->
<!-- -->RestartSec=42s<!-- -->
<!-- -->
<!-- -->[Install]<!-- -->
<!-- -->WantedBy=multi-user.target<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">### BEGIN INIT INFO</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Provides:          consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Required-Start:    $local_fs $remote_fs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Required-Stop:     $local_fs $remote_fs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Default-Start:     2 3 4 5</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Default-Stop:      0 1 6</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Short-Description: Consul agent</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Description:       Consul service discovery framework</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">### END INIT INFO</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Unit]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Description=Consul client agent</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Requires=network-online.target</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">After=network-online.target</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Service]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">User=consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Group=consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">PIDFile=/var/run/consul/consul.pid</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">PermissionsStartOnly=true</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecStartPre=-/bin/mkdir -p /var/run/consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecStartPre=/bin/chown -R consul:consul /var/run/consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecStart=/usr/local/bin/consul agent \</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    -config-file=/usr/local/etc/consul/client_agent.json \</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    -pid-file=/var/run/consul/consul.pid</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecReload=/bin/kill -HUP $MAINPID</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">KillMode=process</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">KillSignal=SIGTERM</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Restart=on-failure</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">RestartSec=42s</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Install]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">WantedBy=multi-user.target</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Change the following values as necessary:</p><ul><li class="g-type-long-body"><strong><code>-config-file</code></strong></li><li class="g-type-long-body"><strong><code>-pid-file</code></strong></li></ul><p class="g-type-long-body">Once the unit file is defined and saved (e.g.
<code>/etc/systemd/system/consul.service</code>), be sure to perform a <code>systemctl daemon-reload</code> and then you can start your Consul service on each Vault server.</p><p class="g-type-long-body">Start the Consul and verify its cluster state to be sure that the ownership and
permissions are correct on the directory you specified for the value of
<code>data_dir</code>, and then start the Consul service on each system and verify the
status:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">$ sudo systemctl start consul<!-- -->
<!-- -->$ sudo systemctl status consul<!-- -->
<!-- -->● consul.service - Consul client agent<!-- -->
<!-- -->   Loaded: loaded (/etc/systemd/system/consul.service; enabled; vendor preset: enabled)<!-- -->
<!-- -->   Active: active (running) since Tue 2018-03-20 19:36:49 UTC; 6s ago<!-- -->
<!-- --> Main PID: 23758 (consul)<!-- -->
<!-- -->    Tasks: 11<!-- -->
<!-- -->   Memory: 9.8M<!-- -->
<!-- -->      CPU: 571ms<!-- -->
<!-- -->   CGroup: /system.slice/consul.service<!-- -->
<!-- -->           └─23758 /usr/local/bin/consul agent -config-file=/usr/local/etc/consul/client_agent.json -pid-file=/var/run/consul/consul.pid<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ sudo systemctl start consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ sudo systemctl status consul</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">● consul.service - Consul client agent</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Loaded: loaded (/etc/systemd/system/consul.service; enabled; vendor preset: enabled)</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Active: active (running) since Tue 2018-03-20 19:36:49 UTC; 6s ago</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"> Main PID: 23758 (consul)</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    Tasks: 11</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Memory: 9.8M</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      CPU: 571ms</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   CGroup: /system.slice/consul.service</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">           └─23758 /usr/local/bin/consul agent -config-file=/usr/local/etc/consul/client_agent.json -pid-file=/var/run/consul/consul.pid</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">After starting all Consul client agents, check the Consul cluster status:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">$consul members<!-- -->
<!-- -->Node        Address           Status  Type    Build  Protocol  DC    Segment<!-- -->
<!-- -->consul_s1   10.1.42.101:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;<!-- -->
<!-- -->consul_s2   10.1.42.102:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;<!-- -->
<!-- -->consul_s3   10.1.42.103:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;<!-- -->
<!-- -->consul_c1   10.1.42.201:8301  alive   client  1.0.6  2         arus  &lt;default&gt;<!-- -->
<!-- -->consul_c2   10.1.42.202:8301  alive   client  1.0.6  2         arus  &lt;default&gt;<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$consul members</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Node        Address           Status  Type    Build  Protocol  DC    Segment</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s1   10.1.42.101:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s2   10.1.42.102:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_s3   10.1.42.103:8301  alive   server  1.0.6  2         dc1   &lt;all&gt;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_c1   10.1.42.201:8301  alive   client  1.0.6  2         arus  &lt;default&gt;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">consul_c2   10.1.42.202:8301  alive   client  1.0.6  2         arus  &lt;default&gt;</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The above output shows 3 Consul server agents and 2 Consul client agents in the
cluster. Now, you are ready to configure the Vault servers.</p><h3 class="g-type-display-4"><a class="__permalink-h" href="#step4" aria-label="step 4 configure the vault servers permalink">»</a><a class="__target-h __compat" id="step4" aria-hidden=""></a><a class="__target-h" id="step-4-configure-the-vault-servers" aria-hidden=""></a>Step 4: Configure the Vault Servers</h3><p class="g-type-long-body">Now that we have a Consul cluster consisting of 3 servers and 2 client agents
for our Vault servers, let’s get the configuration for Vault and a startup
script together so that we can bootstrap the Vault HA setup.</p><p class="g-type-long-body">Our Vault servers in this guide are defined by IP address only, but referenced
by a label as well:</p><ul><li class="g-type-long-body"><strong><code>vault_s1: 10.1.42.201</code></strong></li><li class="g-type-long-body"><strong><code>vault_s2: 10.1.42.202</code></strong></li></ul><p class="g-type-long-body">In our configuration file, we&#x27;ll set up the following:</p><ul><li class="g-type-long-body"><a href="/docs/configuration/listener/tcp"><strong><code>tcp</code></strong></a> listener</li><li class="g-type-long-body"><a href="/docs/configuration/storage/consul"><strong><code>consul</code></strong></a> storage backend</li><li class="g-type-long-body"><a href="/docs/configuration#high-availability-parameters">High Availability parameters</a></li></ul><p class="g-type-long-body">This section assumes the Vault binary is located at <strong><code>/usr/local/bin/vault</code></strong></p><h4 class="g-type-display-5"><a class="__permalink-h" href="#vault-configuration" aria-label="vault configuration permalink">»</a><a class="__target-h" id="vault-configuration" aria-hidden=""></a>Vault Configuration</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">listener &quot;tcp&quot; {<!-- -->
<!-- -->  address          = &quot;0.0.0.0:8200&quot;<!-- -->
<!-- -->  cluster_address  = &quot;0.0.0.0:8201&quot;<!-- -->
<!-- -->  tls_disable      = &quot;true&quot;<!-- -->
<!-- -->}<!-- -->
<!-- -->
<!-- -->storage &quot;consul&quot; {<!-- -->
<!-- -->  address = &quot;127.0.0.1:8500&quot;<!-- -->
<!-- -->  path    = &quot;vault/&quot;<!-- -->
<!-- -->}<!-- -->
<!-- -->
<!-- -->api_addr =  &quot;$API_ADDR&quot;<!-- -->
<!-- -->cluster_addr = &quot;$CLUSTER_ADDR&quot;<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">listener &quot;tcp&quot; {</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  address          = &quot;0.0.0.0:8200&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  cluster_address  = &quot;0.0.0.0:8201&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  tls_disable      = &quot;true&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">storage &quot;consul&quot; {</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  address = &quot;127.0.0.1:8500&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  path    = &quot;vault/&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">api_addr =  &quot;$API_ADDR&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">cluster_addr = &quot;$CLUSTER_ADDR&quot;</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">We&#x27;re setting the following parameters for our <code>tcp</code> listener:</p><ul><li class="g-type-long-body"><a id="address" class="__target-lic" aria-hidden=""></a><a href="#address" aria-label="address permalink" class="__permalink-lic"><code>address</code></a> (string: &quot;127.0.0.1:8200&quot;) – Specifies the address to bind to for listening.</li><li class="g-type-long-body"><a id="cluster_address" class="__target-lic" aria-hidden=""></a><a href="#cluster_address" aria-label="cluster_address permalink" class="__permalink-lic"><code>cluster_address</code></a> (string: &quot;127.0.0.1:8201&quot;) – Specifies the address to bind to for cluster server-to-server requests. This defaults to one port higher than the value of address. This does not usually need to be set, but can be useful in case Vault servers are isolated from each other in such a way that they need to hop through a TCP load balancer or some other scheme in order to talk.</li></ul><p class="g-type-long-body">This configuration allows for listening on all interfaces (such that a Vault
command against the loopback address would succeed, for example).</p><p class="g-type-long-body">We&#x27;re also explicitly setting Vault&#x27;s <a href="/docs/configuration#high-availability-parameters">HA parameters</a> (<code>api_addr</code> and <code>cluster_addr</code>). Often, it&#x27;s not necessary to configure these two parameters when using Consul as Vault&#x27;s storage backend, as Consul will attempt to automatically discover and advertise the address of the active Vault node. However, certain cluster configurations might require them to be explicitly set (accessing Vault through a load balancer, for example).</p><p class="g-type-long-body">For the sake of simplicity, we will assume that clients in our scenario connect directly to the Vault nodes (rather than through a load balancer). Review the <a href="/docs/concepts/ha#client-redirection">Client Redirection</a> documentation for more information on client access patterns and their implications.</p><p class="g-type-long-body">Note that some values contain variable placeholders while the rest have
reasonable defaults. You should replace the following values in your own Vault
server configuration based on the example:</p><ul><li class="g-type-long-body"><p class="g-type-long-body"><strong>\$API_ADDR</strong>: Specifies the address (full URL) to advertise to other Vault servers in the cluster for client redirection. This can also be provided via the environment variable <code>VAULT_API_ADDR</code>. In general this should be set to a full URL that points to the value of the listener address. In our scenario, it will be <code>http://10.1.42.201:8200</code>
and <code>http://10.1.42.202:8200</code> respectively.</p></li><li class="g-type-long-body"><p class="g-type-long-body"><strong>\$CLUSTER_ADDR</strong>: Specifies the address to advertise to other Vault servers in the cluster for request forwarding. This can also be provided via the environment variable <code>VAULT_CLUSTER_ADDR</code>. This is a full URL, like <code>api_addr</code>. In our scenario, it will be <code>https://10.1.42.201:8201</code> and
<code>https://10.1.42.202:8201</code> respectively.</p></li></ul><blockquote><p class="g-type-long-body">Note that the scheme here (https) is ignored; all cluster members will always
use TLS with a private key/certificate.</p></blockquote><h4 class="g-type-display-5"><a class="__permalink-h" href="#vault_s1-hcl-example" aria-label="vault_s1 hcl example permalink">»</a><a class="__target-h" id="vault_s1-hcl-example" aria-hidden=""></a><code>vault_s1.hcl</code> Example</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">listener &quot;tcp&quot; {<!-- -->
<!-- -->  address          = &quot;0.0.0.0:8200&quot;<!-- -->
<!-- -->  cluster_address  = &quot;10.1.42.201:8201&quot;<!-- -->
<!-- -->  tls_disable      = &quot;true&quot;<!-- -->
<!-- -->}<!-- -->
<!-- -->
<!-- -->storage &quot;consul&quot; {<!-- -->
<!-- -->  address = &quot;127.0.0.1:8500&quot;<!-- -->
<!-- -->  path    = &quot;vault/&quot;<!-- -->
<!-- -->}<!-- -->
<!-- -->
<!-- -->api_addr = &quot;http://10.1.42.201:8200&quot;<!-- -->
<!-- -->cluster_addr = &quot;https://10.1.42.201:8201&quot;<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">listener &quot;tcp&quot; {</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  address          = &quot;0.0.0.0:8200&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  cluster_address  = &quot;10.1.42.201:8201&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  tls_disable      = &quot;true&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">storage &quot;consul&quot; {</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  address = &quot;127.0.0.1:8500&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  path    = &quot;vault/&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">api_addr = &quot;http://10.1.42.201:8200&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">cluster_addr = &quot;https://10.1.42.201:8201&quot;</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#vault_s2-hcl-example" aria-label="vault_s2 hcl example permalink">»</a><a class="__target-h" id="vault_s2-hcl-example" aria-hidden=""></a><code>vault_s2.hcl</code> Example</h4><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">listener &quot;tcp&quot; {<!-- -->
<!-- -->  address          = &quot;0.0.0.0:8200&quot;<!-- -->
<!-- -->  cluster_address  = &quot;10.1.42.202:8201&quot;<!-- -->
<!-- -->  tls_disable      = &quot;true&quot;<!-- -->
<!-- -->}<!-- -->
<!-- -->
<!-- -->storage &quot;consul&quot; {<!-- -->
<!-- -->  address = &quot;127.0.0.1:8500&quot;<!-- -->
<!-- -->  path    = &quot;vault/&quot;<!-- -->
<!-- -->}<!-- -->
<!-- -->
<!-- -->api_addr = &quot;http://10.1.42.202:8200&quot;<!-- -->
<!-- -->cluster_addr = &quot;https://10.1.42.202:8201&quot;<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">listener &quot;tcp&quot; {</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  address          = &quot;0.0.0.0:8200&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  cluster_address  = &quot;10.1.42.202:8201&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  tls_disable      = &quot;true&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">storage &quot;consul&quot; {</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  address = &quot;127.0.0.1:8500&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  path    = &quot;vault/&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">}</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">api_addr = &quot;http://10.1.42.202:8200&quot;</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">cluster_addr = &quot;https://10.1.42.202:8201&quot;</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#vault-server-systemd-unit-file" aria-label="vault server systemd unit file permalink">»</a><a class="__target-h" id="vault-server-systemd-unit-file" aria-hidden=""></a>Vault Server <code>systemd</code> Unit file</h4><p class="g-type-long-body">You have Vault binaries and a reasonably basic configuration along with local
client agents configured. Now, you just need to start Vault on each server
instance. Here is an example <code>systemd</code> unit file:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">### BEGIN INIT INFO<!-- -->
<!-- --># Provides:          vault<!-- -->
<!-- --># Required-Start:    $local_fs $remote_fs<!-- -->
<!-- --># Required-Stop:     $local_fs $remote_fs<!-- -->
<!-- --># Default-Start:     2 3 4 5<!-- -->
<!-- --># Default-Stop:      0 1 6<!-- -->
<!-- --># Short-Description: Vault server<!-- -->
<!-- --># Description:       Vault secret management tool<!-- -->
<!-- -->### END INIT INFO<!-- -->
<!-- -->
<!-- -->[Unit]<!-- -->
<!-- -->Description=Vault secret management tool<!-- -->
<!-- -->Requires=network-online.target<!-- -->
<!-- -->After=network-online.target<!-- -->
<!-- -->
<!-- -->[Service]<!-- -->
<!-- -->User=vault<!-- -->
<!-- -->Group=vault<!-- -->
<!-- -->PIDFile=/var/run/vault/vault.pid<!-- -->
<!-- -->ExecStart=/usr/local/bin/vault server -config=/etc/vault/vault_server.hcl -log-level=debug<!-- -->
<!-- -->ExecReload=/bin/kill -HUP $MAINPID<!-- -->
<!-- -->KillMode=process<!-- -->
<!-- -->KillSignal=SIGTERM<!-- -->
<!-- -->Restart=on-failure<!-- -->
<!-- -->RestartSec=42s<!-- -->
<!-- -->LimitMEMLOCK=infinity<!-- -->
<!-- -->
<!-- -->[Install]<!-- -->
<!-- -->WantedBy=multi-user.target<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">### BEGIN INIT INFO</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Provides:          vault</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Required-Start:    $local_fs $remote_fs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Required-Stop:     $local_fs $remote_fs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Default-Start:     2 3 4 5</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Default-Stop:      0 1 6</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Short-Description: Vault server</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"># Description:       Vault secret management tool</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">### END INIT INFO</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Unit]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Description=Vault secret management tool</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Requires=network-online.target</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">After=network-online.target</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Service]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">User=vault</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Group=vault</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">PIDFile=/var/run/vault/vault.pid</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecStart=/usr/local/bin/vault server -config=/etc/vault/vault_server.hcl -log-level=debug</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">ExecReload=/bin/kill -HUP $MAINPID</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">KillMode=process</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">KillSignal=SIGTERM</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Restart=on-failure</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">RestartSec=42s</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">LimitMEMLOCK=infinity</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">[Install]</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">WantedBy=multi-user.target</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Note that you might be interested in changing the values of the following
depending on style, file system hierarchy standard adherence level, and so on:</p><ul><li class="g-type-long-body"><strong><code>-config</code></strong></li><li class="g-type-long-body"><strong><code>-log-level</code></strong></li></ul><p class="g-type-long-body">Once the unit file is defined and saved as e.g.
<code>/etc/systemd/system/vault.service</code>, be sure to perform a <code>systemctl daemon-reload</code>
and then you can start your Vault service on each server.</p><h3 class="g-type-display-4"><a class="__permalink-h" href="#step5" aria-label="step 5 start vault and verify the state permalink">»</a><a class="__target-h __compat" id="step5" aria-hidden=""></a><a class="__target-h" id="step-5-start-vault-and-verify-the-state" aria-hidden=""></a>Step 5: Start Vault and Verify the State</h3><p class="g-type-long-body">Start the Vault service on each system and verify the status:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">$ sudo systemctl start vault<!-- -->
<!-- -->$ sudo systemctl status vault<!-- -->
<!-- -->● vault.service - Vault secret management tool<!-- -->
<!-- -->   Loaded: loaded (/etc/systemd/system/vault.service; enabled; vendor preset: enabled)<!-- -->
<!-- -->   Active: active (running) since Tue 2018-03-20 20:42:10 UTC; 42s ago<!-- -->
<!-- --> Main PID: 2080 (vault)<!-- -->
<!-- -->    Tasks: 12<!-- -->
<!-- -->   Memory: 71.7M<!-- -->
<!-- -->      CPU: 50s<!-- -->
<!-- -->   CGroup: /system.slice/vault.service<!-- -->
<!-- -->           └─2080 /usr/local/bin/vault server -config=/home/ubuntu/vault_nano/config/vault_server.hcl -log-level=debu<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ sudo systemctl start vault</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ sudo systemctl status vault</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">● vault.service - Vault secret management tool</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Loaded: loaded (/etc/systemd/system/vault.service; enabled; vendor preset: enabled)</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Active: active (running) since Tue 2018-03-20 20:42:10 UTC; 42s ago</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"> Main PID: 2080 (vault)</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    Tasks: 12</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   Memory: 71.7M</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      CPU: 50s</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">   CGroup: /system.slice/vault.service</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">           └─2080 /usr/local/bin/vault server -config=/home/ubuntu/vault_nano/config/vault_server.hcl -log-level=debu</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Now you’ll need to move on to <a href="/intro/getting-started/deploy#initializing-the-vault">initializing and
unsealing</a> each Vault
instance.</p><p class="g-type-long-body">Once that is done, check Vault status on each of the servers.</p><p class="g-type-long-body">The <strong>active</strong> Vault server:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">$ vault status<!-- -->
<!-- -->Key             Value<!-- -->
<!-- -->---             -----<!-- -->
<!-- -->Seal Type       shamir<!-- -->
<!-- -->Sealed          false<!-- -->
<!-- -->Total Shares    5<!-- -->
<!-- -->Threshold       3<!-- -->
<!-- -->Version         0.9.5<!-- -->
<!-- -->Cluster Name    vault<!-- -->
<!-- -->Cluster ID      0ee91bd1-55ec-c84f-3c1d-dcc7f4f644a8<!-- -->
<!-- -->HA Enabled      true<!-- -->
<!-- -->HA Cluster      https://10.1.42.201:8201<!-- -->
<!-- -->HA Mode         active<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault status</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Key             Value</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">---             -----</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Seal Type       shamir</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Sealed          false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Total Shares    5</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Threshold       3</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Version         0.9.5</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Cluster Name    vault</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Cluster ID      0ee91bd1-55ec-c84f-3c1d-dcc7f4f644a8</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">HA Enabled      true</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">HA Cluster      https://10.1.42.201:8201</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">HA Mode         active</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The <strong>standby</strong> Vault server:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">vault status<!-- -->
<!-- -->Key                     Value<!-- -->
<!-- -->---                     -----<!-- -->
<!-- -->Seal Type               shamir<!-- -->
<!-- -->Sealed                  false<!-- -->
<!-- -->Total Shares            5<!-- -->
<!-- -->Threshold               3<!-- -->
<!-- -->Version                 0.9.5<!-- -->
<!-- -->Cluster Name            vaultron<!-- -->
<!-- -->Cluster ID              0ee91bd1-55ec-c84f-3c1d-dcc7f4f644a8<!-- -->
<!-- -->HA Enabled              true<!-- -->
<!-- -->HA Cluster              https://10.1.42.201:8201<!-- -->
<!-- -->HA Mode                 standby<!-- -->
<!-- -->Active Node Address:    http://10.1.42.201:8200<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">vault status</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Key                     Value</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">---                     -----</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Seal Type               shamir</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Sealed                  false</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Total Shares            5</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Threshold               3</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Version                 0.9.5</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Cluster Name            vaultron</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Cluster ID              0ee91bd1-55ec-c84f-3c1d-dcc7f4f644a8</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">HA Enabled              true</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">HA Cluster              https://10.1.42.201:8201</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">HA Mode                 standby</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Active Node Address:    http://10.1.42.201:8200</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Vault servers are now operational in HA mode at this point, and you should be
able to write a secret from either the active or the standby Vault instance and
see it succeed as a test of request forwarding. Also, you can shut down the
active instance (<code>sudo systemctl stop vault</code>) to simulate a system failure and
see the standby instance assumes the leadership.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#next-steps" aria-label="next steps permalink">»</a><a class="__target-h" id="next-steps" aria-hidden=""></a>Next steps</h2><p class="g-type-long-body">Read <a href="/guides/operations/production">Production Hardening</a> to learn best
practices for a production hardening deployment of Vault.</p></article></div></div><div id="edit-this-page" class="g-container"><a href="https://github.com/hashicorp/vault/blob/main/website/content/guides/operations/vault-ha-consul.mdx"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjMiIGhlaWdodD0iMjIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTExLjYwOC4zNDJDNS41MzUuMzQyLjYxIDUuMTYyLjYxIDExLjEwOGMwIDQuNzU3IDMuMTUyIDguNzkyIDcuNTIzIDEwLjIxNS41NS4xLjc1MS0uMjMzLjc1MS0uNTE4IDAtLjI1Ni0uMDEtLjkzMy0uMDE1LTEuODMxLTMuMDYuNjUtMy43MDUtMS40NDQtMy43MDUtMS40NDQtLjUtMS4yNDMtMS4yMjItMS41NzQtMS4yMjItMS41NzQtLjk5OC0uNjY4LjA3Ni0uNjU1LjA3Ni0uNjU1IDEuMTA0LjA3NiAxLjY4NSAxLjExIDEuNjg1IDEuMTEuOTgxIDEuNjQ1IDIuNTc1IDEuMTcgMy4yMDEuODk0LjEtLjY5NS4zODUtMS4xNy42OTktMS40MzktMi40NDMtLjI3MS01LjAxMS0xLjE5NS01LjAxMS01LjMyIDAtMS4xNzYuNDI5LTIuMTM3IDEuMTMyLTIuODktLjExMy0uMjcyLS40OS0xLjM2Ny4xMDgtMi44NDkgMCAwIC45MjQtLjI4OSAzLjAyNSAxLjEwNC44NzctLjI0IDEuODE5LS4zNTggMi43NTQtLjM2My45MzQuMDA1IDEuODc1LjEyNCAyLjc1NC4zNjMgMi4xLTEuMzkzIDMuMDIyLTEuMTA0IDMuMDIyLTEuMTA0LjYgMS40ODIuMjIyIDIuNTc3LjExIDIuODUuNzA1Ljc1MiAxLjEzIDEuNzEzIDEuMTMgMi44ODggMCA0LjEzNi0yLjU3MiA1LjA0Ni01LjAyMiA1LjMxMy4zOTQuMzMyLjc0Ni45OS43NDYgMS45OTQgMCAxLjQzOC0uMDEzIDIuNi0uMDEzIDIuOTUzIDAgLjI4OC4xOTguNjIzLjc1Ni41MTggNC4zNjgtMS40MjcgNy41MTYtNS40NiA3LjUxNi0xMC4yMTUgMC01Ljk0Ni00LjkyNS0xMC43NjYtMTEtMTAuNzY2IiBmaWxsPSIjMTYxNTE0IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=" alt="github logo"/><span>Edit this page</span></a></div></div><footer class="g-footer"><div class="g-container"><div class="left"><a href="/docs/vault_v1.8.x/docs/">Docs</a><a href="/docs/vault_v1.8.x/api/">API</a><a href="https://learn.hashicorp.com/vault">Learn</a><a href="/docs/vault_v1.8.x/community/">Community</a><a href="https://hashicorp.com/privacy">Privacy</a><a href="/docs/vault_v1.8.x/security/">Security</a><a href="/docs/vault_v1.8.x/files/press-kit.zip">Press Kit</a><a>Consent Manager</a></div></div></footer><div id="g-consent-manager"></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"currentPath":"operations/vault-ha-consul","frontMatter":{"layout":"guides","page_title":"Vault HA with Consul - Guides","description":"This guide will walk you through a simple Vault Highly Available (HA) cluster\nimplementation. While this is not an exhaustive or prescriptive guide that\ncan be used as a drop-in production example, it covers the basics enough to\ninform your own production setup."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/operations/vault-ha-consul.mdx","mdxSource":{"compiledSource":"var p=Object.defineProperty;var r=Object.prototype.hasOwnProperty;var l=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable;var o=(a,t,n)=\u003et in a?p(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,e=(a,t)=\u003e{for(var n in t||(t={}))r.call(t,n)\u0026\u0026o(a,n,t[n]);if(l)for(var n of l(t))i.call(t,n)\u0026\u0026o(a,n,t[n]);return a};var d=(a,t)=\u003e{var n={};for(var s in a)r.call(a,s)\u0026\u0026t.indexOf(s)\u003c0\u0026\u0026(n[s]=a[s]);if(a!=null\u0026\u0026l)for(var s of l(a))t.indexOf(s)\u003c0\u0026\u0026i.call(a,s)\u0026\u0026(n[s]=a[s]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var s=n,{components:a}=s,t=d(s,[\"components\"]);return mdx(MDXLayout,e(e(e({},layoutProps),t),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h1\",e({},{className:\"g-type-display-2\"}),mdx(\"a\",e({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#vault-high-availability-ha\",\"aria-label\":\"vault high availability ha permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h1\"},{className:\"__target-h\",id:\"vault-high-availability-ha\",\"aria-hidden\":\"\"})),\"Vault High Availability (HA)\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Vault can run in a high availability (HA) mode to protect against outages by\nrunning multiple Vault servers. Vault is typically bound by the IO limits of the\nstorage backend rather than the compute requirements. Certain storage backends,\nsuch as Consul, provide additional coordination functions that enable Vault to\nrun in an HA configuration while others provide a more robust backup and\nrestoration process.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"When running in HA mode, Vault servers have two additional states: \",mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"standby\")),`\nand `,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"active\")),`. Within a Vault cluster, only a single instance will be\n`,mdx(\"em\",{parentName:\"p\"},\"active\"),\" and handles all requests (reads and writes) and all \",mdx(\"em\",{parentName:\"p\"},\"standby\"),` nodes\nredirect requests to the `,mdx(\"em\",{parentName:\"p\"},\"active\"),\" node.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-ha-consul-3.png\",alt:\"Reference Architecture\"}))),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" As of version \",mdx(\"strong\",{parentName:\"p\"},\"0.11\"),`, those standby nodes can handle most\nread-only requests and behave as read-replica nodes. This `,mdx(\"strong\",{parentName:\"p\"},`Performance Standby\nNodes`),\" feature is included in \",mdx(\"em\",{parentName:\"p\"},\"Vault Enterprise Premium\"),`, and also available\nfor `,mdx(\"em\",{parentName:\"p\"},\"Vault Enterprise Pro\"),` with additional fee. This is particularly useful for\nprocessing high volume Encryption as a Service (`,mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/secrets/transit\"}),`Transit secrets\nengine`),\") requests. Read \",mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/enterprise/performance-standby\"}),`Performance Standby\nNodes`),\" documentation and a \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/operations/performance-nodes\"}),\"guide\"),\" for more details.\")),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),`This guide will walk you through a simple Vault Highly Available (HA) cluster\nimplementation. While this is not an exhaustive or prescriptive guide that can\nbe used as a drop-in production example, it covers the `,mdx(\"strong\",{parentName:\"p\"},\"basics\"),` enough to\ninform your own production setup.`)),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-materials\",\"aria-label\":\"reference materials permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-materials\",\"aria-hidden\":\"\"})),\"Reference Materials\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/concepts/ha\"}),\"High Availability Mode\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/configuration/storage/consul\"}),\"Consul Storage Backend\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/configuration#high-availability-parameters\"}),\"High Availability Parameters\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.consul.io/docs/agent/options.html\"}),\"Consul Agent Configuration\"))),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"25 minutes\"),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This intermediate Vault operations guide assumes that you have some working\nknowledge of Vault and Consul.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Our goal in following this guide is to arrive at a Vault HA setup\nconsisting of the following:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"2 Vault servers: 1 active and 1 standby\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"Cluster of 3 Consul servers\")),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#reference-diagram\",\"aria-label\":\"reference diagram permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"reference-diagram\",\"aria-hidden\":\"\"})),\"Reference Diagram\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This diagram lays out the simple architecture details for reference:\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-ha-consul.png\",alt:\"Reference Architecture\"}))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"You perform the following:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step1\"}),\"Step 1: Setup a Consul Server Cluster\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step2\"}),\"Step 2: Start and Verify the Consul Cluster State\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step3\"}),\"Step 3: Setup Consul Client Agents on Vault Nodes\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step4\"}),\"Step 4: Configure the Vault Servers\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"#step5\"}),\"Step 5: Start Vault and Verify the State\"))),mdx(\"div\",e({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),`For the purpose of this guide, we will use the open source software editions of\nVault and Consul; however, the setup is the same for Enterprise editions.`)),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step1\",\"aria-label\":\"step 1 setup a consul server cluster permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step1\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-setup-a-consul-server-cluster\",\"aria-hidden\":\"\"})),\"Step 1: Setup a Consul Server Cluster\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Our Consul servers in this guide will be defined by IP address only, but also\nreferenced by a label:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"consul_s1: 10.1.42.101\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"consul_s2: 10.1.42.102\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"consul_s3: 10.1.42.103\")))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.consul.io/downloads.html\"}),\"Consul binary\"),` is presumed to be\nlocated in `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/usr/local/bin/consul\")),`, but if your case differs, you can adjust the\npath references accordingly.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"With that in mind, here is a basic Consul server configuration starting point:\"),mdx(\"pre\",e({},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"{\",`\n`,'  \"server\": true,',`\n`,'  \"node_name\": \"$NODE_NAME\",',`\n`,'  \"datacenter\": \"dc1\",',`\n`,'  \"data_dir\": \"$CONSUL_DATA_PATH\",',`\n`,'  \"bind_addr\": \"0.0.0.0\",',`\n`,'  \"client_addr\": \"0.0.0.0\",',`\n`,'  \"advertise_addr\": \"$ADVERTISE_ADDR\",',`\n`,'  \"bootstrap_expect\": 3,',`\n`,'  \"retry_join\": [\"$JOIN1\", \"$JOIN2\", \"$JOIN3\"],',`\n`,'  \"ui\": true,',`\n`,'  \"log_level\": \"DEBUG\",',`\n`,'  \"enable_syslog\": true,',`\n`,'  \"acl_enforce_version_8\": false',`\n`,\"}\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Note that some values contain variable placeholders while the rest have\nreasonable defaults. You should replace the following values in your own Consul\nserver configuration based on the example:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$NODE_NAME\"),` this is a unique label for the node; in our case, this will be\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"consul_s1\"),\", \",mdx(\"inlineCode\",{parentName:\"li\"},\"consul_s2\"),\", and \",mdx(\"inlineCode\",{parentName:\"li\"},\"consul_s3\"),\" respectively.\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$CONSUL_DATA_PATH\"),`: absolute path to Consul data directory; ensure that\nthis directory is writable by the Consul process user.`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$ADVERTISE_ADDR\"),`: set to address that you prefer the Consul\nservers advertise to the other servers in the cluster and should not be set to\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"0.0.0.0\"),`; for this guide, it should be set to the Consul server\\u2019s IP address in\neach instance of the configuration file, or `,mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.101\"),\",\",mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.102\"),`, and\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.103\"),\" respectively.\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$JOIN1\"),\",\\u2005\",mdx(\"strong\",{parentName:\"li\"},\"\\\\$JOIN2\"),\", \",mdx(\"strong\",{parentName:\"li\"},\"\\\\$JOIN3\"),\": This example uses the \",mdx(\"inlineCode\",{parentName:\"li\"},\"retry_join\"),`\nmethod of joining the server agents to form a cluster; as such, the values for\nthis guide would be `,mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.101\"),\", \",mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.102\"),\", and \",mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.103\"),\" respectively.\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Note that the web user interface is enabled (\",mdx(\"inlineCode\",{parentName:\"p\"},'\"ui\": true'),`), and Consul will be\nlogging at DEBUG level to the system log (`,mdx(\"inlineCode\",{parentName:\"p\"},'\"log_level\": \"DEBUG\"'),`). For the\npurpose of this guide, the `,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"acl_enforce_version_8\")),\" is set to \",mdx(\"inlineCode\",{parentName:\"p\"},\"false\"),` so that\nwe do not need to be concerned with ACLs in this guide. However, you would want\nto enable ACLs in a production environment and follow the `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.consul.io/docs/guides/acl.html#acl-agent-master-token\"}),\"Consul ACL Guide\"),` for\ndetails.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Create a configuration file for each Vault server and save it as\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/usr/local/etc/consul/client_agent.json\")),\".\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul_s1-json-example\",\"aria-label\":\"consul_s1 json example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul_s1-json-example\",\"aria-hidden\":\"\"})),mdx(\"inlineCode\",{parentName:\"h4\"},\"consul_s1.json\"),\" Example\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"{\",`\n`,'  \"server\": true,',`\n`,'  \"node_name\": \"consul_s1\",',`\n`,'  \"datacenter\": \"dc1\",',`\n`,'  \"data_dir\": \"/var/consul/data\",',`\n`,'  \"bind_addr\": \"0.0.0.0\",',`\n`,'  \"client_addr\": \"0.0.0.0\",',`\n`,'  \"advertise_addr\": \"10.1.42.101\",',`\n`,'  \"bootstrap_expect\": 3,',`\n`,'  \"retry_join\": [\"10.1.42.101\", \"10.1.42.102\", \"10.1.42.103\"],',`\n`,'  \"ui\": true,',`\n`,'  \"log_level\": \"DEBUG\",',`\n`,'  \"enable_syslog\": true,',`\n`,'  \"acl_enforce_version_8\": false',`\n`,\"}\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul_s2-json-example\",\"aria-label\":\"consul_s2 json example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul_s2-json-example\",\"aria-hidden\":\"\"})),mdx(\"inlineCode\",{parentName:\"h4\"},\"consul_s2.json\"),\" Example\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"{\",`\n`,'  \"server\": true,',`\n`,'  \"node_name\": \"consul_s2\",',`\n`,'  \"datacenter\": \"dc1\",',`\n`,'  \"data_dir\": \"/var/consul/data\",',`\n`,'  \"bind_addr\": \"0.0.0.0\",',`\n`,'  \"client_addr\": \"0.0.0.0\",',`\n`,'  \"advertise_addr\": \"10.1.42.102\",',`\n`,'  \"bootstrap_expect\": 3,',`\n`,'  \"retry_join\": [\"10.1.42.101\", \"10.1.42.102\", \"10.1.42.103\"],',`\n`,'  \"ui\": true,',`\n`,'  \"log_level\": \"DEBUG\",',`\n`,'  \"enable_syslog\": true,',`\n`,'  \"acl_enforce_version_8\": false',`\n`,\"}\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul_s3-json-example\",\"aria-label\":\"consul_s3 json example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul_s3-json-example\",\"aria-hidden\":\"\"})),mdx(\"inlineCode\",{parentName:\"h4\"},\"consul_s3.json\"),\" Example\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"{\",`\n`,'  \"server\": true,',`\n`,'  \"node_name\": \"consul_s3\",',`\n`,'  \"datacenter\": \"dc1\",',`\n`,'  \"data_dir\": \"/var/consul/data\",',`\n`,'  \"bind_addr\": \"0.0.0.0\",',`\n`,'  \"client_addr\": \"0.0.0.0\",',`\n`,'  \"advertise_addr\": \"10.1.42.103\",',`\n`,'  \"bootstrap_expect\": 3,',`\n`,'  \"retry_join\": [\"10.1.42.101\", \"10.1.42.102\", \"10.1.42.103\"],',`\n`,'  \"ui\": true,',`\n`,'  \"log_level\": \"DEBUG\",',`\n`,'  \"enable_syslog\": true,',`\n`,'  \"acl_enforce_version_8\": false',`\n`,\"}\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul-server-systemd-unit-file\",\"aria-label\":\"consul server systemd unit file permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul-server-systemd-unit-file\",\"aria-hidden\":\"\"})),\"Consul Server \",mdx(\"inlineCode\",{parentName:\"h4\"},\"systemd\"),\" Unit file\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`You have Consul binaries and a reasonably basic configuration and now you just\nneed to start Consul on each server instance; `,mdx(\"inlineCode\",{parentName:\"p\"},\"systemd\"),` is popular in most\ncontemporary Linux distributions, so with that in mind, here is an example\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"systemd\"),\" unit file:\"),mdx(\"pre\",e({},{className:\"language-plaintext\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-plaintext\"}),\"### BEGIN INIT INFO\",`\n`,\"# Provides:          consul\",`\n`,\"# Required-Start:    $local_fs $remote_fs\",`\n`,\"# Required-Stop:     $local_fs $remote_fs\",`\n`,\"# Default-Start:     2 3 4 5\",`\n`,\"# Default-Stop:      0 1 6\",`\n`,\"# Short-Description: Consul agent\",`\n`,\"# Description:       Consul service discovery framework\",`\n`,\"### END INIT INFO\",`\n`,`\n`,\"[Unit]\",`\n`,\"Description=Consul server agent\",`\n`,\"Requires=network-online.target\",`\n`,\"After=network-online.target\",`\n`,`\n`,\"[Service]\",`\n`,\"User=consul\",`\n`,\"Group=consul\",`\n`,\"PIDFile=/var/run/consul/consul.pid\",`\n`,\"PermissionsStartOnly=true\",`\n`,\"ExecStartPre=-/bin/mkdir -p /var/run/consul\",`\n`,\"ExecStartPre=/bin/chown -R consul:consul /var/run/consul\",`\n`,\"ExecStart=/usr/local/bin/consul agent \\\\\",`\n`,\"    -config-file=/usr/local/etc/consul/client_agent.json \\\\\",`\n`,\"    -pid-file=/var/run/consul/consul.pid\",`\n`,\"ExecReload=/bin/kill -HUP $MAINPID\",`\n`,\"KillMode=process\",`\n`,\"KillSignal=SIGTERM\",`\n`,\"Restart=on-failure\",`\n`,\"RestartSec=42s\",`\n`,`\n`,\"[Install]\",`\n`,\"WantedBy=multi-user.target\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Note that you might be interested in changing the values of the following\ndepending on style, file system hierarchy standard adherence level, and so on:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"-config-file\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"-pid-file\")))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Once the unit file is defined and saved (e.g.\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"/etc/systemd/system/consul.service\"),\"), be sure to perform a \",mdx(\"inlineCode\",{parentName:\"p\"},\"systemctl daemon-reload\"),`\nand then you can start your Consul service on each server.`),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step2\",\"aria-label\":\"step 2 start and verify the consul cluster state permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step2\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-start-and-verify-the-consul-cluster-state\",\"aria-hidden\":\"\"})),\"Step 2: Start and Verify the Consul Cluster State\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Be sure that the ownership and permissions are correct on the directory you\nspecified for the value of `,mdx(\"inlineCode\",{parentName:\"p\"},\"data_dir\"),`, and then start the Consul service on each\nsystem and verify the status:`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"$ sudo systemctl start consul\",`\n`,\"$ sudo systemctl status consul\",`\n`,\"\\u25CF consul.service - Consul server agent\",`\n`,\"   Loaded: loaded (/etc/systemd/system/consul.service; enabled; vendor preset: enabled)\",`\n`,\"   Active: active (running) since Mon 2018-03-19 17:33:14 UTC; 24h ago\",`\n`,\" Main PID: 2068 (consul)\",`\n`,\"    Tasks: 13\",`\n`,\"   Memory: 13.6M\",`\n`,\"      CPU: 0m 52.784s\",`\n`,\"   CGroup: /system.slice/consul.service\",`\n`,\"           \\u2514\\u25002068 /usr/local/bin/consul agent -config-file=/usr/local/etc/consul/client_agent.json -pid-file=/var/run/consul/consul.pid\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"After starting all Consul server agents, let\\u2019s check the Consul cluster status:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"$consul members\",`\n`,\"Node       Address           Status  Type    Build  Protocol  DC    Segment\",`\n`,\"consul_s1  10.1.42.101:8301  alive   server  1.0.6  2         dc1   \u003call\u003e\",`\n`,\"consul_s2  10.1.42.102:8301  alive   server  1.0.6  2         dc1   \u003call\u003e\",`\n`,\"consul_s3  10.1.42.103:8301  alive   server  1.0.6  2         dc1   \u003call\u003e\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The cluster looks good and all 3 servers are shown; let\\u2019s make sure we have a\nleader before proceeding:`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"$consul operator raft list-peers\",`\n`,\"Node                   ID                                    Address           State     Voter  RaftProtocol\",`\n`,\"consul_s2              536b721f-645d-544a-c10d-85c2ca24e4e4  10.1.42.102:8300  follower  true   3\",`\n`,\"consul_s1              e10ba554-a4f9-6a8c-f662-81c8bb2a04f5  10.1.42.101:8300  follower  true   3\",`\n`,\"consul_s3              56370ec8-da25-e7dc-dfc6-bf5f27978a7a  10.1.42.103:8300  leader    true   3\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The above output shows that \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"consul_s3\")),` is the current cluster leader in\nthis example. Now, you are good to move on to the Vault server configuration.`),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step3\",\"aria-label\":\"step 3 setup consul client agents on vault nodes permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step3\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-setup-consul-client-agents-on-vault-nodes\",\"aria-hidden\":\"\"})),\"Step 3: Setup Consul Client Agents on Vault Nodes\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The Vault server nodes require \",mdx(\"strong\",{parentName:\"p\"},\"both\"),\" the Consul and Vault binaries on each node. Consul will be configured as a \",mdx(\"strong\",{parentName:\"p\"},\"client\"),\" agent and Vault will be configured as a server.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),mdx(\"img\",e({parentName:\"p\"},{src:\"/img/vault-ha-consul-2.png\",alt:\"Reference Architecture\"}))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul-client-agent-configuration\",\"aria-label\":\"consul client agent configuration permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul-client-agent-configuration\",\"aria-hidden\":\"\"})),\"Consul Client Agent Configuration\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Since Consul is used to provide a highly available storage backend, you need to\nconfigure local Consul client agents on the Vault servers which will communicate\nwith the Consul server cluster for registering health checks, service discovery, and cluster HA failover coordination (cluster leadership).`),mdx(\"div\",e({},{className:\"alert alert-warning g-type-body\",role:\"alert\"}),mdx(\"p\",e({parentName:\"div\"},{className:\"g-type-long-body\"}),\"Note that \",mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/configuration/storage/consul#address\"}),`it is not recommended to connect the Vault servers directly to the\nConsul servers`),\".\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The Consul client agents will be using the same address as the Vault servers for\nnetwork communication to the Consul server cluster, but they will be binding the\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"client_address\")),` only to the loopback interface such that Vault can connect to\nit over the loopback interface.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Here is the example configuration for the Consul client agent:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"{\",`\n`,'  \"server\": false,',`\n`,'  \"datacenter\": \"dc1\",',`\n`,'  \"node_name\": \"$NODE_NAME\",',`\n`,'  \"data_dir\": \"$CONSUL_DATA_PATH\",',`\n`,'  \"bind_addr\": \"$BIND_ADDR\",',`\n`,'  \"client_addr\": \"127.0.0.1\",',`\n`,'  \"retry_join\": [\"$JOIN1\", \"$JOIN2\", \"$JOIN3\"],',`\n`,'  \"log_level\": \"DEBUG\",',`\n`,'  \"enable_syslog\": true,',`\n`,'  \"acl_enforce_version_8\": false',`\n`,\"}\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Similar to what you have done in \",mdx(\"a\",e({parentName:\"p\"},{href:\"#step1\"}),\"Step 1\"),`, replace the following values\nin your own Consul client agent configuration accordingly:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$NODE_NAME\"),` this is a unique label for the node; in\nour case, this will be `,mdx(\"inlineCode\",{parentName:\"li\"},\"consul_c1\"),\" and \",mdx(\"inlineCode\",{parentName:\"li\"},\"consul_c2\"),\" respectively.\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$CONSUL_DATA_PATH\"),`: absolute path to Consul data directory; ensure that this\ndirectory is writable by the Consul process user.`),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$BIND_ADDR\"),`: this should be set\nto address that you prefer the Consul servers advertise to the other servers in\nthe cluster and should not be set to `,mdx(\"inlineCode\",{parentName:\"li\"},\"0.0.0.0\"),`; for this guide, it should be set\nto the Vault server\\u2019s IP address in each instance of the configuration file, or\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.201\"),\" and \",mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.202\"),\" respectively.\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"\\\\$JOIN1\"),\",\\u2005\",mdx(\"strong\",{parentName:\"li\"},\"\\\\$JOIN2\"),\", \",mdx(\"strong\",{parentName:\"li\"},\"\\\\$JOIN3\"),\": This example uses the \",mdx(\"inlineCode\",{parentName:\"li\"},\"retry_join\"),` method of\njoining the server agents to form a cluster; as such, the values for this guide\nwould be `,mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.101\"),\", \",mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.102\"),\", and \",mdx(\"inlineCode\",{parentName:\"li\"},\"10.1.42.103\"),\" respectively.\")),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Create a configuration file for each Vault server and save it as\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/usr/local/etc/consul/client_agent.json\")),\".\"),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul_c1-json-example\",\"aria-label\":\"consul_c1 json example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul_c1-json-example\",\"aria-hidden\":\"\"})),mdx(\"inlineCode\",{parentName:\"h4\"},\"consul_c1.json\"),\" Example\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"{\",`\n`,'  \"server\": false,',`\n`,'  \"datacenter\": \"dc1\",',`\n`,'  \"node_name\": \"consul_c1\",',`\n`,'  \"data_dir\": \"/var/consul/data\",',`\n`,'  \"bind_addr\": \"10.1.42.201\",',`\n`,'  \"client_addr\": \"127.0.0.1\",',`\n`,'  \"retry_join\": [\"10.1.42.101\", \"10.1.42.102\", \"10.1.42.103\"],',`\n`,'  \"log_level\": \"DEBUG\",',`\n`,'  \"enable_syslog\": true,',`\n`,'  \"acl_enforce_version_8\": false',`\n`,\"}\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul_c2-json-example\",\"aria-label\":\"consul_c2 json example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul_c2-json-example\",\"aria-hidden\":\"\"})),mdx(\"inlineCode\",{parentName:\"h4\"},\"consul_c2.json\"),\" Example\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"{\",`\n`,'  \"server\": false,',`\n`,'  \"datacenter\": \"dc1\",',`\n`,'  \"node_name\": \"consul_c2\",',`\n`,'  \"data_dir\": \"/var/consul/data\",',`\n`,'  \"bind_addr\": \"10.1.42.202\",',`\n`,'  \"client_addr\": \"127.0.0.1\",',`\n`,'  \"retry_join\": [\"10.1.42.101\", \"10.1.42.102\", \"10.1.42.103\"],',`\n`,'  \"log_level\": \"DEBUG\",',`\n`,'  \"enable_syslog\": true,',`\n`,'  \"acl_enforce_version_8\": false',`\n`,\"}\",`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#consul-server-systemd-unit-file-1\",\"aria-label\":\"consul server systemd unit file permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"consul-server-systemd-unit-file-1\",\"aria-hidden\":\"\"})),\"Consul Server \",mdx(\"inlineCode\",{parentName:\"h4\"},\"systemd\"),\" Unit file\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`You have Consul binaries and a reasonably basic client agent configuration and\nnow you just need to start Consul on each of the Vault server instances. Here\nis an example `,mdx(\"inlineCode\",{parentName:\"p\"},\"systemd\"),\" unit file:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"### BEGIN INIT INFO\",`\n`,\"# Provides:          consul\",`\n`,\"# Required-Start:    $local_fs $remote_fs\",`\n`,\"# Required-Stop:     $local_fs $remote_fs\",`\n`,\"# Default-Start:     2 3 4 5\",`\n`,\"# Default-Stop:      0 1 6\",`\n`,\"# Short-Description: Consul agent\",`\n`,\"# Description:       Consul service discovery framework\",`\n`,\"### END INIT INFO\",`\n`,`\n`,\"[Unit]\",`\n`,\"Description=Consul client agent\",`\n`,\"Requires=network-online.target\",`\n`,\"After=network-online.target\",`\n`,`\n`,\"[Service]\",`\n`,\"User=consul\",`\n`,\"Group=consul\",`\n`,\"PIDFile=/var/run/consul/consul.pid\",`\n`,\"PermissionsStartOnly=true\",`\n`,\"ExecStartPre=-/bin/mkdir -p /var/run/consul\",`\n`,\"ExecStartPre=/bin/chown -R consul:consul /var/run/consul\",`\n`,\"ExecStart=/usr/local/bin/consul agent \\\\\",`\n`,\"    -config-file=/usr/local/etc/consul/client_agent.json \\\\\",`\n`,\"    -pid-file=/var/run/consul/consul.pid\",`\n`,\"ExecReload=/bin/kill -HUP $MAINPID\",`\n`,\"KillMode=process\",`\n`,\"KillSignal=SIGTERM\",`\n`,\"Restart=on-failure\",`\n`,\"RestartSec=42s\",`\n`,`\n`,\"[Install]\",`\n`,\"WantedBy=multi-user.target\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Change the following values as necessary:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"-config-file\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"-pid-file\")))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Once the unit file is defined and saved (e.g.\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"/etc/systemd/system/consul.service\"),\"), be sure to perform a \",mdx(\"inlineCode\",{parentName:\"p\"},\"systemctl daemon-reload\"),\" and then you can start your Consul service on each Vault server.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Start the Consul and verify its cluster state to be sure that the ownership and\npermissions are correct on the directory you specified for the value of\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"data_dir\"),`, and then start the Consul service on each system and verify the\nstatus:`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"$ sudo systemctl start consul\",`\n`,\"$ sudo systemctl status consul\",`\n`,\"\\u25CF consul.service - Consul client agent\",`\n`,\"   Loaded: loaded (/etc/systemd/system/consul.service; enabled; vendor preset: enabled)\",`\n`,\"   Active: active (running) since Tue 2018-03-20 19:36:49 UTC; 6s ago\",`\n`,\" Main PID: 23758 (consul)\",`\n`,\"    Tasks: 11\",`\n`,\"   Memory: 9.8M\",`\n`,\"      CPU: 571ms\",`\n`,\"   CGroup: /system.slice/consul.service\",`\n`,\"           \\u2514\\u250023758 /usr/local/bin/consul agent -config-file=/usr/local/etc/consul/client_agent.json -pid-file=/var/run/consul/consul.pid\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"After starting all Consul client agents, check the Consul cluster status:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"$consul members\",`\n`,\"Node        Address           Status  Type    Build  Protocol  DC    Segment\",`\n`,\"consul_s1   10.1.42.101:8301  alive   server  1.0.6  2         dc1   \u003call\u003e\",`\n`,\"consul_s2   10.1.42.102:8301  alive   server  1.0.6  2         dc1   \u003call\u003e\",`\n`,\"consul_s3   10.1.42.103:8301  alive   server  1.0.6  2         dc1   \u003call\u003e\",`\n`,\"consul_c1   10.1.42.201:8301  alive   client  1.0.6  2         arus  \u003cdefault\u003e\",`\n`,\"consul_c2   10.1.42.202:8301  alive   client  1.0.6  2         arus  \u003cdefault\u003e\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`The above output shows 3 Consul server agents and 2 Consul client agents in the\ncluster. Now, you are ready to configure the Vault servers.`),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step4\",\"aria-label\":\"step 4 configure the vault servers permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step4\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-configure-the-vault-servers\",\"aria-hidden\":\"\"})),\"Step 4: Configure the Vault Servers\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Now that we have a Consul cluster consisting of 3 servers and 2 client agents\nfor our Vault servers, let\\u2019s get the configuration for Vault and a startup\nscript together so that we can bootstrap the Vault HA setup.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Our Vault servers in this guide are defined by IP address only, but referenced\nby a label as well:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vault_s1: 10.1.42.201\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"vault_s2: 10.1.42.202\")))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"In our configuration file, we'll set up the following:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/configuration/listener/tcp\"}),mdx(\"strong\",{parentName:\"a\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"tcp\"))),\" listener\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/configuration/storage/consul\"}),mdx(\"strong\",{parentName:\"a\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"consul\"))),\" storage backend\"),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{href:\"/docs/configuration#high-availability-parameters\"}),\"High Availability parameters\"))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"This section assumes the Vault binary is located at \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"/usr/local/bin/vault\"))),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#vault-configuration\",\"aria-label\":\"vault configuration permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"vault-configuration\",\"aria-hidden\":\"\"})),\"Vault Configuration\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),'listener \"tcp\" {',`\n`,'  address          = \"0.0.0.0:8200\"',`\n`,'  cluster_address  = \"0.0.0.0:8201\"',`\n`,'  tls_disable      = \"true\"',`\n`,\"}\",`\n`,`\n`,'storage \"consul\" {',`\n`,'  address = \"127.0.0.1:8500\"',`\n`,'  path    = \"vault/\"',`\n`,\"}\",`\n`,`\n`,'api_addr =  \"$API_ADDR\"',`\n`,'cluster_addr = \"$CLUSTER_ADDR\"',`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"We're setting the following parameters for our \",mdx(\"inlineCode\",{parentName:\"p\"},\"tcp\"),\" listener:\"),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{id:\"address\",className:\"__target-lic\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"li\"},{href:\"#address\",\"aria-label\":\"address permalink\",className:\"__permalink-lic\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"address\")),' (string: \"127.0.0.1:8200\") \\u2013 Specifies the address to bind to for listening.'),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",e({parentName:\"li\"},{id:\"cluster_address\",className:\"__target-lic\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"li\"},{href:\"#cluster_address\",\"aria-label\":\"cluster_address permalink\",className:\"__permalink-lic\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"cluster_address\")),' (string: \"127.0.0.1:8201\") \\u2013 Specifies the address to bind to for cluster server-to-server requests. This defaults to one port higher than the value of address. This does not usually need to be set, but can be useful in case Vault servers are isolated from each other in such a way that they need to hop through a TCP load balancer or some other scheme in order to talk.')),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`This configuration allows for listening on all interfaces (such that a Vault\ncommand against the loopback address would succeed, for example).`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"We're also explicitly setting Vault's \",mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/configuration#high-availability-parameters\"}),\"HA parameters\"),\" (\",mdx(\"inlineCode\",{parentName:\"p\"},\"api_addr\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"cluster_addr\"),\"). Often, it's not necessary to configure these two parameters when using Consul as Vault's storage backend, as Consul will attempt to automatically discover and advertise the address of the active Vault node. However, certain cluster configurations might require them to be explicitly set (accessing Vault through a load balancer, for example).\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"For the sake of simplicity, we will assume that clients in our scenario connect directly to the Vault nodes (rather than through a load balancer). Review the \",mdx(\"a\",e({parentName:\"p\"},{href:\"/docs/concepts/ha#client-redirection\"}),\"Client Redirection\"),\" documentation for more information on client access patterns and their implications.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Note that some values contain variable placeholders while the rest have\nreasonable defaults. You should replace the following values in your own Vault\nserver configuration based on the example:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"\\\\$API_ADDR\"),\": Specifies the address (full URL) to advertise to other Vault servers in the cluster for client redirection. This can also be provided via the environment variable \",mdx(\"inlineCode\",{parentName:\"p\"},\"VAULT_API_ADDR\"),\". In general this should be set to a full URL that points to the value of the listener address. In our scenario, it will be \",mdx(\"inlineCode\",{parentName:\"p\"},\"http://10.1.42.201:8200\"),`\nand `,mdx(\"inlineCode\",{parentName:\"p\"},\"http://10.1.42.202:8200\"),\" respectively.\")),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"p\",e({parentName:\"li\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"\\\\$CLUSTER_ADDR\"),\": Specifies the address to advertise to other Vault servers in the cluster for request forwarding. This can also be provided via the environment variable \",mdx(\"inlineCode\",{parentName:\"p\"},\"VAULT_CLUSTER_ADDR\"),\". This is a full URL, like \",mdx(\"inlineCode\",{parentName:\"p\"},\"api_addr\"),\". In our scenario, it will be \",mdx(\"inlineCode\",{parentName:\"p\"},\"https://10.1.42.201:8201\"),` and\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"https://10.1.42.202:8201\"),\" respectively.\"))),mdx(\"blockquote\",null,mdx(\"p\",e({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`Note that the scheme here (https) is ignored; all cluster members will always\nuse TLS with a private key/certificate.`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#vault_s1-hcl-example\",\"aria-label\":\"vault_s1 hcl example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"vault_s1-hcl-example\",\"aria-hidden\":\"\"})),mdx(\"inlineCode\",{parentName:\"h4\"},\"vault_s1.hcl\"),\" Example\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),'listener \"tcp\" {',`\n`,'  address          = \"0.0.0.0:8200\"',`\n`,'  cluster_address  = \"10.1.42.201:8201\"',`\n`,'  tls_disable      = \"true\"',`\n`,\"}\",`\n`,`\n`,'storage \"consul\" {',`\n`,'  address = \"127.0.0.1:8500\"',`\n`,'  path    = \"vault/\"',`\n`,\"}\",`\n`,`\n`,'api_addr = \"http://10.1.42.201:8200\"',`\n`,'cluster_addr = \"https://10.1.42.201:8201\"',`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#vault_s2-hcl-example\",\"aria-label\":\"vault_s2 hcl example permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"vault_s2-hcl-example\",\"aria-hidden\":\"\"})),mdx(\"inlineCode\",{parentName:\"h4\"},\"vault_s2.hcl\"),\" Example\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),'listener \"tcp\" {',`\n`,'  address          = \"0.0.0.0:8200\"',`\n`,'  cluster_address  = \"10.1.42.202:8201\"',`\n`,'  tls_disable      = \"true\"',`\n`,\"}\",`\n`,`\n`,'storage \"consul\" {',`\n`,'  address = \"127.0.0.1:8500\"',`\n`,'  path    = \"vault/\"',`\n`,\"}\",`\n`,`\n`,'api_addr = \"http://10.1.42.202:8200\"',`\n`,'cluster_addr = \"https://10.1.42.202:8201\"',`\n`)),mdx(\"h4\",e({},{className:\"g-type-display-5\"}),mdx(\"a\",e({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#vault-server-systemd-unit-file\",\"aria-label\":\"vault server systemd unit file permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h4\"},{className:\"__target-h\",id:\"vault-server-systemd-unit-file\",\"aria-hidden\":\"\"})),\"Vault Server \",mdx(\"inlineCode\",{parentName:\"h4\"},\"systemd\"),\" Unit file\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`You have Vault binaries and a reasonably basic configuration along with local\nclient agents configured. Now, you just need to start Vault on each server\ninstance. Here is an example `,mdx(\"inlineCode\",{parentName:\"p\"},\"systemd\"),\" unit file:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"### BEGIN INIT INFO\",`\n`,\"# Provides:          vault\",`\n`,\"# Required-Start:    $local_fs $remote_fs\",`\n`,\"# Required-Stop:     $local_fs $remote_fs\",`\n`,\"# Default-Start:     2 3 4 5\",`\n`,\"# Default-Stop:      0 1 6\",`\n`,\"# Short-Description: Vault server\",`\n`,\"# Description:       Vault secret management tool\",`\n`,\"### END INIT INFO\",`\n`,`\n`,\"[Unit]\",`\n`,\"Description=Vault secret management tool\",`\n`,\"Requires=network-online.target\",`\n`,\"After=network-online.target\",`\n`,`\n`,\"[Service]\",`\n`,\"User=vault\",`\n`,\"Group=vault\",`\n`,\"PIDFile=/var/run/vault/vault.pid\",`\n`,\"ExecStart=/usr/local/bin/vault server -config=/etc/vault/vault_server.hcl -log-level=debug\",`\n`,\"ExecReload=/bin/kill -HUP $MAINPID\",`\n`,\"KillMode=process\",`\n`,\"KillSignal=SIGTERM\",`\n`,\"Restart=on-failure\",`\n`,\"RestartSec=42s\",`\n`,\"LimitMEMLOCK=infinity\",`\n`,`\n`,\"[Install]\",`\n`,\"WantedBy=multi-user.target\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Note that you might be interested in changing the values of the following\ndepending on style, file system hierarchy standard adherence level, and so on:`),mdx(\"ul\",null,mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"-config\"))),mdx(\"li\",e({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"-log-level\")))),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Once the unit file is defined and saved as e.g.\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"/etc/systemd/system/vault.service\"),\", be sure to perform a \",mdx(\"inlineCode\",{parentName:\"p\"},\"systemctl daemon-reload\"),`\nand then you can start your Vault service on each server.`),mdx(\"h3\",e({},{className:\"g-type-display-4\"}),mdx(\"a\",e({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step5\",\"aria-label\":\"step 5 start vault and verify the state permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step5\",\"aria-hidden\":\"\"})),mdx(\"a\",e({parentName:\"h3\"},{className:\"__target-h\",id:\"step-5-start-vault-and-verify-the-state\",\"aria-hidden\":\"\"})),\"Step 5: Start Vault and Verify the State\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Start the Vault service on each system and verify the status:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"$ sudo systemctl start vault\",`\n`,\"$ sudo systemctl status vault\",`\n`,\"\\u25CF vault.service - Vault secret management tool\",`\n`,\"   Loaded: loaded (/etc/systemd/system/vault.service; enabled; vendor preset: enabled)\",`\n`,\"   Active: active (running) since Tue 2018-03-20 20:42:10 UTC; 42s ago\",`\n`,\" Main PID: 2080 (vault)\",`\n`,\"    Tasks: 12\",`\n`,\"   Memory: 71.7M\",`\n`,\"      CPU: 50s\",`\n`,\"   CGroup: /system.slice/vault.service\",`\n`,\"           \\u2514\\u25002080 /usr/local/bin/vault server -config=/home/ubuntu/vault_nano/config/vault_server.hcl -log-level=debu\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Now you\\u2019ll need to move on to \",mdx(\"a\",e({parentName:\"p\"},{href:\"/intro/getting-started/deploy#initializing-the-vault\"}),`initializing and\nunsealing`),` each Vault\ninstance.`),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Once that is done, check Vault status on each of the servers.\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The \",mdx(\"strong\",{parentName:\"p\"},\"active\"),\" Vault server:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"$ vault status\",`\n`,\"Key             Value\",`\n`,\"---             -----\",`\n`,\"Seal Type       shamir\",`\n`,\"Sealed          false\",`\n`,\"Total Shares    5\",`\n`,\"Threshold       3\",`\n`,\"Version         0.9.5\",`\n`,\"Cluster Name    vault\",`\n`,\"Cluster ID      0ee91bd1-55ec-c84f-3c1d-dcc7f4f644a8\",`\n`,\"HA Enabled      true\",`\n`,\"HA Cluster      https://10.1.42.201:8201\",`\n`,\"HA Mode         active\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"The \",mdx(\"strong\",{parentName:\"p\"},\"standby\"),\" Vault server:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),\"vault status\",`\n`,\"Key                     Value\",`\n`,\"---                     -----\",`\n`,\"Seal Type               shamir\",`\n`,\"Sealed                  false\",`\n`,\"Total Shares            5\",`\n`,\"Threshold               3\",`\n`,\"Version                 0.9.5\",`\n`,\"Cluster Name            vaultron\",`\n`,\"Cluster ID              0ee91bd1-55ec-c84f-3c1d-dcc7f4f644a8\",`\n`,\"HA Enabled              true\",`\n`,\"HA Cluster              https://10.1.42.201:8201\",`\n`,\"HA Mode                 standby\",`\n`,\"Active Node Address:    http://10.1.42.201:8200\",`\n`)),mdx(\"p\",e({},{className:\"g-type-long-body\"}),`Vault servers are now operational in HA mode at this point, and you should be\nable to write a secret from either the active or the standby Vault instance and\nsee it succeed as a test of request forwarding. Also, you can shut down the\nactive instance (`,mdx(\"inlineCode\",{parentName:\"p\"},\"sudo systemctl stop vault\"),`) to simulate a system failure and\nsee the standby instance assumes the leadership.`),mdx(\"h2\",e({},{className:\"g-type-display-3\"}),mdx(\"a\",e({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",e({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next steps\"),mdx(\"p\",e({},{className:\"g-type-long-body\"}),\"Read \",mdx(\"a\",e({parentName:\"p\"},{href:\"/guides/operations/production\"}),\"Production Hardening\"),` to learn best\npractices for a production hardening deployment of Vault.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying \u0026 Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup \u0026 Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities \u0026 Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true},"page":"/guides/[[...page]]","query":{"page":["operations","vault-ha-consul"]},"buildId":"pcCu12fyWK7PoQNj4BZ7-","assetPrefix":"/docs/vault_v1.8.x","isFallback":false,"gsp":true}</script><script nomodule="" src="/docs/vault_v1.8.x/_next/static/chunks/polyfills-e4c38ea28892f36667af.js"></script><script src="/docs/vault_v1.8.x/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/framework.3519294afa6a9ab53973.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/2bc72d9a08d5bd816ae6b580871df9fb671d43bb.52fd5ef7a8ab7d8fc0dd.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/9a5be27b89b50ff891e514a88cd42f143404f9a6.033857d62f5a01edf3b3.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/main-b0f1f3f8bd3bddd4e6cd.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/b49b08e2da573413c730dfc51ae423f080a0c275.00ac32ee45240d5b343f.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/b1542cc239bf56c8a14913c0a930efe682b5cf86.32bb900ad80311488529.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/pages/_app-d714c55ad24af91621ba.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/7dbdcaca29374b13a0799a901e26613767d72de2.d088888a4a1113f2bb24.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/92f0085e0e6c1f10382de10b8861ce89d7c192a2.e5495ede8461fc33ed98.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b.5052eda5c7f43583669b.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b_CSS.f6584926f1188e1b5b3e.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/pages/guides/%5B%5B...page%5D%5D-72f9db6e509b49c776de.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/pcCu12fyWK7PoQNj4BZ7-/_buildManifest.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/pcCu12fyWK7PoQNj4BZ7-/_ssgManifest.js" async=""></script><script nomodule="">window.MSInputMethodContext && document.documentMode && document.write('<script src="/ie-custom-properties.js"><\x2fscript>');</script></body></html>