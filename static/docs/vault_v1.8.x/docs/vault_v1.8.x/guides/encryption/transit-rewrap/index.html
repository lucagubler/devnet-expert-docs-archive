<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta property="og:image" content="https://www.vaultproject.io/img/og-image.png"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=16&amp;w=16" type="image/png" sizes="16x16" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=32&amp;w=32" type="image/png" sizes="32x32" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=96&amp;w=96" type="image/png" sizes="96x96" rel="icon"/><link href="https://www.datocms-assets.com/2885/1597163356-vault-favicon.png?h=192&amp;w=192" type="image/png" sizes="192x192" rel="icon"/><title>Transit Secrets Re-wrapping - Guides | Vault by HashiCorp</title><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta property="article:publisher" content="https://www.facebook.com/HashiCorp/"/><meta name="twitter:site" content="@HashiCorp"/><meta name="twitter:card" content="summary_large_image"/><meta name="theme-color" content="#000"/><meta name="description" property="og:description" content="The goal of this guide is to demonstrate one possible way to re-wrap data after
rotating an encryption key in the transit engine in Vault."/><meta property="og:site_name" content="Vault by HashiCorp"/><meta name="next-head-count" content="17"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/css/7246d51e322c1bb7fa92.css" as="style"/><link rel="stylesheet" href="/docs/vault_v1.8.x/_next/static/css/7246d51e322c1bb7fa92.css" data-n-g=""/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/css/fbe3b6b5804634e8fb99.css" as="style"/><link rel="stylesheet" href="/docs/vault_v1.8.x/_next/static/css/fbe3b6b5804634e8fb99.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/framework.3519294afa6a9ab53973.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/2bc72d9a08d5bd816ae6b580871df9fb671d43bb.52fd5ef7a8ab7d8fc0dd.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/9a5be27b89b50ff891e514a88cd42f143404f9a6.033857d62f5a01edf3b3.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/main-b0f1f3f8bd3bddd4e6cd.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/b49b08e2da573413c730dfc51ae423f080a0c275.00ac32ee45240d5b343f.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/b1542cc239bf56c8a14913c0a930efe682b5cf86.32bb900ad80311488529.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/pages/_app-d714c55ad24af91621ba.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/7dbdcaca29374b13a0799a901e26613767d72de2.d088888a4a1113f2bb24.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/92f0085e0e6c1f10382de10b8861ce89d7c192a2.e5495ede8461fc33ed98.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b.5052eda5c7f43583669b.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b_CSS.f6584926f1188e1b5b3e.js" as="script"/><link rel="preload" href="/docs/vault_v1.8.x/_next/static/chunks/pages/guides/%5B%5B...page%5D%5D-72f9db6e509b49c776de.js" as="script"/></head><body><div id="__next"><div class="g-alert-banner style_vault__1OYha show themed"><a href="https://hashiconf.com/europe" class="link"><span class="g-grid-container has-large-tag"><span class="tag g-type-body-small-x-strong">Thank you</span><span class="text g-type-body-small has-large-tag">HashiConf Europe is a wrap. Watch this year’s sessions on-demand.<!-- --> <span class="link-text g-type-body-small-x-strong">Watch Now</span></span></span></a><button class="close"><div><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 5L5 15M5 5l10 10" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><span class="visually-hidden">Dismiss alert</span></button></div><header class="hashi-stack-menu_hashiStackMenu__2dCgY"><nav class="hashi-stack-menu_nav__3DnqS g-grid-container" aria-label="Primary HashiCorp website navigation"><a aria-label="To main HashiCorp website" href="https://www.hashicorp.com/" class="hashi-stack-menu_logoLink__2cbDW"><div data-testid="root"><svg width="317" height="88" viewBox="0 0 317 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M107.692 64.421V47.4h-14.97v17.02h-7.623V24.06h7.622v16.602h14.971V24.06h7.622v40.36h-7.622zm35.567-.001h-6.053l-.548-1.996a16.137 16.137 0 01-8.789 2.607c-5.397 0-7.699-3.697-7.699-8.79 0-5.998 2.607-8.3 8.606-8.3h7.089v-3.095c0-3.27-.907-4.421-5.633-4.421a41.255 41.255 0 00-8.179.877l-.907-5.634a38.496 38.496 0 0110.122-1.395c9.269 0 11.998 3.27 11.998 10.672l-.007 19.476zm-7.394-11.151h-5.45c-2.424 0-3.087.663-3.087 2.912 0 2.058.663 2.973 2.972 2.973a11.629 11.629 0 005.572-1.525l-.007-4.36zm21.701 11.754a34.776 34.776 0 01-10.183-1.7l1.029-5.633a33.038 33.038 0 008.788 1.273c3.271 0 3.758-.762 3.758-2.973 0-1.814-.366-2.729-5.152-3.88-7.211-1.76-8.058-3.575-8.058-9.269 0-5.938 2.607-8.545 11.03-8.545 2.98.003 5.949.348 8.85 1.03l-.762 5.876a51.98 51.98 0 00-8.118-.846c-3.209 0-3.758.763-3.758 2.546 0 2.363.183 2.546 4.185 3.575 8.263 2.188 9.055 3.278 9.055 9.307 0 5.725-1.761 9.239-10.664 9.239zm32.663-.602V43.84c0-1.578-.663-2.363-2.363-2.363-1.814 0-5.031 1.09-7.699 2.485v20.459h-7.394V22.847l7.394-1.029v15.33a26.045 26.045 0 0110.786-2.852c4.909 0 6.662 3.453 6.662 8.728v21.397h-7.386zm12.844-33.692v-8.545h7.394v8.545h-7.394zm0 33.692V34.906h7.394v29.515h-7.394zM215.62 35.15c0-7.394 4.299-11.693 14.361-11.693 3.697 0 7.38.447 10.969 1.334l-.839 6.601a59.517 59.517 0 00-9.909-1.029c-5.275 0-6.967 1.822-6.967 6.098v15.512c0 4.3 1.7 6.098 6.967 6.098a59.506 59.506 0 009.909-1.029l.846 6.609a45.672 45.672 0 01-10.968 1.334c-10.062 0-14.361-4.3-14.361-11.693l-.008-18.142zm40.499 29.873c-10.123 0-12.844-5.572-12.844-11.632v-7.455c0-6.06 2.728-11.632 12.844-11.632 10.115 0 12.844 5.572 12.844 11.632v7.455c-.023 6.06-2.744 11.632-12.844 11.632zm0-24.392c-3.941 0-5.45 1.76-5.45 5.092v7.912c0 3.331 1.524 5.092 5.45 5.092 3.925 0 5.45-1.76 5.45-5.092v-7.943c-.015-3.33-1.532-5.092-5.45-5.092v.03zm32.457.457a57.835 57.835 0 00-7.821 4.3v19.056h-7.394V34.906h6.243l.488 3.27a33.064 33.064 0 017.76-3.88l.724 6.792zm28.035 13.515c0 6.548-2.911 10.42-9.756 10.42a40.76 40.76 0 01-7.882-.853v12.196l-7.394 1.029V34.906h5.877l.762 2.485a15.535 15.535 0 019.33-3.087c5.938 0 9.086 3.514 9.086 10.245l-.023 10.054zm-17.631 3.331c2.152.474 4.346.73 6.548.763 2.668 0 3.697-1.274 3.697-3.941V44.35c0-2.424-.907-3.758-3.636-3.758a10.46 10.46 0 00-6.609 2.668v14.673zM29.134 7L0 23.808v40.361l10.946 6.32V30.127l18.188-10.504V7z" fill="#000"/><path d="M40.758 7v32.144H29.133V27.147l-10.945 6.319V74.65l10.946 6.335V48.932h11.624v11.914l10.946-6.312V13.32L40.758 7z" fill="#000"/><path d="M40.758 81L69.89 64.192V23.831l-10.946-6.32v40.362L40.758 68.377V81z" fill="#000"/></svg></div></a><ul class="hashi-stack-menu_menu__33a9r"><li class="nav-item_navItem__KPnS0"><button type="button" class="nav-item_buttonReset__WeJA7 nav-item_link__1827H g-type-body-small-strong ">Browse Products<span class="nav-item_visuallyHidden__20aYI">Open this menu</span><img class="nav-item_dropdownCarat__2xha-" alt="" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iNyIgdmlld0JveD0iMCAwIDEwIDciIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTguMDUzIDJsLTMgMy4wMDYtMy0zLjAwNiIgc3Ryb2tlPSJ2YXIoLS1ncmF5LTMpIiBzdHJva2Utd2lkdGg9IjEuMjUiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiLz48L3N2Zz4="/></button><section class="browse-panel_browsePanel__1AT8q "><menu class="stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Infrastructure</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.terraform.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M55.522 32.97l32.96 19.02v38.06l-32.96-19.03V32.97zM92.09 51.99v38.06l32.95-19.03V32.97L92.09 51.99zM18.96 11.73v38.05l32.95 19.03V30.76L18.96 11.73zm36.562 101.51l32.95 19.03V94.22l-32.95-19.03v38.05z" fill="#7B42BC"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">terraform</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.packer.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M35.09 26.38L74.22 49v83.38l-39.13-22.62V26.38z" fill="#02A8EF"/><path d="M93.6 36.13L51.06 11.62v17L80 45.34v51.05l13.61 7.82c8.421 4.86 15.311 2 15.311-6.47V60.28c-.01-8.42-6.92-19.28-15.32-24.15z" fill="#02A8EF"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">packer</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.vagrantup.com" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M110.77 17.55L86.68 31.46V40L72 74.52 57.32 40v-8.54L33.23 17.55l-14.65 8.47v9.83l32.63 79.92 20.79 12 20.79-12 32.63-79.92v-9.83l-14.65-8.47z" fill="#0E67ED"/><path d="M125.42 26.02l-24.09 13.9v8.55L81.77 92.19 72 97.83v29.94l20.79-12 32.63-79.92v-9.83zM57.32 40v-8.54l-14.66 8.46v8.55l19.57 43.72L72 86.55V74.52L57.32 40z" fill="#0850C5"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vagrant</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Networking</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.consul.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72.53 128.7a54.787 54.787 0 01-45.258-23.85 54.784 54.784 0 019.368-72.355 54.78 54.78 0 0172.95 1.125l-13 13.6a36 36 0 100 53.43l13 13.6a54.638 54.638 0 01-37.06 14.45zm44.081-27.401a4.49 4.49 0 114.49-4.49 4.5 4.5 0 01-4.49 4.49z" fill="#E03875"/><path d="M72.18 85.79A11.87 11.87 0 1184 73.93a11.88 11.88 0 01-11.82 11.86zm49.58.21a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.495 4.495 0 012.772 4.148 4.503 4.503 0 01-4.49 4.49zm-13.35-.56a4.488 4.488 0 01-4.4-5.385 4.487 4.487 0 013.555-3.515 4.49 4.49 0 11.845 8.9zm13.35-14.57a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.496 4.496 0 012.772 4.149 4.503 4.503 0 01-4.49 4.49zm-13.35.51a4.493 4.493 0 01-4.148-2.772 4.491 4.491 0 114.148 2.771zm8.461-15.61a4.49 4.49 0 11-.02-8.981 4.49 4.49 0 01.02 8.981z" fill="#E03875"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">consul</span></a></li></ul></li></menu><menu class="stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Security</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.vaultproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.88 21.15L71.8 131.4l55.321-110.25H16.881zm61.46 22.12h6.39v6.4h-6.39v-6.4zM65.61 68.84h-6.39v-6.39h6.39v6.39zm0-9.59h-6.39v-6.39h6.39v6.39zm0-9.58h-6.39v-6.4h6.39v6.4zm9.59 28.76h-6.4V72h6.4v6.43zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.58h-6.4v-6.4h6.4v6.4zm3.14 3.19h6.39v6.39h-6.39v-6.39zm0 16v-6.41h6.39v6.39l-6.39.02z" fill="#000"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vault</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.boundaryproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M44.83 125.83v-8.27h17.18v-5.11h-8.33v-8.32h39.33L74.74 72.49l18.27-31.65H52.7v43.89H31V19.15h74.67l12.46 21.58L99.8 72.49l18.7 32.4-12.09 20.94H44.83z" fill="#F24C53"/><path d="M48.17 104.131h-8.32v8.32h8.32v-8.32zM39.32 117.5H31v8.32h8.32v-8.32z" fill="#F24C53"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">boundary</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Applications</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://www.nomadproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72 14L21.77 43v58L72 130l50.23-29V43L72 14zm22.38 63.78L81 85.51l-16.17-8.8v18.48l-15.2 9.64V66.19l12.06-7.38 16.73 8.82V48.76l16-9.59-.04 38.61z" fill="#00CA8E"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">nomad</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://www.waypointproject.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M143.228 27.66l-17.79 30.81-17.79-30.81h35.58zM48.26 48.23H36.39l29.67 51.4-11.87 20.56L.77 27.66h59.36l29.68 51.41 5.93-10.28L72 27.66h23.74l11.88 20.57 11.87 20.56-29.68 51.4-41.55-71.96z" fill="#14C6CB"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">waypoint</span></a></li></ul></li></menu><menu class="stack-menu-section_stackMenuSectionPlusDivider__1BPy6 stack-menu-section_stackMenuSection__2j2KK"><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">HashiCorp Cloud Platform</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a href="https://cloud.hashicorp.com/" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M72.53 128.7a54.787 54.787 0 01-45.258-23.85 54.784 54.784 0 019.368-72.355 54.78 54.78 0 0172.95 1.125l-13 13.6a36 36 0 100 53.43l13 13.6a54.638 54.638 0 01-37.06 14.45zm44.081-27.401a4.49 4.49 0 114.49-4.49 4.5 4.5 0 01-4.49 4.49z" fill="#E03875"/><path d="M72.18 85.79A11.87 11.87 0 1184 73.93a11.88 11.88 0 01-11.82 11.86zm49.58.21a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.495 4.495 0 012.772 4.148 4.503 4.503 0 01-4.49 4.49zm-13.35-.56a4.488 4.488 0 01-4.4-5.385 4.487 4.487 0 013.555-3.515 4.49 4.49 0 11.845 8.9zm13.35-14.57a4.488 4.488 0 01-4.404-5.366 4.488 4.488 0 016.122-3.273 4.496 4.496 0 012.772 4.149 4.503 4.503 0 01-4.49 4.49zm-13.35.51a4.493 4.493 0 01-4.148-2.772 4.491 4.491 0 114.148 2.771zm8.461-15.61a4.49 4.49 0 11-.02-8.981 4.49 4.49 0 01.02 8.981z" fill="#E03875"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">consul</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://app.terraform.io" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M55.522 32.97l32.96 19.02v38.06l-32.96-19.03V32.97zM92.09 51.99v38.06l32.95-19.03V32.97L92.09 51.99zM18.96 11.73v38.05l32.95 19.03V30.76L18.96 11.73zm36.562 101.51l32.95 19.03V94.22l-32.95-19.03v38.05z" fill="#7B42BC"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">terraform</span></a></li><li class="stack-item_stackItem__L41b6"><a href="https://cloud.hashicorp.com/" class="stack-item_itemLink__G2Qmk"><div data-testid="root" class="stack-item_productIcon__1pF_i"><svg width="144" height="144" viewBox="0 0 144 144" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.88 21.15L71.8 131.4l55.321-110.25H16.881zm61.46 22.12h6.39v6.4h-6.39v-6.4zM65.61 68.84h-6.39v-6.39h6.39v6.39zm0-9.59h-6.39v-6.39h6.39v6.39zm0-9.58h-6.39v-6.4h6.39v6.4zm9.59 28.76h-6.4V72h6.4v6.43zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.59h-6.4v-6.39h6.4v6.39zm0-9.58h-6.4v-6.4h6.4v6.4zm3.14 3.19h6.39v6.39h-6.39v-6.39zm0 16v-6.41h6.39v6.39l-6.39.02z" fill="#000"/></svg></div><span class="stack-item_productName__1lhye stack-item_itemName__1cUxR g-type-body-small-strong">vault</span></a></li></ul></li><li class="stack-group_stackGroup__SM4W1"><h5 class="stack-group_stackGroupHeading__U-K-0 g-type-display-6">Partner Services</h5><ul class="stack-group_stackGroupLinkList__4RMZ6"><li class="stack-item_stackItem__L41b6"><a class="stack-item_itemLink__G2Qmk" href="https://www.hashicorp.com/products/consul/service-on-azure"><span class="stack-item_itemName__1cUxR g-type-body-small-strong">HashiCorp Consul Service (HCS) on Azure</span></a></li></ul></li></menu></section></li></ul></nav></header><nav class="g-subnav" aria-label="vault website navigation"><div class="constrain-width-wrapper  g-grid-container"><div class="g-subnav-inner style_vault__1OYha is-constrained" data-overflow-target="true"><a href="/" data-testid="a-raw" class="title-link brand-vault " title="vault"><div data-testid="root"><svg width="208" height="88" viewBox="0 0 208 88" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M114.849 23.69h7.92L110.699 64h-11.25l-12-40.28h7.92l9.74 33.57 9.74-33.6zM144.75 64h-6l-.55-2a16.12 16.12 0 01-8.77 2.6c-5.38 0-7.68-3.69-7.68-8.77 0-6 2.6-8.29 8.59-8.29h7.08v-3.1c0-3.27-.91-4.42-5.63-4.42a40.71 40.71 0 00-8.16.91l-.91-5.63a38.678 38.678 0 0110.1-1.39c9.25 0 12 3.27 12 10.65L144.75 64zm-7.37-11.13h-5.45c-2.42 0-3.08.67-3.08 2.91 0 2 .66 3 3 3a11.72 11.72 0 005.57-1.51l-.04-4.4zm18.992-18.35v20.56c0 1.57.66 2.36 2.36 2.36 1.7 0 5-1.09 7.68-2.48V34.52h7.38V64h-5.63l-.72-2.48a29.437 29.437 0 01-11.8 3.09c-4.9 0-6.65-3.45-6.65-8.71V34.52h7.38zM177.719 64V22.48l7.38-1V64h-7.38zm29.388-.57a20.618 20.618 0 01-6.47 1.15c-5.38 0-8.11-2.54-8.11-7.8v-16.4h-4.41v-5.86h4.41V27.2l7.38-1v8.35h7.56l-.48 5.86h-7.08v15.4a2.323 2.323 0 001.596 2.514c.344.11.708.14 1.064.085a13.919 13.919 0 003.69-.61l.85 5.63zM0 12.6l31.85 63.92L63.92 12.6H0zm35.63 12.83h3.71v3.71h-3.71v-3.71zm-7.38 14.82h-3.7v-3.7h3.7v3.7zm0-5.56h-3.7V31h3.7v3.69zm0-5.55h-3.7v-3.71h3.7v3.71zm5.6 16.67h-3.7V42.1h3.7v3.71zm0-5.56h-3.7v-3.7h3.7v3.7zm0-5.56h-3.7V31h3.7v3.69zm0-5.55h-3.7v-3.71h3.7v3.71zM35.63 31h3.71v3.7h-3.71V31zm0 9.26v-3.7h3.71v3.7h-3.71z" fill="#000"/></svg></div></a><ul class="menu-items-default menu-items-align-right"><li><a href="/" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Overview</span></a></li><li><button class="dropdown-trigger g-type-body-small-strong brand-vault style-menu-item is-collapsed"><span class="text brand-vault">Use Cases</span><div data-testid="root"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9l6 6 6-6" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></button><ul class="submenu-modal style-dropdown is-collapsed"><li><a href="/use-cases/secrets-management" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Secrets Management</span></a></li><li><a href="/use-cases/data-encryption" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Data Encryption</span></a></li><li><a href="/use-cases/identity-based-access" data-testid="a-raw" class="g-type-body-small-strong style-menu-item"><span class="text brand-vault">Identity-based Access</span></a></li></ul></li><li><a href="https://www.hashicorp.com/products/vault/enterprise" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Enterprise</span></a></li><li><span class="vertical-divider"></span></li><li><a href="https://learn.hashicorp.com/vault" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Tutorials</span></a></li><li><a href="/docs" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Docs</span></a></li><li><a href="/api-docs" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">API</span></a></li><li><a href="/community" data-testid="a-raw" class="nav-link g-type-body-small-strong style-menu-item "><span class="text brand-vault ">Community</span></a></li></ul><div class="cta-links "><a href="https://www.github.com/hashicorp/vault" class="github-button"><span class="github"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg><span class="hidden-text">GitHub</span></span></a><a class="g-btn size-small variant-secondary style_vault__1OYha background-light" data-ga-button="try-cloud" href="https://portal.cloud.hashicorp.com/sign-up?utm_source=vault_io&amp;utm_content=top_nav_vault"><span class="text g-type-buttons-and-standalone-links">Try Cloud</span></a><a class="g-btn size-small variant-primary style_vault__1OYha background-light" data-ga-button="download" href="/downloads"><span class="icon at-left is-animated" data-animation="download"><div data-testid="root"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Download icon</title><path d="M3 17v3a2 2 0 002 2h14a2 2 0 002-2v-3" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path data-animation-target="true" d="M8 12l4 4m0 0l4-4m-4 4V2" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></span><span class="text g-type-buttons-and-standalone-links">Download</span></a></div></div></div></nav><div id="p-docs"><div class="content-wrap g-grid-container"><div id="sidebar" role="complementary"><div class="nav docs-nav"><div class="g-docs-sidenav style_root__-H22M style_vault__1OYha"><button class="style_mobileMenuToggle__2iMJX g-type-body-small-strong"><span><div><svg width="20" height="20" fill="none"><path fill="#000" fill-rule="evenodd" d="M3.083 14.411a.847.847 0 00-.267-.183.863.863 0 00-.483-.042c-.05.008-.109.025-.159.042a1.245 1.245 0 00-.266.183 1.01 1.01 0 00-.184.267.864.864 0 00-.058.325c0 .05 0 .108.017.158a.88.88 0 00.041.159c.025.05.05.1.084.141.025.05.066.092.1.125.041.042.082.075.125.108.05.025.091.059.141.075.05.017.109.034.159.05.058.009.107.017.166.017a.829.829 0 00.584-.25.534.534 0 00.108-.125c.025-.042.058-.091.075-.142.025-.05.042-.1.05-.158a1.06 1.06 0 00.017-.158.872.872 0 00-.067-.325.729.729 0 00-.183-.267zm0-5a.846.846 0 00-.267-.183.863.863 0 00-.483-.042 1.11 1.11 0 00-.159.042 1.252 1.252 0 00-.266.183.821.821 0 00-.242.592c0 .108.017.216.058.316a1.01 1.01 0 00.309.375c.05.025.091.05.141.075.05.017.109.034.159.05.058.009.107.017.166.017a.829.829 0 00.584-.25.83.83 0 00.25-.583.871.871 0 00-.067-.325.729.729 0 00-.183-.267zm0-5a.795.795 0 00-.75-.225 1.11 1.11 0 00-.159.042 1.255 1.255 0 00-.266.183.835.835 0 00-.242.592c0 .108.017.217.058.317a1.01 1.01 0 00.309.375c.05.025.091.05.141.075.05.016.109.033.159.05.058.008.107.016.166.016a.83.83 0 00.584-.25.83.83 0 00.25-.583.906.906 0 00-.067-.325.729.729 0 00-.183-.267zm14.414 9.756H6.663a.833.833 0 100 1.667h10.834a.833.833 0 100-1.667zm0-5H6.663a.833.833 0 100 1.667h10.834a.833.833 0 100-1.667zM18.33 5c0 .46-.372.834-.833.834H6.663a.833.833 0 110-1.667h10.834c.46 0 .833.372.833.833z" clip-rule="evenodd"/></svg></div> Documentation Menu</span></button><button type="button" aria-label="Show Search Bar" class="style_searchToggle__226HK"><div><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8.75 15a6.25 6.25 0 100-12.5 6.25 6.25 0 000 12.5z" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.5 17.5l-4.333-4.333" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></button><ul class="style_rootList__1pfEP" data-is-mobile-hidden="true" data-is-mobile-open="false"><button class="style_mobileClose__3BcsD">×</button><input class="style_filterInput__4ecGq" placeholder="Filter..." value=""/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/getting-started/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Getting Started</span></a></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Vault Operations</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/reference-architecture/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Reference Architecture</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/vault-ha-consul/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault HA with Consul</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/production/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Production Hardening</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/generate-root/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Root Token Generation</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/rekeying-and-rotating/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Rekeying & Rotating</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/plugin-backends/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Building Plugin Backends</span></a></li><hr class="style_divider__3H9xA"/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/replication/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Replication Setup & Guidance</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/disaster-recovery/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Disaster Recovery Setup</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/mount-filter/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Mount Filter</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/multi-tenant/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Multi-Tenant: Namespaces</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/autounseal-aws-kms/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Auto-unseal with AWS KMS</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/seal-wrap/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Seal Wrap / FIPS 140-2</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/monitoring/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Cluster Monitoring</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/deployment-guide/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Vault Deployment Guide</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/operations/performance-nodes/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Performance Standby Nodes</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Identity and Access Management</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/secure-intro/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Secure Introduction of Vault Clients</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/policies/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Policies</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/policy-templating/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>ACL Policy Path Templating</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/authentication/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>AppRole Pull Authentication</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/approle-trusted-entities/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>AppRole with Terraform and Chef</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/lease/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Tokens and Leases</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/identity/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Identity - Entities & Groups</span></a></li><hr class="style_divider__3H9xA"/><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/sentinel/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Sentinel Policies</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/identity/control-groups/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Control Groups</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Secrets Management</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/static-secrets/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Static Secrets</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/versioned-kv/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Versioned KV Secret Engine</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/dynamic-secrets/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Secret as a Service</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/db-root-rotation/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>DB Root Credential Rotation</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/cubbyhole/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Cubbyhole Response Wrapping</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/ssh-otp/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>One-Time SSH Password</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/pki-engine/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Build Your Own CA</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/secret-mgmt/app-integration/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Direct Application Integration</span></a></li></ul></li><li class=""><button class="style_navItem__1tCRc" data-is-open="false"><div class="style_navBranchIcon__-utfM style_navItemIcon__1KWKp" data-is-open="false"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.865.661a.498.498 0 10-.704.703l2.636 2.638L2.16 6.639a.498.498 0 10.704.704l2.989-2.989a.498.498 0 000-.705L2.864.66v.001z" fill="#000"/></svg></div><span>Encryption as a Service</span></button><ul class="style_navBranchSubnav__38wnh" data-is-open="false"><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Overview</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/transit/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Encryption as a Service</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/spring-demo/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Java Application Demo</span></a></li><li class=""><a class="style_navItem__1tCRc" href="/docs/vault_v1.8.x/guides/encryption/transit-rewrap/"><div class="style_navLeafIcon__49SuP style_navItemIcon__1KWKp"><svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="2" fill="#000"/></svg></div><span>Transit Secrets Re-wrapping</span></a></li></ul></li></ul></div></div></div><div id="inner" role="main" class=""><article class="g-content g-type-long-body style_vault__1OYha"><div class="g-search"><label id="search-box-label" for="search-box" class="visually-hidden">Search Vault documentation</label><div class="c-search-box"><form novalidate="" action="" role="search"><input type="search" id="search-box" class="g-type-body-strong" placeholder="Search Vault documentation" autoComplete="off" autoCorrect="off" autoCapitalize="off" spellcheck="false" maxLength="512" required="" value="" aria-autocomplete="list" aria-controls="search-results" aria-activedescendant="" data-heap-track="SearchBox"/><button type="submit" title="Submit your search query." class="btn-submit"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8.75 15a6.25 6.25 0 100-12.5 6.25 6.25 0 000 12.5z" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.5 17.5l-4.333-4.333" stroke="var(--gray-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button><button type="reset" title="Clear the search query." class="btn-reset"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.915 1.077h13.684v13.684H1.915z"/><path d="M1.915 1.077l13.683 13.684M1.915 14.76L15.598 1.078" stroke="var(--gray-3)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><div class="icon-loading"><svg width="18" height="18" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#444"><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".5" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18" transform="rotate(296.263 18 18)"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform></path></g></g></svg></div><svg class="icon-slash" width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img"><title>Type &#x27;/&#x27; to Search</title><rect x=".5" y=".5" width="23" height="23" rx=".5" stroke="var(--gray-3)"></rect><path d="M9 18l6-12" stroke="var(--gray-3)" stroke-width="1.5"></path></svg></form></div></div><h1 class="g-type-display-2"><a class="__permalink-h" href="#transit-secrets-engine" aria-label="transit secrets engine permalink">»</a><a class="__target-h" id="transit-secrets-engine" aria-hidden=""></a>Transit Secrets Engine</h1><p class="g-type-long-body">In addition to being able to store secrets, Vault can encrypt/decrypt data that
is stored elsewhere. The primary use of this is to allow applications to encrypt
their data while still storing it in their primary data store. Vault does not
store the data.</p><p class="g-type-long-body">The <a href="/docs/secrets/transit"><code>transit</code> secret engine</a> handles
cryptographic functions on data-in-transit, and often referred to as
<strong><em>Encryption as a Service</em></strong> (EaaS). Both small amounts of arbitrary data, and
large files such as images, can be protected with the transit engine. This EaaS
function can augment or eliminate the need for Transparent Data Encryption (TDE)
with databases to encrypt the contents of a bucket, volume, and disk, etc.</p><p class="g-type-long-body"><img src="/img/vault-encryption.png" alt="Encryption as a Service"/></p><h2 class="g-type-display-3"><a class="__permalink-h" href="#encryption-key-rotation" aria-label="encryption key rotation permalink">»</a><a class="__target-h" id="encryption-key-rotation" aria-hidden=""></a>Encryption Key Rotation</h2><p class="g-type-long-body">One of the benefits of using the Vault EaaS is its ability to easily rotate the
encryption keys. Keys can be rotated manually by a human, or an automated
process which invokes the key rotation API endpoint through <code>cron</code>, a CI
pipeline, a periodic Nomad batch job, Kubernetes Job, etc.</p><p class="g-type-long-body">The goal of this guide is to demonstrate an example for re-wrapping data after
rotating an encryption key in the transit engine in Vault.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#reference-material" aria-label="reference material permalink">»</a><a class="__target-h" id="reference-material" aria-hidden=""></a>Reference Material</h2><ul><li class="g-type-long-body"><a href="/guides/encryption/transit">Encryption as a Service</a></li><li class="g-type-long-body"><a href="/docs/secrets/transit">Transit Secret Engine</a></li><li class="g-type-long-body"><a href="/api/secret/transit">Transit Secret Engine API</a></li><li class="g-type-long-body"><a href="https://www.hashicorp.com/blog/transparent-data-encryption-in-the-modern-datacenter">Transparent Data Encryption in the Modern Datacenter</a></li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#estimated-time-to-complete" aria-label="estimated time to complete permalink">»</a><a class="__target-h" id="estimated-time-to-complete" aria-hidden=""></a>Estimated Time to Complete</h2><p class="g-type-long-body">30 minutes</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#personas" aria-label="personas permalink">»</a><a class="__target-h" id="personas" aria-hidden=""></a>Personas</h2><p class="g-type-long-body">The end-to-end scenario described in this guide involves two personas:</p><ul><li class="g-type-long-body"><strong>security engineer</strong> with privileged permissions to manage the encryption keys</li><li class="g-type-long-body"><strong>app</strong> with un-privileged permissions rewraps secrets via API</li></ul><h2 class="g-type-display-3"><a class="__permalink-h" href="#challenge" aria-label="challenge permalink">»</a><a class="__target-h" id="challenge" aria-hidden=""></a>Challenge</h2><p class="g-type-long-body">Vault maintains the versioned keyring and the operator can decide
the minimum version allowed for decryption operations. When data is
encrypted using Vault, the resulting ciphertext is prepended with the version of
the key used to encrypt it.</p><p class="g-type-long-body">The following example shows data that was encrypted using the fourth version of
a particular encryption key:</p><div class="g-code-block style_root__3eDLf style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">vault:v4:ueizdCqCJ/YhowQSvmJyucnLfIUMd4S/nLTpGTcz64HXoY69dwOrqerFzOlhqg==<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-undefined"><code class="style_code__2AMYw language-undefined"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">vault:v4:ueizdCqCJ/YhowQSvmJyucnLfIUMd4S/nLTpGTcz64HXoY69dwOrqerFzOlhqg==</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">For example, an organization could decide that a key should be rotated <em>once a
week</em>, and that the minimum version allowed to decrypt records is the current
version as well as the previous two versions. If the current version is five,
then Vault would decrypt records that were sent to it with the following
prefixes:</p><ul><li class="g-type-long-body">vault:<strong>v5</strong>:lkjasfdlkjafdlkjsdflajsdf==</li><li class="g-type-long-body">vault:<strong>v4</strong>:asdfas9pirapirteradr33vvv==</li><li class="g-type-long-body">vault:<strong>v3</strong>:ouoiujarontoiue8987sdjf^1==</li></ul><p class="g-type-long-body">In this example, what would happen if you send Vault data that was encrypted
with the first or second version of the key (<code>vault:v1:...</code> or <code>vault:v2:...</code>)?</p><p class="g-type-long-body">Vault would refuse to decrypt the data as the key used is less than the minimum
key version allowed.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#solution" aria-label="solution permalink">»</a><a class="__target-h" id="solution" aria-hidden=""></a>Solution</h2><p class="g-type-long-body">Luckily, Vault provides an easy way of re-wrapping encrypted data when a key is
rotated. Using the rewrap API endpoint, a non-privileged Vault entity can send
data encrypted with an older version of the key to have it re-encrypted with the
latest version. The application performing the re-wrapping never interacts with
the decrypted data. The process of rotating the encryption key and rewrapping
records could (and should) be completely <strong>automated</strong>. Records could be updated
slowly over time to lessen database load, or all at once at the time of
rotation. The exact implementation will depend heavily on the needs of each
particular organization or application.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#prerequisites" aria-label="prerequisites permalink">»</a><a class="__target-h" id="prerequisites" aria-hidden=""></a>Prerequisites</h2><p class="g-type-long-body">To perform the tasks described in this guide, you need to have a Vault
environment. Refer to the <a href="/intro/getting-started/install">Getting
Started</a> guide to install Vault. Make sure
that your Vault server has been <a href="/intro/getting-started/deploy">initialized and
unsealed</a>.</p><p class="g-type-long-body">The following tools are required in order to successfully run the sample
application provided in this guide:</p><ul><li class="g-type-long-body"><a href="https://www.microsoft.com/net/download">.NET Core</a></li><li class="g-type-long-body"><a href="https://docs.docker.com/install/">Docker</a></li></ul><p class="g-type-long-body">Download the sample application code from
<a href="https://github.com/hashicorp/vault-guides/tree/master/encryption/vault-transit-rewrap">vault-guides</a>
repository to perform the steps described in this guide.</p><p class="g-type-long-body">The <code>vault-transit-rewrap-example</code> contains the following:</p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token builtin class-name">.</span>
<!-- -->├── AppDb.cs<!-- -->
<!-- -->├── DBHelper.cs<!-- -->
<!-- -->├── Program.cs<!-- -->
<!-- -->├── README.md<!-- -->
<!-- -->├── Record.cs<!-- -->
<!-- -->├── VaultClient.cs<!-- -->
<!-- -->├── WebHelper.cs<!-- -->
<!-- -->└── rewrap_example.csproj<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token builtin class-name">.</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── AppDb.cs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── DBHelper.cs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── Program.cs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── README.md</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── Record.cs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── VaultClient.cs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">├── WebHelper.cs</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">└── rewrap_example.csproj</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#policy-requirements" aria-label="policy requirements permalink">»</a><a class="__target-h" id="policy-requirements" aria-hidden=""></a>Policy requirements</h3><div class="alert alert-info g-type-body" role="alert"><p class="g-type-long-body"><strong>NOTE:</strong> For the purpose of this guide, you can use the <strong><code>root</code></strong> token to work
with Vault. However, it is recommended that root tokens are only used for just
enough initial setup or in emergencies. As a best practice, use tokens with
an appropriate set of policies based on your role in the organization.</p></div><p class="g-type-long-body">To perform all tasks demonstrated in this guide, your policy must include the
following permissions:</p><div class="g-code-block style_root__3eDLf language-shell style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Manage transit secret engine</span>
<!-- -->path <span class="token string">&quot;transit/keys/*&quot;</span> <span class="token punctuation">{</span>
<!-- -->  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;read&quot;</span>, <span class="token string">&quot;update&quot;</span>, <span class="token string">&quot;delete&quot;</span>, <span class="token string">&quot;list&quot;</span>, <span class="token string">&quot;sudo&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<!-- -->
<span class="token comment"># Enable transit secret engine</span>
<!-- -->path <span class="token string">&quot;sys/mounts/transit&quot;</span> <span class="token punctuation">{</span>
<!-- -->  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;update&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<!-- -->
<span class="token comment"># Write ACL policies</span>
<!-- -->path <span class="token string">&quot;sys/policy/*&quot;</span> <span class="token punctuation">{</span>
<!-- -->  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;read&quot;</span>, <span class="token string">&quot;update&quot;</span>, <span class="token string">&quot;delete&quot;</span>, <span class="token string">&quot;list&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<!-- -->
<span class="token comment"># Create tokens for verification &amp; test</span>
<!-- -->path <span class="token string">&quot;auth/token/create&quot;</span> <span class="token punctuation">{</span>
<!-- -->  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;update&quot;</span>, <span class="token string">&quot;sudo&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell"><code class="style_code__2AMYw language-shell"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Manage transit secret engine</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">path <span class="token string">&quot;transit/keys/*&quot;</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;read&quot;</span>, <span class="token string">&quot;update&quot;</span>, <span class="token string">&quot;delete&quot;</span>, <span class="token string">&quot;list&quot;</span>, <span class="token string">&quot;sudo&quot;</span> <span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Enable transit secret engine</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">path <span class="token string">&quot;sys/mounts/transit&quot;</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;update&quot;</span> <span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Write ACL policies</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">path <span class="token string">&quot;sys/policy/*&quot;</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;read&quot;</span>, <span class="token string">&quot;update&quot;</span>, <span class="token string">&quot;delete&quot;</span>, <span class="token string">&quot;list&quot;</span> <span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create tokens for verification &amp; test</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">path <span class="token string">&quot;auth/token/create&quot;</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;update&quot;</span>, <span class="token string">&quot;sudo&quot;</span> <span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">If you are not familiar with policies, complete the
<a href="/guides/identity/policies">policies</a> guide.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#steps" aria-label="steps permalink">»</a><a class="__target-h" id="steps" aria-hidden=""></a>Steps</h2><p class="g-type-long-body">This guide introduces a sample <em>.Net</em> application which automates the
re-wrapping of the data using the latest encryption key.</p><p class="g-type-long-body">For the purpose of this guide, a MySQL database runs locally using Docker.
However, these steps would work for an existing MySQL database by supplying the
proper network information to your environment.</p><p class="g-type-long-body">You are going to perform the following steps:</p><ol><li class="g-type-long-body"><a href="#step1">Test database setup (Docker)</a></li><li class="g-type-long-body"><a href="#step2">Enable the transit secret engine</a></li><li class="g-type-long-body"><a href="#step3">Generate a new token for sample app</a></li><li class="g-type-long-body"><a href="#step4">Run the sample application</a></li><li class="g-type-long-body"><a href="#step5">Rotate the encryption keys</a></li><li class="g-type-long-body"><a href="#step6">Re-wrapping data programmatically</a></li></ol><h3 class="g-type-display-4"><a class="__permalink-h" href="#step1" aria-label="step 1 test database setup docker permalink">»</a><a class="__target-h __compat" id="step1" aria-hidden=""></a><a class="__target-h" id="step-1-test-database-setup-docker" aria-hidden=""></a>Step 1: Test database setup (Docker)</h3><p class="g-type-long-body">You need a database to test with. You can create one to test with easily using
Docker:</p><div class="g-code-block style_root__3eDLf language-bash style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Pull the latest mysql container image</span>
<!-- -->docker pull mysql/mysql-server:5.7<!-- -->
<!-- -->
<span class="token comment"># Create a directory for our data (change the following line if running on Windows)</span>
<span class="token function">mkdir</span> ~/rewrap-data<!-- -->
<!-- -->
<span class="token comment"># Run the container.  The following command creates a database named &#x27;my_app&#x27;,</span>
<span class="token comment"># specifies the root user password as &#x27;root&#x27;, and adds a user named vault</span>
<!-- -->docker run --name mysql-rewrap <span class="token punctuation">\</span>
<!-- -->  -p <span class="token number">3306</span>:3306 <span class="token punctuation">\</span>
<!-- -->  -v ~/rewrap-data/var/lib/mysql <span class="token punctuation">\</span>
<!-- -->  -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root <span class="token punctuation">\</span>
<!-- -->  -e <span class="token assign-left variable">MYSQL_ROOT_HOST</span><span class="token operator">=</span>% <span class="token punctuation">\</span>
<!-- -->  -e <span class="token assign-left variable">MYSQL_DATABASE</span><span class="token operator">=</span>my_app <span class="token punctuation">\</span>
<!-- -->  -e <span class="token assign-left variable">MYSQL_USER</span><span class="token operator">=</span>vault <span class="token punctuation">\</span>
<!-- -->  -e <span class="token assign-left variable">MYSQL_PASSWORD</span><span class="token operator">=</span>vaultpw <span class="token punctuation">\</span>
<!-- -->  -d mysql/mysql-server:5.7<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-bash"><code class="style_code__2AMYw language-bash"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Pull the latest mysql container image</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">docker pull mysql/mysql-server:5.7</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Create a directory for our data (change the following line if running on Windows)</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token function">mkdir</span> ~/rewrap-data</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Run the container.  The following command creates a database named &#x27;my_app&#x27;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># specifies the root user password as &#x27;root&#x27;, and adds a user named vault</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">docker run --name mysql-rewrap <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -p <span class="token number">3306</span>:3306 <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -v ~/rewrap-data/var/lib/mysql <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -e <span class="token assign-left variable">MYSQL_ROOT_HOST</span><span class="token operator">=</span>% <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -e <span class="token assign-left variable">MYSQL_DATABASE</span><span class="token operator">=</span>my_app <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -e <span class="token assign-left variable">MYSQL_USER</span><span class="token operator">=</span>vault <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -e <span class="token assign-left variable">MYSQL_PASSWORD</span><span class="token operator">=</span>vaultpw <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  -d mysql/mysql-server:5.7</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step2" aria-label="step 2 enable the transit secret engine permalink">»</a><a class="__target-h __compat" id="step2" aria-hidden=""></a><a class="__target-h" id="step-2-enable-the-transit-secret-engine" aria-hidden=""></a>Step 2: Enable the transit secret engine</h3><p class="g-type-long-body">(<strong>Persona:</strong> security engineer)</p><h4 class="g-type-display-5"><a class="__permalink-h" href="#cli-command" aria-label="cli command permalink">»</a><a class="__target-h" id="cli-command" aria-hidden=""></a>CLI command</h4><p class="g-type-long-body">Enable the <code>transit</code> secret engine by executing the following command:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault secrets <span class="token builtin class-name">enable</span> transit</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault secrets <span class="token builtin class-name">enable</span> transit</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Create an encryption key to use for transit named, &quot;my_app_key&quot;.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault <span class="token function">write</span> -f transit/keys/my_app_key</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault <span class="token function">write</span> -f transit/keys/my_app_key</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#api-call-using-curl" aria-label="api call using curl permalink">»</a><a class="__target-h" id="api-call-using-curl" aria-hidden=""></a>API call using cURL</h4><p class="g-type-long-body">Enable the <code>transit</code> secret engine via API, use the <code>/sys/mounts</code> endpoint:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: &lt;TOKEN&gt;&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       --request POST \</span>
<span class="token output">       --data &lt;PARAMETERS&gt; \</span>
<span class="token output">       &lt;VAULT_ADDRESS&gt;/v1/sys/mounts/transit</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: &lt;TOKEN&gt;&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --request POST \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --data &lt;PARAMETERS&gt; \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       &lt;VAULT_ADDRESS&gt;/v1/sys/mounts/transit</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Where <code>&lt;TOKEN&gt;</code> is your valid token, and <code>&lt;PARAMETERS&gt;</code> holds <a href="/api/system/mounts#enable-secrets-engine">configuration
parameters</a> of the secret engine.</p><p class="g-type-long-body">To crate a new encryption key, use the <code>transit/keys/&lt;key_name&gt;</code> endpoint:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: &lt;TOKEN&gt;&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       --request POST \</span>
<span class="token output">       --data &lt;PARAMETERS&gt; \</span>
<span class="token output">       &lt;VAULT_ADDRESS&gt;/v1/transit/keys/&lt;KEY_NAME&gt;</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: &lt;TOKEN&gt;&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --request POST \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --data &lt;PARAMETERS&gt; \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       &lt;VAULT_ADDRESS&gt;/v1/transit/keys/&lt;KEY_NAME&gt;</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Where <code>&lt;PARAMETERS&gt;</code> holds <a href="/api/secret/transit#create-key">configuration
parameters</a> to specify the key type.</p><p class="g-type-long-body"><strong>Example:</strong></p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       --request POST \</span>
<span class="token output">       --data &#x27;{&quot;type&quot;: &quot;transit&quot;}&#x27; \</span>
<span class="token output">       https://localhost:8200/v1/sys/mounts/transit</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --request POST \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --data &#x27;{&quot;type&quot;: &quot;transit&quot;}&#x27; \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       https://localhost:8200/v1/sys/mounts/transit</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The above example passes the <strong>type</strong> (<code>transit</code>) in the request payload which
at the <code>sys/mounts/transit</code> endpoint.</p><p class="g-type-long-body">Next, create an encryption key to use for transit named, &quot;my_app_key&quot;.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       --request POST \</span>
<span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --request POST \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step3" aria-label="step 3 generate a new token for sample app permalink">»</a><a class="__target-h __compat" id="step3" aria-hidden=""></a><a class="__target-h" id="step-3-generate-a-new-token-for-sample-app" aria-hidden=""></a>Step 3: Generate a new token for sample app</h3><p class="g-type-long-body">(<strong>Persona:</strong> security engineer)</p><p class="g-type-long-body">Before generating a token, create a limited scope policy named, &quot;<strong>rewrap_example</strong>&quot;
for the sample application.</p><p class="g-type-long-body">The ACL policy (<code>rewrap_example.hcl</code>) looks as follows:</p><div class="g-code-block style_root__3eDLf language-shell style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none">path <span class="token string">&quot;transit/keys/my_app_key&quot;</span> <span class="token punctuation">{</span>
<!-- -->  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<!-- -->
<!-- -->path <span class="token string">&quot;transit/rewrap/my_app_key&quot;</span> <span class="token punctuation">{</span>
<!-- -->  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<!-- -->
<span class="token comment"># This last policy is needed to seed the database as part of the example.</span>
<span class="token comment"># It can be omitted if seeding is not required</span>
<!-- -->path <span class="token string">&quot;transit/encrypt/my_app_key&quot;</span> <span class="token punctuation">{</span>
<!-- -->  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell"><code class="style_code__2AMYw language-shell"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">path <span class="token string">&quot;transit/keys/my_app_key&quot;</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">path <span class="token string">&quot;transit/rewrap/my_app_key&quot;</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># This last policy is needed to seed the database as part of the example.</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># It can be omitted if seeding is not required</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">path <span class="token string">&quot;transit/encrypt/my_app_key&quot;</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#cli-command-1" aria-label="cli command permalink">»</a><a class="__target-h" id="cli-command-1" aria-hidden=""></a>CLI command</h4><p class="g-type-long-body">Create <code>rewrap_example</code> policy:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault policy <span class="token function">write</span> rewrap_example ./rewrap_example.hcl</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault policy <span class="token function">write</span> rewrap_example ./rewrap_example.hcl</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Finally, create a token to use the <code>rewrap_example</code> policy:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault token create -policy<span class="token operator">=</span>rewrap_example</span></span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault token create -policy<span class="token operator">=</span>rewrap_example</span></span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body"><strong>Example:</strong></p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault token create -policy<span class="token operator">=</span>rewrap_example</span></span>
<span class="token output">Key                Value</span>
<span class="token output">---                -----</span>
<span class="token output">token              68396128-82d8-002e-f289-1106944fee9f</span>
<span class="token output">token_accessor     75f05f43-6a5f-2eb1-5bb8-0de3c7cf0996</span>
<span class="token output">token_duration     768h</span>
<span class="token output">token_renewable    true</span>
<span class="token output">token_policies     [default rewrap_example]</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault token create -policy<span class="token operator">=</span>rewrap_example</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Key                Value</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">---                -----</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token              68396128-82d8-002e-f289-1106944fee9f</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_accessor     75f05f43-6a5f-2eb1-5bb8-0de3c7cf0996</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_duration     768h</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_renewable    true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">token_policies     [default rewrap_example]</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The generated token is what the sample application uses to connect to Vault.</p><h4 class="g-type-display-5"><a class="__permalink-h" href="#api-call-using-curl-1" aria-label="api call using curl permalink">»</a><a class="__target-h" id="api-call-using-curl-1" aria-hidden=""></a>API call using cURL</h4><p class="g-type-long-body">To create a policy via API, use the <code>/sys/policy</code> endpoint:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request PUT --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       --data @payload.json \</span>
<span class="token output">       https://localhost:8200/v1/sys/policy/rewrap_example</span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> payload.json</span></span>
<span class="token output">{</span>
<span class="token output">  &quot;policy&quot;: &quot;path \&quot;transit/keys/my_app_key\&quot; { capabilities = [\&quot;read\&quot;] } path \&quot;transit/rewrap/my_app_key\&quot; ... }&quot;</span>
<span class="token output">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request PUT --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --data @payload.json \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       https://localhost:8200/v1/sys/policy/rewrap_example</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> payload.json</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  &quot;policy&quot;: &quot;path \&quot;transit/keys/my_app_key\&quot; { capabilities = [\&quot;read\&quot;] } path \&quot;transit/rewrap/my_app_key\&quot; ... }&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Finally, create a token to use the <code>rewrap_example</code> policy:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> --request POST  </span></span><span class="token output">\</span>
<span class="token output">       --data &#x27;{ &quot;policies&quot;: [&quot;rewrap_example&quot;] }&#x27; \</span>
<span class="token output">       https://localhost:8200/v1/auth/token/create | jq</span>
<span class="token output">{</span>
<span class="token output"> &quot;request_id&quot;: &quot;da8bde73-99ab-b435-a344-fb963b3a599f&quot;,</span>
<span class="token output"> &quot;lease_id&quot;: &quot;&quot;,</span>
<span class="token output"> &quot;renewable&quot;: false,</span>
<span class="token output"> &quot;lease_duration&quot;: 0,</span>
<span class="token output"> &quot;data&quot;: null,</span>
<span class="token output"> &quot;wrap_info&quot;: null,</span>
<span class="token output"> &quot;warnings&quot;: null,</span>
<span class="token output"> &quot;auth&quot;: {</span>
<span class="token output">   &quot;client_token&quot;: &quot;997107d5-9049-8b4b-8f39-a33a458fd02d&quot;,</span>
<span class="token output">   &quot;accessor&quot;: &quot;d400076b-4143-4d63-7473-a8cc52c73ba3&quot;,</span>
<span class="token output">   &quot;policies&quot;: [</span>
<span class="token output">     &quot;default&quot;,</span>
<span class="token output">     &quot;rewrap-example&quot;</span>
<span class="token output">   ],</span>
<span class="token output">   &quot;metadata&quot;: null,</span>
<span class="token output">   &quot;lease_duration&quot;: 2764800,</span>
<span class="token output">   &quot;renewable&quot;: true,</span>
<span class="token output">   &quot;entity_id&quot;: &quot;&quot;</span>
<span class="token output"> }</span>
<span class="token output">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> --request POST  </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --data &#x27;{ &quot;policies&quot;: [&quot;rewrap_example&quot;] }&#x27; \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       https://localhost:8200/v1/auth/token/create | jq</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;request_id&quot;: &quot;da8bde73-99ab-b435-a344-fb963b3a599f&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;lease_id&quot;: &quot;&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;renewable&quot;: false,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;lease_duration&quot;: 0,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;data&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;wrap_info&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;warnings&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;auth&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;client_token&quot;: &quot;997107d5-9049-8b4b-8f39-a33a458fd02d&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;accessor&quot;: &quot;d400076b-4143-4d63-7473-a8cc52c73ba3&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;policies&quot;: [</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     &quot;default&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     &quot;rewrap-example&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   ],</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;metadata&quot;: null,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;lease_duration&quot;: 2764800,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;renewable&quot;: true,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;entity_id&quot;: &quot;&quot;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> }</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">The generated token is what the sample application uses to connect to Vault.</p><h3 class="g-type-display-4"><a class="__permalink-h" href="#step4" aria-label="step 4 run the sample application permalink">»</a><a class="__target-h __compat" id="step4" aria-hidden=""></a><a class="__target-h" id="step-4-run-the-sample-application" aria-hidden=""></a>Step 4: Run the sample application</h3><p class="g-type-long-body">(<strong>Persona:</strong> app)</p><p class="g-type-long-body">You are now ready to run the app. Be sure to <a href="#prerequisites">download</a> the
sample application code before beginning.</p><p class="g-type-long-body"><strong>Sample application</strong></p><table><thead><tr><th>File</th><th>Description</th></tr></thead><tbody><tr><td>Program.cs</td><td>Starting point of this sample app (the <code>Main()</code> method) is in this file. It reads the environment variable values, connects to Vault and the MySQL database. If the <code>user_data</code> table does not exist, it creates it.</td></tr><tr><td>DBHelper.cs</td><td>Defines a method to create the <code>user_data</code> table if it does not exist. Finds and updates records that need to be rewrapped with the new key.</td></tr><tr><td>AppDb.cs</td><td>Connects to the MySQL database.</td></tr><tr><td>Record.cs</td><td>Sample data record template.</td></tr><tr><td>VaultClient.cs</td><td>Defines methods necessary to rewrap transit data.</td></tr><tr><td>WebHelper.cs</td><td>Helper code to seed the initial table schema.</td></tr><tr><td>rewrap_example.csproj</td><td>Project file for this sample app.</td></tr></tbody></table><p class="g-type-long-body">The sample app retrieves the user token, Vault address, and the name of the
transit key through environment variables. Be sure to supply the token created
in <a href="#step3">Step 3</a>:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span></span></span><span class="token output">&lt;APP_TOKEN&gt; \</span>
<span class="token output">     VAULT_ADDR=&lt;VAULT_ADDRESS&gt; \</span>
<span class="token output">     VAULT_TRANSIT_KEY=my_app_key \</span>
<span class="token output">     SHOULD_SEED_USERS=true \</span>
<span class="token output">     dotnet run</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span></span></span><span class="token output">&lt;APP_TOKEN&gt; \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     VAULT_ADDR=&lt;VAULT_ADDRESS&gt; \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     VAULT_TRANSIT_KEY=my_app_key \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     SHOULD_SEED_USERS=true \</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     dotnet run</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><blockquote><p class="g-type-long-body">If you need to seed test data you can do so by including the
<code>SHOULD_SEED_USERS=true</code>.</p></blockquote><p class="g-type-long-body"><strong>Example:</strong></p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span><span class="token variable">$TOKEN</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://localhost:8200 <span class="token assign-left variable">VAULT_TRANSIT_KEY</span><span class="token operator">=</span>my_app_key <span class="token assign-left variable">SHOULD_SEED_USERS</span><span class="token operator">=</span>true dotnet run</span></span>
<!-- -->
<span class="token output">Connecting to Vault server...</span>
<span class="token output">Created (if not exist) my_app DB</span>
<span class="token output">Create (if not exist) user_data table</span>
<span class="token output">Seeded the database...</span>
<span class="token output">Moving rewrap...</span>
<span class="token output">Current Key Version: 5</span>
<span class="token output">Found 0 records to rewrap.</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span><span class="token variable">$TOKEN</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://localhost:8200 <span class="token assign-left variable">VAULT_TRANSIT_KEY</span><span class="token operator">=</span>my_app_key <span class="token assign-left variable">SHOULD_SEED_USERS</span><span class="token operator">=</span>true dotnet run</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Connecting to Vault server...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Created (if not exist) my_app DB</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Create (if not exist) user_data table</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Seeded the database...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Moving rewrap...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Current Key Version: 5</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Found 0 records to rewrap.</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">You can inspect the contents of the database with:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">docker <span class="token builtin class-name">exec</span> -it mysql-rewrap mysql -uroot -proot</span></span>
<span class="token output">...</span>
<span class="token output">mysql&gt; DESC user_data;</span>
<span class="token output">mysql&gt; SELECT * FROM user_data WHERE dob LIKE &quot;vault:v1%&quot; limit 10;</span>
<span class="token output">...data...</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">docker <span class="token builtin class-name">exec</span> -it mysql-rewrap mysql -uroot -proot</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">mysql&gt; DESC user_data;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">mysql&gt; SELECT * FROM user_data WHERE dob LIKE &quot;vault:v1%&quot; limit 10;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...data...</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step5" aria-label="step 5 rotate the encryption keys permalink">»</a><a class="__target-h __compat" id="step5" aria-hidden=""></a><a class="__target-h" id="step-5-rotate-the-encryption-keys" aria-hidden=""></a>Step 5: Rotate the encryption keys</h3><p class="g-type-long-body">(<strong>Persona:</strong> security engineer)</p><p class="g-type-long-body">The encryption key (<code>my_app_key</code>) can be rotated easily.</p><h4 class="g-type-display-5"><a class="__permalink-h" href="#cli-command-2" aria-label="cli command permalink">»</a><a class="__target-h" id="cli-command-2" aria-hidden=""></a>CLI command</h4><p class="g-type-long-body">To rotate the key, you write to the <code>transit/keys/&lt;KEY_NAME&gt;/rotate</code> path.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault <span class="token function">write</span> -f transit/keys/my_app_key/rotate</span></span>
<span class="token output">Success! Data written to: transit/keys/my_app_key/rotate</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault <span class="token function">write</span> -f transit/keys/my_app_key/rotate</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Success! Data written to: transit/keys/my_app_key/rotate</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Run the command a few times to generate several versions of the encryption key
for testing.</p><p class="g-type-long-body">To view the key information:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault <span class="token builtin class-name">read</span> transit/keys/my_app_key</span></span>
<span class="token output">Key                       Value</span>
<span class="token output">---                       -----</span>
<span class="token output">allow_plaintext_backup    false</span>
<span class="token output">deletion_allowed          false</span>
<span class="token output">derived                   false</span>
<span class="token output">exportable                false</span>
<span class="token output">keys                      map[5:1519623974 6:1519623980 1:1519620952 2:1519623255 3:1519623285 4:1519623603]</span>
<span class="token output">latest_version            6</span>
<span class="token output">min_decryption_version    1</span>
<span class="token output">min_encryption_version    0</span>
<span class="token output">name                      my_app_key</span>
<span class="token output">supports_decryption       true</span>
<span class="token output">supports_derivation       true</span>
<span class="token output">supports_encryption       true</span>
<span class="token output">supports_signing          false</span>
<span class="token output">type                      aes256-gcm96</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">vault <span class="token builtin class-name">read</span> transit/keys/my_app_key</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Key                       Value</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">---                       -----</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">allow_plaintext_backup    false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">deletion_allowed          false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">derived                   false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">exportable                false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">keys                      map[5:1519623974 6:1519623980 1:1519620952 2:1519623255 3:1519623285 4:1519623603]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">latest_version            6</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">min_decryption_version    1</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">min_encryption_version    0</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">name                      my_app_key</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">supports_decryption       true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">supports_derivation       true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">supports_encryption       true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">supports_signing          false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">type                      aes256-gcm96</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">You can see that in the above example the current version of the key is six.
There is no restriction about a minimum encryption key version, and any of the key
versions can decrypt the data (<code>min_decryption_version</code>).</p><p class="g-type-long-body">Let&#x27;s enforce the use of the encryption key at version five or later to decrypt
data.</p><div class="g-code-block style_root__3eDLf language-shell style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># replace &#x27;5&#x27; with the appropriate version</span>
<!-- -->$ vault <span class="token function">write</span> transit/keys/my_app_key/config <span class="token assign-left variable">min_decryption_version</span><span class="token operator">=</span><span class="token number">5</span>
<!-- -->
<span class="token comment"># Verify the changes were successful</span>
<!-- -->$ vault <span class="token builtin class-name">read</span> transit/keys/my_app_key<!-- -->
<!-- -->Key                       Value<!-- -->
<!-- -->---                       -----<!-- -->
<!-- -->allow_plaintext_backup    <span class="token boolean">false</span>
<!-- -->deletion_allowed          <span class="token boolean">false</span>
<!-- -->derived                   <span class="token boolean">false</span>
<!-- -->exportable                <span class="token boolean">false</span>
<!-- -->keys                      map<span class="token punctuation">[</span><span class="token number">5</span>:1519623974 <span class="token number">6</span>:1519623980<span class="token punctuation">]</span>
<!-- -->latest_version            <span class="token number">6</span>
<!-- -->min_decryption_version    <span class="token number">5</span>
<!-- -->min_encryption_version    <span class="token number">0</span>
<!-- -->name                      my_app_key<!-- -->
<!-- -->supports_decryption       <span class="token boolean">true</span>
<!-- -->supports_derivation       <span class="token boolean">true</span>
<!-- -->supports_encryption       <span class="token boolean">true</span>
<!-- -->supports_signing          <span class="token boolean">false</span>
<span class="token builtin class-name">type</span>                      aes256-gcm96<!-- -->
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell"><code class="style_code__2AMYw language-shell"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># replace &#x27;5&#x27; with the appropriate version</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault <span class="token function">write</span> transit/keys/my_app_key/config <span class="token assign-left variable">min_decryption_version</span><span class="token operator">=</span><span class="token number">5</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Verify the changes were successful</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ vault <span class="token builtin class-name">read</span> transit/keys/my_app_key</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">Key                       Value</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">---                       -----</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">allow_plaintext_backup    <span class="token boolean">false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">deletion_allowed          <span class="token boolean">false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">derived                   <span class="token boolean">false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">exportable                <span class="token boolean">false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">keys                      map<span class="token punctuation">[</span><span class="token number">5</span>:1519623974 <span class="token number">6</span>:1519623980<span class="token punctuation">]</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">latest_version            <span class="token number">6</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">min_decryption_version    <span class="token number">5</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">min_encryption_version    <span class="token number">0</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">name                      my_app_key</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">supports_decryption       <span class="token boolean">true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">supports_derivation       <span class="token boolean">true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">supports_encryption       <span class="token boolean">true</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">supports_signing          <span class="token boolean">false</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token builtin class-name">type</span>                      aes256-gcm96</span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#api-call-using-curl-2" aria-label="api call using curl permalink">»</a><a class="__target-h" id="api-call-using-curl-2" aria-hidden=""></a>API call using cURL</h4><p class="g-type-long-body">To rotate the encryption key via API, use the <code>transit/keys/&lt;KEY_NAME&gt;/rotate</code> endpoint:</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request POST --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key/rotate</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request POST --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key/rotate</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">Run the command a few times to generate several versions of the encryption key
for testing.</p><div class="g-code-block style_root__3eDLf language-shell style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token comment"># Verify the changes were successful</span>
<!-- -->$ <span class="token function">curl</span> --request GET --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> <span class="token punctuation">\</span>
<!-- -->      https://localhost:8200/v1/transit/keys/my_app_key <span class="token operator">|</span> jq<!-- -->
<span class="token punctuation">{</span>
<!-- -->  <span class="token string">&quot;request_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ed13436a-4816-2f51-0552-6a001e823548&quot;</span>,<!-- -->
<!-- -->  <span class="token string">&quot;lease_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,<!-- -->
<!-- -->  <span class="token string">&quot;renewable&quot;</span><span class="token builtin class-name">:</span> false,<!-- -->
<!-- -->  <span class="token string">&quot;lease_duration&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,<!-- -->
<!-- -->  <span class="token string">&quot;data&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
<!-- -->    <span class="token string">&quot;allow_plaintext_backup&quot;</span><span class="token builtin class-name">:</span> false,<!-- -->
<!-- -->    <span class="token string">&quot;deletion_allowed&quot;</span><span class="token builtin class-name">:</span> false,<!-- -->
<!-- -->    <span class="token string">&quot;derived&quot;</span><span class="token builtin class-name">:</span> false,<!-- -->
<!-- -->    <span class="token string">&quot;exportable&quot;</span><span class="token builtin class-name">:</span> false,<!-- -->
<!-- -->    <span class="token string">&quot;keys&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
<!-- -->      <span class="token string">&quot;1&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519620952</span>,<!-- -->
<!-- -->      <span class="token string">&quot;2&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623255</span>,<!-- -->
<!-- -->      <span class="token string">&quot;3&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623285</span>,<!-- -->
<!-- -->      <span class="token string">&quot;4&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623603</span>,<!-- -->
<!-- -->      <span class="token string">&quot;5&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623974</span>,<!-- -->
<!-- -->      <span class="token string">&quot;6&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623980</span>
<!-- -->    <span class="token punctuation">}</span>,<!-- -->
<!-- -->    <span class="token string">&quot;latest_version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,<!-- -->
<!-- -->    <span class="token string">&quot;min_decryption_version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,<!-- -->
<!-- -->    <span class="token string">&quot;min_encryption_version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,<!-- -->
<!-- -->    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my_app_key&quot;</span>,<!-- -->
<!-- -->    <span class="token punctuation">..</span>.<!-- -->
<!-- -->  <span class="token punctuation">}</span>,<!-- -->
<!-- -->  <span class="token punctuation">..</span>.<!-- -->
<span class="token punctuation">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell"><code class="style_code__2AMYw language-shell"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token comment"># Verify the changes were successful</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">$ <span class="token function">curl</span> --request GET --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> <span class="token punctuation">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      https://localhost:8200/v1/transit/keys/my_app_key <span class="token operator">|</span> jq</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;request_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ed13436a-4816-2f51-0552-6a001e823548&quot;</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;lease_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;renewable&quot;</span><span class="token builtin class-name">:</span> false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;lease_duration&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token string">&quot;data&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;allow_plaintext_backup&quot;</span><span class="token builtin class-name">:</span> false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;deletion_allowed&quot;</span><span class="token builtin class-name">:</span> false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;derived&quot;</span><span class="token builtin class-name">:</span> false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;exportable&quot;</span><span class="token builtin class-name">:</span> false,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;keys&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      <span class="token string">&quot;1&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519620952</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      <span class="token string">&quot;2&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623255</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      <span class="token string">&quot;3&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623285</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      <span class="token string">&quot;4&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623603</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      <span class="token string">&quot;5&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623974</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">      <span class="token string">&quot;6&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1519623980</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token punctuation">}</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;latest_version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;min_decryption_version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;min_encryption_version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my_app_key&quot;</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">    <span class="token punctuation">..</span>.</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token punctuation">}</span>,</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">  <span class="token punctuation">..</span>.</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token punctuation">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><p class="g-type-long-body">You can see that in the above example the current version of the key is six.
There is no restriction about the minimum encryption key version, and any of the key
versions can decrypt the data (<code>min_decryption_version</code>).</p><p class="g-type-long-body">Let&#x27;s enforce the use of the encryption key at version five or later to decrypt the
data.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request POST --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       --data &#x27;{ &quot;min_decryption_version&quot;: 5 }&#x27;</span>
<span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key/config</span>
<!-- -->
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Verify the changes were successful</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request GET --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span>
<span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key | jq</span>
<span class="token output">{</span>
<span class="token output"> ...</span>
<span class="token output"> &quot;data&quot;: {</span>
<span class="token output">   ...</span>
<span class="token output">   &quot;keys&quot;: {</span>
<span class="token output">     &quot;5&quot;: 1519623974,</span>
<span class="token output">     &quot;6&quot;: 1519623980</span>
<span class="token output">   },</span>
<span class="token output">   &quot;latest_version&quot;: 6,</span>
<span class="token output">   &quot;min_decryption_version&quot;: 5,</span>
<span class="token output">   &quot;min_encryption_version&quot;: 0,</span>
<span class="token output">   &quot;name&quot;: &quot;my_app_key&quot;,</span>
<span class="token output">   ...</span>
<span class="token output">  },</span>
<span class="token output">}</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request POST --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       --data &#x27;{ &quot;min_decryption_version&quot;: 5 }&#x27;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key/config</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Verify the changes were successful</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> --request GET --header <span class="token string">&quot;X-Vault-Token: ...&quot;</span> </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">       https://localhost:8200/v1/transit/keys/my_app_key | jq</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">{</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> ...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output"> &quot;data&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   ...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;keys&quot;: {</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     &quot;5&quot;: 1519623974,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">     &quot;6&quot;: 1519623980</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   },</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;latest_version&quot;: 6,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;min_decryption_version&quot;: 5,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;min_encryption_version&quot;: 0,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   &quot;name&quot;: &quot;my_app_key&quot;,</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">   ...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">  },</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">}</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#step6" aria-label="step 6 programmatically re wrap the data permalink">»</a><a class="__target-h __compat" id="step6" aria-hidden=""></a><a class="__target-h" id="step-6-programmatically-re-wrap-the-data" aria-hidden=""></a>Step 6: Programmatically re-wrap the data</h3><p class="g-type-long-body">(<strong>Persona:</strong> app)</p><p class="g-type-long-body">Now you have records in the database and you have updated our minimum key
version. You can run the application again and should see it update records as
appropriate. Remember you can inspect records using the MySQL shell (see above).</p><p class="g-type-long-body"><strong>Example:</strong></p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span>2616214b-6868-3589-b443-0330d7915882 <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://localhost:8200 </span></span><span class="token output">\</span>
<span class="token output">          VAULT_TRANSIT_KEY=my_app_key SHOULD_SEED_USERS=true dotnet run</span>
<span class="token output">Connecting to Vault server...</span>
<span class="token output">Created (if not exist) my_app DB</span>
<span class="token output">Create (if not exist) user_data table</span>
<span class="token output">Seeded the database...</span>
<span class="token output">Current Key Version: 6</span>
<span class="token output">Found 3500 records to rewrap.</span>
<span class="token output">Wrapped another 10 records: 10 so far...</span>
<span class="token output">Wrapped another 10 records: 20 so far...</span>
<span class="token output">Wrapped another 10 records: 30 so far...</span>
<span class="token output">...</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span>2616214b-6868-3589-b443-0330d7915882 <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://localhost:8200 </span></span><span class="token output">\</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">          VAULT_TRANSIT_KEY=my_app_key SHOULD_SEED_USERS=true dotnet run</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Connecting to Vault server...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Created (if not exist) my_app DB</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Create (if not exist) user_data table</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Seeded the database...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Current Key Version: 6</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Found 3500 records to rewrap.</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Wrapped another 10 records: 10 so far...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Wrapped another 10 records: 20 so far...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Wrapped another 10 records: 30 so far...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h4 class="g-type-display-5"><a class="__permalink-h" href="#validation" aria-label="validation permalink">»</a><a class="__target-h" id="validation" aria-hidden=""></a>Validation</h4><p class="g-type-long-body">The application has now re-wrapped all records with the latest key. You can
verify this by running the application again, or by inspecting the records using the
MySQL client.</p><div class="g-code-block style_root__3eDLf language-shell-session style_codeMargin__gCa5y theme-dark_base__2i1UN theme-dark_syntax__1ok1Y" data-heap-track="code-block"><pre style="display:none"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">docker <span class="token builtin class-name">exec</span> -it mysql-rewrap mysql -uroot -proot</span></span>
<span class="token output">...</span>
<span class="token output">mysql&gt; DESC user_data;</span>
<span class="token output">mysql&gt; SELECT * FROM user_data WHERE dob LIKE &quot;vault:v1%&quot; limit 10;</span>
<span class="token output">Empty set (0.00 sec)</span>
<!-- -->
<span class="token output">mysql&gt; SELECT * FROM user_data WHERE dob LIKE &quot;vault:v6%&quot; limit 10;</span>
<span class="token output">...data...</span>
</pre><div class="style_linesContainer__3neRW"><pre class="style_pre__1vh6Z language-shell-session"><code class="style_code__2AMYw language-shell-session"><span class="style_linesColumn__33g5m style_styledScrollbars__2aszk"><span class="style_linesWrapper__3Hf6o"><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">docker <span class="token builtin class-name">exec</span> -it mysql-rewrap mysql -uroot -proot</span></span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">mysql&gt; DESC user_data;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">mysql&gt; SELECT * FROM user_data WHERE dob LIKE &quot;vault:v1%&quot; limit 10;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">Empty set (0.00 sec)</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl">
</span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">mysql&gt; SELECT * FROM user_data WHERE dob LIKE &quot;vault:v6%&quot; limit 10;</span></span><span class="style_LineOfCode__Ykefu g-type-code style_hasFloatingCopyButton__18ybl"><span class="token output">...data...</span></span></span></span></code></pre><div class="style_copyButtonContainer__1tl-z"><div class="style_copyButtonBackground__1VUWz"><button class="style_button__3y017 g-type-body-small-strong" data-heap-track="code-block-clipboard-icon" type="button">Copy<div class="style_svg__1ZhpC"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.82 3C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-4.18zM10 13H7v2h3v-2zm-3 6h5v-2H7v2zM7 9v2h6V9H7zm5-6c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM5 21V5h2v1.007h10V5h2v5.992h2.003V17H19v4H5zm11.99-3v-3H24v-2h-7.01v-3L13 14l3.99 4z" fill="#000"/></svg></div></button></div></div></div></div><h3 class="g-type-display-4"><a class="__permalink-h" href="#conclusion" aria-label="conclusion permalink">»</a><a class="__target-h" id="conclusion" aria-hidden=""></a>Conclusion</h3><p class="g-type-long-body">An application similar to this could be scheduled via cron, run periodically as
a <a href="https://www.nomadproject.io/docs/job-specification/periodic">Nomad batch
job</a>, or
executed in a variety of other ways. You could also modify it to re-wrap a
limited number of records at a time so as to not put undue strain on the
database. The final implementation should be based upon the needs and design
goals specific to each organization or application.</p><h2 class="g-type-display-3"><a class="__permalink-h" href="#next-steps" aria-label="next steps permalink">»</a><a class="__target-h" id="next-steps" aria-hidden=""></a>Next Steps</h2><p class="g-type-long-body">Since the main focus of this guide was to programmatically rewrap your secrets
using the latest encryption key, the token used by the sample application was
generated manually. In a production environment, you&#x27;ll want to pass the token in
a more secure manner. Refer to the <a href="/guides/secret-mgmt/cubbyhole">Cubbyhole Response
Wrapping</a> guide to wrap the token so that only the
expecting app can unwrap to obtain the token.</p><p class="g-type-long-body">Also, refer to the <a href="/guides/identity/authentication">AppRole Pull
Authentication</a> to generate tokens for
apps using the AppRole auth method.</p></article></div></div><div id="edit-this-page" class="g-container"><a href="https://github.com/hashicorp/vault/blob/main/website/content/guides/encryption/transit-rewrap.mdx"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjMiIGhlaWdodD0iMjIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTExLjYwOC4zNDJDNS41MzUuMzQyLjYxIDUuMTYyLjYxIDExLjEwOGMwIDQuNzU3IDMuMTUyIDguNzkyIDcuNTIzIDEwLjIxNS41NS4xLjc1MS0uMjMzLjc1MS0uNTE4IDAtLjI1Ni0uMDEtLjkzMy0uMDE1LTEuODMxLTMuMDYuNjUtMy43MDUtMS40NDQtMy43MDUtMS40NDQtLjUtMS4yNDMtMS4yMjItMS41NzQtMS4yMjItMS41NzQtLjk5OC0uNjY4LjA3Ni0uNjU1LjA3Ni0uNjU1IDEuMTA0LjA3NiAxLjY4NSAxLjExIDEuNjg1IDEuMTEuOTgxIDEuNjQ1IDIuNTc1IDEuMTcgMy4yMDEuODk0LjEtLjY5NS4zODUtMS4xNy42OTktMS40MzktMi40NDMtLjI3MS01LjAxMS0xLjE5NS01LjAxMS01LjMyIDAtMS4xNzYuNDI5LTIuMTM3IDEuMTMyLTIuODktLjExMy0uMjcyLS40OS0xLjM2Ny4xMDgtMi44NDkgMCAwIC45MjQtLjI4OSAzLjAyNSAxLjEwNC44NzctLjI0IDEuODE5LS4zNTggMi43NTQtLjM2My45MzQuMDA1IDEuODc1LjEyNCAyLjc1NC4zNjMgMi4xLTEuMzkzIDMuMDIyLTEuMTA0IDMuMDIyLTEuMTA0LjYgMS40ODIuMjIyIDIuNTc3LjExIDIuODUuNzA1Ljc1MiAxLjEzIDEuNzEzIDEuMTMgMi44ODggMCA0LjEzNi0yLjU3MiA1LjA0Ni01LjAyMiA1LjMxMy4zOTQuMzMyLjc0Ni45OS43NDYgMS45OTQgMCAxLjQzOC0uMDEzIDIuNi0uMDEzIDIuOTUzIDAgLjI4OC4xOTguNjIzLjc1Ni41MTggNC4zNjgtMS40MjcgNy41MTYtNS40NiA3LjUxNi0xMC4yMTUgMC01Ljk0Ni00LjkyNS0xMC43NjYtMTEtMTAuNzY2IiBmaWxsPSIjMTYxNTE0IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=" alt="github logo"/><span>Edit this page</span></a></div></div><footer class="g-footer"><div class="g-container"><div class="left"><a href="/docs/vault_v1.8.x/docs/">Docs</a><a href="/docs/vault_v1.8.x/api/">API</a><a href="https://learn.hashicorp.com/vault">Learn</a><a href="/docs/vault_v1.8.x/community/">Community</a><a href="https://hashicorp.com/privacy">Privacy</a><a href="/docs/vault_v1.8.x/security/">Security</a><a href="/docs/vault_v1.8.x/files/press-kit.zip">Press Kit</a><a>Consent Manager</a></div></div></footer><div id="g-consent-manager"></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"currentPath":"encryption/transit-rewrap","frontMatter":{"layout":"guides","page_title":"Transit Secrets Re-wrapping - Guides","description":"The goal of this guide is to demonstrate one possible way to re-wrap data after\nrotating an encryption key in the transit engine in Vault."},"githubFileUrl":"https://github.com/hashicorp/vault/blob/main/website/content/guides/encryption/transit-rewrap.mdx","mdxSource":{"compiledSource":"var c=Object.defineProperty;var o=Object.prototype.hasOwnProperty;var p=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable;var l=(e,n,s)=\u003en in e?c(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,a=(e,n)=\u003e{for(var s in n||(n={}))o.call(n,s)\u0026\u0026l(e,s,n[s]);if(p)for(var s of p(n))r.call(n,s)\u0026\u0026l(e,s,n[s]);return e};var m=(e,n)=\u003e{var s={};for(var t in e)o.call(e,t)\u0026\u0026n.indexOf(t)\u003c0\u0026\u0026(s[t]=e[t]);if(e!=null\u0026\u0026p)for(var t of p(e))n.indexOf(t)\u003c0\u0026\u0026r.call(e,t)\u0026\u0026(s[t]=e[t]);return s};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(s){var t=s,{components:e}=t,n=m(t,[\"components\"]);return mdx(MDXLayout,a(a(a({},layoutProps),n),{components:e,mdxType:\"MDXLayout\"}),mdx(\"h1\",a({},{className:\"g-type-display-2\"}),mdx(\"a\",a({parentName:\"h1\"},{className:\"__permalink-h\",href:\"#transit-secrets-engine\",\"aria-label\":\"transit secrets engine permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h1\"},{className:\"__target-h\",id:\"transit-secrets-engine\",\"aria-hidden\":\"\"})),\"Transit Secrets Engine\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`In addition to being able to store secrets, Vault can encrypt/decrypt data that\nis stored elsewhere. The primary use of this is to allow applications to encrypt\ntheir data while still storing it in their primary data store. Vault does not\nstore the data.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The \",mdx(\"a\",a({parentName:\"p\"},{href:\"/docs/secrets/transit\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"transit\"),\" secret engine\"),` handles\ncryptographic functions on data-in-transit, and often referred to as\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"em\",{parentName:\"strong\"},\"Encryption as a Service\")),` (EaaS). Both small amounts of arbitrary data, and\nlarge files such as images, can be protected with the transit engine. This EaaS\nfunction can augment or eliminate the need for Transparent Data Encryption (TDE)\nwith databases to encrypt the contents of a bucket, volume, and disk, etc.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"img\",a({parentName:\"p\"},{src:\"/img/vault-encryption.png\",alt:\"Encryption as a Service\"}))),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#encryption-key-rotation\",\"aria-label\":\"encryption key rotation permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"encryption-key-rotation\",\"aria-hidden\":\"\"})),\"Encryption Key Rotation\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`One of the benefits of using the Vault EaaS is its ability to easily rotate the\nencryption keys. Keys can be rotated manually by a human, or an automated\nprocess which invokes the key rotation API endpoint through `,mdx(\"inlineCode\",{parentName:\"p\"},\"cron\"),`, a CI\npipeline, a periodic Nomad batch job, Kubernetes Job, etc.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`The goal of this guide is to demonstrate an example for re-wrapping data after\nrotating an encryption key in the transit engine in Vault.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#reference-material\",\"aria-label\":\"reference material permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"reference-material\",\"aria-hidden\":\"\"})),\"Reference Material\"),mdx(\"ul\",null,mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"/guides/encryption/transit\"}),\"Encryption as a Service\")),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"/docs/secrets/transit\"}),\"Transit Secret Engine\")),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"/api/secret/transit\"}),\"Transit Secret Engine API\")),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"https://www.hashicorp.com/blog/transparent-data-encryption-in-the-modern-datacenter\"}),\"Transparent Data Encryption in the Modern Datacenter\"))),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#estimated-time-to-complete\",\"aria-label\":\"estimated time to complete permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"estimated-time-to-complete\",\"aria-hidden\":\"\"})),\"Estimated Time to Complete\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"30 minutes\"),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#personas\",\"aria-label\":\"personas permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"personas\",\"aria-hidden\":\"\"})),\"Personas\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The end-to-end scenario described in this guide involves two personas:\"),mdx(\"ul\",null,mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"security engineer\"),\" with privileged permissions to manage the encryption keys\"),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"li\"},\"app\"),\" with un-privileged permissions rewraps secrets via API\")),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#challenge\",\"aria-label\":\"challenge permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"challenge\",\"aria-hidden\":\"\"})),\"Challenge\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Vault maintains the versioned keyring and the operator can decide\nthe minimum version allowed for decryption operations. When data is\nencrypted using Vault, the resulting ciphertext is prepended with the version of\nthe key used to encrypt it.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`The following example shows data that was encrypted using the fourth version of\na particular encryption key:`),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),\"vault:v4:ueizdCqCJ/YhowQSvmJyucnLfIUMd4S/nLTpGTcz64HXoY69dwOrqerFzOlhqg==\",`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"For example, an organization could decide that a key should be rotated \",mdx(\"em\",{parentName:\"p\"},`once a\nweek`),`, and that the minimum version allowed to decrypt records is the current\nversion as well as the previous two versions. If the current version is five,\nthen Vault would decrypt records that were sent to it with the following\nprefixes:`),mdx(\"ul\",null,mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"vault:\",mdx(\"strong\",{parentName:\"li\"},\"v5\"),\":lkjasfdlkjafdlkjsdflajsdf==\"),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"vault:\",mdx(\"strong\",{parentName:\"li\"},\"v4\"),\":asdfas9pirapirteradr33vvv==\"),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),\"vault:\",mdx(\"strong\",{parentName:\"li\"},\"v3\"),\":ouoiujarontoiue8987sdjf^1==\")),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`In this example, what would happen if you send Vault data that was encrypted\nwith the first or second version of the key (`,mdx(\"inlineCode\",{parentName:\"p\"},\"vault:v1:...\"),\" or \",mdx(\"inlineCode\",{parentName:\"p\"},\"vault:v2:...\"),\")?\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Vault would refuse to decrypt the data as the key used is less than the minimum\nkey version allowed.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#solution\",\"aria-label\":\"solution permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"solution\",\"aria-hidden\":\"\"})),\"Solution\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Luckily, Vault provides an easy way of re-wrapping encrypted data when a key is\nrotated. Using the rewrap API endpoint, a non-privileged Vault entity can send\ndata encrypted with an older version of the key to have it re-encrypted with the\nlatest version. The application performing the re-wrapping never interacts with\nthe decrypted data. The process of rotating the encryption key and rewrapping\nrecords could (and should) be completely `,mdx(\"strong\",{parentName:\"p\"},\"automated\"),`. Records could be updated\nslowly over time to lessen database load, or all at once at the time of\nrotation. The exact implementation will depend heavily on the needs of each\nparticular organization or application.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#prerequisites\",\"aria-label\":\"prerequisites permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"prerequisites\",\"aria-hidden\":\"\"})),\"Prerequisites\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`To perform the tasks described in this guide, you need to have a Vault\nenvironment. Refer to the `,mdx(\"a\",a({parentName:\"p\"},{href:\"/intro/getting-started/install\"}),`Getting\nStarted`),` guide to install Vault. Make sure\nthat your Vault server has been `,mdx(\"a\",a({parentName:\"p\"},{href:\"/intro/getting-started/deploy\"}),`initialized and\nunsealed`),\".\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`The following tools are required in order to successfully run the sample\napplication provided in this guide:`),mdx(\"ul\",null,mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"https://www.microsoft.com/net/download\"}),\".NET Core\")),mdx(\"li\",a({parentName:\"ul\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"https://docs.docker.com/install/\"}),\"Docker\"))),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Download the sample application code from\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/hashicorp/vault-guides/tree/master/encryption/vault-transit-rewrap\"}),\"vault-guides\"),`\nrepository to perform the steps described in this guide.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"vault-transit-rewrap-example\"),\" contains the following:\"),mdx(\"pre\",a({},{className:\"language-bash\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\".\"),`\n`,\"\\u251C\\u2500\\u2500 AppDb.cs\",`\n`,\"\\u251C\\u2500\\u2500 DBHelper.cs\",`\n`,\"\\u251C\\u2500\\u2500 Program.cs\",`\n`,\"\\u251C\\u2500\\u2500 README.md\",`\n`,\"\\u251C\\u2500\\u2500 Record.cs\",`\n`,\"\\u251C\\u2500\\u2500 VaultClient.cs\",`\n`,\"\\u251C\\u2500\\u2500 WebHelper.cs\",`\n`,\"\\u2514\\u2500\\u2500 rewrap_example.csproj\",`\n`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#policy-requirements\",\"aria-label\":\"policy requirements permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"policy-requirements\",\"aria-hidden\":\"\"})),\"Policy requirements\"),mdx(\"div\",a({},{className:\"alert alert-info g-type-body\",role:\"alert\"}),mdx(\"p\",a({parentName:\"div\"},{className:\"g-type-long-body\"}),\"\",mdx(\"strong\",{parentName:\"p\"},\"NOTE:\"),\" For the purpose of this guide, you can use the \",mdx(\"strong\",{parentName:\"p\"},mdx(\"inlineCode\",{parentName:\"strong\"},\"root\")),` token to work\nwith Vault. However, it is recommended that root tokens are only used for just\nenough initial setup or in emergencies. As a best practice, use tokens with\nan appropriate set of policies based on your role in the organization.`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`To perform all tasks demonstrated in this guide, your policy must include the\nfollowing permissions:`),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Manage transit secret engine\"),`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"transit/keys/*\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sudo\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Enable transit secret engine\"),`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sys/mounts/transit\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Write ACL policies\"),`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sys/policy/*\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"delete\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"list\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Create tokens for verification \u0026 test\"),`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"auth/token/create\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"create\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),\", \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"sudo\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`If you are not familiar with policies, complete the\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"/guides/identity/policies\"}),\"policies\"),\" guide.\"),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#steps\",\"aria-label\":\"steps permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"steps\",\"aria-hidden\":\"\"})),\"Steps\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"This guide introduces a sample \",mdx(\"em\",{parentName:\"p\"},\".Net\"),` application which automates the\nre-wrapping of the data using the latest encryption key.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`For the purpose of this guide, a MySQL database runs locally using Docker.\nHowever, these steps would work for an existing MySQL database by supplying the\nproper network information to your environment.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"You are going to perform the following steps:\"),mdx(\"ol\",null,mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step1\"}),\"Test database setup (Docker)\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step2\"}),\"Enable the transit secret engine\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step3\"}),\"Generate a new token for sample app\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step4\"}),\"Run the sample application\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step5\"}),\"Rotate the encryption keys\")),mdx(\"li\",a({parentName:\"ol\"},{className:\"g-type-long-body\"}),mdx(\"a\",a({parentName:\"li\"},{href:\"#step6\"}),\"Re-wrapping data programmatically\"))),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step1\",\"aria-label\":\"step 1 test database setup docker permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step1\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-1-test-database-setup-docker\",\"aria-hidden\":\"\"})),\"Step 1: Test database setup (Docker)\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`You need a database to test with. You can create one to test with easily using\nDocker:`),mdx(\"pre\",a({},{className:\"language-bash\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Pull the latest mysql container image\"),`\n`,\"docker pull mysql/mysql-server:5.7\",`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Create a directory for our data (change the following line if running on Windows)\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"mkdir\"),\" ~/rewrap-data\",`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Run the container.  The following command creates a database named 'my_app',\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# specifies the root user password as 'root', and adds a user named vault\"),`\n`,\"docker run --name mysql-rewrap \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -p \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"3306\"),\":3306 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -v ~/rewrap-data/var/lib/mysql \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -e \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"MYSQL_ROOT_PASSWORD\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"root \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -e \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"MYSQL_ROOT_HOST\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"% \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -e \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"MYSQL_DATABASE\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"my_app \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -e \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"MYSQL_USER\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"vault \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -e \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"MYSQL_PASSWORD\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\"vaultpw \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"  -d mysql/mysql-server:5.7\",`\n`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step2\",\"aria-label\":\"step 2 enable the transit secret engine permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step2\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-2-enable-the-transit-secret-engine\",\"aria-hidden\":\"\"})),\"Step 2: Enable the transit secret engine\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" security engineer)\"),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Enable the \",mdx(\"inlineCode\",{parentName:\"p\"},\"transit\"),\" secret engine by executing the following command:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault secrets \",mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"enable\"),\" transit\")),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),'Create an encryption key to use for transit named, \"my_app_key\".'),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" -f transit/keys/my_app_key\")),`\n`)),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Enable the \",mdx(\"inlineCode\",{parentName:\"p\"},\"transit\"),\" secret engine via API, use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"/sys/mounts\"),\" endpoint:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: \u003cTOKEN\u003e\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --data \u003cPARAMETERS\u003e \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       \u003cVAULT_ADDRESS\u003e/v1/sys/mounts/transit\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Where \",mdx(\"inlineCode\",{parentName:\"p\"},\"\u003cTOKEN\u003e\"),\" is your valid token, and \",mdx(\"inlineCode\",{parentName:\"p\"},\"\u003cPARAMETERS\u003e\"),\" holds \",mdx(\"a\",a({parentName:\"p\"},{href:\"/api/system/mounts#enable-secrets-engine\"}),`configuration\nparameters`),\" of the secret engine.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To crate a new encryption key, use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"transit/keys/\u003ckey_name\u003e\"),\" endpoint:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: \u003cTOKEN\u003e\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --data \u003cPARAMETERS\u003e \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       \u003cVAULT_ADDRESS\u003e/v1/transit/keys/\u003cKEY_NAME\u003e\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Where \",mdx(\"inlineCode\",{parentName:\"p\"},\"\u003cPARAMETERS\u003e\"),\" holds \",mdx(\"a\",a({parentName:\"p\"},{href:\"/api/secret/transit#create-key\"}),`configuration\nparameters`),\" to specify the key type.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),`       --data '{\"type\": \"transit\"}' \\\\`),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://localhost:8200/v1/sys/mounts/transit\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The above example passes the \",mdx(\"strong\",{parentName:\"p\"},\"type\"),\" (\",mdx(\"inlineCode\",{parentName:\"p\"},\"transit\"),`) in the request payload which\nat the `,mdx(\"inlineCode\",{parentName:\"p\"},\"sys/mounts/transit\"),\" endpoint.\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),'Next, create an encryption key to use for transit named, \"my_app_key\".'),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --request POST \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://localhost:8200/v1/transit/keys/my_app_key\"),`\n`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step3\",\"aria-label\":\"step 3 generate a new token for sample app permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step3\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-3-generate-a-new-token-for-sample-app\",\"aria-hidden\":\"\"})),\"Step 3: Generate a new token for sample app\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" security engineer)\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),'Before generating a token, create a limited scope policy named, \"',mdx(\"strong\",{parentName:\"p\"},\"rewrap_example\"),`\"\nfor the sample application.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The ACL policy (\",mdx(\"inlineCode\",{parentName:\"p\"},\"rewrap_example.hcl\"),\") looks as follows:\"),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"transit/keys/my_app_key\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"read\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"transit/rewrap/my_app_key\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# This last policy is needed to seed the database as part of the example.\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# It can be omitted if seeding is not required\"),`\n`,\"path \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"transit/encrypt/my_app_key\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  capabilities \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"update\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-1\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-1\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Create \",mdx(\"inlineCode\",{parentName:\"p\"},\"rewrap_example\"),\" policy:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault policy \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" rewrap_example ./rewrap_example.hcl\")),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Finally, create a token to use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"rewrap_example\"),\" policy:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault token create -policy\",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"rewrap_example\")),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault token create -policy\",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"rewrap_example\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Key                Value\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"---                -----\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"token              68396128-82d8-002e-f289-1106944fee9f\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"token_accessor     75f05f43-6a5f-2eb1-5bb8-0de3c7cf0996\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"token_duration     768h\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"token_renewable    true\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"token_policies     [default rewrap_example]\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The generated token is what the sample application uses to connect to Vault.\"),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-1\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-1\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To create a policy via API, use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"/sys/policy\"),\" endpoint:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --request PUT --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       --data @payload.json \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://localhost:8200/v1/sys/policy/rewrap_example\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"cat\"),\" payload.json\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'  \"policy\": \"path \\\\\"transit/keys/my_app_key\\\\\" { capabilities = [\\\\\"read\\\\\"] } path \\\\\"transit/rewrap/my_app_key\\\\\" ... }\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Finally, create a token to use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"rewrap_example\"),\" policy:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" --request POST  \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),`       --data '{ \"policies\": [\"rewrap_example\"] }' \\\\`),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://localhost:8200/v1/auth/token/create | jq\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"request_id\": \"da8bde73-99ab-b435-a344-fb963b3a599f\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"lease_id\": \"\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"renewable\": false,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"lease_duration\": 0,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"data\": null,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"wrap_info\": null,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"warnings\": null,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"auth\": {'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"client_token\": \"997107d5-9049-8b4b-8f39-a33a458fd02d\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"accessor\": \"d400076b-4143-4d63-7473-a8cc52c73ba3\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"policies\": ['),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     \"default\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     \"rewrap-example\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"   ],\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"metadata\": null,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"lease_duration\": 2764800,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"renewable\": true,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"entity_id\": \"\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\" }\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The generated token is what the sample application uses to connect to Vault.\"),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step4\",\"aria-label\":\"step 4 run the sample application permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step4\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-4-run-the-sample-application\",\"aria-hidden\":\"\"})),\"Step 4: Run the sample application\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" app)\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"You are now ready to run the app. Be sure to \",mdx(\"a\",a({parentName:\"p\"},{href:\"#prerequisites\"}),\"download\"),` the\nsample application code before beginning.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Sample application\")),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",a({parentName:\"tr\"},{align:null}),\"File\"),mdx(\"th\",a({parentName:\"tr\"},{align:null}),\"Description\"))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Program.cs\"),mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Starting point of this sample app (the \",mdx(\"inlineCode\",{parentName:\"td\"},\"Main()\"),\" method) is in this file. It reads the environment variable values, connects to Vault and the MySQL database. If the \",mdx(\"inlineCode\",{parentName:\"td\"},\"user_data\"),\" table does not exist, it creates it.\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"DBHelper.cs\"),mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Defines a method to create the \",mdx(\"inlineCode\",{parentName:\"td\"},\"user_data\"),\" table if it does not exist. Finds and updates records that need to be rewrapped with the new key.\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"AppDb.cs\"),mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Connects to the MySQL database.\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Record.cs\"),mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Sample data record template.\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"VaultClient.cs\"),mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Defines methods necessary to rewrap transit data.\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"WebHelper.cs\"),mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Helper code to seed the initial table schema.\")),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"rewrap_example.csproj\"),mdx(\"td\",a({parentName:\"tr\"},{align:null}),\"Project file for this sample app.\")))),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`The sample app retrieves the user token, Vault address, and the name of the\ntransit key through environment variables. Be sure to supply the token created\nin `,mdx(\"a\",a({parentName:\"p\"},{href:\"#step3\"}),\"Step 3\"),\":\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_TOKEN\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"))),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\u003cAPP_TOKEN\u003e \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"     VAULT_ADDR=\u003cVAULT_ADDRESS\u003e \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"     VAULT_TRANSIT_KEY=my_app_key \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"     SHOULD_SEED_USERS=true \\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"     dotnet run\"),`\n`)),mdx(\"blockquote\",null,mdx(\"p\",a({parentName:\"blockquote\"},{className:\"g-type-long-body\"}),`If you need to seed test data you can do so by including the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"SHOULD_SEED_USERS=true\"),\".\")),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_TOKEN\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$TOKEN\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_ADDR\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"http://localhost:8200 \",mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_TRANSIT_KEY\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"my_app_key \",mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"SHOULD_SEED_USERS\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"true dotnet run\")),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Connecting to Vault server...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Created (if not exist) my_app DB\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Create (if not exist) user_data table\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Seeded the database...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Moving rewrap...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Current Key Version: 5\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Found 0 records to rewrap.\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"You can inspect the contents of the database with:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"docker \",mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"exec\"),\" -it mysql-rewrap mysql -uroot -proot\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"mysql\u003e DESC user_data;\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'mysql\u003e SELECT * FROM user_data WHERE dob LIKE \"vault:v1%\" limit 10;'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"...data...\"),`\n`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step5\",\"aria-label\":\"step 5 rotate the encryption keys permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step5\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-5-rotate-the-encryption-keys\",\"aria-hidden\":\"\"})),\"Step 5: Rotate the encryption keys\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" security engineer)\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"The encryption key (\",mdx(\"inlineCode\",{parentName:\"p\"},\"my_app_key\"),\") can be rotated easily.\"),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#cli-command-2\",\"aria-label\":\"cli command permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"cli-command-2\",\"aria-hidden\":\"\"})),\"CLI command\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To rotate the key, you write to the \",mdx(\"inlineCode\",{parentName:\"p\"},\"transit/keys/\u003cKEY_NAME\u003e/rotate\"),\" path.\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"write\"),\" -f transit/keys/my_app_key/rotate\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Success! Data written to: transit/keys/my_app_key/rotate\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Run the command a few times to generate several versions of the encryption key\nfor testing.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To view the key information:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"vault \",mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"read\"),\" transit/keys/my_app_key\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Key                       Value\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"---                       -----\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"allow_plaintext_backup    false\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"deletion_allowed          false\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"derived                   false\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"exportable                false\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"keys                      map[5:1519623974 6:1519623980 1:1519620952 2:1519623255 3:1519623285 4:1519623603]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"latest_version            6\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"min_decryption_version    1\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"min_encryption_version    0\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"name                      my_app_key\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"supports_decryption       true\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"supports_derivation       true\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"supports_encryption       true\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"supports_signing          false\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"type                      aes256-gcm96\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`You can see that in the above example the current version of the key is six.\nThere is no restriction about a minimum encryption key version, and any of the key\nversions can decrypt the data (`,mdx(\"inlineCode\",{parentName:\"p\"},\"min_decryption_version\"),\").\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Let's enforce the use of the encryption key at version five or later to decrypt\ndata.`),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# replace '5' with the appropriate version\"),`\n`,\"$ vault \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"write\"),\" transit/keys/my_app_key/config \",mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"min_decryption_version\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"5\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Verify the changes were successful\"),`\n`,\"$ vault \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"read\"),\" transit/keys/my_app_key\",`\n`,\"Key                       Value\",`\n`,\"---                       -----\",`\n`,\"allow_plaintext_backup    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"deletion_allowed          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"derived                   \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"exportable                \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,\"keys                      map\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"5\"),\":1519623974 \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"6\"),\":1519623980\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,\"latest_version            \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"6\"),`\n`,\"min_decryption_version    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"5\"),`\n`,\"min_encryption_version    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"0\"),`\n`,\"name                      my_app_key\",`\n`,\"supports_decryption       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"supports_derivation       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"supports_encryption       \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n`,\"supports_signing          \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"false\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"type\"),\"                      aes256-gcm96\",`\n`)),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#api-call-using-curl-2\",\"aria-label\":\"api call using curl permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"api-call-using-curl-2\",\"aria-hidden\":\"\"})),\"API call using cURL\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"To rotate the encryption key via API, use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"transit/keys/\u003cKEY_NAME\u003e/rotate\"),\" endpoint:\"),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --request POST --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://localhost:8200/v1/transit/keys/my_app_key/rotate\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Run the command a few times to generate several versions of the encryption key\nfor testing.`),mdx(\"pre\",a({},{className:\"language-shell\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Verify the changes were successful\"),`\n`,\"$ \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"curl\"),\" --request GET --header \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n`,\"      https://localhost:8200/v1/transit/keys/my_app_key \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" jq\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"request_id\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ed13436a-4816-2f51-0552-6a001e823548\"'),\",\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"lease_id\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"\"'),\",\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"renewable\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" false,\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"lease_duration\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"0\"),\",\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"data\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"allow_plaintext_backup\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" false,\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"deletion_allowed\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" false,\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"derived\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" false,\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"exportable\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" false,\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"keys\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1519620952\"),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"2\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1519623255\"),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"3\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1519623285\"),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"4\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1519623603\"),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"5\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1519623974\"),\",\",`\n`,\"      \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"6\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1519623980\"),`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"latest_version\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"6\"),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"min_decryption_version\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1\"),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"min_encryption_version\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"0\"),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"name\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"my_app_key\"'),\",\",`\n`,\"    \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\",\",`\n`,\"  \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\".\",`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`You can see that in the above example the current version of the key is six.\nThere is no restriction about the minimum encryption key version, and any of the key\nversions can decrypt the data (`,mdx(\"inlineCode\",{parentName:\"p\"},\"min_decryption_version\"),\").\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Let's enforce the use of the encryption key at version five or later to decrypt the\ndata.`),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --request POST --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),`       --data '{ \"min_decryption_version\": 5 }'`),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://localhost:8200/v1/transit/keys/my_app_key/config\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"#\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"Verify the changes were successful\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"curl\"),\" --request GET --header \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"X-Vault-Token: ...\"'),\" \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"       https://localhost:8200/v1/transit/keys/my_app_key | jq\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"{\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\" ...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),' \"data\": {'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"   ...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"keys\": {'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     \"5\": 1519623974,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'     \"6\": 1519623980'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"   },\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"latest_version\": 6,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"min_decryption_version\": 5,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"min_encryption_version\": 0,'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'   \"name\": \"my_app_key\",'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"   ...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"  },\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"}\"),`\n`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#step6\",\"aria-label\":\"step 6 programmatically re wrap the data permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h __compat\",id:\"step6\",\"aria-hidden\":\"\"})),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"step-6-programmatically-re-wrap-the-data\",\"aria-hidden\":\"\"})),\"Step 6: Programmatically re-wrap the data\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"(\",mdx(\"strong\",{parentName:\"p\"},\"Persona:\"),\" app)\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Now you have records in the database and you have updated our minimum key\nversion. You can run the application again and should see it update records as\nappropriate. Remember you can inspect records using the MySQL shell (see above).`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),mdx(\"strong\",{parentName:\"p\"},\"Example:\")),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_TOKEN\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"2616214b-6868-3589-b443-0330d7915882 \",mdx(\"span\",a({parentName:\"span\"},{className:\"token assign-left variable\"}),\"VAULT_ADDR\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"=\"),\"http://localhost:8200 \")),mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"\\\\\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"          VAULT_TRANSIT_KEY=my_app_key SHOULD_SEED_USERS=true dotnet run\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Connecting to Vault server...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Created (if not exist) my_app DB\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Create (if not exist) user_data table\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Seeded the database...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Current Key Version: 6\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Found 3500 records to rewrap.\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Wrapped another 10 records: 10 so far...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Wrapped another 10 records: 20 so far...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Wrapped another 10 records: 30 so far...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`)),mdx(\"h4\",a({},{className:\"g-type-display-5\"}),mdx(\"a\",a({parentName:\"h4\"},{className:\"__permalink-h\",href:\"#validation\",\"aria-label\":\"validation permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h4\"},{className:\"__target-h\",id:\"validation\",\"aria-hidden\":\"\"})),\"Validation\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`The application has now re-wrapped all records with the latest key. You can\nverify this by running the application again, or by inspecting the records using the\nMySQL client.`),mdx(\"pre\",a({},{className:\"language-shell-session\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-shell-session\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token command\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token shell-symbol important\"}),\"$\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token bash language-bash\"}),\"docker \",mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"exec\"),\" -it mysql-rewrap mysql -uroot -proot\")),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"mysql\u003e DESC user_data;\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'mysql\u003e SELECT * FROM user_data WHERE dob LIKE \"vault:v1%\" limit 10;'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"Empty set (0.00 sec)\"),`\n`,`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),'mysql\u003e SELECT * FROM user_data WHERE dob LIKE \"vault:v6%\" limit 10;'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token output\"}),\"...data...\"),`\n`)),mdx(\"h3\",a({},{className:\"g-type-display-4\"}),mdx(\"a\",a({parentName:\"h3\"},{className:\"__permalink-h\",href:\"#conclusion\",\"aria-label\":\"conclusion permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h3\"},{className:\"__target-h\",id:\"conclusion\",\"aria-hidden\":\"\"})),\"Conclusion\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`An application similar to this could be scheduled via cron, run periodically as\na `,mdx(\"a\",a({parentName:\"p\"},{href:\"https://www.nomadproject.io/docs/job-specification/periodic\"}),`Nomad batch\njob`),`, or\nexecuted in a variety of other ways. You could also modify it to re-wrap a\nlimited number of records at a time so as to not put undue strain on the\ndatabase. The final implementation should be based upon the needs and design\ngoals specific to each organization or application.`),mdx(\"h2\",a({},{className:\"g-type-display-3\"}),mdx(\"a\",a({parentName:\"h2\"},{className:\"__permalink-h\",href:\"#next-steps\",\"aria-label\":\"next steps permalink\"}),\"\\xBB\"),mdx(\"a\",a({parentName:\"h2\"},{className:\"__target-h\",id:\"next-steps\",\"aria-hidden\":\"\"})),\"Next Steps\"),mdx(\"p\",a({},{className:\"g-type-long-body\"}),`Since the main focus of this guide was to programmatically rewrap your secrets\nusing the latest encryption key, the token used by the sample application was\ngenerated manually. In a production environment, you'll want to pass the token in\na more secure manner. Refer to the `,mdx(\"a\",a({parentName:\"p\"},{href:\"/guides/secret-mgmt/cubbyhole\"}),`Cubbyhole Response\nWrapping`),` guide to wrap the token so that only the\nexpecting app can unwrap to obtain the token.`),mdx(\"p\",a({},{className:\"g-type-long-body\"}),\"Also, refer to the \",mdx(\"a\",a({parentName:\"p\"},{href:\"/guides/identity/authentication\"}),`AppRole Pull\nAuthentication`),` to generate tokens for\napps using the AppRole auth method.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"navData":[{"title":"Getting Started","path":"getting-started","filePath":"content/guides/getting-started.mdx"},{"title":"Vault Operations","routes":[{"title":"Overview","path":"operations","filePath":"content/guides/operations/index.mdx"},{"title":"Reference Architecture","path":"operations/reference-architecture","filePath":"content/guides/operations/reference-architecture.mdx"},{"title":"Vault HA with Consul","path":"operations/vault-ha-consul","filePath":"content/guides/operations/vault-ha-consul.mdx"},{"title":"Production Hardening","path":"operations/production","filePath":"content/guides/operations/production.mdx"},{"title":"Root Token Generation","path":"operations/generate-root","filePath":"content/guides/operations/generate-root.mdx"},{"title":"Rekeying \u0026 Rotating","path":"operations/rekeying-and-rotating","filePath":"content/guides/operations/rekeying-and-rotating.mdx"},{"title":"Building Plugin Backends","path":"operations/plugin-backends","filePath":"content/guides/operations/plugin-backends.mdx"},{"divider":true},{"title":"Replication Setup \u0026 Guidance","path":"operations/replication","filePath":"content/guides/operations/replication.mdx"},{"title":"Disaster Recovery Setup","path":"operations/disaster-recovery","filePath":"content/guides/operations/disaster-recovery.mdx"},{"title":"Mount Filter","path":"operations/mount-filter","filePath":"content/guides/operations/mount-filter.mdx"},{"title":"Multi-Tenant: Namespaces","path":"operations/multi-tenant","filePath":"content/guides/operations/multi-tenant.mdx"},{"title":"Vault Auto-unseal with AWS KMS","path":"operations/autounseal-aws-kms","filePath":"content/guides/operations/autounseal-aws-kms.mdx"},{"title":"Seal Wrap / FIPS 140-2","path":"operations/seal-wrap","filePath":"content/guides/operations/seal-wrap.mdx"},{"title":"Vault Cluster Monitoring","path":"operations/monitoring","filePath":"content/guides/operations/monitoring.mdx"},{"title":"Vault Deployment Guide","path":"operations/deployment-guide","filePath":"content/guides/operations/deployment-guide.mdx"},{"title":"Performance Standby Nodes","path":"operations/performance-nodes","filePath":"content/guides/operations/performance-nodes.mdx"}]},{"title":"Identity and Access Management","routes":[{"title":"Overview","path":"identity","filePath":"content/guides/identity/index.mdx"},{"title":"Secure Introduction of Vault Clients","path":"identity/secure-intro","filePath":"content/guides/identity/secure-intro.mdx"},{"title":"Policies","path":"identity/policies","filePath":"content/guides/identity/policies.mdx"},{"title":"ACL Policy Path Templating","path":"identity/policy-templating","filePath":"content/guides/identity/policy-templating.mdx"},{"title":"AppRole Pull Authentication","path":"identity/authentication","filePath":"content/guides/identity/authentication.mdx"},{"title":"AppRole with Terraform and Chef","path":"identity/approle-trusted-entities","filePath":"content/guides/identity/approle-trusted-entities.mdx"},{"title":"Tokens and Leases","path":"identity/lease","filePath":"content/guides/identity/lease.mdx"},{"title":"Identity - Entities \u0026 Groups","path":"identity/identity","filePath":"content/guides/identity/identity.mdx"},{"divider":true},{"title":"Sentinel Policies","path":"identity/sentinel","filePath":"content/guides/identity/sentinel.mdx"},{"title":"Control Groups","path":"identity/control-groups","filePath":"content/guides/identity/control-groups.mdx"}]},{"title":"Secrets Management","routes":[{"title":"Overview","path":"secret-mgmt","filePath":"content/guides/secret-mgmt/index.mdx"},{"title":"Static Secrets","path":"secret-mgmt/static-secrets","filePath":"content/guides/secret-mgmt/static-secrets.mdx"},{"title":"Versioned KV Secret Engine","path":"secret-mgmt/versioned-kv","filePath":"content/guides/secret-mgmt/versioned-kv.mdx"},{"title":"Secret as a Service","path":"secret-mgmt/dynamic-secrets","filePath":"content/guides/secret-mgmt/dynamic-secrets.mdx"},{"title":"DB Root Credential Rotation","path":"secret-mgmt/db-root-rotation","filePath":"content/guides/secret-mgmt/db-root-rotation.mdx"},{"title":"Cubbyhole Response Wrapping","path":"secret-mgmt/cubbyhole","filePath":"content/guides/secret-mgmt/cubbyhole.mdx"},{"title":"One-Time SSH Password","path":"secret-mgmt/ssh-otp","filePath":"content/guides/secret-mgmt/ssh-otp.mdx"},{"title":"Build Your Own CA","path":"secret-mgmt/pki-engine","filePath":"content/guides/secret-mgmt/pki-engine.mdx"},{"title":"Direct Application Integration","path":"secret-mgmt/app-integration","filePath":"content/guides/secret-mgmt/app-integration.mdx"}]},{"title":"Encryption as a Service","routes":[{"title":"Overview","path":"encryption","filePath":"content/guides/encryption/index.mdx"},{"title":"Encryption as a Service","path":"encryption/transit","filePath":"content/guides/encryption/transit.mdx"},{"title":"Java Application Demo","path":"encryption/spring-demo","filePath":"content/guides/encryption/spring-demo.mdx"},{"title":"Transit Secrets Re-wrapping","path":"encryption/transit-rewrap","filePath":"content/guides/encryption/transit-rewrap.mdx"}]}],"versions":[]},"__N_SSG":true},"page":"/guides/[[...page]]","query":{"page":["encryption","transit-rewrap"]},"buildId":"pcCu12fyWK7PoQNj4BZ7-","assetPrefix":"/docs/vault_v1.8.x","isFallback":false,"gsp":true}</script><script nomodule="" src="/docs/vault_v1.8.x/_next/static/chunks/polyfills-e4c38ea28892f36667af.js"></script><script src="/docs/vault_v1.8.x/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/framework.3519294afa6a9ab53973.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/2bc72d9a08d5bd816ae6b580871df9fb671d43bb.52fd5ef7a8ab7d8fc0dd.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/9a5be27b89b50ff891e514a88cd42f143404f9a6.033857d62f5a01edf3b3.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/main-b0f1f3f8bd3bddd4e6cd.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/b49b08e2da573413c730dfc51ae423f080a0c275.00ac32ee45240d5b343f.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/b1542cc239bf56c8a14913c0a930efe682b5cf86.32bb900ad80311488529.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/pages/_app-d714c55ad24af91621ba.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/7dbdcaca29374b13a0799a901e26613767d72de2.d088888a4a1113f2bb24.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/92f0085e0e6c1f10382de10b8861ce89d7c192a2.e5495ede8461fc33ed98.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b.5052eda5c7f43583669b.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/e697469aff49e0b13fc0c4d2651008fc1aaadc2b_CSS.f6584926f1188e1b5b3e.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/chunks/pages/guides/%5B%5B...page%5D%5D-72f9db6e509b49c776de.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/pcCu12fyWK7PoQNj4BZ7-/_buildManifest.js" async=""></script><script src="/docs/vault_v1.8.x/_next/static/pcCu12fyWK7PoQNj4BZ7-/_ssgManifest.js" async=""></script><script nomodule="">window.MSInputMethodContext && document.documentMode && document.write('<script src="/ie-custom-properties.js"><\x2fscript>');</script></body></html>