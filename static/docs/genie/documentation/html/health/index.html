<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyATS Health Check &mdash; Genie Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-player.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/genie_ico.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/asciinema-player.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Design" href="health_design/design.html" />
    <link rel="prev" title="Usage" href="../blitz/usage/usage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS Library: Genie
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbooks/index.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../userguide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clean/index.html">pyATS Clean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blitz/index.html">pyATS Blitz</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pyATS Health Check</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health_design/design.html">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_usage/usage.html">Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Genie Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../solutions/index.html">Genie Solutions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://wiki.cisco.com/pages/viewpage.action?pageId=831194226">Internal Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis">Available APIs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/clean">Available Clean Stages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/models">Available Models (Conf/Ops)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers">Available Parsers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/triggers">Available Triggers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/verifications">Available Verifications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../abstract/index.html">Library Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metaparser/index.html">Metaparsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parsergen/index.html">CLI Auto-Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../predcore/index.html">Predicates</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS Library: Genie</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">pyATS Health Check</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pyats-health-check">
<span id="health"></span><h1>pyATS Health Check<a class="headerlink" href="#pyats-health-check" title="Permalink to this heading"></a></h1>
<p>By using pyATS Health Check, it is possible to check the CPU load, memory usage, detection of specific log messages, and whether or not the core file created in the event of a crash or malfunction is generated.</p>
<p>pyATS Health Check currently supports the following 4 checks by default.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>health check</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cpu</p></td>
<td><p>cpu load check. check total of cpu load with threshold 90% by default.</p></td>
</tr>
<tr class="row-odd"><td><p>memory</p></td>
<td><p>memory usage check. check total of memory usage with threshold 90% by default.</p></td>
</tr>
<tr class="row-even"><td><p>logging</p></td>
<td><p>keyword check in show logging output. default keywords are traceback, Traceback, TRACEBACK</p></td>
</tr>
<tr class="row-odd"><td><p>core</p></td>
<td><p>check if core file is generated on device. just check by default. Please use <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-remote-device</span></code> to copy the core file to remote server.</p></td>
</tr>
</tbody>
</table>
<p>Using pyATS Health Check is very easy. Just list the above heath check names by adding <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-checks</span></code> to the current pyats command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core
</pre></div>
</div>
<p>If you want to check only cpu, please specify <code class="xref py py-obj docutils literal notranslate"><span class="pre">cpu</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-checks</span></code>. <strong>The pyATS Health Check specified by `–health-checks` runs as a post-processor after each test case.</strong></p>
<p>The core file is the only detection that is by default. If you want to send it to TAC for analysis or move it to the remote server at the time of detection, you can enumerate the remote server information with <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-remote-device</span></code> to copy the generated core file. To copy the file at the time of detection and delete the file from the device, specify the –health-remote-device argument.</p>
<p>The command example in that case is as follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core<span class="w"> </span>--health-remote-device<span class="w"> </span>name:myserver<span class="w"> </span>path:/tmp/<span class="w"> </span>protocol:http<span class="w"> </span>--health-mgmt-vrf<span class="w"> </span>iosxe:None
</pre></div>
</div>
<p>Note that in order to run the above example you need to have the server <code class="xref py py-obj docutils literal notranslate"><span class="pre">myserver</span></code> in testbed yaml as below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">testbed</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">general_xe_xr_nx</span>
<span class="w">  </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">myserver</span><span class="p">:</span>
<span class="w">      </span><span class="nt">dynamic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.255.0/24</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<span class="w">      </span><span class="nt">credentials</span><span class="p">:</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span>
<span class="w">          </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyats</span>
<span class="w">          </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;password&gt;&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above example uses <a class="reference external" href="https://pubhub.devnetcloud.com/media/pyats/docs/utilities/file_transfer_server.html">Embedded pyATS File Transfer Server</a>.</p>
</div>
<p>You can find more examples in our <a class="reference external" href="https://github.com/CiscoTestAutomation/examples/tree/master/health">Github repo</a>. Any contributions for pyATS Health Check examples are encouraged!</p>
<section id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this heading"></a></h2>
<p><strong>1. What kind of protocols are supported for core file transfer? And how to adjust to my remote server info?</strong></p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">http</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">scp</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">tftp</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">ftp</span></code> are supported. It depends on what is supported by <a class="reference external" href="https://pubhub.devnetcloud.com/media/pyats/docs/utilities/file_transfer_utilities.html">Multiprotocol File Transfer Utilities</a>.</p>
<p>If VRF for transfer needs to be changed from common default ones (<code class="xref py py-obj docutils literal notranslate"><span class="pre">Mgmt-intf</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">management</span></code>), please change via <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-mgmt-vrf</span></code> argument. for default VRF, needs to specify <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code> like <code class="xref py py-obj docutils literal notranslate"><span class="pre">iosxe:None</span></code>.</p>
<p>example when using tftp and vrf <code class="xref py py-obj docutils literal notranslate"><span class="pre">mgmt</span></code> for both iosxe and nxos</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core<span class="w"> </span>--health-remote-device<span class="w"> </span>name:myserver<span class="w"> </span>path:/tmp/<span class="w"> </span>protocol:scp<span class="w"> </span>--health-mgmt-vrf<span class="w"> </span>iosxe:mgmt<span class="w"> </span>nxos:mgmt
</pre></div>
</div>
<p><strong>2. How to change threshold for cpu load/memory usage?</strong></p>
<p>It can be done via <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-threshold</span></code> argument.</p>
<p>example when specifying thresholds, cpu 75% and memory 80%</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core<span class="w"> </span>--health-threshold<span class="w"> </span>cpu:75<span class="w"> </span>memory:80
</pre></div>
</div>
<p><strong>3. How can I change which logging keywords I want to detect?</strong></p>
<p>By default, <code class="xref py py-obj docutils literal notranslate"><span class="pre">logging</span></code> check detects only <code class="xref py py-obj docutils literal notranslate"><span class="pre">traceback</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Traceback</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">TRACEBACK</span></code>. The keywords can be overwritten via <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-show-logging-keywords</span></code>.</p>
<p>example when changing to <code class="xref py py-obj docutils literal notranslate"><span class="pre">Crash</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">CRASH</span></code> for both iosxr and nxos.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core<span class="w"> </span>--health-show-logging-keywords<span class="w"> </span><span class="s2">&quot;iosxr:[&#39;Crash&#39;, &#39;CRASH&#39;]&quot;</span><span class="w"> </span><span class="s2">&quot;nxos:[&#39;Crash&#39;, &#39;CRASH&#39;]&quot;</span>
</pre></div>
</div>
<p><strong>4. I want to change the location of where core files are searched for</strong></p>
<p>by default, it’s pre-defined for each platform (iosxe, iosxr, nxos). If you want to look somewhere else, the location can be overwritten via <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-core-default-dir</span></code>.</p>
<p>example to change to <code class="xref py py-obj docutils literal notranslate"><span class="pre">harddisk0:/core</span></code> for iosxe.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core<span class="w"> </span>--health-core-default-dir<span class="w"> </span><span class="s2">&quot;iosxe:[&#39;harddisk0:/core&#39;]&quot;</span>
</pre></div>
</div>
<p><strong>5. How to run pyATS Health check against only certain devices?</strong></p>
<p>All checks will run against all connected devices in testbed yaml by default. To run checks against only specific devices, please use <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-devices</span></code>.</p>
<p>example to run against only <code class="xref py py-obj docutils literal notranslate"><span class="pre">R1_xe</span></code> device.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core<span class="w"> </span>--health-devices<span class="w"> </span>R1_xe
</pre></div>
</div>
<p><strong>6. Is it possible to send a webex notification?</strong></p>
<p>Yes. There is <code class="xref py py-obj docutils literal notranslate"><span class="pre">--health-webex</span></code> argument to send a webex notification. The webex notification will be sent out only when health checks fail.
Webex token and space id or email need to be given via pyats.conf or webex arguments <code class="xref py py-obj docutils literal notranslate"><span class="pre">--webex-token</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">--webex-space</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">--webex-email</span></code>.</p>
<p>example to send Webex notification to webex space by using webex arguments</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyats<span class="w"> </span>run<span class="w"> </span>job<span class="w"> </span>&lt;job<span class="w"> </span>file&gt;<span class="w"> </span>--testbed-file<span class="w"> </span>/path/to/testbed.yaml<span class="w"> </span>--health-checks<span class="w"> </span>cpu<span class="w"> </span>memory<span class="w"> </span>logging<span class="w"> </span>core<span class="w"> </span>--health-webex<span class="w"> </span>--webex-token<span class="w"> </span>&lt;webex<span class="w"> </span>token&gt;<span class="w"> </span>--webex-space<span class="w"> </span>&lt;webex<span class="w"> </span>space<span class="w"> </span>id&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Webex notification is done by pyATS Webex Plugin in <code class="xref py py-obj docutils literal notranslate"><span class="pre">pyats.contrib</span></code> package. Please refer to <a class="reference external" href="https://github.com/CiscoTestAutomation/pyats.contrib/tree/master/src/pyats/contrib/plugins/webex_plugin">Webex Plugin README</a> for more detail.</p>
</div>
<hr class="docutils" />
<p>The above are all the easy ways to use pyATS Health Check. Also, please be aware that each of the above arguments can be used in combination. If you want to use custom pyATS Health Checks, please check the design chapter.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="health_design/design.html">Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health_design/design.html#pyats-health-check-yaml">pyATS Health Check yaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_design/design.html#processor-key-in-yaml">processor key in YAML</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_design/design.html#reconnect-feature">reconnect feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_design/design.html#selecting-testcase-section">Selecting Testcase/Section</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_design/design.html#result-propagation">Result propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_design/design.html#supported-platforms-for-pyats-health-check">Supported Platforms for pyATS Health Check</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="health_usage/usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="health_usage/usage.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_usage/usage.html#integrated">Integrated</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_usage/usage.html#standalone">Standalone</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_usage/usage.html#pyats-health-check-yaml-validation">pyATS Health Check YAML Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="health_usage/usage.html#pyats-health-check-examples">pyATS Health Check Examples</a></li>
</ul>
</li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../blitz/usage/usage.html" class="btn btn-neutral float-left" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="health_design/design.html" class="btn btn-neutral float-right" title="Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 30, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>