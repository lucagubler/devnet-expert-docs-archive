<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Summary &mdash; Genie Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/asciinema-player.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/genie_ico.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/asciinema-player.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Summary" href="ops.html" />
    <link rel="prev" title="1. Summary" href="cli.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS Library: Genie
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#explore-genie">Explore Genie</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#genie-general">Genie - General</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#genie-command-line">Genie Command Line</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#genie-libs-parsers">Genie.libs.parsers</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">1. Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#available-parsers">2. Available parsers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-execute-a-parser-python">3. How to execute a parser - Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-execute-a-parser-linux">3. How to execute a parser - Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-exclude-keys-for-a-parser-python">4. Get exclude keys for a parser - Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compare-two-parsers-python">5. Compare two parsers - Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#executing-parsers-with-fuzzy-search-python">6. Executing parsers with fuzzy search - Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-the-raw-ouput-of-a-parser">7. Getting the raw ouput of a parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-parsers-apis">8. External Parsers/APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-an-external-parser-api">What is an external parser/api?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-by-step-guide-for-local-genie-library-implementation">Step-By-Step Guide For Local Genie Library Implementation:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-local-private-overwrite-genie-libraries">Using Local/Private/Overwrite Genie Libraries:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#genie-ops">Genie.Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#genie-conf">Genie.Conf</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#genie-harness">Genie.Harness</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userguide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clean/index.html">pyATS Clean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blitz/index.html">pyATS Blitz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../health/index.html">pyATS Health Check</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Genie Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../solutions/index.html">Genie Solutions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://wiki.cisco.com/pages/viewpage.action?pageId=831194226">Internal Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis">Available APIs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/clean">Available Clean Stages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/models">Available Models (Conf/Ops)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers">Available Parsers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/triggers">Available Triggers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/verifications">Available Verifications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../abstract/index.html">Library Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metaparser/index.html">Metaparsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parsergen/index.html">CLI Auto-Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../predcore/index.html">Predicates</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS Library: Genie</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Getting Started</a></li>
      <li class="breadcrumb-item active">1. Summary</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h2>Genie Parser Recipes</h2><section id="summary">
<h1>1. Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h1>
<p>Genie.libs.parsers is a parser library. It takes device output and convert it
into a structured datatype (Json/dictionary)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------------------
Port   VRF          Status IP Address                              Speed    MTU
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
Ethernet      VLAN    Type Mode   Status  Reason                   Speed     Port
Interface                                                                    Ch #
--------------------------------------------------------------------------------
Eth1/1        1       eth  routed up      none                       1000(D) --
Eth1/2        --      eth  routed up      none                       1000(D) --
Eth1/3        --      eth  routed up      none                       1000(D) --
</pre></div>
</div>
<p>And convert it into</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># parsed_output
# -------------
# {&#39;Eth1/1&#39;: {&#39;Ethernet Interface&#39;: &#39;Eth1/1&#39;,
#             &#39;Mode&#39;: &#39;routed&#39;,
#             &#39;Port&#39;: &#39;--&#39;,
#             &#39;Reason&#39;: &#39;none&#39;,
#             &#39;Speed&#39;: &#39;1000(D)&#39;,
#             &#39;Status&#39;: &#39;up&#39;,
#             &#39;Type&#39;: &#39;eth&#39;,
#             &#39;VLAN&#39;: &#39;1&#39;},
#  &#39;Eth1/2&#39;: {&#39;Ethernet Interface&#39;: &#39;Eth1/2&#39;,
#             &#39;Mode&#39;: &#39;routed&#39;,
#             &#39;Port&#39;: &#39;--&#39;,
#             &#39;Reason&#39;: &#39;none&#39;,
#             &#39;Speed&#39;: &#39;1000(D)&#39;,
#             &#39;Status&#39;: &#39;up&#39;,
#             &#39;Type&#39;: &#39;eth&#39;,
#             &#39;VLAN&#39;: &#39;--&#39;},
#  &#39;Eth1/3&#39;: {&#39;Ethernet Interface&#39;: &#39;Eth1/3&#39;,
#             &#39;Mode&#39;: &#39;routed&#39;,
#             &#39;Port&#39;: &#39;--&#39;,
#             &#39;Reason&#39;: &#39;none&#39;,
#             &#39;Speed&#39;: &#39;1000(D)&#39;,
#             &#39;Status&#39;: &#39;up&#39;,
#             &#39;Type&#39;: &#39;eth&#39;,
#             &#39;VLAN&#39;: &#39;--&#39;}}
</pre></div>
</div>
<p>Once you have this structured data you can do so much with it:</p>
<blockquote>
<div><ul class="simple">
<li><p>Look for specific key/value</p></li>
<li><p>Verify if state is as expected</p></li>
<li><p>Compare between two dictionaries and verify if anything has changed</p></li>
</ul>
</div></blockquote>
<p>Once you have the data, the possibilities are really limitless.</p>
</section>
<section id="available-parsers">
<h1>2. Available parsers<a class="headerlink" href="#available-parsers" title="Permalink to this heading"></a></h1>
<p>Visit our <a class="reference external" href="http://wwwin-pyats.cisco.com/cisco-shared/genie/latest/genie_libs/#/parsers">website to find all the available parsers</a>.</p>
</section>
<section id="how-to-execute-a-parser-python">
<h1>3. How to execute a parser - Python<a class="headerlink" href="#how-to-execute-a-parser-python" title="Permalink to this heading"></a></h1>
<p>Parsers are easy to call.</p>
<p>You want to call it within python? First, you must have a <a class="reference internal" href="genie.html#book-setup-testbed"><span class="std std-ref">Genie Testbed
object</span></a>.</p>
<i class="fa fa-anchor"></i>
<span style='color:#6ab0de'>Python</span><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;nx-osv-1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;nx-osv-1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;show version&#39;</span><span class="p">)</span>
<span class="n">output</span>
<span class="c1"># {&#39;platform&#39;: {&#39;hardware&#39;: {&#39;bootflash&#39;: &#39;3184776 kB&#39;,</span>
<span class="c1">#    &#39;chassis&#39;: &#39;NX-OSv Supervisor Module&#39;,</span>
<span class="c1">#    &#39;device_name&#39;: &#39;nx-osv-1&#39;,</span>
<span class="c1">#    &#39;model&#39;: &#39;NX-OSv&#39;,</span>
<span class="c1">#    &#39;processor_board_id&#39;: &#39;TM00010000B&#39;,</span>
<span class="c1">#    &#39;slots&#39;: &#39;None&#39;},</span>
<span class="c1">#   &#39;kernel_uptime&#39;: {&#39;days&#39;: 6, &#39;hours&#39;: 1, &#39;minutes&#39;: 12, &#39;seconds&#39;: 30},</span>
<span class="c1">#   &#39;name&#39;: &#39;Nexus&#39;,</span>
<span class="c1">#   &#39;os&#39;: &#39;NX-OS&#39;,</span>
<span class="c1">#   &#39;software&#39;: {&#39;kickstart_compile_time&#39;: &#39;1/11/2016 16:00:00 [02/11/2016 10:30:12]&#39;,</span>
<span class="c1">#    &#39;kickstart_image_file&#39;: &#39;bootflash:///titanium-d1-kickstart.7.3.0.D1.1.bin&#39;,</span>
<span class="c1">#    &#39;kickstart_version&#39;: &#39;7.3(0)D1(1)&#39;,</span>
<span class="c1">#    &#39;system_compile_time&#39;: &#39;1/11/2016 16:00:00 [02/11/2016 13:08:11]&#39;,</span>
<span class="c1">#    &#39;system_image_file&#39;: &#39;bootflash:///titanium-d1.7.3.0.D1.1.bin&#39;,</span>
<span class="c1">#    &#39;system_version&#39;: &#39;7.3(0)D1(1)&#39;}}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also use the <a class="reference internal" href="explore.html#book-explore-1"><span class="std std-ref">Genie shell</span></a> command line for
Python interactive shell</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>use <code class="docutils literal notranslate"><span class="pre">device.parse('all')</span></code> to run all the available parsers on the device, and the output will be returned in a dictionary
format: <code class="docutils literal notranslate"><span class="pre">{'show</span> <span class="pre">command'</span> <span class="pre">:</span> <span class="pre">parsed_output}</span></code>. If an exception occurred during the execution a particular parser, then <code class="docutils literal notranslate"><span class="pre">parsed_output</span></code> will become the exception object.</p>
</div>
</section>
<section id="how-to-execute-a-parser-linux">
<h1>3. How to execute a parser - Linux<a class="headerlink" href="#how-to-execute-a-parser-linux" title="Permalink to this heading"></a></h1>
<p>Parsers are easy to call even without knowing python.</p>
<i class="fa fa-linux"></i>
<span style='color:#6ab0de'>Bash</span><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>genie<span class="w"> </span>parse<span class="w"> </span><span class="s2">&quot;show version&quot;</span><span class="w"> </span>--testbed-file<span class="w"> </span>testbed.yaml<span class="w"> </span>--output<span class="w"> </span><span class="nv">explore1</span>
<span class="o">+==============================================================================</span>+
<span class="p">|</span><span class="w"> </span>Genie<span class="w"> </span>Parse<span class="w"> </span>Summary<span class="w"> </span><span class="k">for</span><span class="w"> </span>nx-osv-1<span class="w">                                             </span><span class="p">|</span>
+<span class="o">==============================================================================</span>+
<span class="p">|</span><span class="w">  </span>Connected<span class="w"> </span>to<span class="w"> </span>nx-osv-1<span class="w">                                                       </span><span class="p">|</span>
<span class="p">|</span><span class="w">  </span>-<span class="w">  </span>Log:<span class="w"> </span>explore-1/connection_nx-osv-1.txt<span class="w">                                   </span><span class="p">|</span>
<span class="p">|</span>------------------------------------------------------------------------------<span class="p">|</span>
<span class="p">|</span><span class="w">  </span>Parsed<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="s1">&#39;show version&#39;</span><span class="w">                                               </span><span class="p">|</span>
<span class="p">|</span><span class="w">  </span>-<span class="w">  </span>Parsed<span class="w"> </span>structure:<span class="w"> </span>explore-1/nx-osv-1_show-version_parsed.txt<span class="w">             </span><span class="p">|</span>
<span class="p">|</span><span class="w">  </span>-<span class="w">  </span>Device<span class="w"> </span>Console:<span class="w">   </span>explore-1/nx-osv-1_show-version_console.txt<span class="w">            </span><span class="p">|</span>
<span class="p">|</span>------------------------------------------------------------------------------<span class="p">|</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can find all the details in the <a class="reference internal" href="../cli/index.html#genie-cli"><span class="std std-ref">Genie Cli
documentaiton</span></a></p>
</div>
</section>
<section id="get-exclude-keys-for-a-parser-python">
<h1>4. Get exclude keys for a parser - Python<a class="headerlink" href="#get-exclude-keys-for-a-parser-python" title="Permalink to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">genie.libs.parser.utils</span> <span class="kn">import</span> <span class="n">get_parser_exclude</span>
<span class="n">get_parser_exclude</span><span class="p">(</span><span class="s1">&#39;show interface&#39;</span><span class="p">,</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;in_unicast_pkts&#39;</span><span class="p">,</span> <span class="s1">&#39;out_unicast_pkts&#39;</span><span class="p">,</span> <span class="s1">&#39;in_octets&#39;</span><span class="p">,</span> <span class="s1">&#39;out_octets&#39;</span><span class="p">,</span> <span class="s1">&#39;in_pkts&#39;</span><span class="p">,</span> <span class="s1">&#39;out_pkts&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="compare-two-parsers-python">
<h1>5. Compare two parsers - Python<a class="headerlink" href="#compare-two-parsers-python" title="Permalink to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">genie</span> <span class="kn">import</span> <span class="n">testbed</span>
<span class="kn">from</span> <span class="nn">genie.utils.diff</span> <span class="kn">import</span> <span class="n">Diff</span>
<span class="kn">from</span> <span class="nn">genie.libs.parser.utils</span> <span class="kn">import</span> <span class="n">get_parser_exclude</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;tb.yaml&#39;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;nx-osv-1&#39;</span><span class="p">]</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">output1</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;show version&#39;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">output2</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;show version&#39;</span><span class="p">)</span>
<span class="c1"># Without exclude keys</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">Diff</span><span class="p">(</span><span class="n">output1</span><span class="p">,</span> <span class="n">output2</span><span class="p">)</span>
<span class="n">diff</span><span class="o">.</span><span class="n">findDiff</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
<span class="n">platform</span><span class="p">:</span>
 <span class="n">kernel_uptime</span><span class="p">:</span>
<span class="o">+</span>  <span class="n">seconds</span><span class="p">:</span> <span class="mi">15</span>
<span class="o">-</span>  <span class="n">seconds</span><span class="p">:</span> <span class="mi">3</span>

<span class="c1"># With exclude keys</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">Diff</span><span class="p">(</span><span class="n">output1</span><span class="p">,</span> <span class="n">output2</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">get_parser_exclude</span><span class="p">(</span><span class="s1">&#39;show version&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">))</span>
<span class="n">diff</span><span class="o">.</span><span class="n">findDiff</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="executing-parsers-with-fuzzy-search-python">
<h1>6. Executing parsers with fuzzy search - Python<a class="headerlink" href="#executing-parsers-with-fuzzy-search-python" title="Permalink to this heading"></a></h1>
<p>Adding <code class="xref py py-obj docutils literal notranslate"><span class="pre">fuzzy=True</span></code> when calling parse enables fuzzy search, which allows you to
use some regex syntax in your search and match multiple commands. By default,
searching for command is done by exact match or prefix matching, if no ambiguity
exists.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">genie</span> <span class="kn">import</span> <span class="n">testbed</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;tb.yaml&#39;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;nx-osv-1&#39;</span><span class="p">]</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;show bgp .*&#39;</span><span class="p">,</span> <span class="n">fuzzy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Fuzzy matching works by tokenizing your search query by spaces, and then
comparing each token with each of the command’s token to see if they are either
the same or is the prefix of the other. When it encounters the supported regex
expressions, it will perform regex matching as expected and return the results.
The search is done by best fit, meaning it will try its best to fit your query
with each command, and if it succeeds, it will be counted as a match. As a
result, arguments are essentially wild cards, and using fuzzy will attempt to
fit your query with the arguments in any way possible. For instance,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sh</span> <span class="pre">.*</span> <span class="pre">abc</span> <span class="pre">.*</span></code> will match with <code class="xref py py-obj docutils literal notranslate"><span class="pre">show</span> <span class="pre">vrf</span> <span class="pre">{vrf}</span> <span class="pre">detail</span></code>. In this case <code class="xref py py-obj docutils literal notranslate"><span class="pre">abc</span></code> is
simply an argument for <code class="xref py py-obj docutils literal notranslate"><span class="pre">vrf</span></code>.</p>
<p>Fuzzy current supports the follow regex symbols and their combinations:</p>
<ul class="simple">
<li><ul>
<li></li>
</ul>
</li>
<li><p>[a-zA-Z0-9]</p></li>
<li><ul>
<li></li>
</ul>
</li>
<li><p>?</p></li>
<li><p>sSwWdD</p></li>
<li><p>[^a-zA-Z0-9]</p></li>
<li><p>(a|b)</p></li>
<li><p>a{3}</p></li>
<li><p>.</p></li>
</ul>
<p>However, since lookup is done by one token at a time, this will limit the use of
more complex regex expressions such as lookahead and greedy. Moreover, space is
used as a delimiter, so to incorporate space in your query, use <code class="xref py py-obj docutils literal notranslate"><span class="pre">s</span></code> instead.</p>
<p>Here are some example of matches:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Search                       |                                    Sample Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>sh .* tags                   |                                show ethernet tags</p></td>
</tr>
<tr class="row-odd"><td><p>sh .* abc .* ext</p></td>
<td><p>show ospf vrf {vrf} database external</p></td>
</tr>
<tr class="row-even"><td><p>sh .* [a-z]* extS+</p></td>
<td><blockquote>
<div><blockquote>
<div><p>show ted database extensive</p>
</div></blockquote>
<p>show ospf3 interface extensive</p>
</div></blockquote>
<dl class="simple">
<dt>show ospf vrf all-inclusive database external</dt><dd><p>…</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>Fuzzy matching will return multiple parsed results in the form of a dictionary,
where the key indicates the command executed and the value is the output. In
some cases, commands that are not enabled on the device will be executed too,
and consequently throw an error in your script. To silence these exceptions,
attach <code class="xref py py-obj docutils literal notranslate"><span class="pre">continue_on_failure=True</span></code> to your parse call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;show .*&#39;</span><span class="p">,</span> <span class="n">fuzzy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">continue_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>This will execute all the commands without raising an exception. Any silenced
errors can be accessed through <code class="xref py py-obj docutils literal notranslate"><span class="pre">output['exceptions']</span></code>, which is a dictionary
of the command that failed mapped to its corresponding error message.</p>
</section>
<section id="getting-the-raw-ouput-of-a-parser">
<h1>7. Getting the raw ouput of a parser<a class="headerlink" href="#getting-the-raw-ouput-of-a-parser" title="Permalink to this heading"></a></h1>
<p>Adding <code class="xref py py-obj docutils literal notranslate"><span class="pre">raw_data=True</span></code> when calling parse gives you access to the raw output of the command. All you need to do is get the value in
the attribute named raw_output. This attribute comprises a list of dictionaries containing all commands executed for this parser call.
Each item has three keys:
- command: a string containing the command that was executed.
- kwargs: the keyword arguments required to execute the command.
- output: a string containing the raw output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dev</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;R1_xe&#39;</span><span class="p">]</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">dev</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;show version&#39;</span><span class="p">,</span> <span class="n">raw_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">out</span><span class="o">.</span><span class="n">raw_output</span>
<span class="p">[{</span><span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="s1">&#39;show version&#39;</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco IOS XE Software, Version 17.03.01a</span><span class="se">\r\n</span><span class="s1">...&#39;</span><span class="p">}]</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need pyATS 22.5 or greater to use this feature.</p>
</div>
</section>
<section id="external-parsers-apis">
<h1>8. External Parsers/APIs<a class="headerlink" href="#external-parsers-apis" title="Permalink to this heading"></a></h1>
<section id="what-is-an-external-parser-api">
<h2>What is an external parser/api?<a class="headerlink" href="#what-is-an-external-parser-api" title="Permalink to this heading"></a></h2>
<p>In short, they are parsers and apis which have been developed but are not yet ready for open-source releases.</p>
</section>
<section id="step-by-step-guide-for-local-genie-library-implementation">
<h2>Step-By-Step Guide For Local Genie Library Implementation:<a class="headerlink" href="#step-by-step-guide-for-local-genie-library-implementation" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Create a directory to store external parsers and external apis, respectively.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>/Users/&lt;username&gt;/Desktop/external_parser
mkdir<span class="w"> </span>/Users/&lt;username&gt;/Desktop/external_api
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create __init__.py under the root folder (if it doesn’t exist)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the following example is for external parser directory - follow the same steps for external api directory</span>
<span class="nb">cd</span><span class="w"> </span>/Users/&lt;username&gt;/Desktop/external_parser
vim<span class="w"> </span>__init__.py

<span class="c1"># inside the __init__.py file</span>
<span class="c1"># declare the package with genie abstract</span>
from<span class="w"> </span>genie<span class="w"> </span>import<span class="w"> </span>abstract
abstract.declare_package<span class="o">(</span>__name__<span class="o">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Create specific os subfolder under root folder</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the following example is for parsers - follow the same steps for external api directory</span>

<span class="c1"># eg, for iosxe parser</span>
mkdir<span class="w"> </span>iosxe
<span class="nb">cd</span><span class="w"> </span>iosxe/

<span class="c1"># for c9300 platform under iosxe</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>iosxe/c9300
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Create __init__.py under the os folder (and platform) folder</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the following example is for parsers - follow the same steps for external api directory</span>

<span class="nb">cd</span><span class="w"> </span>iosxe/
vim<span class="w"> </span>__init__.py

<span class="c1"># inside the __init__.py file</span>
<span class="c1"># declare the device os token with genie abstract</span>
from<span class="w"> </span>genie<span class="w"> </span>import<span class="w"> </span>abstract
abstract.declare_token<span class="o">(</span>__name__<span class="o">)</span>

<span class="c1"># do the same for platform folder</span>
<span class="nb">cd</span><span class="w"> </span>c9300/
vim<span class="w"> </span>__init__.py

<span class="c1"># declare the device platform token with genie abstract</span>
from<span class="w"> </span>genie<span class="w"> </span>import<span class="w"> </span>abstract
abstract.declare_token<span class="o">(</span>__name__<span class="o">)</span>
</pre></div>
</div>
<ol class="arabic" start="5">
<li><p>Create or overwrite libraries under the corresponding os folder</p>
<blockquote>
<div><dl class="simple">
<dt>Refer to the official Genie documentation for how to develop parsers and apis:</dt><dd><p>how to write a parser:  <a class="reference external" href="https://pubhub.devnetcloud.com/media/pyats-development-guide/docs/writeparser/writeparser.html">https://pubhub.devnetcloud.com/media/pyats-development-guide/docs/writeparser/writeparser.html</a>
genie parser github repo: <a class="reference external" href="https://github.com/CiscoTestAutomation/genieparser/tree/master/src/genie/libs/parser">https://github.com/CiscoTestAutomation/genieparser/tree/master/src/genie/libs/parser</a>
current available parsers: <a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers">https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers</a></p>
</dd>
<dt>Refer to the following links to write apis:</dt><dd><p>api guideline: <a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-docs/docs/userguide/apis/index.html">https://pubhub.devnetcloud.com/media/genie-docs/docs/userguide/apis/index.html</a>
genie api github repo: <a class="reference external" href="https://github.com/CiscoTestAutomation/genielibs/tree/master/pkgs/sdk-pkg/src/genie/libs/sdk/apis">https://github.com/CiscoTestAutomation/genielibs/tree/master/pkgs/sdk-pkg/src/genie/libs/sdk/apis</a>
current available apis: <a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis">https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis</a></p>
</dd>
</dl>
</div></blockquote>
</li>
</ol>
<p>External parser tree structure example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># inside /Users/&lt;username&gt;/Desktop/external_parser</span>
.
├──<span class="w"> </span>__init__.py
├──<span class="w"> </span>iosxe
│<span class="w">   </span>├──<span class="w"> </span>__init__.py
│<span class="w">   </span>├──<span class="w"> </span>c9300
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>__init__.py
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>show_platform.py
│<span class="w">   </span>└──<span class="w"> </span>show_clock.py
└──<span class="w"> </span>iosxr
<span class="w">    </span>├──<span class="w"> </span>__init__.py
<span class="w">    </span>└──<span class="w"> </span>show_clock.py
</pre></div>
</div>
<p>6. Export the parser root folder name and path to environment variable PYATS_LIBS_EXTERNAL_PARSER and PYTHONPATH or use pyats.conf file to include the external package
NOTE: this is already done for you if you are using the <a class="reference external" href="https://cisco.sharepoint.com/sites/PolarisDevAT/SitePages/SDK%20Knowledge%20bank.aspx#option-1-using-devat-activate-script">DevAT Activate Script</a>.</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>use environment variable</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/Users/&lt;username&gt;/Desktop:<span class="nv">$PYTHONPATH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PYATS_LIBS_EXTERNAL_PARSER</span><span class="o">=</span><span class="s1">&#39;external_parser&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PYATS_LIBS_EXTERNAL_API</span><span class="o">=</span><span class="s1">&#39;external_api&#39;</span>
</pre></div>
</div>
<ol class="loweralpha simple" start="2">
<li><p>use pyats.conf file, this file is located at ~/.pyats/ folder, if you don’t have it, please create one</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>$/Users/&lt;username&gt;/Desktop:<span class="nv">$PYTHONPATH</span>

<span class="nb">cd</span><span class="w"> </span>~/.pyats/
vim<span class="w"> </span>pyats.conf

<span class="c1"># Inside pyats.conf file, add the following settings</span>
<span class="o">[</span>pyats.libs<span class="o">]</span>
external.parser<span class="w"> </span><span class="o">=</span><span class="w"> </span>external_parser
external.api<span class="w"> </span><span class="o">=</span><span class="w"> </span>external_api
</pre></div>
</div>
</div></blockquote>
<p>And that’s it! From here onwards, you should be able to use these libraries.</p>
</section>
<section id="using-local-private-overwrite-genie-libraries">
<h2>Using Local/Private/Overwrite Genie Libraries:<a class="headerlink" href="#using-local-private-overwrite-genie-libraries" title="Permalink to this heading"></a></h2>
<p>When following the above steps, your local override/private libraries (part of the external_api/parser folder) should be automatically picked up by Genie library infrastructure. These “overrides” will work as if they are directly part of the library system, no additional work necessary.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># calling device parsers</span>
<span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>device.parse<span class="o">(</span><span class="s1">&#39;show version&#39;</span><span class="o">)</span>

<span class="c1"># calling device apis</span>
<span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>device.api.configure_cdp<span class="o">(</span>...<span class="o">)</span>
</pre></div>
</div>
<p>Follow the standard Genie library usage/guidelines for how apis and parsers are invoked.</p>
<p><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-docs/docs/cookbooks/index.html#explore-genie">https://pubhub.devnetcloud.com/media/genie-docs/docs/cookbooks/index.html#explore-genie</a></p>
<p>Do not importing them directly in your script as it will cause an ImportError since the parsers are not in your PYTHONPATH. That is, do not do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>from<span class="w"> </span>cisco.pyats.libs.genie.external_parser.iosxe.some_useful_parsers<span class="w"> </span>import<span class="w"> </span>some_parser
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cli.html" class="btn btn-neutral float-left" title="1. Summary" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ops.html" class="btn btn-neutral float-right" title="1. Summary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 30, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>