<!doctype html>
<html lang="zh" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>


<link rel="alternate" hreflang="en" href="http://localhost:1313/docs/tasks/inject-data-application/">
<link rel="alternate" hreflang="ko" href="http://localhost:1313/ko/docs/tasks/inject-data-application/">
<link rel="alternate" hreflang="ja" href="http://localhost:1313/ja/docs/tasks/inject-data-application/">
<link rel="alternate" hreflang="fr" href="http://localhost:1313/fr/docs/tasks/inject-data-application/">
<link rel="alternate" hreflang="de" href="http://localhost:1313/de/docs/tasks/inject-data-application/">
<link rel="alternate" hreflang="es" href="http://localhost:1313/es/docs/tasks/inject-data-application/">
<link rel="alternate" hreflang="id" href="http://localhost:1313/id/docs/tasks/inject-data-application/">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.87.0" />
<link rel="canonical" type="text/html" href="http://localhost:1313/zh/docs/tasks/inject-data-application/">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="manifest" href="/manifest.webmanifest">
<link rel="apple-touch-icon" href="/images/kubernetes-192x192.png">
<title>给应用注入数据 | Kubernetes</title><meta property="og:title" content="给应用注入数据" />
<meta property="og:description" content="给你的工作负载 Pod 指定配置和其他数据。" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://localhost:1313/zh/docs/tasks/inject-data-application/" /><meta property="og:site_name" content="Kubernetes" />

<meta itemprop="name" content="给应用注入数据">
<meta itemprop="description" content="给你的工作负载 Pod 指定配置和其他数据。"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="给应用注入数据"/>
<meta name="twitter:description" content="给你的工作负载 Pod 指定配置和其他数据。"/>






<link href="/scss/main.css" rel="stylesheet">


<script
  src="/js/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>





<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "url": "https://kubernetes.io",
    "logo": "https://kubernetes.io/images/favicon.png",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "http://localhost:1313/search/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }

  }
</script>
<meta name="theme-color" content="#326ce5">




<link rel="stylesheet" href="/css/feature-states.css">



<meta name="description" content="给你的工作负载 Pod 指定配置和其他数据。">
<meta property="og:description" content="给你的工作负载 Pod 指定配置和其他数据。">
<meta name="twitter:description" content="给你的工作负载 Pod 指定配置和其他数据。">
<meta property="og:url" content="http://localhost:1313/zh/docs/tasks/inject-data-application/">
<meta property="og:title" content="给应用注入数据">
<meta name="twitter:title" content="给应用注入数据">
<meta name="twitter:image" content="https://kubernetes.io/images/favicon.png" />

<meta name="twitter:image:alt" content="Kubernetes">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">

<script src="/js/script.js"></script>


  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark  flex-column flex-md-row td-navbar" data-auto-burger="primary">
        <a class="navbar-brand" href="/zh/"></a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			
			
			<li class="nav-item mr-2 mb-lg-0">
				
				<a class="nav-link active" href="/zh/docs/" >文档</a>
			</li>
			
			
			
			<li class="nav-item mr-2 mb-lg-0">
				
				<a class="nav-link" href="/zh/blog/" >Kubernetes 博客</a>
			</li>
			
			
			
			<li class="nav-item mr-2 mb-lg-0">
				
				<a class="nav-link" href="/zh/training/" >培训</a>
			</li>
			
			
			
			<li class="nav-item mr-2 mb-lg-0">
				
				<a class="nav-link" href="/zh/partners/" >合作伙伴</a>
			</li>
			
			
			
			<li class="nav-item mr-2 mb-lg-0">
				
				<a class="nav-link" href="/zh/community/" >社区</a>
			</li>
			
			
			
			<li class="nav-item mr-2 mb-lg-0">
				
				<a class="nav-link" href="/zh/case-studies/" >案例分析</a>
			</li>
			
			
			
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Versions
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/releases">Release Information</a>
	
	<a class="dropdown-item" href="https://kubernetes.io/zh/docs/tasks/inject-data-application/">v1.23</a>
	
	<a class="dropdown-item" href="https://v1-22.docs.kubernetes.io/zh/docs/tasks/inject-data-application/">v1.22</a>
	
	<a class="dropdown-item" href="https://v1-21.docs.kubernetes.io/zh/docs/tasks/inject-data-application/">v1.21</a>
	
	<a class="dropdown-item" href="https://v1-20.docs.kubernetes.io/zh/docs/tasks/inject-data-application/">v1.20</a>
	
	<a class="dropdown-item" href="https://v1-19.docs.kubernetes.io/zh/docs/tasks/inject-data-application/">v1.19</a>
	
</div>
			</li>
			
			
			<li class="nav-item dropdown">
				

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	中文 Chinese
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/docs/tasks/inject-data-application/">English</a>
	
	<a class="dropdown-item" href="/ko/docs/tasks/inject-data-application/">한국어 Korean</a>
	
	<a class="dropdown-item" href="/ja/docs/tasks/inject-data-application/">日本語 Japanese</a>
	
	<a class="dropdown-item" href="/fr/docs/tasks/inject-data-application/">Français</a>
	
	<a class="dropdown-item" href="/de/docs/tasks/inject-data-application/">Deutsch</a>
	
	<a class="dropdown-item" href="/es/docs/tasks/inject-data-application/">Español</a>
	
	<a class="dropdown-item" href="/id/docs/tasks/inject-data-application/">Bahasa Indonesia</a>
	
</div>

			</li>
			
		</ul>
	</div>
	<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/zh/docs/tasks/inject-data-application/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">给应用注入数据</h1>
<div class="lead">给你的工作负载 Pod 指定配置和其他数据。</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-c9af1e81bb6e109f6c41febe44f0931b">为容器设置启动时要执行的命令和参数</a></li>


    
  
    
    
	
<li>2: <a href="#pg-82c93897176489678232542102daea40">为容器设置环境变量</a></li>


    
  
    
    
	
<li>3: <a href="#pg-eff97c25c917cdb414eda016df0e2bca">定义相互依赖的环境变量</a></li>


    
  
    
    
	
<li>4: <a href="#pg-66c0456fdbef5e5116dd606d1e6f73cc">通过环境变量将 Pod 信息呈现给容器</a></li>


    
  
    
    
	
<li>5: <a href="#pg-bcf93d1cd019501fd0b7649e9fbcaf60">通过文件将 Pod 信息呈现给容器</a></li>


    
  
    
    
	
<li>6: <a href="#pg-7f9454a1e775548c23ee5b300a9218a3">使用 Secret 安全地分发凭证</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c9af1e81bb6e109f6c41febe44f0931b">1 - 为容器设置启动时要执行的命令和参数</h1>
    
	<!--
title: Define a Command and Arguments for a Container
content_type: task
weight: 10
-->
<!-- overview -->
<!--
This page shows how to define commands and arguments when you run a container
in a <a class='glossary-tooltip' title='Pod 表示您的集群上一组正在运行的容器。' data-toggle='tooltip' data-placement='top' href='/docs/concepts/workloads/pods/pod-overview/' target='_blank' aria-label='Pod'>Pod</a>.
-->
<p>本页将展示如何为 <a class='glossary-tooltip' title='Pod 表示您的集群上一组正在运行的容器。' data-toggle='tooltip' data-placement='top' href='/docs/concepts/workloads/pods/pod-overview/' target='_blank' aria-label='Pod'>Pod</a>
中容器设置启动时要执行的命令及其参数。</p>
<h2 id="before-you-begin">Before you begin</h2>
<p><p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。
建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。
如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">Minikube</a>
构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<!--
You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
[minikube](https://minikube.sigs.k8s.io/docs/tutorials/multi_node/)
or you can use one of these Kubernetes playgrounds:
-->
<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/">玩转 Kubernetes</a></li>
</ul>
 
 To check the version, enter <code>kubectl version</code>.
</p>
<!-- steps -->
<!--
## Define a command and arguments when you create a Pod

When you create a Pod, you can define a command and arguments for the
containers that run in the Pod. To define a command, include the `command`
field in the configuration file. To define arguments for the command, include
the `args` field in the configuration file. The command and arguments that
you define cannot be changed after the Pod is created.
-->
<h2 id="创建-pod-时设置命令及参数">创建 Pod 时设置命令及参数</h2>
<p>创建 Pod 时，可以为其下的容器设置启动时要执行的命令及其参数。如果要设置命令，就填写在配置文件的 <code>command</code> 字段下，如果要设置命令的参数，就填写在配置文件的 <code>args</code> 字段下。一旦 Pod 创建完成，该命令及其参数就无法再进行更改了。</p>
<!--
The command and arguments that you define in the configuration file
override the default command and arguments provided by the container image.
If you define args, but do not define a command, the default command is used
with your new arguments.
-->
<p>如果在配置文件中设置了容器启动时要执行的命令及其参数，那么容器镜像中自带的命令与参数将会被覆盖而不再执行。如果配置文件中只是设置了参数，却没有设置其对应的命令，那么容器镜像中自带的命令会使用该新参数作为其执行时的参数。</p>
<!--
The `command` field corresponds to `entrypoint` in some container runtimes. 
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 在有些容器运行时中，<code>command</code> 字段对应 <code>entrypoint</code>，请参阅下面的
<a href="#notes">说明事项</a>。
</div>
<!--
In this exercise, you create a Pod that runs one container. The configuration
file for the Pod defines a command and two arguments:
-->
<p>本示例中，将创建一个只包含单个容器的 Pod。在 Pod 配置文件中设置了一个命令与两个参数：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/commands.yaml" download="pods/commands.yaml"><code>pods/commands.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-commands-yaml')" title="Copy pods/commands.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-commands-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>command-demo<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">purpose</span>:<span style="color:#bbb"> </span>demonstrate-command<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>command-demo-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>debian<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;printenv&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;HOSTNAME&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;KUBERNETES_PORT&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">restartPolicy</span>:<span style="color:#bbb"> </span>OnFailure<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<!--
1. Create a Pod based on the YAML configuration file:
-->
<ol>
<li>
<p>基于 YAML 文件创建一个 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/commands.yaml
</code></pre></div></li>
</ol>
<!--
1. List the running Pods:
-->
<ol start="2">
<li>
<p>获取正在运行的 Pods：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods
</code></pre></div><!--
The output shows that the container that ran in the command-demo Pod has completed.
-->
<p>查询结果显示在 command-demo 这个 Pod 下运行的容器已经启动完成。</p>
</li>
</ol>
<!--
1. To see the output of the command that ran in the container, view the logs
from the Pod:
-->
<ol start="3">
<li>
<p>如果要获取容器启动时执行命令的输出结果，可以通过 Pod 的日志进行查看：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl logs command-demo
</code></pre></div><!--
The output shows the values of the HOSTNAME and KUBERNETES_PORT environment variables:
-->
<p>日志中显示了 HOSTNAME 与 KUBERNETES_PORT 这两个环境变量的值：</p>
<pre><code>command-demo
tcp://10.3.240.1:443
</code></pre></li>
</ol>
<!--
## Use environment variables to define arguments

In the preceding example, you defined the arguments directly by
providing strings. As an alternative to providing strings directly,
you can define arguments by using environment variables:
-->
<h2 id="使用环境变量来设置参数">使用环境变量来设置参数</h2>
<p>在上面的示例中，我们直接将一串字符作为命令的参数。除此之外，我们还可以将环境变量作为命令的参数。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MESSAGE<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;hello world&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;/bin/echo&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;$(MESSAGE)&#34;</span>]<span style="color:#bbb">
</span></code></pre></div><!--
This means you can define an argument for a Pod using any of
the techniques available for defining environment variables, including
[ConfigMaps](/docs/tasks/configure-pod-container/configure-pod-configmap/)
and
[Secrets](/docs/concepts/configuration/secret/).
-->
<p>这意味着你可以将那些用来设置环境变量的方法应用于设置命令的参数，其中包括了
<a href="/zh/docs/tasks/configure-pod-container/configure-pod-configmap/">ConfigMaps</a> 与
<a href="/zh/docs/concepts/configuration/secret/">Secrets</a>。</p>
<!--
The environment variable appears in parentheses, `"$(VAR)"`. This is
required for the variable to be expanded in the `command` or `args` field.
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 环境变量需要加上括号，类似于 <code>&quot;$(VAR)&quot;</code>。这是在 <code>command</code> 或 <code>args</code> 字段使用变量的格式要求。
</div>
<!--
## Run a command in a shell

In some cases, you need your command to run in a shell. For example, your
command might consist of several commands piped together, or it might be a shell
script. To run your command in a shell, wrap it like this:
-->
<h2 id="在-shell-来执行命令">在 Shell 来执行命令</h2>
<p>有时候，你需要在 Shell 脚本中运行命令。
例如，你要执行的命令可能由多个命令组合而成，或者它就是一个 Shell 脚本。
这时，就可以通过如下方式在 Shell 中执行命令：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">command: <span style="color:#666">[</span><span style="color:#b44">&#34;/bin/sh&#34;</span><span style="color:#666">]</span>
args: <span style="color:#666">[</span><span style="color:#b44">&#34;-c&#34;</span>, <span style="color:#b44">&#34;while true; do echo hello; sleep 10;done&#34;</span><span style="color:#666">]</span>
</code></pre></div><h2 id="what-s-next">What's next</h2>
<!--
* Learn more about [configuring pods and containers](/docs/tasks/).
* Learn more about [running commands in a container](/docs/tasks/debug-application-cluster/get-shell-running-container/).
* See [Container](/docs/reference/generated/kubernetes-api/v1.23/#container-v1-core).
-->
<ul>
<li>进一步了解<a href="/zh/docs/tasks/">配置 Pod 和容器</a></li>
<li>进一步了解<a href="/zh/docs/tasks/debug-application-cluster/get-shell-running-container/">在容器中运行命令</a></li>
<li>参阅 <a href="/docs/reference/generated/kubernetes-api/v1.23/#container-v1-core">Container</a>
API 资源</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-82c93897176489678232542102daea40">2 - 为容器设置环境变量</h1>
    
	<!--
title: Define Environment Variables for a Container
content_type: task
weight: 20
-->
<!-- overview -->
<!--
This page shows how to define environment variables for a container
in a Kubernetes Pod. 
-->
<p>本页将展示如何为 kubernetes Pod 下的容器设置环境变量。</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。
建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。
如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">Minikube</a>
构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<!--
You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
[minikube](https://minikube.sigs.k8s.io/docs/tutorials/multi_node/)
or you can use one of these Kubernetes playgrounds:
-->
<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/">玩转 Kubernetes</a></li>
</ul>

<!-- steps -->
<!--
## Define an environment variable for a container
-->
<h2 id="为容器设置一个环境变量">为容器设置一个环境变量</h2>
<!--
When you create a Pod, you can set environment variables for the containers
that run in the Pod. To set environment variables, include the `env` or
`envFrom` field in the configuration file.
-->
<p>创建 Pod 时，可以为其下的容器设置环境变量。通过配置文件的 <code>env</code> 或者 <code>envFrom</code> 字段来设置环境变量。</p>
<!--
In this exercise, you create a Pod that runs one container. The configuration
file for the Pod defines an environment variable with name `DEMO_GREETING` and
value `"Hello from the environment"`. Here is the configuration manifest for the
Pod:
-->
<p>本示例中，将创建一个只包含单个容器的 Pod。Pod 的配置文件中设置环境变量的名称为 <code>DEMO_GREETING</code>，
其值为 <code>&quot;Hello from the environment&quot;</code>。下面是 Pod 的配置清单：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/envars.yaml" download="pods/inject/envars.yaml"><code>pods/inject/envars.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-envars-yaml')" title="Copy pods/inject/envars.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-envars-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>envar-demo<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">purpose</span>:<span style="color:#bbb"> </span>demonstrate-envars<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>envar-demo-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>gcr.io/google-samples/node-hello:1.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>DEMO_GREETING<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Hello from the environment&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>DEMO_FAREWELL<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Such a sweet sorrow&#34;</span><span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<!--
1. Create a Pod based on that manifest:
-->
<ol>
<li>
<p>基于配置清单创建一个 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/inject/envars.yaml
</code></pre></div></li>
</ol>
<!--
1. List the running Pods:
-->
<ol start="2">
<li>
<p>获取一下当前正在运行的 Pods 信息：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods -l <span style="color:#b8860b">purpose</span><span style="color:#666">=</span>demonstrate-envars
</code></pre></div> <!--
 The output is similar to this:
 -->
<p>查询结果应为：</p>
<pre><code>NAME            READY     STATUS    RESTARTS   AGE
envar-demo      1/1       Running   0          9s
</code></pre></li>
</ol>
<!--
1. List the Pod's container environment variables:
-->
<ol start="3">
<li>
<p>列出 Pod 容器的环境变量：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> envar-demo -- printenv
</code></pre></div> <!--
 The output is similar to this:
 -->
<p>打印结果应为：</p>
<pre><code>NODE_VERSION=4.4.2
EXAMPLE_SERVICE_PORT_8080_TCP_ADDR=10.3.245.237
HOSTNAME=envar-demo
...
DEMO_GREETING=Hello from the environment
DEMO_FAREWELL=Such a sweet sorrow
</code></pre></li>
</ol>
<!--
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> The environment variables set using the <code>env</code> or <code>envFrom</code> field
override any environment variables specified in the container image.
</div>
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 通过 <code>env</code> 或 <code>envFrom</code> 字段设置的环境变量将覆盖容器镜像中指定的所有环境变量。
</div>
<!--
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> Environment variables may reference each other, however ordering is important.
Variables making use of others defined in the same context must come later in
the list. Similarly, avoid circular references.
</div>
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 环境变量可以互相引用，但是顺序很重要。
使用在相同上下文中定义的其他变量的变量必须在列表的后面。
同样，请避免使用循环引用。
</div>
<!--
## Using environment variables inside of your config

Environment variables that you define in a Pod's configuration can be used
elsewhere in the configuration, for example in commands and arguments that
you set for the Pod's containers.
In the example configuration below, the `GREETING`, `HONORIFIC`, and
`NAME` environment variables are set to `Warm greetings to`, `The Most
Honorable`, and `Kubernetes`, respectively. Those environment variables
are then used in the CLI arguments passed to the `env-print-demo`
container.
-->
<h2 id="在配置中使用环境变量">在配置中使用环境变量</h2>
<p>您在 Pod 的配置中定义的环境变量可以在配置的其他地方使用，
例如可用在为 Pod 的容器设置的命令和参数中。
在下面的示例配置中，环境变量 <code>GREETING</code> ，<code>HONORIFIC</code> 和 <code>NAME</code> 分别设置为 <code>Warm greetings to</code> ，
<code>The Most Honorable</code> 和 <code>Kubernetes</code>。然后这些环境变量在传递给容器 <code>env-print-demo</code> 的 CLI 参数中使用。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>print-greeting<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>env-print-demo<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>bash<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>GREETING<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Warm greetings to&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>HONORIFIC<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;The Most Honorable&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>NAME<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;Kubernetes&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;echo&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;$(GREETING) $(HONORIFIC) $(NAME)&#34;</span>]<span style="color:#bbb">
</span></code></pre></div><!--
Upon creation, the command `echo Warm greetings to The Most Honorable Kubernetes` is run on the container.
-->
<p>创建后，命令 <code>echo Warm greetings to The Most Honorable Kubernetes</code> 将在容器中运行。</p>
<h2 id="what-s-next">What's next</h2>
<!--
* Learn more about [environment variables](/docs/tasks/inject-data-application/environment-variable-expose-pod-information/).
* Learn about [using secrets as environment variables](/docs/user-guide/secrets/#using-secrets-as-environment-variables).
* See [EnvVarSource](/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core).
-->
<ul>
<li>进一步了解<a href="/zh/docs/tasks/inject-data-application/environment-variable-expose-pod-information/">环境变量</a></li>
<li>进一步了解<a href="/zh/docs/concepts/configuration/secret/#using-secrets-as-environment-variables">通过环境变量来使用 Secret</a></li>
<li>关于 <a href="/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core">EnvVarSource</a> 资源的信息。</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-eff97c25c917cdb414eda016df0e2bca">3 - 定义相互依赖的环境变量</h1>
    
	<!-- 
title: Define Dependent Environment Variables
-->
<!-- overview -->
<!-- 
This page shows how to define dependent environment variables for a container
in a Kubernetes Pod.
-->
<p>本页展示了如何为 Kubernetes Pod 中的容器定义相互依赖的环境变量。</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。
建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。
如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">Minikube</a>
构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<!--
You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
[minikube](https://minikube.sigs.k8s.io/docs/tutorials/multi_node/)
or you can use one of these Kubernetes playgrounds:
-->
<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/">玩转 Kubernetes</a></li>
</ul>

<!-- steps -->
<!-- 
## Define an environment dependent variable for a container

When you create a Pod, you can set dependent environment variables for the containers that run in the Pod. To set dependent environment variables, you can use $(VAR_NAME) in the `value` of `env` in the configuration file.

In this exercise, you create a Pod that runs one container. The configuration
file for the Pod defines an dependent environment variable with common usage defined. Here is the configuration manifest for the
Pod:
-->
<h2 id="define-an-environment-dependent-variable-for-a-container">为容器定义相互依赖的环境变量  </h2>
<p>当创建一个 Pod 时，你可以为运行在 Pod 中的容器设置相互依赖的环境变量。
设置相互依赖的环境变量，你就可以在配置清单文件的 <code>env</code> 的 <code>value</code> 中使用 $(VAR_NAME)。</p>
<p>在本练习中，你会创建一个单容器的 Pod。
此 Pod 的配置文件定义了一个已定义常用用法的相互依赖的环境变量。
下面是 Pod 的配置清单：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/dependent-envars.yaml" download="pods/inject/dependent-envars.yaml"><code>pods/inject/dependent-envars.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-dependent-envars-yaml')" title="Copy pods/inject/dependent-envars.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-dependent-envars-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>dependent-envars-demo<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>dependent-envars-demo<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- while true; do echo -en &#39;\n&#39;; printf UNCHANGED_REFERENCE=$UNCHANGED_REFERENCE&#39;\n&#39;; printf SERVICE_ADDRESS=$SERVICE_ADDRESS&#39;\n&#39;;printf ESCAPED_REFERENCE=$ESCAPED_REFERENCE&#39;\n&#39;; sleep 30; done;<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- sh<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- -c<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>busybox:1.28<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>SERVICE_PORT<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;80&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>SERVICE_IP<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;172.17.0.1&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>UNCHANGED_REFERENCE<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>PROTOCOL<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;https&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>SERVICE_ADDRESS<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>ESCAPED_REFERENCE<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">value</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;$$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)&#34;</span><span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<!-- 1. Create a Pod based on that manifest: -->
<ol>
<li>
<p>依据清单创建 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/inject/dependent-envars.yaml
</code></pre></div><pre><code>pod/dependent-envars-demo created
</code></pre> <!-- 2. List the running Pods: -->
</li>
<li>
<p>列出运行的 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods dependent-envars-demo
</code></pre></div><pre><code>NAME                      READY     STATUS    RESTARTS   AGE
dependent-envars-demo     1/1       Running   0          9s
</code></pre> <!-- 3. Check the logs for the container running in your Pod: -->
</li>
<li>
<p>检查 Pod 中运行容器的日志：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl logs pod/dependent-envars-demo
</code></pre></div><pre><code>
UNCHANGED_REFERENCE=$(PROTOCOL)://172.17.0.1:80
SERVICE_ADDRESS=https://172.17.0.1:80
ESCAPED_REFERENCE=$(PROTOCOL)://172.17.0.1:80
</code></pre></li>
</ol>
<!-- 
As shown above, you have defined the correct dependency reference of `SERVICE_ADDRESS`, bad dependency reference of `UNCHANGED_REFERENCE` and skip dependent references of `ESCAPED_REFERENCE`.

When an environment variable is already defined when being referenced,
the reference can be correctly resolved, such as in the `SERVICE_ADDRESS` case.
-->
<p>如上所示，你已经定义了 <code>SERVICE_ADDRESS</code> 的正确依赖引用，
<code>UNCHANGED_REFERENCE</code> 的错误依赖引用，
并跳过了 <code>ESCAPED_REFERENCE</code> 的依赖引用。</p>
<p>如果环境变量被引用时已事先定义，则引用可以正确解析，
比如 <code>SERVICE_ADDRESS</code> 的例子。</p>
<!-- 
When the environment variable is undefined or only includes some variables, the undefined environment variable is treated as a normal string, such as `UNCHANGED_REFERENCE`. Note that incorrectly parsed environment variables, in general, will not block the container from starting.

The `$(VAR_NAME)` syntax can be escaped with a double `$`, ie: `$$(VAR_NAME)`.
Escaped references are never expanded, regardless of whether the referenced variable
is defined or not. This can be seen from the `ESCAPED_REFERENCE` case above.
-->
<p>当环境变量未定义或仅包含部分变量时，未定义的变量会被当做普通字符串对待，
比如 <code>UNCHANGED_REFERENCE</code> 的例子。
注意，解析不正确的环境变量通常不会阻止容器启动。</p>
<p><code>$(VAR_NAME)</code> 这样的语法可以用两个 <code>$</code> 转义，既：<code>$$(VAR_NAME)</code>。
无论引用的变量是否定义，转义的引用永远不会展开。
这一点可以从上面 <code>ESCAPED_REFERENCE</code> 的例子得到印证。</p>
<h2 id="what-s-next">What's next</h2>
<!--
* Learn more about [environment variables](/docs/tasks/inject-data-application/environment-variable-expose-pod-information/).
* See [EnvVarSource](/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core).
-->
<ul>
<li>进一步了解<a href="/zh/docs/tasks/inject-data-application/environment-variable-expose-pod-information/">环境变量</a>.</li>
<li>参阅 <a href="/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core">EnvVarSource</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-66c0456fdbef5e5116dd606d1e6f73cc">4 - 通过环境变量将 Pod 信息呈现给容器</h1>
    
	<!--
title: Expose Pod Information to Containers Through Environment Variables
content_type: task
weight: 30
-->
<!-- overview -->
<!--
This page shows how a Pod can use environment variables to expose information
about itself to Containers running in the Pod. Environment variables can expose
Pod fields and Container fields.
-->
<p>此页面展示 Pod 如何使用环境变量把自己的信息呈现给 Pod 中运行的容器。
环境变量可以呈现 Pod 的字段和容器字段。</p>
<h2 id="before-you-begin">Before you begin</h2>
<p><p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。
建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。
如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">Minikube</a>
构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<!--
You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
[minikube](https://minikube.sigs.k8s.io/docs/tutorials/multi_node/)
or you can use one of these Kubernetes playgrounds:
-->
<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/">玩转 Kubernetes</a></li>
</ul>
 
 To check the version, enter <code>kubectl version</code>.
</p>
<!-- steps -->
<h2 id="downward-api">Downward API</h2>
<!--
There are two ways to expose Pod and Container fields to a running Container:

* Environment variables
* [Volume Files](/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api)

Together, these two ways of exposing Pod and Container fields are called the
*Downward API*.
-->
<p>有两种方式可以将 Pod 和 Container 字段呈现给运行中的容器：</p>
<ul>
<li>环境变量</li>
<li><a href="/zh/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api">卷文件</a></li>
</ul>
<p>这两种呈现 Pod 和 Container 字段的方式统称为 <em>Downward API</em>。</p>
<!--
## Use Pod fields as values for environment variables

In this exercise, you create a Pod that has one Container. Here is the
configuration file for the Pod:
-->
<h2 id="用-pod-字段作为环境变量的值">用 Pod 字段作为环境变量的值</h2>
<p>在这个练习中，你将创建一个包含一个容器的 Pod。这是该 Pod 的配置文件：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/dapi-envars-pod.yaml" download="pods/inject/dapi-envars-pod.yaml"><code>pods/inject/dapi-envars-pod.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-dapi-envars-pod-yaml')" title="Copy pods/inject/dapi-envars-pod.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-dapi-envars-pod-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>dapi-envars-fieldref<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>k8s.gcr.io/busybox<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#b44">&#34;sh&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;-c&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- while true; do<span style="color:#bbb">
</span><span style="color:#bbb">          </span>echo -en &#39;\n&#39;;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>printenv MY_NODE_NAME MY_POD_NAME MY_POD_NAMESPACE;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>printenv MY_POD_IP MY_POD_SERVICE_ACCOUNT;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>sleep 10;<span style="color:#bbb">
</span><span style="color:#bbb">        </span>done;<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_NODE_NAME<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">fieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">fieldPath</span>:<span style="color:#bbb"> </span>spec.nodeName<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_POD_NAME<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">fieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">fieldPath</span>:<span style="color:#bbb"> </span>metadata.name<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_POD_NAMESPACE<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">fieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">fieldPath</span>:<span style="color:#bbb"> </span>metadata.namespace<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_POD_IP<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">fieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">fieldPath</span>:<span style="color:#bbb"> </span>status.podIP<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_POD_SERVICE_ACCOUNT<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">fieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">fieldPath</span>:<span style="color:#bbb"> </span>spec.serviceAccountName<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">restartPolicy</span>:<span style="color:#bbb"> </span>Never<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<!--
In the configuration file, you can see five environment variables. The `env`
field is an array of
[EnvVars](/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core).
The first element in the array specifies that the `MY_NODE_NAME` environment
variable gets its value from the Pod's `spec.nodeName` field. Similarly, the
other environment variables get their names from Pod fields.
-->
<p>这个配置文件中，你可以看到五个环境变量。<code>env</code> 字段是一个
<a href="/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core">EnvVars</a>.
对象的数组。
数组中第一个元素指定 <code>MY_NODE_NAME</code> 这个环境变量从 Pod 的 <code>spec.nodeName</code> 字段获取变量值。
同样，其它环境变量也是从 Pod 的字段获取它们的变量值。</p>
<!--
The fields in this example are Pod fields. They are not fields of the
Container in the Pod.
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 本示例中的字段是 Pod 字段，不是 Pod 中 Container 的字段。
</div>
<!--
Create the Pod:
-->
<p>创建Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/inject/dapi-envars-pod.yaml
</code></pre></div><!--
Verify that the Container in the Pod is running:
-->
<p>验证 Pod 中的容器运行正常：</p>
<pre><code>kubectl get pods
</code></pre><!--
View the Container's logs:
-->
<p>查看容器日志：</p>
<pre><code>kubectl logs dapi-envars-fieldref
</code></pre><!--
The output shows the values of selected environment variables:
-->
<p>输出信息显示了所选择的环境变量的值：</p>
<pre><code>minikube
dapi-envars-fieldref
default
172.17.0.4
default
</code></pre><!--
To see why these values are in the log, look at the `command` and `args` fields
in the configuration file. When the Container starts, it writes the values of
five environment variables to stdout. It repeats this every ten seconds.

Next, get a shell into the Container that is running in your Pod:
-->
<p>要了解为什么这些值在日志中，请查看配置文件中的<code>command</code> 和 <code>args</code>字段。
当容器启动时，它将五个环境变量的值写入 stdout。每十秒重复执行一次。</p>
<p>接下来，通过打开一个 Shell 进入 Pod 中运行的容器：</p>
<pre><code>kubectl exec -it dapi-envars-fieldref -- sh
</code></pre><!--
In your shell, view the environment variables:
-->
<p>在 Shell 中，查看环境变量：</p>
<pre><code>/# printenv
</code></pre><!--
The output shows that certain environment variables have been assigned the
values of Pod fields:
-->
<p>输出信息显示环境变量已经设置为 Pod 字段的值。</p>
<pre><code>MY_POD_SERVICE_ACCOUNT=default
...
MY_POD_NAMESPACE=default
MY_POD_IP=172.17.0.4
...
MY_NODE_NAME=minikube
...
MY_POD_NAME=dapi-envars-fieldref
</code></pre><!--
## Use Container fields as values for environment variables

In the preceding exercise, you used Pod fields as the values for environment
variables. In this next exercise, you use Container fields as the values for
environment variables. Here is the configuration file for a Pod that has one
container:
-->
<h2 id="用-container-字段作为环境变量的值">用 Container 字段作为环境变量的值</h2>
<p>前面的练习中，你将 Pod 字段作为环境变量的值。
接下来这个练习中，你将用 Container 字段作为环境变量的值。这里是包含一个容器的 Pod 的配置文件：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/dapi-envars-container.yaml" download="pods/inject/dapi-envars-container.yaml"><code>pods/inject/dapi-envars-container.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-dapi-envars-container-yaml')" title="Copy pods/inject/dapi-envars-container.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-dapi-envars-container-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>dapi-envars-resourcefieldref<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>k8s.gcr.io/busybox:1.24<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#b44">&#34;sh&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;-c&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- while true; do<span style="color:#bbb">
</span><span style="color:#bbb">          </span>echo -en &#39;\n&#39;;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>printenv MY_CPU_REQUEST MY_CPU_LIMIT;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>printenv MY_MEM_REQUEST MY_MEM_LIMIT;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>sleep 10;<span style="color:#bbb">
</span><span style="color:#bbb">        </span>done;<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;32Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;125m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">limits</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;64Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;250m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_CPU_REQUEST<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>requests.cpu<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_CPU_LIMIT<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>limits.cpu<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_MEM_REQUEST<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>requests.memory<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>MY_MEM_LIMIT<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>limits.memory<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">restartPolicy</span>:<span style="color:#bbb"> </span>Never<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<!--
In the configuration file, you can see four environment variables. The `env`
field is an array of
[EnvVars](/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core).
The first element in the array specifies that the `MY_CPU_REQUEST` environment
variable gets its value from the `requests.cpu` field of a Container named
`test-container`. Similarly, the other environment variables get their values
from Container fields.

The fields in this example are Pod fields. They are not fields of the
Container in the Pod.

Create the Pod:
-->
<p>这个配置文件中，你可以看到四个环境变量。<code>env</code> 字段是一个
<a href="/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core">EnvVars</a>.
对象的数组。数组中第一个元素指定 <code>MY_CPU_REQUEST</code> 这个环境变量从 Container 的 <code>requests.cpu</code>
字段获取变量值。同样，其它环境变量也是从 Container 的字段获取它们的变量值。</p>
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 本例中使用的是 Container 的字段而不是 Pod 的字段。
</div>
<p>创建Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/inject/dapi-envars-container.yaml
</code></pre></div><!--
Verify that the Container in the Pod is running:
-->
<p>验证 Pod 中的容器运行正常：</p>
<pre><code>kubectl get pods
</code></pre><!--
View the Container's logs:
-->
<p>查看容器日志：</p>
<pre><code>kubectl logs dapi-envars-resourcefieldref
</code></pre><!--
The output shows the values of selected environment variables:
-->
<p>输出信息显示了所选择的环境变量的值：</p>
<pre><code>1
1
33554432
67108864
</code></pre><h2 id="what-s-next">What's next</h2>
<!--
* [Defining Environment Variables for a Container](/docs/tasks/inject-data-application/define-environment-variable-container/)
* [PodSpec](/docs/reference/generated/kubernetes-api/v1.23/#podspec-v1-core)
* [Container](/docs/reference/generated/kubernetes-api/v1.23/#container-v1-core)
* [EnvVar](/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core)
* [EnvVarSource](/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core)
* [ObjectFieldSelector](/docs/reference/generated/kubernetes-api/v1.23/#objectfieldselector-v1-core)
* [ResourceFieldSelector](/docs/reference/generated/kubernetes-api/v1.23/#resourcefieldselector-v1-core)
-->
<ul>
<li><a href="/zh/docs/tasks/inject-data-application/define-environment-variable-container/">给容器定义环境变量</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#podspec-v1-core">PodSpec</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#container-v1-core">Container</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core">EnvVar</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core">EnvVarSource</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#objectfieldselector-v1-core">ObjectFieldSelector</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#resourcefieldselector-v1-core">ResourceFieldSelector</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bcf93d1cd019501fd0b7649e9fbcaf60">5 - 通过文件将 Pod 信息呈现给容器</h1>
    
	<!-- overview -->
<!--
This page shows how a Pod can use a DownwardAPIVolumeFile to expose information
about itself to Containers running in the Pod. A DownwardAPIVolumeFile can expose
Pod fields and Container fields.
-->
<p>此页面描述 Pod 如何使用 DownwardAPIVolumeFile 把自己的信息呈现给 Pod 中运行的容器。
DownwardAPIVolumeFile 可以呈现 Pod 的字段和容器字段。</p>
<h2 id="before-you-begin">Before you begin</h2>
<p><p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。
建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。
如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">Minikube</a>
构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<!--
You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
[minikube](https://minikube.sigs.k8s.io/docs/tutorials/multi_node/)
or you can use one of these Kubernetes playgrounds:
-->
<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/">玩转 Kubernetes</a></li>
</ul>
 
 To check the version, enter <code>kubectl version</code>.
</p>
<!-- steps -->
<!--
## The Downward API

There are two ways to expose Pod and Container fields to a running Container:

* [Environment variables](/docs/tasks/inject-data-application/environment-variable-expose-pod-information/#the-downward-api)
* Volume Files
-->
<h2 id="downward-api">Downward API</h2>
<p>有两种方式可以将 Pod 和 Container 字段呈现给运行中的容器：</p>
<ul>
<li><a href="/zh/docs/tasks/inject-data-application/environment-variable-expose-pod-information/#the-downward-api">环境变量</a></li>
<li>卷文件</li>
</ul>
<p>这两种呈现 Pod 和 Container 字段的方式都称为 <em>Downward API</em>。</p>
<!--
## Store Pod fields

In this exercise, you create a Pod that has one Container.
Here is the configuration file for the Pod:
-->
<h2 id="存储-pod-字段">存储 Pod 字段</h2>
<p>在这个练习中，你将创建一个包含一个容器的 Pod。Pod 的配置文件如下：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/dapi-volume.yaml" download="pods/inject/dapi-volume.yaml"><code>pods/inject/dapi-volume.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-dapi-volume-yaml')" title="Copy pods/inject/dapi-volume.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-dapi-volume-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>kubernetes-downwardapi-volume-example<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">zone</span>:<span style="color:#bbb"> </span>us-est-coast<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">cluster</span>:<span style="color:#bbb"> </span>test-cluster1<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">rack</span>:<span style="color:#bbb"> </span>rack-22<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">annotations</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">build</span>:<span style="color:#bbb"> </span>two<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">builder</span>:<span style="color:#bbb"> </span>john-doe<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>client-container<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>k8s.gcr.io/busybox<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;sh&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;-c&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- while true; do<span style="color:#bbb">
</span><span style="color:#bbb">          </span>if [[ -e /etc/podinfo/labels ]]; then<span style="color:#bbb">
</span><span style="color:#bbb">            </span>echo -en &#39;\n\n&#39;; cat /etc/podinfo/labels; fi;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>if [[ -e /etc/podinfo/annotations ]]; then<span style="color:#bbb">
</span><span style="color:#bbb">            </span>echo -en &#39;\n\n&#39;; cat /etc/podinfo/annotations; fi;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>sleep 5;<span style="color:#bbb">
</span><span style="color:#bbb">        </span>done;<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>podinfo<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/etc/podinfo<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">volumes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>podinfo<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">downwardAPI</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">items</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#008000;font-weight:bold">path</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;labels&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">fieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">fieldPath</span>:<span style="color:#bbb"> </span>metadata.labels<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#008000;font-weight:bold">path</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;annotations&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">fieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">fieldPath</span>:<span style="color:#bbb"> </span>metadata.annotations<span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<!--
In the configuration file, you can see that the Pod has a `downwardAPI` Volume,
and the Container mounts the Volume at `/etc/podinfo`.

Look at the `items` array under `downwardAPI`. Each element of the array is a
[DownwardAPIVolumeFile](/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core).
The first element specifies that the value of the Pod's
`metadata.labels` field should be stored in a file named `labels`.
The second element specifies that the value of the Pod's `annotations`
field should be stored in a file named `annotations`.
-->
<p>在配置文件中，你可以看到 Pod 有一个 <code>downwardAPI</code> 类型的卷，并且挂载到容器中的
<code>/etc/podinfo</code> 目录。</p>
<p>查看 <code>downwardAPI</code> 下面的 <code>items</code> 数组。
每个数组元素都是一个
<a href="/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core">DownwardAPIVolumeFile</a>
对象。
第一个元素指示 Pod 的 <code>metadata.labels</code> 字段的值保存在名为 <code>labels</code> 的文件中。
第二个元素指示 Pod 的 <code>annotations</code> 字段的值保存在名为 <code>annotations</code> 的文件中。</p>
<!--
The fields in this example are Pod fields. They are not
fields of the Container in the Pod.
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 本示例中的字段是Pod字段，不是Pod中容器的字段。
</div>
<!--
Create the Pod:
-->
<p>创建 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/inject/dapi-volume.yaml
</code></pre></div><!--
Verify that the Container in the Pod is running:
-->
<p>验证Pod中的容器运行正常：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pods
</code></pre></div><!--
View the Container's logs:
-->
<p>查看容器的日志：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl logs kubernetes-downwardapi-volume-example
</code></pre></div><!--
The output shows the contents of the labels file and the annotations file:
-->
<p>输出显示 <code>labels</code> 和 <code>annotations</code> 文件的内容：</p>
<pre><code>cluster=&quot;test-cluster1&quot;
rack=&quot;rack-22&quot;
zone=&quot;us-est-coast&quot;

build=&quot;two&quot;
builder=&quot;john-doe&quot;
</code></pre><!--
Get a shell into the Container that is running in your Pod:
-->
<p>进入 Pod 中运行的容器，打开一个 Shell：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -it kubernetes-downwardapi-volume-example -- sh
</code></pre></div><!--
In your shell, view the `labels` file:
-->
<p>在该 Shell中，查看 <code>labels</code> 文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/# cat /etc/podinfo/labels
</code></pre></div><!--
The output shows that all of the Pod's labels have been written
to the `labels` file:
-->
<p>输出显示 Pod 的所有标签都已写入 <code>labels</code> 文件。</p>
<pre><code>cluster=&quot;test-cluster1&quot;
rack=&quot;rack-22&quot;
zone=&quot;us-est-coast&quot;
</code></pre><!--
Similarly, view the `annotations` file:
-->
<p>同样，查看<code>annotations</code>文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/# cat /etc/podinfo/annotations
</code></pre></div><!--
View the files in the `/etc/podinfo` directory:
-->
<p>查看<code>/etc/podinfo</code>目录下的文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/# ls -laR /etc/podinfo
</code></pre></div><!--
In the output, you can see that the `labels` and `annotations` files
are in a temporary subdirectory: in this example,
`..2982_06_02_21_47_53.299460680`. In the `/etc/podinfo` directory, `..data` is
a symbolic link to the temporary subdirectory. Also in the `/etc/podinfo` directory,
`labels` and `annotations` are symbolic links.
-->
<p>在输出中可以看到，<code>labels</code> 和 <code>annotations</code> 文件都在一个临时子目录中。
在这个例子，<code>..2982_06_02_21_47_53.299460680</code>。
在 <code>/etc/podinfo</code> 目录中，<code>..data</code> 是一个指向临时子目录
的符号链接。<code>/etc/podinfo</code> 目录中，<code>labels</code> 和 <code>annotations</code> 也是符号链接。</p>
<pre><code>drwxr-xr-x  ... Feb 6 21:47 ..2982_06_02_21_47_53.299460680
lrwxrwxrwx  ... Feb 6 21:47 ..data -&gt; ..2982_06_02_21_47_53.299460680
lrwxrwxrwx  ... Feb 6 21:47 annotations -&gt; ..data/annotations
lrwxrwxrwx  ... Feb 6 21:47 labels -&gt; ..data/labels

/etc/podinfo/..2982_06_02_21_47_53.299460680:
total 8
-rw-r--r--  ... Feb  6 21:47 annotations
-rw-r--r--  ... Feb  6 21:47 labels
</code></pre><!--
Using symbolic links enables dynamic atomic refresh of the metadata; updates are
written to a new temporary directory, and the `..data` symlink is updated
atomically using
[rename(2)](http://man7.org/linux/man-pages/man2/rename.2.html).
-->
<p>用符号链接可实现元数据的动态原子性刷新；更新将写入一个新的临时目录，
然后通过使用<a href="http://man7.org/linux/man-pages/man2/rename.2.html">rename(2)</a>
完成 <code>..data</code> 符号链接的原子性更新。</p>
<!--
A container using Downward API as a
[subPath](/docs/concepts/storage/volumes/#using-subpath) volume mount will not
receive Downward API updates.
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 如果容器以
<a href="/zh/docs/concepts/storage/volumes/#using-subpath">subPath</a>卷挂载方式来使用
Downward API，则该容器无法收到更新事件。
</div>
<p>退出 Shell：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/# <span style="color:#a2f">exit</span>
</code></pre></div><h2 id="存储容器字段">存储容器字段</h2>
<!--
The preceding exercise, you stored Pod fields in a DownwardAPIVolumeFile.
In this next exercise, you store Container fields. Here is the configuration
file for a Pod that has one Container:
-->
<p>前面的练习中，你将 Pod 字段保存到 DownwardAPIVolumeFile 中。
接下来这个练习，你将存储 Container 字段。这里是包含一个容器的 Pod 的配置文件：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/dapi-volume-resources.yaml" download="pods/inject/dapi-volume-resources.yaml"><code>pods/inject/dapi-volume-resources.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-dapi-volume-resources-yaml')" title="Copy pods/inject/dapi-volume-resources.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-dapi-volume-resources-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>kubernetes-downwardapi-volume-example-2<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>client-container<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>k8s.gcr.io/busybox:1.24<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;sh&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;-c&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- while true; do<span style="color:#bbb">
</span><span style="color:#bbb">          </span>echo -en &#39;\n&#39;;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>if [[ -e /etc/podinfo/cpu_limit ]]; then<span style="color:#bbb">
</span><span style="color:#bbb">            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/cpu_limit; fi;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>if [[ -e /etc/podinfo/cpu_request ]]; then<span style="color:#bbb">
</span><span style="color:#bbb">            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/cpu_request; fi;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>if [[ -e /etc/podinfo/mem_limit ]]; then<span style="color:#bbb">
</span><span style="color:#bbb">            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/mem_limit; fi;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>if [[ -e /etc/podinfo/mem_request ]]; then<span style="color:#bbb">
</span><span style="color:#bbb">            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/mem_request; fi;<span style="color:#bbb">
</span><span style="color:#bbb">          </span>sleep 5;<span style="color:#bbb">
</span><span style="color:#bbb">        </span>done;<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;32Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;125m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">limits</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;64Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;250m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>podinfo<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/etc/podinfo<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">volumes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>podinfo<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">downwardAPI</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">items</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#008000;font-weight:bold">path</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;cpu_limit&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>client-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>limits.cpu<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">divisor</span>:<span style="color:#bbb"> </span>1m<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#008000;font-weight:bold">path</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;cpu_request&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>client-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>requests.cpu<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">divisor</span>:<span style="color:#bbb"> </span>1m<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#008000;font-weight:bold">path</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;mem_limit&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>client-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>limits.memory<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">divisor</span>:<span style="color:#bbb"> </span>1Mi<span style="color:#bbb">
</span><span style="color:#bbb">          </span>- <span style="color:#008000;font-weight:bold">path</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;mem_request&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">resourceFieldRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">containerName</span>:<span style="color:#bbb"> </span>client-container<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">resource</span>:<span style="color:#bbb"> </span>requests.memory<span style="color:#bbb">
</span><span style="color:#bbb">              </span><span style="color:#008000;font-weight:bold">divisor</span>:<span style="color:#bbb"> </span>1Mi<span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<!--
In the configuration file, you can see that the Pod has a `downwardAPI` Volume,
and the Container mounts the Volume at `/etc/podinfo`.

Look at the `items` array under `downwardAPI`. Each element of the array is a
DownwardAPIVolumeFile.

The first element specifies that in the Container named `client-container`,
the value of the `limits.cpu` field in the format specified by `1m` should be
stored in a file named `cpu_limit`. The `divisor` field is optional and has the
default value of `1` which means cores for cpu and bytes for memory.

Create the Pod:
-->
<p>在这个配置文件中，你可以看到 Pod 有一个 <code>downwardAPI</code> 类型的卷，并且挂载到容器的
<code>/etc/podinfo</code> 目录。</p>
<p>查看 <code>downwardAPI</code> 下面的 <code>items</code> 数组。每个数组元素都是一个 DownwardAPIVolumeFile。</p>
<p>第一个元素指定名为 <code>client-container</code> 的容器中 <code>limits.cpu</code> 字段的值应保存在名为
<code>cpu_limit</code> 的文件中。</p>
<p>创建Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/inject/dapi-volume-resources.yaml
</code></pre></div><!--
Get a shell into the Container that is running in your Pod:
-->
<p>打开一个 Shell，进入 Pod 中运行的容器：</p>
<pre><code>kubectl exec -it kubernetes-downwardapi-volume-example-2 -- sh
</code></pre><!--
In your shell, view the `cpu_limit` file:
-->
<p>在 Shell 中，查看 <code>cpu_limit</code> 文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/# cat /etc/podinfo/cpu_limit
</code></pre></div><!--
You can use similar commands to view the `cpu_request`, `mem_limit` and
`mem_request` files.
-->
<p>你可以使用同样的命令查看 <code>cpu_request</code>、<code>mem_limit</code> 和 <code>mem_request</code> 文件.</p>
<!-- discussion -->
<!--
## Capabilities of the Downward API
-->
<h2 id="downward-api-的能力">Downward API 的能力</h2>
<!--
The following information is available to containers through environment
variables and `downwardAPI` volumes:

* Information available via `fieldRef`:
  * `metadata.name` - the pod's name
  * `metadata.namespace` - the pod's namespace
  * `metadata.uid` - the pod's UID
  * `metadata.labels['<KEY>']` - the value of the pod's label `<KEY>` (for example, `metadata.labels['mylabel']`)
  * `metadata.annotations['<KEY>']` - the value of the pod's annotation `<KEY>` (for example, `metadata.annotations['myannotation']`)
-->
<p>下面这些信息可以通过环境变量和 <code>downwardAPI</code> 卷提供给容器：</p>
<ul>
<li>能通过 <code>fieldRef</code> 获得的：
<ul>
<li><code>metadata.name</code> - Pod 名称</li>
<li><code>metadata.namespace</code> - Pod 名字空间</li>
<li><code>metadata.uid</code> - Pod 的 UID</li>
<li><code>metadata.labels['&lt;KEY&gt;']</code> - Pod 标签 <code>&lt;KEY&gt;</code> 的值 (例如, <code>metadata.labels['mylabel']</code>）</li>
<li><code>metadata.annotations['&lt;KEY&gt;']</code> - Pod 的注解 <code>&lt;KEY&gt;</code> 的值（例如, <code>metadata.annotations['myannotation']</code>）</li>
</ul>
</li>
</ul>
<!--
* Information available via `resourceFieldRef`:
  * A Container's CPU limit
  * A Container's CPU request
  * A Container's memory limit
  * A Container's memory request
  * A Container's hugepages limit (providing that the `DownwardAPIHugePages` [feature gate](/docs/reference/command-line-tools-reference/feature-gates/) is enabled)
  * A Container's hugepages request (providing that the `DownwardAPIHugePages` [feature gate](/docs/reference/command-line-tools-reference/feature-gates/) is enabled)
  * A Container's ephemeral-storage limit
  * A Container's ephemeral-storage request
-->
<ul>
<li>能通过 <code>resourceFieldRef</code> 获得的：
<ul>
<li>容器的 CPU 约束值</li>
<li>容器的 CPU 请求值</li>
<li>容器的内存约束值</li>
<li>容器的内存请求值</li>
<li>容器的巨页限制值（前提是启用了 <code>DownwardAPIHugePages</code> <a href="/zh/docs/reference/command-line-tools-reference/feature-gates/">特性门控</a>）</li>
<li>容器的巨页请求值（前提是启用了 <code>DownwardAPIHugePages</code> <a href="/zh/docs/reference/command-line-tools-reference/feature-gates/">特性门控</a>）</li>
<li>容器的临时存储约束值</li>
<li>容器的临时存储请求值</li>
</ul>
</li>
</ul>
<!--
In addition, the following information is available through
`downwardAPI` volume `fieldRef`:
-->
<p>此外，以下信息可通过 <code>downwardAPI</code> 卷从 <code>fieldRef</code> 获得：</p>
<!--
* `metadata.labels` - all of the pod’s labels, formatted as `label-key="escaped-label-value"` with one label per line
* `metadata.annotations` - all of the pod’s annotations, formatted as `annotation-key="escaped-annotation-value"` with one annotation per line
-->
<ul>
<li><code>metadata.labels</code> - Pod 的所有标签，以 <code>label-key=&quot;escaped-label-value&quot;</code> 格式显示，每行显示一个标签</li>
<li><code>metadata.annotations</code> - Pod 的所有注解，以 <code>annotation-key=&quot;escaped-annotation-value&quot;</code>
格式显示，每行显示一个标签</li>
</ul>
<!--
The following information is available through environment variables:
-->
<p>以下信息可通过环境变量获得：</p>
<ul>
<li><code>status.podIP</code> - 节点 IP</li>
<li><code>spec.serviceAccountName</code> - Pod 服务帐号名称, 版本要求 v1.4.0-alpha.3</li>
<li><code>spec.nodeName</code> - 节点名称, 版本要求 v1.4.0-alpha.3</li>
<li><code>status.hostIP</code> - 节点 IP, 版本要求 v1.7.0-alpha.1</li>
</ul>
<!--
If CPU and memory limits are not specified for a Container, the
Downward API defaults to the node allocatable value for CPU and memory.
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 如果容器未指定 CPU 和内存限制，则 Downward API 默认将节点可分配值
视为容器的 CPU 和内存限制。
</div>
<!--
## Project keys to specific paths and file permissions

You can project keys to specific paths and specific permissions on a per-file
basis. For more information, see
[Secrets](/docs/concepts/configuration/secret/).
-->
<h2 id="投射键名到指定路径并且指定文件权限">投射键名到指定路径并且指定文件权限</h2>
<p>你可以将键名投射到指定路径并且指定每个文件的访问权限。
更多信息，请参阅<a href="/zh/docs/concepts/configuration/secret/">Secrets</a>.</p>
<!--
## Motivation for the Downward API

It is sometimes useful for a Container to have information about itself, without
being overly coupled to Kubernetes. The Downward API allows containers to consume
information about themselves or the cluster without using the Kubernetes client
or API server.

An example is an existing application that assumes a particular well-known
environment variable holds a unique identifier. One possibility is to wrap the
application, but that is tedious and error prone, and it violates the goal of low
coupling. A better option would be to use the Pod's name as an identifier, and
inject the Pod's name into the well-known environment variable.
-->
<h2 id="downward-api的动机">Downward API的动机</h2>
<p>对于容器来说，有时候拥有自己的信息是很有用的，可避免与 Kubernetes 过度耦合。
Downward API 使得容器使用自己或者集群的信息，而不必通过 Kubernetes 客户端或
API 服务器来获得。</p>
<p>一个例子是有一个现有的应用假定要用一个非常熟悉的环境变量来保存一个唯一标识。
一种可能是给应用增加处理层，但这样是冗余和易出错的，而且它违反了低耦合的目标。
更好的选择是使用 Pod 名称作为标识，把 Pod 名称注入这个环境变量中。</p>
<h2 id="what-s-next">What's next</h2>
<ul>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#podspec-v1-core">PodSpec</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#volume-v1-core">Volume</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumesource-v1-core">DownwardAPIVolumeSource</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core">DownwardAPIVolumeFile</a></li>
<li><a href="/docs/reference/generated/kubernetes-api/v1.23/#resourcefieldselector-v1-core">ResourceFieldSelector</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7f9454a1e775548c23ee5b300a9218a3">6 - 使用 Secret 安全地分发凭证</h1>
    
	<!-- overview -->
<!--
This page shows how to securely inject sensitive data, such as passwords and
encryption keys, into Pods.
-->
<p>本文展示如何安全地将敏感数据（如密码和加密密钥）注入到 Pods 中。</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。
建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。
如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/">Minikube</a>
构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<!--
You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
[minikube](https://minikube.sigs.k8s.io/docs/tutorials/multi_node/)
or you can use one of these Kubernetes playgrounds:
-->
<ul>
<li><a href="https://www.katacoda.com/courses/kubernetes/playground">Katacoda</a></li>
<li><a href="http://labs.play-with-k8s.com/">玩转 Kubernetes</a></li>
</ul>

<!--
### Convert your secret data to a base-64 representation

Suppose you want to have two pieces of secret data: a username `my-app` and a password
`39528$vdg7Jb`. First, use a base64 encoding tool to convert your username and password to a base64 representation. Here's an example using the commonly available base64 program:
-->
<h3 id="将-secret-数据转换为-base-64-形式">将 secret 数据转换为 base-64 形式</h3>
<p>假设用户想要有两条 Secret 数据：用户名 <code>my-app</code> 和密码 <code>39528$vdg7Jb</code>。
首先使用 <a href="https://www.base64encode.org/">Base64 编码</a> 将用户名和密码转化为 base-64 形式。
下面是一个使用常用的 base64 程序的示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f">echo</span> -n <span style="color:#b44">&#39;my-app&#39;</span> | base64
<span style="color:#a2f">echo</span> -n <span style="color:#b44">&#39;39528$vdg7Jb&#39;</span> | base64
</code></pre></div><!--
The output shows that the base-64 representation of your username is `bXktYXBw`,
and the base-64 representation of your password is `Mzk1MjgkdmRnN0pi`.
-->
<p>结果显示 base-64 形式的用户名为 <code>bXktYXBw</code>，
base-64 形式的密码为 <code>Mzk1MjgkdmRnN0pi</code>。</p>
<!--
Use a local tool trusted by your OS to decrease the security risks of external tools.
-->
<div class="alert alert-warning caution callout" role="alert">
  <strong>Caution:</strong> 使用你的操作系统所能信任的本地工具以降低使用外部工具的风险。
</div>

<!-- steps -->
<!--
## Create a Secret

Here is a configuration file you can use to create a Secret that holds your
username and password:
-->
<h2 id="创建-secret">创建 Secret</h2>
<p>这里是一个配置文件，可以用来创建存有用户名和密码的 Secret:</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/secret.yaml" download="pods/inject/secret.yaml"><code>pods/inject/secret.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-secret-yaml')" title="Copy pods/inject/secret.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-secret-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>test-secret<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">data</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">username</span>:<span style="color:#bbb"> </span>bXktYXBw<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">password</span>:<span style="color:#bbb"> </span>Mzk1MjgkdmRnN0pi<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<ol>
<li>
<!--Create the Secret -->
<p>创建 Secret：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/inject/secret.yaml
</code></pre></div></li>
<li>
<!-- View information about the Secret -->
<p>查看 Secret 相关信息：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get secret test-secret
</code></pre></div><!-- Output: -->
<p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">NAME          TYPE      DATA      AGE
test-secret   Opaque    <span style="color:#666">2</span>         1m
</code></pre></div></li>
<li>
<!-- View more detailed information about the Secret -->
<p>查看 Secret 相关的更多详细信息：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl describe secret test-secret
</code></pre></div><!-- Output: -->
<p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Name:       test-secret
Namespace:  default
Labels:     &lt;none&gt;
Annotations:    &lt;none&gt;

Type:   Opaque

<span style="color:#b8860b">Data</span>
<span style="color:#666">====</span>
password:   <span style="color:#666">13</span> bytes
username:   <span style="color:#666">7</span>  bytes
</code></pre></div></li>
</ol>
<!--
### Create a Secret directly with kubectl

If you want to skip the Base64 encoding step, you can create the
same Secret using the `kubectl create secret` command. For example:
-->
<h3 id="直接用-kubectl-创建-secret">直接用 kubectl 创建 Secret</h3>
<p>如果你希望略过 Base64 编码的步骤，你也可以使用 <code>kubectl create secret</code>
命令直接创建 Secret。例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create secret generic test-secret --from-literal<span style="color:#666">=</span><span style="color:#b44">&#39;username=my-app&#39;</span> --from-literal<span style="color:#666">=</span><span style="color:#b44">&#39;password=39528$vdg7Jb&#39;</span>
</code></pre></div><!--
This is more convenient. The detailed approach shown earlier runs
through each step explicitly to demonstrate what is happening.
-->
<p>这是一种更为方便的方法。
前面展示的详细分解步骤有助于了解究竟发生了什么事情。</p>
<!--
## Create a Pod that has access to the secret data through a Volume

Here is a configuration file you can use to create a Pod:
-->
<h2 id="创建一个可以通过卷访问-secret-数据的-pod">创建一个可以通过卷访问 secret 数据的 Pod</h2>
<p>这里是一个可以用来创建 pod 的配置文件：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/secret-pod.yaml" download="pods/inject/secret-pod.yaml"><code>pods/inject/secret-pod.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-secret-pod-yaml')" title="Copy pods/inject/secret-pod.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-secret-pod-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>secret-test-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>test-container<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic"># name must match the volume name below</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/etc/secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># The secret data is exposed to Containers in the Pod through a Volume.</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">volumes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">secret</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">secretName</span>:<span style="color:#bbb"> </span>test-secret<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


<ol>
<li>
<!-- Create the Pod:-->
<p>创建 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create -f secret-pod.yaml
</code></pre></div></li>
<li>
<!-- Verify that your Pod is running: -->
<p>确认 Pod 正在运行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod secret-test-pod
</code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">NAME              READY     STATUS    RESTARTS   AGE
secret-test-pod   1/1       Running   <span style="color:#666">0</span>          42m
</code></pre></div></li>
<li>
<!-- Get a shell into the Container that is running in your Pod:-->
<p>获取一个 shell 进入 Pod 中运行的容器：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -it secret-test-pod -- /bin/bash
</code></pre></div></li>
<li>
<!-- The secret data is exposed to the Container through a Volume mounted under
`/etc/secret-volume`.

In your shell, list the files in the `/etc/secret-volume` directory:
-->
<p>Secret 数据通过挂载在 <code>/etc/secret-volume</code> 目录下的卷暴露在容器中。</p>
<p>在 shell 中，列举 <code>/etc/secret-volume</code> 目录下的文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ls /etc/secret-volume
</code></pre></div><!--
The output shows two files, one for each piece of secret data:
-->
<p>输出包含两个文件，每个对应一个 Secret 数据条目：</p>
<pre><code>password username
</code></pre></li>
<li>
<!--
In your shell, display the contents of the `username` and `password` files:
-->
<p>在 Shell 中，显示 <code>username</code> 和 <code>password</code> 文件的内容：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#080;font-style:italic"># 在容器中 Shell 运行下面命令</span>
<span style="color:#a2f">echo</span> <span style="color:#b44">&#34;</span><span style="color:#a2f;font-weight:bold">$(</span>cat /etc/secret-volume/username<span style="color:#a2f;font-weight:bold">)</span><span style="color:#b44">&#34;</span>
<span style="color:#a2f">echo</span> <span style="color:#b44">&#34;</span><span style="color:#a2f;font-weight:bold">$(</span>cat /etc/secret-volume/password<span style="color:#a2f;font-weight:bold">)</span><span style="color:#b44">&#34;</span>
</code></pre></div><!--
The output is your username and password:
-->
<p>输出为用户名和密码：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">my-app
39528<span style="color:#b8860b">$vdg7Jb</span>
</code></pre></div></li>
</ol>
<!--
## Define container environment variables using Secret data

### Define a container environment variable with data from a single Secret

-->
<h2 id="使用-secret-数据定义容器变量">使用 Secret 数据定义容器变量</h2>
<h3 id="使用来自-secret-中的数据定义容器变量">使用来自 Secret 中的数据定义容器变量</h3>
<!--
*  Define an environment variable as a key-value pair in a Secret:
-->
<ul>
<li>
<p>定义环境变量为 Secret 中的键值偶对：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create secret generic backend-user --from-literal<span style="color:#666">=</span>backend-username<span style="color:#666">=</span><span style="color:#b44">&#39;backend-admin&#39;</span>
</code></pre></div></li>
</ul>
<!--
*  Assign the `backend-username` value defined in the Secret to the `SECRET_USERNAME` environment variable in the Pod specification.
-->
<ul>
<li>
<p>在 Pod 规约中，将 Secret 中定义的值 <code>backend-username</code> 赋给 <code>SECRET_USERNAME</code> 环境变量</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/pod-single-secret-env-variable.yaml" download="pods/inject/pod-single-secret-env-variable.yaml"><code>pods/inject/pod-single-secret-env-variable.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-pod-single-secret-env-variable-yaml')" title="Copy pods/inject/pod-single-secret-env-variable.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-pod-single-secret-env-variable-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>env-single-secret<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>envars-test-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>SECRET_USERNAME<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">secretKeyRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>backend-user<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">key</span>:<span style="color:#bbb"> </span>backend-username<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


</li>
</ul>
<!--
*  Create the Pod:
-->
<ul>
<li>
<p>创建 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create -f https://k8s.io/examples/pods/inject/pod-single-secret-env-variable.yaml
</code></pre></div></li>
</ul>
<!--
*  In your shell, display the content of `SECRET_USERNAME` container environment variable
-->
<ul>
<li>
<p>在 Shell 中，显示容器环境变量 <code>SECRET_USERNAME</code> 的内容：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -i -t env-single-secret -- /bin/sh -c <span style="color:#b44">&#39;echo $SECRET_USERNAME&#39;</span>
</code></pre></div><p>输出为：</p>
<pre><code>backend-admin
</code></pre></li>
</ul>
<!--
### Define container environment variables with data from multiple Secrets
-->
<h3 id="使用来自多个-secret-的数据定义环境变量">使用来自多个 Secret 的数据定义环境变量</h3>
<!--
*  As with the previous example, create the Secrets first.
-->
<ul>
<li>
<p>和前面的例子一样，先创建 Secret：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create secret generic backend-user --from-literal<span style="color:#666">=</span>backend-username<span style="color:#666">=</span><span style="color:#b44">&#39;backend-admin&#39;</span>
kubectl create secret generic db-user --from-literal<span style="color:#666">=</span>db-username<span style="color:#666">=</span><span style="color:#b44">&#39;db-admin&#39;</span>
</code></pre></div></li>
</ul>
<!--
*  Define the environment variables in the Pod specification.
-->
<ul>
<li>
<p>在 Pod 规约中定义环境变量：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/pod-multiple-secret-env-variable.yaml" download="pods/inject/pod-multiple-secret-env-variable.yaml"><code>pods/inject/pod-multiple-secret-env-variable.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-pod-multiple-secret-env-variable-yaml')" title="Copy pods/inject/pod-multiple-secret-env-variable.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-pod-multiple-secret-env-variable-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>envvars-multiple-secrets<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>envars-test-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>BACKEND_USERNAME<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">secretKeyRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>backend-user<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">key</span>:<span style="color:#bbb"> </span>backend-username<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>DB_USERNAME<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">valueFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">secretKeyRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>db-user<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">key</span>:<span style="color:#bbb"> </span>db-username<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


</li>
</ul>
<!--
*  Create the Pod:
-->
<ul>
<li>
<p>创建 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create -f https://k8s.io/examples/pods/inject/pod-multiple-secret-env-variable.yaml
</code></pre></div></li>
</ul>
<!--
*  In your shell, display the container environment variables
-->
<ul>
<li>
<p>在你的 Shell 中，显示容器环境变量的内容：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -i -t envvars-multiple-secrets -- /bin/sh -c <span style="color:#b44">&#39;env | grep _USERNAME&#39;</span>
</code></pre></div><p>输出：</p>
<pre><code>DB_USERNAME=db-admin
BACKEND_USERNAME=backend-admin
</code></pre></li>
</ul>
<!--
## Configure all key-value pairs in a Secret as container environment variables
-->
<h2 id="将-secret-中的所有键值偶对定义为环境变量">将 Secret 中的所有键值偶对定义为环境变量</h2>
<!--
This functionality is available in Kubernetes v1.6 and later.
-->
<div class="alert alert-info note callout" role="alert">
  <strong>Note:</strong> 此功能在 Kubernetes 1.6 版本之后可用。
</div>
<!--
*  Create a Secret containing multiple key-value pairs
-->
<ul>
<li>
<p>创建包含多个键值偶对的 Secret：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create secret generic test-secret --from-literal<span style="color:#666">=</span><span style="color:#b8860b">username</span><span style="color:#666">=</span><span style="color:#b44">&#39;my-app&#39;</span> --from-literal<span style="color:#666">=</span><span style="color:#b8860b">password</span><span style="color:#666">=</span><span style="color:#b44">&#39;39528$vdg7Jb&#39;</span>
</code></pre></div></li>
</ul>
<!--
*  Use envFrom to define all of the Secret's data as container environment variables. The key from the Secret becomes the environment variable name in the Pod.
-->
<ul>
<li>
<p>使用 <code>envFrom</code> 来将 Secret 中的所有数据定义为环境变量。
Secret 中的键名成为容器中的环境变量名：</p>


 













<div class="highlight">
    <div class="copy-code-icon" style="text-align:right">
    <a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/inject/pod-secret-envFrom.yaml" download="pods/inject/pod-secret-envFrom.yaml"><code>pods/inject/pod-secret-envFrom.yaml</code>
    </a>
    <img src="/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-inject-pod-secret-envfrom-yaml')" title="Copy pods/inject/pod-secret-envFrom.yaml to clipboard">
    </img>
    </div>
    <div class="includecode" id="pods-inject-pod-secret-envfrom-yaml">
    <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>envfrom-secret<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>envars-test-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">image</span>:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">envFrom</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">secretRef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>test-secret<span style="color:#bbb">
</span></code></pre></div>
    </div>
</div>


</li>
</ul>
<!--
*  Create the Pod:
-->
<ul>
<li>
<p>创建 Pod：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl create -f https://k8s.io/examples/pods/inject/pod-secret-envFrom.yaml
</code></pre></div></li>
</ul>
<!--
* In your shell, display `username` and `password` container environment variables
-->
<ul>
<li>
<p>在 Shell 中，显示环境变量 <code>username</code> 和 <code>password</code> 的内容：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -i -t envfrom-secret -- /bin/sh -c <span style="color:#b44">&#39;echo &#34;username: $username\npassword: $password\n&#34;&#39;</span>
</code></pre></div><p>输出为：</p>
<pre><code>username: my-app
password: 39528$vdg7Jb
</code></pre></li>
</ul>
<!-- ### References -->
<h3 id="参考">参考</h3>
<ul>
<li><a href="/docs/api-reference/v1.23/#secret-v1-core">Secret</a></li>
<li><a href="/docs/api-reference/v1.23/#volume-v1-core">Volume</a></li>
<li><a href="/docs/api-reference/v1.23/#pod-v1-core">Pod</a></li>
</ul>
<h2 id="what-s-next">What's next</h2>
<!--
* Learn more about [Secrets](/docs/concepts/configuration/secret/).
* Learn about [Volumes](/docs/concepts/storage/volumes/).
-->
<ul>
<li>进一步了解 <a href="/zh/docs/concepts/configuration/secret/">Secret</a>。</li>
<li>了解 <a href="/zh/docs/concepts/storage/volumes/">Volumes</a>。</li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="d-print-none">
  <div class="footer__links">
    <nav>
      
      
      
      <a class="text-white" href="/zh/docs/home/">主页</a>
      
      <a class="text-white" href="/zh/blog/">博客</a>
      
      <a class="text-white" href="/zh/training/">培训</a>
      
      <a class="text-white" href="/zh/partners/">合作伙伴</a>
      
      <a class="text-white" href="/zh/community/">社区</a>
      
      <a class="text-white" href="/zh/case-studies/">案例分析</a>
      
    </nav>
  </div>
  <div class="container-fluid">
    <div class="row">
      <div class="col-6 col-sm-2 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="User mailing list" aria-label="User mailing list">
    <a class="text-white" target="_blank" href="https://discuss.kubernetes.io">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" href="https://twitter.com/kubernetesio">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Calendar" aria-label="Calendar">
    <a class="text-white" target="_blank" href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io">
      <i class="fas fa-calendar-alt"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Youtube" aria-label="Youtube">
    <a class="text-white" target="_blank" href="https://youtube.com/kubernetescommunity">
      <i class="fab fa-youtube"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/kubernetes/kubernetes">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" href="https://slack.k8s.io">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Contribute" aria-label="Contribute">
    <a class="text-white" target="_blank" href="https://git.k8s.io/community/contributors/guide">
      <i class="fas fa-edit"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" href="https://stackoverflow.com/questions/tagged/kubernetes">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-8 text-center order-sm-2">
        <small class="text-white">&copy; 2024 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></small>
        <br/>
        <small class="text-white">Copyright &copy; 2024 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a></small>
        <br/>
        <small class="text-white">ICP license: 京ICP备17074266号-3</small>
        
        
          
        
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="/js/popper-1.14.3.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="/js/bootstrap-4.3.1.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>










<script src="/js/main.js"></script>






  </body>
</html>
