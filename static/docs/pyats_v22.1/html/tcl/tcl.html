<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tcl &amp; Interpreter &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Variables &amp; Typecasting" href="variables.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aetest/index.html">AEtest - Test Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tcl Integration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tcl &amp; Interpreter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-local-interpreters">Creating Local Interpreters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-global-interpreter">The Global Interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-tcl-calls">Making Tcl Calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-raw-returns">Getting Raw Returns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#things-to-know">Things To Know</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="variables.html">Variables &amp; Typecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="datastructures.html">Custom Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="q.html">Q</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">Interpreter History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tcl Integration</a></li>
      <li class="breadcrumb-item active">Tcl &amp; Interpreter</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tcl-interpreter">
<h1>Tcl &amp; Interpreter<a class="headerlink" href="#tcl-interpreter" title="Permalink to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> class is an extension of <code class="docutils literal notranslate"><span class="pre">tkinter.Tk</span></code> class, inhering all of
Python’s native Tcl integration whilst providing extended APIs for ease
of use.</p>
<section id="creating-local-interpreters">
<h2>Creating Local Interpreters<a class="headerlink" href="#creating-local-interpreters" title="Permalink to this heading">¶</a></h2>
<p>Users are free to create instances of <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> class and make Tcl calls
anywhere in their script and/or library code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import Interpreter</span>
<span class="kn">from</span> <span class="nn">pyats.tcl</span> <span class="kn">import</span> <span class="n">Interpreter</span>

<span class="c1"># create an instance</span>
<span class="n">tcl</span> <span class="o">=</span> <span class="n">Interpreter</span><span class="p">()</span>

<span class="n">ats_tcl_tree_path</span> <span class="o">=</span> <span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set ::env(AUTOTEST)&#39;</span><span class="p">)</span>

<span class="c1"># getting tcl version</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;info patchlevel&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Note the object-orientedness of this approach: each time an <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code>
class is instantiated, a different object/interpreter is returned. This
enables the creation of distinct Tcl instances, but also is fundamentally
different from how a typical Tcl script is executed: always within the same
interpreter.</p>
</div>
</section>
<section id="the-global-interpreter">
<h2>The Global Interpreter<a class="headerlink" href="#the-global-interpreter" title="Permalink to this heading">¶</a></h2>
<p>Python is object oriented: everything is an object. And therefore in Python,
when an <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> class instance is created, it is simply another object,
and there could be an arbitrary number of such instances. Each of them would
be independent and holds their own variables, procedures namespaces &amp; etc.</p>
<p>And thus arises the issue: in Tcl, everything assumed that it was always running
under the same interpreter.</p>
<p>To follow the same behavior, and load libraries, functions, and connection
handles in the same interpreter instance, we need to maintain the usage of a
single instance <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code>. The most pythonic way would be to create an
instance of it and carry it throughout your script/code, and passed around as
argument. However, this creates a huge amount of overhead and unnecessary
coding.</p>
<p>This module features a special mechanism that offers a similar concept of
<em>global</em> <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the tcl module</span>
<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">tcl</span>

<span class="c1"># use the module directly to make tcl calls</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set myVar 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">tcl</span></code> module itself is also the global instance of <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> class.
Within the same Python process, the <code class="docutils literal notranslate"><span class="pre">tcl</span></code> module always refers to the same
<code class="docutils literal notranslate"><span class="pre">interpreter</span></code> instance. This eliminates user’s need to explicitly create
new <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> instances and having to pass them around, drastically
reducing code complexity &amp; time to market.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the tcl module</span>
<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">tcl</span>

<span class="c1"># tcl module is also an instance of Interpreter class</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tcl</span><span class="p">,</span> <span class="n">tcl</span><span class="o">.</span><span class="n">Interpreter</span><span class="p">)</span>

<span class="c1"># however/wherever/whenever the tcl module is imported,</span>
<span class="c1"># the same global Interpreter instance object is always returned</span>
<span class="kn">import</span> <span class="nn">pyats.tcl</span>
<span class="k">assert</span> <span class="n">ats</span><span class="o">.</span><span class="n">tcl</span> <span class="ow">is</span> <span class="n">tcl</span>
<span class="k">assert</span> <span class="nb">id</span><span class="p">(</span><span class="n">ats</span><span class="o">.</span><span class="n">tcl</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">tcl</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>unless you have a specific need to create a local <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> instance
to encapsulate some Tcl code, always use this global instance.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>as the <code class="docutils literal notranslate"><span class="pre">tcl</span></code> module is also a global <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> instance, all of its
features/APIs &amp; etc are also inherited. Therefore,  documentations w.r.t.
<code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> instance is also applicable to this global instance. For
variety’s sake, examples are given using either.</p>
</div>
</section>
<section id="making-tcl-calls">
<h2>Making Tcl Calls<a class="headerlink" href="#making-tcl-calls" title="Permalink to this heading">¶</a></h2>
<p>Any and all Tcl commands can be called directly within the <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code>
instance (and similarly, through the global instance).</p>
<p>As Tcl is a string-interpreted language where everything is a string, evaluating
Tcl calls within Python is effectively the same as evaluating a string object
containing Tcl code using the interpreter’s <code class="docutils literal notranslate"><span class="pre">eval()</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the global tcl instance</span>
<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">tcl</span>

<span class="c1"># make tcl calls</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;info global&#39;</span><span class="p">)</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;proc testProc </span><span class="si">{args}</span><span class="s1"> {puts $args}&#39;</span><span class="p">)</span>

<span class="c1"># load packages from ATS tree</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;package require Tclx&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can pass Python information to Tcl commands via string substitution.
However, note that you have to be careful in using braces <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code> to contain
the information into a single list/string. This is due to string substitution
occurring first in Python, and if the brace was not present, you’d get a nasty
error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s try a local interpreter instead</span>
<span class="kn">from</span> <span class="nn">pyats.tcl</span> <span class="kn">import</span> <span class="n">Interpreter</span>

<span class="c1"># instantiate a local interpreter</span>
<span class="n">tcl</span> <span class="o">=</span> <span class="n">Interpreter</span><span class="p">()</span>

<span class="c1"># for the sake of demonstration, let&#39;s prove that this</span>
<span class="c1"># instance is not the same as the global instance</span>
<span class="kn">import</span> <span class="nn">pyats.tcl</span>
<span class="k">assert</span> <span class="n">tcl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ats</span><span class="o">.</span><span class="n">tcl</span>

<span class="c1"># moving on with our demo</span>

<span class="c1"># variable to be passed to substitution</span>
<span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;list information&#39;</span>

<span class="c1"># make a tcl call.. without {}.</span>
<span class="c1"># see the error</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set var </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">info</span><span class="p">)</span>
<span class="k">except</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># The error would be:</span>
<span class="c1">#</span>
<span class="c1">#   Traceback (most recent call last):</span>
<span class="c1">#     File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="c1">#     File &quot;ats/tcl/interpreter.py&quot;, line 221, in eval</span>
<span class="c1">#       return self.tk.eval(code)</span>
<span class="c1">#   _tkinter.TclError: wrong # args: should be &quot;set varName ?newValue?&quot;</span>
<span class="c1">#</span>
<span class="c1"># as after the substitution the command became invalid:</span>
<span class="c1"># tcl.eval(&#39;set var list information&#39;)</span>

<span class="c1"># now do it properly.</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set var {</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">info</span><span class="p">)</span>

<span class="c1"># this would&#39;ve translated to</span>
<span class="c1"># tcl.eval(&#39;set var {list information}&#39;)</span>

<span class="c1"># test that it worked</span>
<span class="n">asset</span> <span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set var&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">info</span>
</pre></div>
</div>
</section>
<section id="getting-raw-returns">
<h2>Getting Raw Returns<a class="headerlink" href="#getting-raw-returns" title="Permalink to this heading">¶</a></h2>
<p>All returns from Tcl is in the form of a string (<code class="docutils literal notranslate"><span class="pre">str</span></code> object). This is
inline with how Tcl treats everything as strings, where even lists are only
strings with spaces as separators and braces as sub-list containers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">tcl</span>

<span class="c1"># create a tcl variable, storing a number</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set myVariable </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="mi">9999</span><span class="p">)</span>

<span class="c1"># read out the variable to a python object</span>
<span class="n">myVar</span> <span class="o">=</span> <span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set myVariable&#39;</span><span class="p">)</span>

<span class="c1"># note that the obj type is str</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">myVar</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>

<span class="c1"># create a procedure in Tcl, returning its called arguments</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;proc myTestProcedure </span><span class="si">{args}</span><span class="s1"> {return $args}&#39;</span><span class="p">)</span>

<span class="c1"># call it</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;myTestProcedure -argA 1 -argB 2&#39;</span><span class="p">)</span>

<span class="c1"># and the string would be returned</span>
<span class="k">assert</span> <span class="n">ret</span> <span class="o">==</span> <span class="s1">&#39;-argA 1 -argB 2&#39;</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p><code class="docutils literal notranslate"><span class="pre">set</span></code> API reads and returns a variable’s content if no value was
provided. This is needed because you need to <em>return</em> a variable from Tcl
to Python. Using <code class="docutils literal notranslate"><span class="pre">puts</span></code> will not suffice, because that only prints to
screen (STDIO)</p>
</div>
</section>
<section id="things-to-know">
<h2>Things To Know<a class="headerlink" href="#things-to-know" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>When <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> or <code class="docutils literal notranslate"><span class="pre">tkinter</span></code> is loaded inside Python, it exists as
a native Tcl environment within Python, running Tcl C code internally. Thus
there is no separate Tcl PID inside Unix. Tcl <code class="docutils literal notranslate"><span class="pre">pid</span></code> call returns the
same PID as the Python process.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">debug</span></code> or <code class="docutils literal notranslate"><span class="pre">interpreter</span></code> call is made within Tcl, the Tcl process
takes over STDIO, pauses and gives user the typical <code class="docutils literal notranslate"><span class="pre">expect&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">dbg&gt;</span></code>
prompt. This is the same behavior as in native Tcl. Exiting
debug/interpreter mode continues the script execution.</p></li>
<li><p>If Tcl opens up a communication port, it acts as if it had native
controls. Python passes the handle to Tcl.</p></li>
<li><p>If a process fork is made within Tcl, a child Python process is created
with the same Tcl interpreter loaded at the point of forking. In Linux this
looks as if the parent Python process has many child Python processes.</p></li>
<li><p>Arguments to Tcl has to be in the form of strings. If you want to pass an
object, convert it to its string form.</p></li>
<li><p>Interpreter always evaluates at the global scope. To access namespaces, fully
qualify your namespace/API names with namespace qualifiers.</p></li>
<li><p>If you exited a Python/Tcl process and your shell prompts are messed up with
the following symptoms: no newlines when hitting enter and typing yields
invisible characters, type <code class="docutils literal notranslate"><span class="pre">stty</span> <span class="pre">sane</span></code> and hit enter. This will fix it.
This is a known issue (although we don’t know what’s causing it), and will
eventually be looked into.</p></li>
</ol>
<p>There is still much to be discovered in terms of Python-Tcl interactions. Basic
testing suggests that everything seems to work correctly - but there might be
corner conditions. Unfortunately <code class="docutils literal notranslate"><span class="pre">tkinter</span></code>’s Tcl side is poorly documented (as
the original focus from Python was on Tk portability), so if there’s something
puzzling you, contact the support team, and maybe we can sort it out.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="variables.html" class="btn btn-neutral float-right" title="Variables &amp; Typecasting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>