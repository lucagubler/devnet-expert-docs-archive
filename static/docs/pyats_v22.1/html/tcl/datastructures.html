<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Data Structures &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Q" href="q.html" />
    <link rel="prev" title="Variables &amp; Typecasting" href="variables.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aetest/index.html">AEtest - Test Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tcl Integration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="tcl.html">Tcl &amp; Interpreter</a></li>
<li class="toctree-l2"><a class="reference internal" href="variables.html">Variables &amp; Typecasting</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Custom Data Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#array">Array</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keyed-lists">Keyed Lists</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="q.html">Q</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">Interpreter History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tcl Integration</a></li>
      <li class="breadcrumb-item active">Custom Data Structures</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-data-structures">
<h1>Custom Data Structures<a class="headerlink" href="#custom-data-structures" title="Permalink to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">tcl</span></code> module offers two custom datastructures: <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">KeyedList</span></code>.
As you may have guessed, they are the Python counterparts of Tcl’s array and
keyed list data structures. This is needed in order to fully map Tcl variables
into Python objects, maintaining a Pythonic programming experience.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">KeyedList</span></code> implementations are simply to enable users to
deal with Tcl outputs (eg, parser returns). They should not be used
in Python code, since there are… better datastructure native to Python.</p>
</div>
<section id="array">
<span id="tcl-array"></span><h2>Array<a class="headerlink" href="#array" title="Permalink to this heading">¶</a></h2>
<p>Class <code class="docutils literal notranslate"><span class="pre">Array</span></code> was created to offer direct typecasting of a whole Tcl Array
type variable to a single Python object whilst feature the same look-and-feel.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   creating Tcl arrays in Python</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">tcl</span>
<span class="kn">from</span> <span class="nn">pyats.tcl</span> <span class="kn">import</span> <span class="n">tclstr</span><span class="p">,</span> <span class="n">Array</span>

<span class="c1"># create an array in Tcl</span>
<span class="c1"># using one liner array set instead of ().. for less typing</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;array set testArray &quot;a 1 b 2 c 3&quot;&#39;</span><span class="p">)</span>

<span class="c1"># copy it to Python</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">tcl</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;testArray&#39;</span><span class="p">)</span>

<span class="c1"># notice how we have an Array variable</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Array</span>
</pre></div>
</div>
<p>Python <code class="docutils literal notranslate"><span class="pre">Array</span></code> class implementation extends the base <code class="docutils literal notranslate"><span class="pre">dict</span></code>. The resulting
object features the same concept as Tcl - but think Pythonic. There’s no
<code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">names</span></code> API, but rather:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># continuing from last code...</span>

<span class="c1"># check that array contains index &#39;a&#39;</span>
<span class="k">assert</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">array</span>

<span class="c1"># check all array index are in the array</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># accessing the array</span>
<span class="c1"># note that the value is still string - not typecasted</span>
<span class="k">assert</span> <span class="n">array</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span>

<span class="c1"># adding more to the array</span>
<span class="c1"># note that this only adds to the local variable</span>
<span class="n">array</span><span class="p">[</span><span class="s1">&#39;zzz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span>
</pre></div>
</div>
<p>When a Tcl Array is typecasted into <code class="docutils literal notranslate"><span class="pre">Array</span></code> object, it gets its content and
copies it to Python - that is, the Python object is stand-alone and not linked
to the Tcl source variable. Any modifications to one variable does not affect
the other. In addition, the value of each array index value is not typecasted.
If those values (which remains in string format) needs to also be typecasted,
user should loop through the index and typecast each value individually.</p>
<p>The reverse operation is also possible. To convert an <code class="docutils literal notranslate"><span class="pre">Array</span></code> object back
to its Tcl form, call the <code class="docutils literal notranslate"><span class="pre">tclstr()</span></code> function. This API returns a list -
a form accepted by <code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">set</span> <span class="pre">&lt;arrayName&gt;</span> <span class="pre">&lt;valueList&gt;</span></code> call, which creates an
array from a list of key-value pairs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># continuing where we left off...</span>

<span class="c1"># calling tclstr() to get a glimpse of the output</span>
<span class="n">tclstr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="c1"># output: &#39;a 1 c 3 b 2 zzz 999&#39;</span>
<span class="c1"># note how it&#39;s a Tcl [array get &lt;arrayName&gt;] format</span>

<span class="c1"># setting it back to Tcl using native commands</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;array set newArray {</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tclstr</span><span class="p">(</span><span class="n">array</span><span class="p">),))</span>

<span class="c1"># checkout the content</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;parray newArray&#39;</span><span class="p">)</span>
<span class="c1"># newArray(a) = 1</span>
<span class="c1"># newArray(b) = 2</span>
<span class="c1"># newArray(c) = 3</span>
<span class="c1"># newArray(zzz) = 999</span>

<span class="c1"># of course, you can always call the set_array API</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;newArray&#39;</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>calling <code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">set</span> <span class="pre">&lt;arrayName&gt;</span> <span class="pre">&lt;valueList&gt;</span></code> on an existing array does
NOT replace it. This merely update it (add new keys-values, replace
existing key-values). This is similar in concept as <code class="docutils literal notranslate"><span class="pre">dict.update()</span></code>.
If you want to fully replace an existing array, delete the old one first!</p>
</div>
</section>
<section id="keyed-lists">
<span id="tcl-keyedlist"></span><h2>Keyed Lists<a class="headerlink" href="#keyed-lists" title="Permalink to this heading">¶</a></h2>
<p>Tcl Keyed-List is really just a string/list that follows a particular
syntax. When using the right keyed list APIs, the following properties of
keyed-lists are observed:</p>
<ul class="simple">
<li><p>A key may be associated to a value, or another keyed-list</p></li>
<li><p>If a key is associated to another keyed-list, then associated keyed-list’s
keys are called a sub-keys of a that first key.</p></li>
<li><p>Key and subkeys are separate by the special <code class="docutils literal notranslate"><span class="pre">.</span></code> character</p></li>
</ul>
<p>Our <code class="docutils literal notranslate"><span class="pre">KeyedList</span></code> class is a Python implementation of the above Tcl keyed-list
behavior, with enhanced APIs more natural to those of Python design patterns.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   creating Tcl keyed lists in Python</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">tcl</span>
<span class="kn">from</span> <span class="nn">pyats.tcl</span> <span class="kn">import</span> <span class="n">KeyedList</span>

<span class="c1"># create a keyed-list in Tcl</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;keylset myKeyedList a.x 1 a.y 2 b 3&#39;</span><span class="p">)</span>
<span class="c1"># the content is now:</span>
<span class="c1"># {&#39;a&#39;: {&#39;y&#39;: &#39;2&#39;, &#39;x&#39;: &#39;1&#39;}, &#39;b&#39;: &#39;3&#39;}</span>

<span class="c1"># now read it to Python</span>
<span class="n">klist</span> <span class="o">=</span> <span class="n">tcl</span><span class="o">.</span><span class="n">get_keyed_list</span><span class="p">(</span><span class="s1">&#39;myKeyedList&#39;</span><span class="p">)</span>

<span class="c1"># note the behaviors:</span>
<span class="c1">#  - keys and subkeys separator via .</span>
<span class="c1">#  - the content of a keyed list can be also another keyed list</span>
<span class="k">assert</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">klist</span>
<span class="k">assert</span> <span class="s1">&#39;a.y&#39;</span> <span class="ow">in</span> <span class="n">klist</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">klist</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="n">KeyedList</span>

<span class="c1"># getting values</span>
<span class="n">sub_klist_a</span> <span class="o">=</span> <span class="n">klist</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="c1"># this returns another keyed-list</span>
<span class="c1"># with content: {&#39;y&#39;: &#39;2&#39;, &#39;x&#39;: &#39;1&#39;}</span>

<span class="c1"># getting key.subkey values</span>
<span class="k">assert</span> <span class="n">klist</span><span class="p">[</span><span class="s1">&#39;a.x&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span>

<span class="c1"># because key a contains sub-keyedlist with x and y</span>
<span class="c1"># in Python we can chain the index [] behavior without using .</span>
<span class="k">assert</span> <span class="n">klist</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">klist</span><span class="p">[</span><span class="s1">&#39;a.x&#39;</span><span class="p">]</span>
<span class="c1"># note that it&#39;s probably easier to use .</span>
<span class="c1"># but the idea here is to show how the objects work</span>
</pre></div>
</div>
<p>In effect, keyed-lists are kind of like Python dictionaries, except if a <code class="docutils literal notranslate"><span class="pre">.</span></code>
is used then the content should be another keyed-list - e.g. nested dictionary.</p>
<p>Therefore, notice above how when a key’s associated value is also a keyed list,
then you can access it directly using <code class="docutils literal notranslate"><span class="pre">.</span></code> separator, instead of having to
chain <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code> index operator. Our implementation of <code class="docutils literal notranslate"><span class="pre">KeyedList</span></code> class takes
care of the nested nature of keyed-lists for the user.</p>
<p>You can also create <code class="docutils literal notranslate"><span class="pre">KeyedLists</span></code> on the fly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   creating KeyedList content on the fly in Python</span>

<span class="kn">from</span> <span class="nn">pyats.tcl</span> <span class="kn">import</span> <span class="n">KeyedList</span>

<span class="c1"># create a blank object</span>
<span class="n">klist</span> <span class="o">=</span> <span class="n">KeyedList</span><span class="p">()</span>

<span class="c1"># add some keys and subkeys</span>
<span class="n">klist</span><span class="p">[</span><span class="s1">&#39;a.x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">klist</span><span class="p">[</span><span class="s1">&#39;b.y.z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">klist</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># let&#39;s see the output.</span>
<span class="c1"># note how sub-keys were automatically created into keyed lists.</span>
<span class="n">klist</span>
<span class="c1"># {&#39;b&#39;: {&#39;y&#39;: {&#39;z&#39;: 2}}, &#39;a&#39;: {&#39;x&#39;: 1}, &#39;c&#39;: 3}</span>

<span class="c1"># you can also create a klist from kwargs</span>
<span class="c1"># but this limits you to one key only, as Python does not support</span>
<span class="c1"># kwargs keys to contain .</span>
<span class="n">KeyedList</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># output: {&#39;b&#39;: 2, &#39;a&#39;: 1}</span>
<span class="c1"># hence this isn&#39;t really the best way of creating a python keyed list.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">KeyedList</span></code> class was created for ease-of using Tcl code in Python. If
writing original Python code, there’s no point in using this class - use
native Python classes instead.</p>
<p>Just because you’re familiar with it doesn’t mean you should use it.
Bringing Tcl concepts into Python is not recommended.</p>
</div>
<p>Similarly to <code class="docutils literal notranslate"><span class="pre">Array</span></code> class, to save back to Tcl, call the <code class="docutils literal notranslate"><span class="pre">tclstr()</span></code>
function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># continuing from above section</span>

<span class="c1"># let&#39;s see some output</span>
<span class="n">tclstr</span><span class="p">(</span><span class="n">klist</span><span class="p">)</span>
<span class="c1"># &#39;{b {{y {{z 2}}}}} {a {{x 1}}} {c 3}</span>

<span class="c1"># set it back to Tcl</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set newKlist {</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tclstr</span><span class="p">(</span><span class="n">klist</span><span class="p">),))</span>

<span class="c1"># let&#39;s see the keys</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;keylkeys newKlist&#39;</span><span class="p">)</span>
<span class="c1"># &#39;b a c&#39;</span>

<span class="c1"># alternatively, use set_keyed_list API</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">set_keyed_list</span><span class="p">(</span><span class="s1">&#39;altKList&#39;</span><span class="p">,</span> <span class="n">klist</span><span class="p">)</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;keylkeys altKList&#39;</span><span class="p">)</span>
<span class="c1"># &#39;b a c&#39;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="variables.html" class="btn btn-neutral float-left" title="Variables &amp; Typecasting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="q.html" class="btn btn-neutral float-right" title="Q" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>