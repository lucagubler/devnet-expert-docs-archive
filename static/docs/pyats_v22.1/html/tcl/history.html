<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interpreter History &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Logging" href="../log/index.html" />
    <link rel="prev" title="Q" href="q.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aetest/index.html">AEtest - Test Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tcl Integration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="tcl.html">Tcl &amp; Interpreter</a></li>
<li class="toctree-l2"><a class="reference internal" href="variables.html">Variables &amp; Typecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="datastructures.html">Custom Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="q.html">Q</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Interpreter History</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How It Works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filter">Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#markers">Markers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tcl Integration</a></li>
      <li class="breadcrumb-item active">Interpreter History</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="interpreter-history">
<h1>Interpreter History<a class="headerlink" href="#interpreter-history" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>When an instance of <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> class is created, an associated instance of
<code class="docutils literal notranslate"><span class="pre">History</span></code> is also loaded automatically. This class offers the ability to track
user Tcl call history with time stamp information. In addition, the <code class="docutils literal notranslate"><span class="pre">History</span></code>
class offers users to mark the beginning and end of important events as
separate history queues, with filters that looks for particular Tcl calls. This
can be very effective when used to debug what-went-wrong during Python-Tcl
interactions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   how history is tracked and read</span>

<span class="kn">from</span> <span class="nn">pyats.tcl</span> <span class="kn">import</span> <span class="n">Interpreter</span><span class="p">,</span> <span class="n">History</span>

<span class="n">tcl</span> <span class="o">=</span> <span class="n">Interpreter</span><span class="p">()</span>

<span class="c1"># note the history attribute</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="ow">is</span> <span class="n">History</span>

<span class="c1"># make some tcl calls</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set testVar 1&#39;</span><span class="p">)</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set testVar 2&#39;</span><span class="p">)</span>

<span class="c1"># let&#39;s take a look at the history</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span>
<span class="c1"># output:</span>
<span class="c1">#   deque(</span>
<span class="c1">#    [&lt;HistoryEntry &#39;2014-06-04T23:30:12.939354: set testVar 1&#39; at ...&gt;,</span>
<span class="c1">#     &lt;HistoryEntry &#39;2014-06-04T23:30:18.665275: set testVar 2&#39; at ...&gt;,</span>
<span class="c1">#     maxlen=9999])</span>

<span class="c1"># print it in a more usable fashion:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">api</span><span class="p">)</span>
<span class="c1"># output:</span>
<span class="c1">#   2014-06-04 23:30:12.939354 - set testVar 1</span>
<span class="c1">#   2014-06-04 23:30:18.665275 - set testVar 2</span>
</pre></div>
</div>
</section>
<section id="how-it-works">
<h2>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this heading">¶</a></h2>
<p>History is stored as a first-in-last-out queue with a maximum limit. Each time
the user makes a call to <code class="docutils literal notranslate"><span class="pre">eval</span></code>, it is added to the history with the current
timestamp. When the max queue is reached, the earliest historical entry is
deleted to save from ever-growing memory usage.</p>
<p>Each historical event is saved as a <code class="docutils literal notranslate"><span class="pre">HistoryEntry</span></code> object. Each of these
object has <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> and <code class="docutils literal notranslate"><span class="pre">api</span></code> attribute:
* <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> being the time when the API was called
* <code class="docutils literal notranslate"><span class="pre">api</span></code> being the Tcl command itself.</p>
<p>The default max limit for the queue is <em>9999</em>. This can be altered if user
manually replace the <code class="docutils literal notranslate"><span class="pre">history</span></code> attribute of the an <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code> instance
with a new one with bigger queue:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># continuing from above...</span>

<span class="c1"># replace the history tracker with a new, bigger one</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">History</span><span class="p">(</span><span class="n">max_history</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">)</span>

<span class="c1"># note that this deletes all historical event up until now</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span>
<span class="c1"># output:</span>
<span class="c1">#   deque([], maxlen=15000)</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>the API may be multi-line if multiple semi-colon <code class="docutils literal notranslate"><span class="pre">;</span></code> separated Tcl
commands were evaluated in the same <code class="docutils literal notranslate"><span class="pre">eval()</span></code>.</p>
</div>
</section>
<section id="filter">
<h2>Filter<a class="headerlink" href="#filter" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">filter</span></code> API returns by default the last 20 historical events for better
viewing. Use this API to return an iterable history list. You can also use it
to only filter calls that match a particular regular expression.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># continuing from above (but assuming we didn&#39;t reset the history)</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span> <span class="o">=</span> <span class="s1">&#39;testVar 1&#39;</span><span class="p">)</span>
<span class="c1"># output:</span>
<span class="c1">#   [&lt;HistoryEntry &#39;2014-06-04T23:30:12.939354: set testVar 1&#39; at ...&gt;]</span>
</pre></div>
</div>
</section>
<section id="markers">
<h2>Markers<a class="headerlink" href="#markers" title="Permalink to this heading">¶</a></h2>
<p>Consider markers as separate history queues that can be used to mark and store
important events. Eg: start at the beginning of a testcase and end of it, in
order to give users full picture of what Tcl commands were called within that
testcase.</p>
<p>By default, all history is appended to the <strong>master</strong> queue. This queue is
always updated with each Tcl call. When a new marker is started, all subsequent
Tcl calls are saved to both the new marker and the <strong>master</strong> queue, until
stopped.  There may be an indefinite number of markers active (limited by
CPU/memory of course).</p>
<p>Consider the <strong>master</strong> queue as a broad picture into everything, with the
individual marker queues as a snapshot of a particular time/event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   showing how markers work</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">tcl</span>

<span class="c1"># run some Tcl code</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set test 1&#39;</span><span class="p">)</span>

<span class="c1"># create a new marker</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">start_marker</span><span class="p">(</span><span class="s1">&#39;testMarker&#39;</span><span class="p">)</span>

<span class="c1"># run code under new marker</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set a 1&#39;</span><span class="p">)</span>

<span class="c1"># now create another marker</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">start_marker</span><span class="p">(</span><span class="s1">&#39;testMarker2&#39;</span><span class="p">)</span>

<span class="c1"># run code under new marker as well</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set b 2&#39;</span><span class="p">)</span>

<span class="c1"># stop the markers</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">end_marker</span><span class="p">(</span><span class="s1">&#39;testMarker&#39;</span><span class="p">)</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">end_marker</span><span class="p">(</span><span class="s1">&#39;testMarker2&#39;</span><span class="p">)</span>

<span class="c1"># run more code</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;set c 3&#39;</span><span class="p">)</span>

<span class="c1"># now let&#39;s see history vs marker behavior</span>
<span class="c1"># all calls are in the master (default) marker</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span>
<span class="c1"># output:</span>
<span class="c1">#   [&lt;HistoryEntry &#39;2014-08-19T14:17:57.697085: set test 1&#39; at ...&gt;,</span>
<span class="c1">#    &lt;HistoryEntry &#39;2014-08-19T14:18:12.505794: set a 1&#39; at ...&gt;,</span>
<span class="c1">#    &lt;HistoryEntry &#39;2014-08-19T14:18:29.150347: set b 2&#39; at ...&gt;,</span>
<span class="c1">#    &lt;HistoryEntry &#39;2014-08-19T14:18:52.338709: set c 3&#39; at ...&gt;]</span>

<span class="c1"># &#39;testMarker&#39; only has 1 calls</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;testMarker&#39;</span><span class="p">)</span>
<span class="c1"># output:</span>
<span class="c1">#   [&lt;HistoryEntry &#39;2014-08-19T14:18:12.505794: set a 1&#39; at ...&gt;,</span>
<span class="c1">#    &lt;HistoryEntry &#39;2014-08-19T14:18:29.150347: set b 2&#39; at ...&gt;]</span>

<span class="c1"># &#39;testMarker2&#39; only contains 1 call</span>
<span class="n">tcl</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;testMarker2&#39;</span><span class="p">)</span>
<span class="c1"># output:</span>
<span class="c1"># [&lt;HistoryEntry &#39;2014-08-19T14:18:29.150347: set b 2&#39; at ...&gt;]</span>
</pre></div>
</div>
<p>Marker usage is pretty much trivial. For detailed usage to the API, refer to the
API documentation.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="q.html" class="btn btn-neutral float-left" title="Q" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../log/index.html" class="btn btn-neutral float-right" title="Logging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>