<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Embedded pyATS File Transfer Server &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Import Utilities" href="import_utils.html" />
    <link rel="prev" title="Multiprotocol File Transfer Utilities" href="file_transfer_utilities.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aetest/index.html">AEtest - Test Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tcl/index.html">Tcl Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Utilities</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="helper_functions.html">Find</a></li>
<li class="toctree-l2"><a class="reference internal" href="secret_strings.html">Secret Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_transfer_utilities.html">Multiprotocol File Transfer Utilities</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Embedded pyATS File Transfer Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-the-plugin">Using the Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-as-a-context-manager">Using as a context manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#caveats">Caveats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="import_utils.html">Import Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Utilities</a></li>
      <li class="breadcrumb-item active">Embedded pyATS File Transfer Server</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="embedded-pyats-file-transfer-server">
<span id="pyats-file-transfer-server"></span><h1>Embedded pyATS File Transfer Server<a class="headerlink" href="#embedded-pyats-file-transfer-server" title="Permalink to this heading">¶</a></h1>
<p>The embedded file transfer server allows a server to be launched automatically
with any pyATS job run. This enables file transfer with devices for the duration
of a run, with support for FTP, TFTP, SCP and HTTP. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">FileServer</span></code> class uses
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">device.spawn.pid</span></code> process ID to lookup the local IP address which is
reachable by devices in the testbed. Altnernatively, you can specify the <code class="xref py py-obj docutils literal notranslate"><span class="pre">subnet</span></code>
argument to find the correct network interface and local IP address. Once found,
the testbed will be updated with the accurate server address, and launch a process
with file server to listen on that interface with a random port. The SCP protocol
just gathers the relevant information to add to the testbed and enable easy SCP
copying with a device, but does not start any other processes.</p>
<p>When an file server is started, it will auto generate random credentials. These
are only used for the duration of the run, after which they are lost. They are
also entirely unrelated to user credentials, keeping user credentials secure.</p>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">FileServer</span></code> class and related Easypy Plugin are found in the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">genie.libs.filetransferutils</span></code> package, and the plugin will be automatically run
with every pyATS run as long as it is installed.</p>
<section id="using-the-plugin">
<h2>Using the Plugin<a class="headerlink" href="#using-the-plugin" title="Permalink to this heading">¶</a></h2>
<p>To start a file transfer server using the Easypy Plugin, the server must be
defined in the testbed YAML file with <code class="xref py py-obj docutils literal notranslate"><span class="pre">dynamic:</span> <span class="pre">true</span></code>, as well as some other
information.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">testbed</span><span class="p">:</span>
<span class="w">  </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">myftpserver</span><span class="p">:</span>
<span class="w">      </span><span class="nt">dynamic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ftp</span>
<span class="w">      </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/8</span><span class="w">  </span><span class="c1"># Optional</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/root/dir</span>
</pre></div>
</div>
<p>Additional information can be defined for dynamic servers:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dynamic:</span> <span class="pre">true</span></code> allows the file transfer server plugin to identify it
as a server to be started.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">protocol</span></code> is one of <code class="xref py py-obj docutils literal notranslate"><span class="pre">ftp</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">tftp</span></code>, or <code class="xref py py-obj docutils literal notranslate"><span class="pre">scp</span></code>. The default is <code class="xref py py-obj docutils literal notranslate"><span class="pre">ftp</span></code>.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">subnet</span></code> is how the <code class="xref py py-obj docutils literal notranslate"><span class="pre">FileServer</span></code> can identify which interface faces the
testbed network so that the devices will be able to connect and copy files.
This can also be defined in <a class="reference internal" href="../configuration/index.html#pyats-configuration"><span class="std std-ref">Configuration</span></a>. (optional)</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">path</span></code> is the root directory being served by a FTP or TFTP server. The
default is <code class="xref py py-obj docutils literal notranslate"><span class="pre">/</span></code></p></li>
</ul>
</div></blockquote>
<p>Once a server is started by the plugin, copy commands can just reference it by
name. An example using a Genie API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uut</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">copy_to_device</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;ftp&#39;</span><span class="p">,</span>
                       <span class="n">server</span><span class="o">=</span><span class="s1">&#39;myftpserver&#39;</span><span class="p">,</span>
                       <span class="n">remote_path</span><span class="o">=</span><span class="s1">&#39;myimage.bin&#39;</span><span class="p">,</span>
                       <span class="n">local_path</span><span class="o">=</span><span class="s1">&#39;flash:/‘)</span>
</pre></div>
</div>
</section>
<section id="using-as-a-context-manager">
<h2>Using as a context manager<a class="headerlink" href="#using-as-a-context-manager" title="Permalink to this heading">¶</a></h2>
<p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">FileServer</span></code> can also be used as a context manager if not defined in the
testbed. It will only last for the duration of the context block, but can also
add itself to the testbed for discovery by various copy APIs during that time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">genie.libs.filetransferutils</span> <span class="kn">import</span> <span class="n">FileServer</span>
<span class="k">with</span> <span class="n">FileServer</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;ftp&#39;</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/path/to/root/dir&#39;</span><span class="p">,</span>
                <span class="n">testbed</span><span class="o">=</span><span class="n">testbed</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mycontextserver&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>
    <span class="n">uut</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">copy_to_device</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;ftp&#39;</span><span class="p">,</span>
                           <span class="n">server</span><span class="o">=</span><span class="s1">&#39;mycontextserver&#39;</span><span class="p">,</span>
                           <span class="n">remote_path</span><span class="o">=</span><span class="s1">&#39;myimage.bin&#39;</span><span class="p">,</span>
                           <span class="n">local_path</span><span class="o">=</span><span class="s1">&#39;flash:/‘)</span>
</pre></div>
</div>
</section>
<section id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Devices may not support copying to a non-standard port. The default port can
be used by defining the <code class="xref py py-obj docutils literal notranslate"><span class="pre">port</span></code> value of the server as well in the testbed YAML
with the default port <code class="xref py py-obj docutils literal notranslate"><span class="pre">69</span></code> for TFTP. However this port must be available for
this to work, or the plugin will fail and the job will not execute.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="file_transfer_utilities.html" class="btn btn-neutral float-left" title="Multiprotocol File Transfer Utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="import_utils.html" class="btn btn-neutral float-right" title="Import Utilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>