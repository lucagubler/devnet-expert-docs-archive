<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Input Files &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cleaning Model" href="clean.html" />
    <link rel="prev" title="Usage &amp; Arguments" href="usages.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../aetest/index.html">AEtest - Test Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Testbed &amp; Device Cleaning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="usages.html">Usage &amp; Arguments</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Input Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clean-file">Clean File</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#images-specified-via-filename">Images specified via filename</a></li>
<li class="toctree-l4"><a class="reference internal" href="#images-specified-via-url">Images specified via URL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#clean-file-markups">Clean File Markups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clean-file-loading">Clean File Loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clean-schema">Clean Schema</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="clean.html">Cleaning Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tcl/index.html">Tcl Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Testbed &amp; Device Cleaning</a></li>
      <li class="breadcrumb-item active">Input Files</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="input-files">
<h1>Input Files<a class="headerlink" href="#input-files" title="Permalink to this heading">¶</a></h1>
<p>Kleenex introduces a new input file, responsible for feeding different
information to the runtime engine: the <code class="docutils literal notranslate"><span class="pre">clean_file</span></code>.
This file comes with its own schema, and is defined using <a class="reference external" href="http://www.yaml.org/spec/1.2/spec.html">YAML</a> format.</p>
<p>The primary design goal of this input files is to <em>provide sufficient
standardization</em> to the look &amp; feel of how dynamic testbed cleaning
datasets are passed to the infrastructure, whilst <em>maintaining enough
flexibility</em> to accomodate for various differences between device-specific
details &amp; user implementations.</p>
<section id="clean-file">
<span id="id1"></span><h2>Clean File<a class="headerlink" href="#clean-file" title="Permalink to this heading">¶</a></h2>
<p>Where as a <a class="reference internal" href="../topology/creation.html#topology-testbed-file"><span class="std std-ref">Topology Testbed File</span></a> is mostly
static, describing the physical nature of the topology and its devices, a clean
file is considered to mostly contain the corresponding volatile information, eg:</p>
<blockquote>
<div><ul class="simple">
<li><p>which clean implementation to use, what is the cleaning sequence</p></li>
<li><p>arguments for instantiating and running each cleaner</p></li>
<li><p>where device images (and pies/SMUs, if applicable) are located</p></li>
<li><p>specific information related to device cleaning and image loading</p></li>
<li><p>base configuration required to operate each device</p></li>
<li><p>etc.</p></li>
</ul>
</div></blockquote>
<p>Consider the clean file &amp; its content as an addendum to <a class="reference internal" href="../topology/creation.html#topology-testbed-file"><span class="std std-ref">Testbed File</span></a>: each clean file’s content defines a set of devices
and how to clean them.</p>
<p>When Kleenex loads a testbed’s clean file, its content is parsed and stored
(updated) into the <code class="docutils literal notranslate"><span class="pre">Device.clean</span></code> attribute of each
<a class="reference internal" href="../topology/concept.html#topology-device-object"><span class="std std-ref">Device object</span></a>. This tight integration allows
runtime accessess to each device’s specific clean information
directly through the object model. Multiple clean files can be loaded at once,
which will add to or overwrite the values of the previous clean files.</p>
<p>The specific runtime clean information loaded from the clean file for each
device is applied to its corresponding device object’s <code class="docutils literal notranslate"><span class="pre">clean</span></code> dictionary
using <strong>recursive dictionary update</strong>. This allows the user to provide default,
static clean content in the testbed topology file and potentially overwrite it
using the clean file before a run when needed.</p>
<section id="images-specified-via-filename">
<h3>Images specified via filename<a class="headerlink" href="#images-specified-via-filename" title="Permalink to this heading">¶</a></h3>
<p>Here is an example of specifying clean images via fully specified path names:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   demonstrating how clean file content is loaded</span>
<span class="c1">#   and applied to device objects for user reference</span>

<span class="nn">---</span><span class="w"> </span><span class="c1"># assuming we have this simple testbed.yaml file</span>
<span class="nt">devices</span><span class="p">:</span>
<span class="w">    </span><span class="nt">example-device</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-type</span>
<span class="w">        </span><span class="nt">connections</span><span class="p">:</span>
<span class="w">            </span><span class="nt">default</span><span class="p">:</span>
<span class="w">                </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">                </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.10</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="nn">...</span>

<span class="nn">---</span><span class="w"> </span><span class="c1"># and we had this clean.yaml clean-file for this testbed</span>
<span class="nt">cleaners</span><span class="p">:</span>
<span class="w">    </span><span class="nt">AwesomeClean</span><span class="p">:</span>
<span class="w">        </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mollymaid.cleaners</span>
<span class="w">        </span><span class="nt">devices</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">example-device</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>

<span class="nt">devices</span><span class="p">:</span>
<span class="w">    </span><span class="nt">example-device</span><span class="p">:</span>
<span class="w">        </span><span class="nt">images</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/device/image/r99.9.9.bin</span>

<span class="w">        </span><span class="nt">awesomeclean</span><span class="p">:</span>
<span class="w">            </span><span class="nt">check_image_md5</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900</span>
</pre></div>
</div>
<p>During runtime, when the above testbed and clean files are loaded by Kleenex,
the resulting content would be as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   pseduo-code demonstrating how clean content is applied to device objects</span>

<span class="c1"># after the above testbed is loaded, you start with the following:</span>
<span class="n">testbed</span>
<span class="c1"># &lt;pyats.topology.testbed.Testbed object at 0xf705c40c&gt;</span>
<span class="n">testbed</span><span class="o">.</span><span class="n">devices</span>
<span class="c1"># {&#39;example-device&#39;: &lt;Device example-device at 0xf705cccc&gt;}</span>

<span class="c1"># the device would only have the static clean information</span>
<span class="c1"># defined within the testbed yaml file</span>
<span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;example-device&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clean</span>
<span class="c1"># {&#39;golden_image&#39;: &#39;/path/to/golden/image.bin&#39;,</span>
<span class="c1">#  &#39;preclean&#39;: &#39;switchname example-device\n&#39;</span>
<span class="c1">#              &#39;username admin password cisco123\n&#39;</span>
<span class="c1">#              &#39;no password strength-check\n&#39;</span>
<span class="c1">#              &#39;interface mgmt0\n&#39;</span>
<span class="c1">#              &#39;    ip address 1.1.1.10 255.255.255.0\n&#39;</span>
<span class="c1">#              &#39;    no shutdown\n&#39;</span>
<span class="c1">#              &#39;vrf context management\n&#39;</span>
<span class="c1">#              &#39;    ip route 0.0.0.0/0 1.1.1.1\n&#39;</span>
<span class="c1">#              &#39;feature telnet\n&#39;,</span>
<span class="c1">#  }</span>

<span class="c1"># --------------------------------------------------</span>
<span class="c1"># once the clean information is applied, it is added</span>
<span class="c1"># directly to the device&#39;s clean dictionary, and the</span>
<span class="c1"># resulting device.clean becomes the following:</span>
<span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;example-device&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clean</span>
<span class="c1"># {&#39;awesomeclean&#39;: {&#39;check_image_md5&#39;: True},</span>
<span class="c1">#  &#39;golden_image&#39;: &#39;/path/to/golden/image.bin&#39;,</span>
<span class="c1">#  &#39;images&#39;: [&#39;/path/to/device/image/r99.9.9.bin&#39;],</span>
<span class="c1">#  &#39;preclean&#39;: &#39;switchname example-device\n&#39;</span>
<span class="c1">#              &#39;username admin password cisco123\n&#39;</span>
<span class="c1">#              &#39;no password strength-check\n&#39;</span>
<span class="c1">#              &#39;interface mgmt0\n&#39;</span>
<span class="c1">#              &#39;    ip address 1.1.1.10 255.255.255.0\n&#39;</span>
<span class="c1">#              &#39;    no shutdown\n&#39;</span>
<span class="c1">#              &#39;vrf context management\n&#39;</span>
<span class="c1">#              &#39;    ip route 0.0.0.0/0 1.1.1.1\n&#39;</span>
<span class="c1">#              &#39;feature telnet\n&#39;,</span>
<span class="c1">#  &#39;timeout&#39;: 900}}</span>
<span class="c1">#</span>
<span class="c1"># notice how the content of clean file got applied?</span>
<span class="c1">#</span>
<span class="c1"># Note: the clean timeout value if defined at the device level is always</span>
<span class="c1"># used even if it is also specified at the global level.</span>
</pre></div>
</div>
</section>
<section id="images-specified-via-url">
<h3>Images specified via URL<a class="headerlink" href="#images-specified-via-url" title="Permalink to this heading">¶</a></h3>
<p>Images for a particular device may be specified individually via URL
or collectively via a URL of a directory in which images may be found.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Neither image nor image directory URLs need to contain
authentication details, which are instead retrieved from the server block
of the <a class="reference internal" href="../topology/schema.html#schema"><span class="std std-ref">testbed configuration</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>URL-formatted images are only supported for use by clean plugins
and not by bringup orchestrator plugins.</p>
</div>
<section id="allowable-image-url-formats">
<span id="clean-image-url-formats"></span><h4>Allowable image URL formats<a class="headerlink" href="#allowable-image-url-formats" title="Permalink to this heading">¶</a></h4>
<p>Image URLs take the following form :
<code class="docutils literal notranslate"><span class="pre">&lt;protocol&gt;://&lt;server&gt;.&lt;domain&gt;:&lt;port&gt;/path/to/image/my_image</span></code></p>
<p>When an image is specified in a non-URL form a protocol of <code class="docutils literal notranslate"><span class="pre">file</span></code> is assumed.</p>
<p>The list of available protocols is platform-dependent
but may include the following:</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">Possible available clean image protocols</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>file</p></td>
<td><p>ftp</p></td>
<td><p>tftp</p></td>
<td><p>sftp</p></td>
<td><p>scp</p></td>
</tr>
</tbody>
</table>
</section>
<section id="allowable-image-directory-url-formats">
<span id="clean-image-dir-url-formats"></span><h4>Allowable image directory URL formats<a class="headerlink" href="#allowable-image-directory-url-formats" title="Permalink to this heading">¶</a></h4>
<p>A set of images may be specified by first specifying a set of
roles and image inclusion patterns, and then specifying a
remote directory from which the image list is to be populated.</p>
<p>Image directory URLs take the following form :
<code class="docutils literal notranslate"><span class="pre">&lt;dir-protocol&gt;://&lt;server&gt;.&lt;domain&gt;:&lt;port&gt;/path/to/image/</span></code></p>
<p>Where <code class="docutils literal notranslate"><span class="pre">dir-protocol</span></code> is a protocol capable of retrieving a file listing.
If <code class="docutils literal notranslate"><span class="pre">&lt;dir-protocol&gt;</span></code> is not specified then a protocol of <code class="docutils literal notranslate"><span class="pre">file</span></code> is assumed.
A protocol of <code class="docutils literal notranslate"><span class="pre">file</span></code> is assumed when an image path is specified in
non-URL form.</p>
<p>The list of available directory protocols is platform-dependent
but may include the following:</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text">Possible available clean image directory protocols</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>file</p></td>
<td><p>ftp</p></td>
<td><p>sftp</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="clean-file-markups">
<h2>Clean File Markups<a class="headerlink" href="#clean-file-markups" title="Permalink to this heading">¶</a></h2>
<p>The following <a class="reference internal" href="../topology/creation.html#testbed-file-markups"><span class="std std-ref">Testbed File Markups</span></a> are allowed in clean YAML files:
%ENV, %CALLABLE, %INCLUDE.</p>
<p>The following markups are also allowed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Syntax
# ------
#
#   Clean YAML markup syntax

# reference to arbitrary attribute within the clean file
%{a.b.c}

# reference to current clean device name.
# This also works under the platforms: block.
%{self}

# reference to attributes within the current clean device section
# This also works under the platforms: block.
%{self.x.y.z}

# reference to attributes within the testbed content.
%{testbed.x.y.z}

# reference to attributes within the testbed device section corresponding
# to the current clean device name.
# This also works under the platforms: block.
%{testbed.self.x.y.z}
</pre></div>
</div>
</section>
<section id="clean-file-loading">
<h2>Clean File Loading<a class="headerlink" href="#clean-file-loading" title="Permalink to this heading">¶</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   demonstrating how clean file content is loaded</span>
<span class="c1">#   and applied to device objects for user reference</span>

<span class="nn">---</span><span class="w"> </span><span class="c1"># assuming we have this simple testbed.yaml file</span>
<span class="nt">testbed</span><span class="p">:</span>
<span class="w">    </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">        </span><span class="nt">golden_img_svr.domain.com</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Auth details for svr to allow below url to work.</span>
<span class="w">            </span><span class="nt">credentials</span><span class="p">:</span>
<span class="w">                </span><span class="nt">default</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdoe</span>
<span class="w">                    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pw</span>

<span class="w">        </span><span class="nt">img_svr.domain.com</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Auth details for svr to allow below urls to work.</span>
<span class="w">            </span><span class="nt">credentials</span><span class="p">:</span>
<span class="w">                </span><span class="nt">default</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdoe</span>
<span class="w">                    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pw</span>

<span class="nt">devices</span><span class="p">:</span>
<span class="w">    </span><span class="nt">example-device</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-type</span>
<span class="w">        </span><span class="nt">connections</span><span class="p">:</span>
<span class="w">            </span><span class="nt">default</span><span class="p">:</span>
<span class="w">                </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">                </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.10</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>

<span class="w">    </span><span class="nt">another-example-device</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-type</span>
<span class="w">        </span><span class="nt">connections</span><span class="p">:</span>
<span class="w">            </span><span class="nt">default</span><span class="p">:</span>
<span class="w">                </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">                </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.10</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">501</span>
<span class="nn">...</span>

<span class="nn">---</span><span class="w"> </span><span class="c1"># and we had this clean.yaml clean-file for this testbed</span>
<span class="nt">cleaners</span><span class="p">:</span>
<span class="w">    </span><span class="nt">AwesomeClean</span><span class="p">:</span>
<span class="w">        </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mollymaid.cleaners</span>
<span class="w">        </span><span class="nt">devices</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">example-device</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>

<span class="nt">devices</span><span class="p">:</span>
<span class="w">    </span><span class="nt">example-device</span><span class="p">:</span>
<span class="w">        </span><span class="nt">images</span><span class="p">:</span>
<span class="w">            </span><span class="nt">rp</span><span class="p">:</span>
<span class="w">                </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/device/image/r99.9.9.bin</span>
<span class="w">                </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">r\d+\.\d\.\d\.bin</span>
<span class="w">                </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file_pat_to_exclude</span>
<span class="w">                </span><span class="nt">cardinality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="w">            </span><span class="nt">pie</span><span class="p">:</span>
<span class="w">                </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ftp://img_svr.domain.com/path/to/mypies/k9sec.bin</span>
<span class="w">                </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k9sec</span>
<span class="w">                </span><span class="nt">cardinality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ANY</span>


<span class="w">    </span><span class="nt">another-example-device</span><span class="p">:</span>
<span class="w">        </span><span class="nt">images</span><span class="p">:</span>
<span class="w">            </span><span class="nt">role_defaults</span><span class="p">:</span>
<span class="w">                </span><span class="nt">base_dir</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">sftp://img_svr.domain.com/path/to/device/images/</span>
<span class="w">                           </span><span class="l l-Scalar l-Scalar-Plain"># Is dir due to trailing slash.</span>
<span class="w">                           </span><span class="l l-Scalar l-Scalar-Plain"># It is ignored if there is not at least one</span>
<span class="w">                           </span><span class="l l-Scalar l-Scalar-Plain"># &lt;role_name&gt;/include pattern specified.</span>
<span class="w">                </span><span class="nt">cardinality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">rp</span><span class="p">:</span>
<span class="w">                </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">r\d+\.\d\.\d\.bin</span>
<span class="w">                </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file_pat_to_exclude</span>

<span class="w">        </span><span class="c1"># Static clean information may also be specified in the clean file</span>
<span class="w">        </span><span class="c1"># instead of only the testbed file.  Note how the markup refers</span>
<span class="w">        </span><span class="c1"># to content in the testbed file&#39;s block for this device.</span>
<span class="w">        </span><span class="nt">apply_configuration</span><span class="p">:</span>
<span class="w">            </span><span class="nt">configuration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">                </span><span class="no">switchname another-example-device</span>
<span class="w">                </span><span class="no">username admin password cisco123</span>
<span class="w">                </span><span class="no">no password strength-check</span>
<span class="w">                </span><span class="no">interface mgmt0</span>
<span class="w">                    </span><span class="no">ip address %{testbed.self.clean.mgt_itf.ipv4.address} %{testbed.self.clean.mgt_itf.ipv4.net.mask}</span>
<span class="w">                    </span><span class="no">no shutdown</span>
<span class="w">                </span><span class="no">vrf context management</span>
<span class="w">                    </span><span class="no">ip route 0.0.0.0/0 1.1.1.1</span>
<span class="w">                </span><span class="no">feature telnet</span>

<span class="w">        </span><span class="nt">awesomeclean</span><span class="p">:</span>
<span class="w">            </span><span class="nt">check_image_md5</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900</span>
</pre></div>
</div>
</section>
<section id="clean-schema">
<span id="id2"></span><h2>Clean Schema<a class="headerlink" href="#clean-schema" title="Permalink to this heading">¶</a></h2>
<p>The following describes the top-level skeleton clean file schema. When Kleenex
is provided a clean file, its content is always checked against the schema below
for consistency.</p>
<p>The clean schema is intended to provided only <em>sufficient</em> consistency across
the board, whilst maintaining enough <em>flexibility</em> in order to accomodate
various different user implementations.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">clean_devices</span></code></dt><dd><p>optional key containing a list of devices to clean sequentially. If not
specified here or via the <code class="docutils literal notranslate"><span class="pre">--clean-devices</span></code> CLI parameter, defaults to
cleaning all devices specified in the clean file that are also present
in the testbed file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extends:</span></code></dt><dd><p>section allowing the ability for one clean file to include/extend other
clean files (extension and/or inheritance relationship). When one clean file
extends another, the other file forms the basis, and contents of the
current file is then applied on top using <em>recursive dictionary update</em>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cleaners:</span></code></dt><dd><p>section defining <a class="reference internal" href="clean.html#kleenex-cleaners"><span class="std std-ref">Cleaner classes</span></a>. Declare all
clean classes to be used for cleaning this testbed’s devices, including the
mapping of which cleaner is to be used for which device and/or group of
devices.  If not specified then it is autopopulated by assigning to a
default cleaner class all devices defined in the clean file (including all
devices specified by group or platform) which are also defined in the
testbed file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">devices:</span></code></dt><dd><p>section defining device specific clean information, sub-keyed by device
name. All key/value pairs for each device are updated into
the corresponding device object during runtime for ease of access.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">platforms:</span></code></dt><dd><p>section defining platform specific clean information, sub-keyed by platform
name. All key/value pairs for each platform are updated into
the corresponding device object(s) with matching platform  during runtime
for ease of access.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">groups:</span></code></dt><dd><p>section allowing users to group common information for multiple devices
(eg, a platform family) together, reducing copy/pasting. During runtime,
group information is expanded to <em>per device</em> definition and then added to
each device’s object, similarly to how the above device section works.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>if the same device belongs to a group and has its device specific
section, the group information forms the basis, and the device specific
info is applied on top.</p>
</div>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clean File Schema</span>
<span class="c1"># -----------------</span>
<span class="c1">#</span>
<span class="c1">#   production clean file schema with commentary from the devs</span>

<span class="nt">extends</span><span class="p">:</span><span class="w">    </span><span class="c1"># Clean file(s) to extend/build on.</span>
<span class="w">            </span><span class="c1"># Use this field to extend an existing yaml clean file,</span>
<span class="w">            </span><span class="c1"># allowing you to create an inheritance hierarchy.</span>
<span class="w">            </span><span class="c1"># Supports full path/names or name of file in the same dir.</span>
<span class="w">            </span><span class="c1"># The content of the last file on the list forms the base and</span>
<span class="w">            </span><span class="c1"># is updated with the preceding file, and so on,</span>
<span class="w">            </span><span class="c1"># until the existing file content is updated last.</span>
<span class="w">            </span><span class="c1"># (optional)</span>


<span class="c1"># clean_devices</span>
<span class="c1"># -------------</span>
<span class="c1">#</span>
<span class="c1"># This optional key specifies the devices to be cleaned.</span>
<span class="c1"># Devices may be specified by their actual name or their alias.</span>
<span class="c1">#</span>
<span class="c1"># This key may be used to clean devices sequentially.</span>
<span class="c1">#</span>
<span class="c1"># In the following example, device_a, device_b and device_c are</span>
<span class="c1"># cleaned in parallel, and only once complete are device_d and device_e</span>
<span class="c1"># cleaned in parallel.</span>
<span class="c1">#</span>
<span class="c1"># It may be overridden by specifying the CLI parameter clean_devices.</span>
<span class="c1">#</span>
<span class="c1"># clean_devices: [[device_a, device_b, device_c], [device_d, device_e]]</span>


<span class="c1"># cleaners block</span>
<span class="c1"># --------------</span>
<span class="c1">#</span>
<span class="c1">#   information regarding how kleenex cleaners are to be configured</span>
<span class="c1">#   kleenex support per device/group cleaner mapping</span>
<span class="nt">cleaners</span><span class="p">:</span>

<span class="w">    </span><span class="nt">&lt;cleaner class&gt;</span><span class="p">:</span><span class="w">    </span><span class="c1"># Clean class implementation to instantiate</span>
<span class="w">                        </span><span class="c1"># This needs to be the actual class definition name</span>
<span class="w">                        </span><span class="c1"># to be used for cleaning one or more device.</span>
<span class="w">                        </span><span class="c1"># eg: PyatsDeviceClean</span>
<span class="w">                        </span><span class="c1"># (mandatory)</span>

<span class="w">        </span><span class="nt">module</span><span class="p">:</span><span class="w">         </span><span class="c1"># Module where the cleaner class can be</span>
<span class="w">                        </span><span class="c1"># imported from. Eg, genie.libs.clean</span>
<span class="w">                        </span><span class="c1"># (mandatory)</span>

<span class="w">        </span><span class="nt">devices</span><span class="p">:</span><span class="w">        </span><span class="c1"># List of cleanable devices using this cleaner class</span>
<span class="w">                        </span><span class="c1"># devices here need to be defined either in groups</span>
<span class="w">                        </span><span class="c1"># or as specific devices below.  Any devices</span>
<span class="w">                        </span><span class="c1"># without a corresponding testbed topology</span>
<span class="w">                        </span><span class="c1"># entry are ignored with a warning.</span>
<span class="w">                        </span><span class="c1"># Either device name or device alias may be</span>
<span class="w">                        </span><span class="c1"># specified.</span>
<span class="w">                        </span><span class="c1"># (optional)</span>

<span class="w">        </span><span class="nt">platforms</span><span class="p">:</span><span class="w">      </span><span class="c1"># list of platforms</span>
<span class="w">                        </span><span class="c1"># Specify the list of platforms that belong to this</span>
<span class="w">                        </span><span class="c1"># group. The cleanable devices are derived from</span>
<span class="w">                        </span><span class="c1"># testbed topology devices with matching platform.</span>
<span class="w">                        </span><span class="c1"># (optional)</span>

<span class="w">        </span><span class="nt">groups</span><span class="p">:</span><span class="w">         </span><span class="c1"># List of groups of cleanable devices using this</span>
<span class="w">                        </span><span class="c1"># cleaner class. any groups used here need to be</span>
<span class="w">                        </span><span class="c1"># defined in the groups: block down below</span>
<span class="w">                        </span><span class="c1"># (optional)</span>

<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w">        </span><span class="c1"># Clean timeout in seconds.</span>
<span class="w">                        </span><span class="c1"># At runtime this clean timeout is used</span>
<span class="w">                        </span><span class="c1"># if not specified at the device level.</span>
<span class="w">                        </span><span class="c1"># If timeout is specified at neither level,</span>
<span class="w">                        </span><span class="c1"># the clean worker runs without timing out.</span>
<span class="w">                        </span><span class="c1"># (optional)</span>

<span class="w">        </span><span class="c1"># any key/value pair to be used to configure this cleaner</span>
<span class="w">        </span><span class="c1"># these are passed as kwargs to the class&#39;s __init__()</span>
<span class="w">        </span><span class="nt">&lt;key&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;value&gt;</span>


<span class="c1"># platforms block</span>
<span class="c1"># ---------------</span>
<span class="c1">#</span>
<span class="c1">#   clean information specific to a particular platform.</span>
<span class="nt">platforms</span><span class="p">:</span><span class="w">              </span><span class="c1"># A block of clean information specific to a</span>
<span class="w">                        </span><span class="c1"># particular platform.</span>
<span class="w">                        </span><span class="c1"># This block applies to every device in your</span>
<span class="w">                        </span><span class="c1"># testbed topology file with matching platform</span>
<span class="w">                        </span><span class="c1"># value.</span>

<span class="w">    </span><span class="nt">&lt;platform name&gt;</span><span class="p">:</span><span class="w">    </span><span class="c1"># Platform name</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># (mandatory)</span>
<span class="w">        </span><span class="c1"># platform content has an identical schema to the devices block.</span>


<span class="c1"># devices block</span>
<span class="c1"># -------------</span>
<span class="c1">#</span>
<span class="c1">#   clean information specific to each device.</span>
<span class="nt">devices</span><span class="p">:</span>

<span class="w">    </span><span class="nt">&lt;device name&gt;</span><span class="p">:</span><span class="w">      </span><span class="c1"># Device name (hostname)</span>
<span class="w">                        </span><span class="c1"># This defines the block of clean information</span>
<span class="w">                        </span><span class="c1"># specific to this device. This must correspond to</span>
<span class="w">                        </span><span class="c1"># the same device in your testbed topology file.</span>
<span class="w">                        </span><span class="c1"># (mandatory)</span>


<span class="w">        </span><span class="nt">images</span><span class="p">:</span><span class="w">         </span><span class="c1"># Image(s) to be loaded for this device</span>
<span class="w">                        </span><span class="c1"># (2 for NXOS N7K, 1 for for most other platforms)</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># A single image may be specified directly</span>
<span class="w">                        </span><span class="c1"># without using a list.</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Images may also be sub-keyed by role:</span>
<span class="w">                        </span><span class="c1"># images/&lt;image_role&gt;/[list of images] or</span>
<span class="w">                        </span><span class="c1"># images/&lt;image_role&gt;/single_image</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># For example:</span>
<span class="w">                        </span><span class="c1">#   images:</span>
<span class="w">                        </span><span class="c1">#     kick: /path/to/kick.img</span>
<span class="w">                        </span><span class="c1">#     system: /path/to/system.img</span>
<span class="w">                        </span><span class="c1">#     smu: [/path/to/smu1.img, /path/to/smu2.img]</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Images are assumed to be filesystem-based unless</span>
<span class="w">                        </span><span class="c1"># they are specified as URLs of the following form:</span>
<span class="w">                        </span><span class="c1"># &lt;protocol&gt;://&lt;server&gt;.&lt;domain&gt;:&lt;port&gt;/path/to/image/my_image</span>
<span class="w">                        </span><span class="c1"># where available &lt;protocol&gt; values are platform</span>
<span class="w">                        </span><span class="c1"># dependent but could be one of the following :</span>
<span class="w">                        </span><span class="c1"># ftp, tftp, sftp, scp</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Authentication details are discovered from the</span>
<span class="w">                        </span><span class="c1"># servers block of the testbed topology via one</span>
<span class="w">                        </span><span class="c1"># of the following forms:</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># servers:</span>
<span class="w">                        </span><span class="c1">#   &lt;server&gt;:</span>
<span class="w">                        </span><span class="c1">#     credentials:</span>
<span class="w">                        </span><span class="c1">#       ftp:</span>
<span class="w">                        </span><span class="c1">#         username: my_user</span>
<span class="w">                        </span><span class="c1">#         password: my_pw</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># or</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># servers:</span>
<span class="w">                        </span><span class="c1">#   alternate_server_name:</span>
<span class="w">                        </span><span class="c1">#     server: server.com</span>
<span class="w">                        </span><span class="c1">#     credentials:</span>
<span class="w">                        </span><span class="c1">#       ftp:</span>
<span class="w">                        </span><span class="c1">#         username: my_user</span>
<span class="w">                        </span><span class="c1">#         password: my_pw</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># or</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># servers:</span>
<span class="w">                        </span><span class="c1">#   alternate_server_name:</span>
<span class="w">                        </span><span class="c1">#     address: &lt;server&#39;s IP address&gt;</span>
<span class="w">                        </span><span class="c1">#     credentials:</span>
<span class="w">                        </span><span class="c1">#       ftp:</span>
<span class="w">                        </span><span class="c1">#         username: my_user</span>
<span class="w">                        </span><span class="c1">#         password: my_pw</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># For example:</span>
<span class="w">                        </span><span class="c1">#  images:</span>
<span class="w">                        </span><span class="c1">#    kick:</span>
<span class="w">                        </span><span class="c1">#      file: [ftp://server.com/path/to/my/image]</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Images may also be specified by directory when</span>
<span class="w">                        </span><span class="c1"># additional validation/searching parameters</span>
<span class="w">                        </span><span class="c1"># are provided.</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># For example:</span>
<span class="w">                        </span><span class="c1">#  images:</span>
<span class="w">                        </span><span class="c1">#    role_defaults:</span>
<span class="w">                        </span><span class="c1">#      base_dir : ftp://server.com/path/to/images</span>
<span class="w">                        </span><span class="c1">#      cardinality: 1</span>
<span class="w">                        </span><span class="c1">#    kick:</span>
<span class="w">                        </span><span class="c1">#      include: &#39;.*kick.*\.bin&#39;</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># (optional)</span>


<span class="w">            </span><span class="nt">role_defaults</span><span class="p">:</span><span class="w"> </span><span class="c1"># Default role-based properties that apply</span>
<span class="w">                           </span><span class="c1"># to all defined roles unless specifically</span>
<span class="w">                           </span><span class="c1"># overridden at the role level.</span>
<span class="w">                           </span><span class="c1">#</span>
<span class="w">                           </span><span class="c1"># Keys shown as mandatory in this section</span>
<span class="w">                           </span><span class="c1"># must be specified at the role level for</span>
<span class="w">                           </span><span class="c1"># each defined role if not specified here.</span>
<span class="w">                           </span><span class="c1"># (Optional)</span>


<span class="w">                    </span><span class="nt">base_dir </span><span class="p">:</span><span class="w"> </span><span class="c1"># A directory in which the image(s)</span>
<span class="w">                               </span><span class="c1"># may be found.  May be filesystem-based or</span>
<span class="w">                               </span><span class="c1"># a URL of the following form:</span>
<span class="w">                               </span><span class="c1"># &lt;dir-protocol&gt;://&lt;server&gt;.&lt;domain&gt;:&lt;port&gt;/path/to/image/</span>
<span class="w">                               </span><span class="c1"># where available &lt;dir-protocol&gt; values are</span>
<span class="w">                               </span><span class="c1"># platform dependent but could be one of the</span>
<span class="w">                               </span><span class="c1"># following : ftp, sftp</span>
<span class="w">                               </span><span class="c1">#</span>
<span class="w">                               </span><span class="c1"># May only be specified when one or more</span>
<span class="w">                               </span><span class="c1"># roles with include patterns are defined.</span>
<span class="w">                               </span><span class="c1"># images/&lt;role_name&gt;/file content is then</span>
<span class="w">                               </span><span class="c1"># populated from the specified directory.</span>
<span class="w">                               </span><span class="c1">#</span>
<span class="w">                               </span><span class="c1"># This key does not appear in the final</span>
<span class="w">                               </span><span class="c1"># loaded content.</span>
<span class="w">                               </span><span class="c1">#</span>
<span class="w">                               </span><span class="c1"># May not be specified together with</span>
<span class="w">                               </span><span class="c1"># file.</span>
<span class="w">                               </span><span class="c1"># (mandatory if file not specified)</span>


<span class="w">                    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="c1"># An explicit image filename or URL (or list of</span>
<span class="w">                          </span><span class="c1"># filenames/URLs).</span>
<span class="w">                          </span><span class="c1">#</span>
<span class="w">                          </span><span class="c1"># Any image filename specified via URL is</span>
<span class="w">                          </span><span class="c1"># expected to exist, otherwise an</span>
<span class="w">                          </span><span class="c1"># exception is thrown.</span>
<span class="w">                          </span><span class="c1">#</span>
<span class="w">                          </span><span class="c1"># May not be specified together with base_dir.</span>
<span class="w">                          </span><span class="c1">#</span>
<span class="w">                          </span><span class="c1"># (mandatory if base_dir not specified)</span>


<span class="w">                    </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="c1"># A regular expression that images</span>
<span class="w">                             </span><span class="c1"># must match.</span>
<span class="w">                             </span><span class="c1">#</span>
<span class="w">                             </span><span class="c1"># This key does not appear in the final</span>
<span class="w">                             </span><span class="c1"># loaded content.</span>
<span class="w">                             </span><span class="c1">#</span>
<span class="w">                             </span><span class="c1"># (mandatory only when images are specified</span>
<span class="w">                             </span><span class="c1"># via base_dir).</span>


<span class="w">                    </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="c1"># A regular expression that images</span>
<span class="w">                             </span><span class="c1"># must not match.</span>
<span class="w">                             </span><span class="c1">#</span>
<span class="w">                             </span><span class="c1"># This key does not appear in the final</span>
<span class="w">                             </span><span class="c1"># loaded content.</span>
<span class="w">                             </span><span class="c1">#</span>
<span class="w">                             </span><span class="c1"># (optional)</span>


<span class="w">                    </span><span class="nt">cardinality</span><span class="p">:</span><span class="w"> </span><span class="c1"># The exact number of images</span>
<span class="w">                                 </span><span class="c1"># that may be specified.</span>
<span class="w">                                 </span><span class="c1">#</span>
<span class="w">                                 </span><span class="c1"># It may also be specified as</span>
<span class="w">                                 </span><span class="c1"># ANY (case insensitive), which</span>
<span class="w">                                 </span><span class="c1"># means that zero or more images are</span>
<span class="w">                                 </span><span class="c1"># allowed.</span>
<span class="w">                                 </span><span class="c1">#</span>
<span class="w">                                 </span><span class="c1"># This key does not appear in the final</span>
<span class="w">                                 </span><span class="c1"># loaded content.</span>
<span class="w">                                 </span><span class="c1">#</span>
<span class="w">                                 </span><span class="c1"># (mandatory when base_dir is specified)</span>


<span class="w">            </span><span class="nt">&lt;role_name&gt;</span><span class="p">:</span><span class="w"> </span><span class="c1"># A role (such as system, kickstart or smu)</span>
<span class="w">                         </span><span class="c1"># that is recognized by this device&#39;s cleaner</span>
<span class="w">                         </span><span class="c1"># class.</span>
<span class="w">                         </span><span class="c1">#</span>
<span class="w">                         </span><span class="c1"># May be specified as a single filename or URL or</span>
<span class="w">                         </span><span class="c1"># a list of filenames/URLs.</span>
<span class="w">                         </span><span class="c1">#</span>
<span class="w">                         </span><span class="c1"># Any filename specified via URL is</span>
<span class="w">                         </span><span class="c1"># expected to exist, otherwise an</span>
<span class="w">                         </span><span class="c1"># exception is thrown.</span>
<span class="w">                         </span><span class="c1">#</span>
<span class="w">                         </span><span class="c1"># May also contain any key documented under</span>
<span class="w">                         </span><span class="c1"># role_defaults, the value here overrides</span>
<span class="w">                         </span><span class="c1"># the value in role_defaults (if specified).</span>
<span class="w">                         </span><span class="c1">#</span>
<span class="w">                         </span><span class="c1"># If specified as blank, role_defaults must</span>
<span class="w">                         </span><span class="c1"># not be blank, and all mandatory keys must</span>
<span class="w">                         </span><span class="c1"># be specified in role_defaults, otherwise</span>
<span class="w">                         </span><span class="c1"># an exception is thrown.</span>


<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w">        </span><span class="c1"># Clean timeout in seconds.</span>
<span class="w">                        </span><span class="c1"># At runtime this clean timeout is used even</span>
<span class="w">                        </span><span class="c1"># if specified at the global level.</span>
<span class="w">                        </span><span class="c1"># If timeout is specified at neither level,</span>
<span class="w">                        </span><span class="c1"># the clean worker runs without timing out.</span>
<span class="w">                        </span><span class="c1"># (optional)</span>

<span class="w">        </span><span class="c1"># any key/value pair to be stored to this device object&#39;s</span>
<span class="w">        </span><span class="c1"># Device.clean attribute. (nested dictionary update)</span>
<span class="w">        </span><span class="nt">&lt;key&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;value&gt;</span>


<span class="c1"># groups block</span>
<span class="c1"># ------------</span>
<span class="c1">#</span>
<span class="c1">#   clean information common to a group of devices</span>
<span class="nt">groups</span><span class="p">:</span>

<span class="w">    </span><span class="nt">&lt;group name&gt;</span><span class="p">:</span><span class="w">       </span><span class="c1"># group name (arbitrary string)</span>
<span class="w">                        </span><span class="c1"># define a group of devices that share the same</span>
<span class="w">                        </span><span class="c1"># clean definitions.</span>
<span class="w">                        </span><span class="c1"># (mandatory)</span>


<span class="w">        </span><span class="nt">devices</span><span class="p">:</span><span class="w">        </span><span class="c1"># list of devices</span>
<span class="w">                        </span><span class="c1"># Specify the list of devices that belong to this</span>
<span class="w">                        </span><span class="c1"># group (either device name or device alias may</span>
<span class="w">                        </span><span class="c1"># be specified).</span>
<span class="w">                        </span><span class="c1"># (Do not specify more than a single group type)</span>
<span class="w">                        </span><span class="c1"># (choose only one from os, platforms, devices group types.)</span>


<span class="w">        </span><span class="nt">platforms</span><span class="p">:</span><span class="w">      </span><span class="c1"># list of platforms</span>
<span class="w">                        </span><span class="c1"># Specify the list of platforms that belong to this</span>
<span class="w">                        </span><span class="c1"># group. The devices in this group are derived from</span>
<span class="w">                        </span><span class="c1"># testbed topology devices with matching platform.</span>
<span class="w">                        </span><span class="c1"># (Do not specify more than a single group type)</span>
<span class="w">                        </span><span class="c1"># (choose only one from os, platforms, devices group types.)</span>


<span class="w">        </span><span class="nt">os</span><span class="p">:</span><span class="w">             </span><span class="c1"># list of os</span>
<span class="w">                        </span><span class="c1"># Specify the list of os that belong to this</span>
<span class="w">                        </span><span class="c1"># group. The devices in this group are derived from</span>
<span class="w">                        </span><span class="c1"># testbed topology devices with matching os.</span>
<span class="w">                        </span><span class="c1"># (Do not specify more than a single group type)</span>
<span class="w">                        </span><span class="c1"># (choose only one from os, platforms, devices group types.)</span>



<span class="w">        </span><span class="nt">images</span><span class="p">:</span><span class="w">         </span><span class="c1"># Image(s) to be loaded for this group&#39;s</span>
<span class="w">                        </span><span class="c1"># devices (2 for NXOS N7K,</span>
<span class="w">                        </span><span class="c1"># 1 for for most other platforms)</span>
<span class="w">                        </span><span class="c1"># A single image may be specified directly</span>
<span class="w">                        </span><span class="c1"># without using a list.</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Images may also be sub-keyed by role:</span>
<span class="w">                        </span><span class="c1"># images/&lt;image_role&gt;/[list of images] or</span>
<span class="w">                        </span><span class="c1"># images/&lt;image_role&gt;/single_image</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># For example:</span>
<span class="w">                        </span><span class="c1">#   images:</span>
<span class="w">                        </span><span class="c1">#     kick: /path/to/kick.img</span>
<span class="w">                        </span><span class="c1">#     system: /path/to/system.img</span>
<span class="w">                        </span><span class="c1">#     smu: [/path/to/smu1.img, /path/to/smu2.img]</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Images are assumed to be filesystem-based unless</span>
<span class="w">                        </span><span class="c1"># they are specified as URLs of the following form:</span>
<span class="w">                        </span><span class="c1"># &lt;protocol&gt;://&lt;server&gt;.&lt;domain&gt;:&lt;port&gt;/path/to/image/my_image</span>
<span class="w">                        </span><span class="c1"># where available &lt;protocol&gt; values are platform</span>
<span class="w">                        </span><span class="c1"># dependent but could be one of the following :</span>
<span class="w">                        </span><span class="c1"># ftp, tftp, sftp, scp</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># For example:</span>
<span class="w">                        </span><span class="c1">#  images:</span>
<span class="w">                        </span><span class="c1">#    kick:</span>
<span class="w">                        </span><span class="c1">#      file: [ftp://server.com/path/to/my/image]</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Images may also be specified by directory when</span>
<span class="w">                        </span><span class="c1"># additional validation/searching parameters</span>
<span class="w">                        </span><span class="c1"># are provided.</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># For example:</span>
<span class="w">                        </span><span class="c1">#  images:</span>
<span class="w">                        </span><span class="c1">#    role_defaults:</span>
<span class="w">                        </span><span class="c1">#      base_dir : ftp://server.com/path/to/images</span>
<span class="w">                        </span><span class="c1">#      cardinality: 1</span>
<span class="w">                        </span><span class="c1">#    kick:</span>
<span class="w">                        </span><span class="c1">#      include: &#39;.*kick.*\.bin&#39;</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># Please refer to the schema and examples under</span>
<span class="w">                        </span><span class="c1"># devices/&lt;device_name&gt;/images</span>
<span class="w">                        </span><span class="c1"># as they also apply at the group level.</span>
<span class="w">                        </span><span class="c1">#</span>
<span class="w">                        </span><span class="c1"># (optional)</span>


<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w">        </span><span class="c1"># clean timeout in seconds.</span>
<span class="w">                        </span><span class="c1"># if not timeout is specified, clean worker will</span>
<span class="w">                        </span><span class="c1"># run without timing out.</span>
<span class="w">                        </span><span class="c1"># (optional)</span>

<span class="w">        </span><span class="c1"># any key/value pair to be stored to this group&#39;s device object&#39;s</span>
<span class="w">        </span><span class="c1"># Device.clean attribute. (nested dictionary update)</span>
<span class="w">        </span><span class="nt">&lt;key&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;value&gt;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usages.html" class="btn btn-neutral float-left" title="Usage &amp; Arguments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="clean.html" class="btn btn-neutral float-right" title="Cleaning Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>