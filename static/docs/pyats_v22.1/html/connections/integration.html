<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Integration &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Connection Manager" href="manager.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../aetest/index.html">AEtest - Test Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Connection Meta</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#single-instance">Single Instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-instance">Multiple Instance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="manager.html">Connection Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="class.html">Connection Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="hook.html">Connection Hook</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing.html">Connection Sharing</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tcl/index.html">Tcl Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Connection Meta</a></li>
      <li class="breadcrumb-item active">Integration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="integration">
<span id="connection-integration"></span><h1>Integration<a class="headerlink" href="#integration" title="Permalink to this heading">¶</a></h1>
<p>The integration of connection module’s <a class="reference internal" href="manager.html#connection-manager"><span class="std std-ref">Connection Manager</span></a> and topology
<a class="reference internal" href="../topology/concept.html#topology-device-object"><span class="std std-ref">Device object</span></a> is based off a relatively
simple &amp; straight-forward concept:</p>
<blockquote>
<div><p><em>When given a Device object, users should be able to directly interface
(eg, connect, send/receive commands) with the actual device, without having
to consciously involve anything else.</em></p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   device &amp; connection integration</span>

<span class="c1"># when given a device object</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;some-uut-device&#39;</span><span class="p">]</span>

<span class="c1"># users should be able to directly interface with it, eg:</span>
<span class="c1"># connect to it</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># send commands</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;show version&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    interface Ethernet1/1</span>
<span class="s1">        ip address 192.5.10.1 255.255.255.0</span>
<span class="s1">        no shutdown</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># and more ...</span>
<span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">connected</span>
<span class="n">device</span><span class="o">.</span><span class="n">ping</span><span class="p">(</span><span class="s1">&#39;192.5.10.2&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
<span class="n">device</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For the sake of verbal simplicity, each connection (eg, telnet to console),
shall be referred to as a <em>connection instance</em> here forward.</p>
</div>
<section id="single-instance">
<span id="connection-single-instance"></span><h2>Single Instance<a class="headerlink" href="#single-instance" title="Permalink to this heading">¶</a></h2>
<p>The most simplistic usage scenarios of connections is to just open a <em>single</em>
connection instance to a testbed device. To do so, simply invoke the
<code class="docutils literal notranslate"><span class="pre">Device.connect()</span></code> method directly. From there on, all services associated
with that device should just show up directly as methods of that object
instance:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Syntax
------

    # [] denotes optional arguments
    # *args, **kwargs denotes all other possible arguments

    # connect &amp; disconnect
    device.connect([via = &quot;path&quot;], [**kwargs])
    device.disconnect()

    # calling services
    device.&lt;services&gt;([*args], [**kwargs])
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   simplistic connection example</span>

<span class="c1"># using the topology module</span>
<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">topology</span>

<span class="c1"># let&#39;s write an inline testbed file for simplicity</span>
<span class="c1"># (edit this to whatever your testbed looks like)</span>
<span class="n">testbed</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">testbed:</span>
<span class="s1">    name: my-inline-testbed</span>

<span class="s1">devices:</span>
<span class="s1">    tplana-hath:</span>
<span class="s1">        type: iosxe</span>
<span class="s1">        os: iosxe</span>
<span class="s1">        connections:</span>
<span class="s1">            a:</span>
<span class="s1">                protocol: telnet</span>
<span class="s1">                ip: 10.1.1.1</span>
<span class="s1">                port: 10000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># pick the device to work with</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;tplana-hath&#39;</span><span class="p">]</span>

<span class="c1"># we should be able to directly connect to it</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">connected</span>

<span class="c1"># run the various services associated with this connection</span>
<span class="n">device</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;show version&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;clock set 18:00:00 April 4 2063&#39;</span><span class="p">)</span>

<span class="c1"># disconnect from it</span>
<span class="n">device</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>keep in mind that connection library is oblivious to what type of connection
is being opened up or where it is connecting to. Eg, in single connection
instances, the opened session could be either console or mgmt/vty.</p>
</div>
</section>
<section id="multiple-instance">
<h2>Multiple Instance<a class="headerlink" href="#multiple-instance" title="Permalink to this heading">¶</a></h2>
<p>When opening multiple connection instances, each connection must be provided
with its own unique alias for identification purposes:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Syntax
------

    # [] denotes optional arguments
    # *args, **kwargs denotes all other possible arguments

    # connect to alias and disconnect from alias
    device.connect(alias = &quot;alias&quot;, [via = &quot;path&quot;], [**kwargs])
    device.&lt;alias&gt;.disconnect()

    # calling services of an alias
    device.&lt;alias&gt;.&lt;services&gt;([*args], [**kwargs])
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   multiple connection instance example</span>

<span class="c1"># following the example above, let&#39;s make the testbed</span>
<span class="c1"># connection description slightly more complicated</span>
<span class="c1"># (edit this to whatever your testbed looks like)</span>
<span class="n">testbed</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">testbed:</span>
<span class="s1">    name: my-inline-testbed</span>

<span class="s1">devices:</span>
<span class="s1">    tplana-hath:</span>
<span class="s1">        type: iosxe</span>
<span class="s1">        os: iosxe</span>
<span class="s1">        connections:</span>
<span class="s1">            a:</span>
<span class="s1">                protocol: telnet</span>
<span class="s1">                ip: 10.1.1.1</span>
<span class="s1">                port: 10000</span>
<span class="s1">            mgmt:</span>
<span class="s1">                protocol: telnet</span>
<span class="s1">                ip: 10.1.1.1</span>
<span class="s1">                port: 20000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># pick the device</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s1">&#39;tplana-hath&#39;</span><span class="p">]</span>

<span class="c1"># make multiple connections to mgmt port (which accepts multi sessions)</span>
<span class="c1"># each should be provided a unique alias and the exact path eg:</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">alias</span> <span class="o">=</span> <span class="s1">&#39;vty_1&#39;</span><span class="p">,</span> <span class="n">via</span> <span class="o">=</span> <span class="s1">&#39;mgmt&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">alias</span> <span class="o">=</span> <span class="s1">&#39;vty_2&#39;</span><span class="p">,</span> <span class="n">via</span> <span class="o">=</span> <span class="s1">&#39;mgmt&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">alias</span> <span class="o">=</span> <span class="s1">&#39;vty_3&#39;</span><span class="p">,</span> <span class="n">via</span> <span class="o">=</span> <span class="s1">&#39;mgmt&#39;</span><span class="p">)</span>

<span class="c1"># now we can use each instance independent of the others</span>
<span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">vty_1</span><span class="o">.</span><span class="n">connected</span>
<span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">vty_2</span><span class="o">.</span><span class="n">connected</span>
<span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">vty_3</span><span class="o">.</span><span class="n">connected</span>

<span class="c1"># each instance has its own services</span>
<span class="c1"># eg, configure different terminal width for each session</span>
<span class="n">device</span><span class="o">.</span><span class="n">vty_1</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;terminal width 100&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">vty_2</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;terminal width 200&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">vty_2</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;terminal width 300&#39;</span><span class="p">)</span>

<span class="c1"># disconnect each independently</span>
<span class="n">device</span><span class="o">.</span><span class="n">vty_1</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
<span class="n">device</span><span class="o">.</span><span class="n">vty_2</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
<span class="n">device</span><span class="o">.</span><span class="n">vty_3</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="c1"># or disconnect everything altogether</span>
<span class="n">device</span><span class="o">.</span><span class="n">disconnect_all</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>alias names may not contain characters such as <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">.</span></code>, <code class="docutils literal notranslate"><span class="pre">\</span></code> etc. It
may only contain valid python attribute identifiers: <code class="docutils literal notranslate"><span class="pre">[a-z],</span> <span class="pre">[A-Z],</span> <span class="pre">[0-9],</span>
<span class="pre">_</span></code>.</p>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">device.connect()</span></code> is called without the <code class="docutils literal notranslate"><span class="pre">alias</span></code> argument (eg,
<a class="reference internal" href="#connection-single-instance"><span class="std std-ref">Single Instance</span></a>), a default alias is used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   default alias is &quot;default&quot;</span>

<span class="c1"># in the case of single connections above</span>
<span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># you only get ONE connection, and</span>
<span class="c1"># this connection bears the alias &quot;default&quot;, eg:</span>
<span class="n">device</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;show clock&#39;</span><span class="p">)</span>

<span class="c1"># is the exact same as:</span>
<span class="n">device</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;show clock&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When creating and handling multiple connections, always keep in mind that
whilst you may establish multiple connections to the same device, the underlying
router/device resources are still shared, and thus changes (eg, configs) may be
applied <em>globally</em> (depending on what it was), and affect all your connection
instances.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>multiple connection instances start to make sense when you want to perform
many <code class="docutils literal notranslate"><span class="pre">show</span></code> commands at the same time through asychronous means (eg,
multiprocessing, threading, etc).</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="manager.html" class="btn btn-neutral float-right" title="Connection Manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>