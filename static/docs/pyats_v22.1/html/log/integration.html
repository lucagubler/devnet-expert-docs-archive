<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Integration with Easypy &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Logging Utilities" href="utilities.html" />
    <link rel="prev" title="Implementation" href="implementation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aetest/index.html">AEtest - Test Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tcl/index.html">Tcl Integration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Logging</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="concept.html">Logging Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Log Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="implementation.html">Implementation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Integration with Easypy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#managed-handlers">Managed Handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-tasklog">One TaskLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tasklog-multiprocessing">TaskLog &amp; Multiprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#various-package-behaviors">Various Package Behaviors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Logging Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Logging</a></li>
      <li class="breadcrumb-item active">Integration with Easypy</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="integration-with-easypy">
<h1>Integration with Easypy<a class="headerlink" href="#integration-with-easypy" title="Permalink to this heading">¶</a></h1>
<p>Because of the specific <code class="docutils literal notranslate"><span class="pre">log</span></code> concept implementation, it is pretty much
automatically integrated with the execution environment (Easypy), where users
should not need to concern themselves with the logging facility, and only focus
on standard usage.</p>
<p>The following describes the points of automated integration with <code class="docutils literal notranslate"><span class="pre">easypy</span></code>,
<code class="docutils literal notranslate"><span class="pre">tcl</span></code> and <code class="docutils literal notranslate"><span class="pre">aetest</span></code> in case you are interested.</p>
<section id="managed-handlers">
<h2>Managed Handlers<a class="headerlink" href="#managed-handlers" title="Permalink to this heading">¶</a></h2>
<p>Following the Python logger hierarchy, by default, all <code class="docutils literal notranslate"><span class="pre">LogRecord</span></code> objects
propagate to the <code class="docutils literal notranslate"><span class="pre">root</span></code> logger. This allows the simple concept of <code class="docutils literal notranslate"><span class="pre">TaskLog</span></code>
to work: if we only configure the <code class="docutils literal notranslate"><span class="pre">root</span></code> logger with a <code class="docutils literal notranslate"><span class="pre">TaskLogHandler</span></code>,
then all log messages would be processed and stored to the given TaskLog file.</p>
<p>However, since each logger is able to have multiple handlers, there is a need
to track which handler is the current active TaskLog. Ergo the concept of
managed handlers:</p>
<blockquote>
<div><p>instead of creating new handler instances on the fly, a “globally” managed
instance of <code class="docutils literal notranslate"><span class="pre">ScreenHandler</span></code> and <code class="docutils literal notranslate"><span class="pre">TaskLogHandler</span></code> is automatically
created and stored in the <code class="docutils literal notranslate"><span class="pre">log</span></code> module.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># code snippet</span>
<span class="c1"># ------------</span>
<span class="c1">#</span>
<span class="c1">#   log/__init__.py</span>

<span class="c1"># global managed handlers instances</span>
<span class="n">managed_handlers</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;tasklog&#39;</span><span class="p">:</span> <span class="n">TaskLogHandler</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
                    <span class="s1">&#39;screen&#39;</span> <span class="p">:</span> <span class="n">ScreenHandler</span><span class="p">(),</span>
                    <span class="p">}</span>
</pre></div>
</div>
<p>These managed handlers are intended to be attached to the <code class="docutils literal notranslate"><span class="pre">root</span></code> logger so
that wherever within the code, we can always refer back to current TaskLog
handler. Consider this as the same concept as how <code class="docutils literal notranslate"><span class="pre">logging</span></code> always creates
the <code class="docutils literal notranslate"><span class="pre">root</span></code> logger as <code class="docutils literal notranslate"><span class="pre">logging.root</span></code> internally.</p>
</section>
<section id="one-tasklog">
<h2>One TaskLog<a class="headerlink" href="#one-tasklog" title="Permalink to this heading">¶</a></h2>
<p>In pyATS typical usage, there is only one TaskLog per process. This is achieved
through the usage of managed handlers, tracking which handler instance is the
current active TaskLog. It is required because of the following:</p>
<ul class="simple">
<li><p>TaskLogs needs to be closed after a test script finishes running in a job,
and new TaskLog file need to be assigned to the next script</p></li>
<li><p>Need to maintain the ability to change the current active TaskLog file with
a simple API call.</p></li>
</ul>
<p>Therefore for all practical purposes and usages, the <code class="docutils literal notranslate"><span class="pre">managed_handlers</span></code> should
be the only active instances of those handler classes when executing in pyATS.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the system is designed to be flexible. If you are familiar with how Python
logging works and want to apply additional TaskLogs, filters, handlers
and more, it is absolutely possible to do so. It won’t break the above
conditions, except that pyATS is designed around the above: everything else
is at your discretion/control, and you are responsible in configuring and
tracking them.</p>
</div>
</section>
<section id="tasklog-multiprocessing">
<span id="log-multiprocessing"></span><h2>TaskLog &amp; Multiprocessing<a class="headerlink" href="#tasklog-multiprocessing" title="Permalink to this heading">¶</a></h2>
<p>By default, Python <code class="docutils literal notranslate"><span class="pre">logging</span></code> module is not process-aware: users are expected
to modify/re-configure log handlers manually at the start of each process. In an
effort to make pyATS &amp; the test ecosystem more user-friendly, this mundane work
is automatically handled by the infrastructure.</p>
<p>When running through <a class="reference internal" href="../easypy/index.html#easypy"><span class="std std-ref">Easypy - Runtime Environment</span></a>, <code class="docutils literal notranslate"><span class="pre">TaskLogHandler</span></code> is automatically attached
to <code class="docutils literal notranslate"><span class="pre">root</span></code> logger by the infrastructure to handle each testscript’s TaskLog. In
addition, Easypy also auto-enables <code class="docutils literal notranslate"><span class="pre">TaskLogHandler.enableForked()</span></code> method to
make the handler process aware, so that all future forked child processes
automatically logs to new log files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   demonstrating tasklog &amp; multiprocessing</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">log</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># attach managed_handler to logger</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">managed_handlers</span><span class="o">.</span><span class="n">tasklog</span><span class="p">)</span>

<span class="c1"># change tasklog to a meaninful file &amp; enable forking behavior</span>
<span class="n">log</span><span class="o">.</span><span class="n">managed_handlers</span><span class="o">.</span><span class="n">tasklog</span><span class="o">.</span><span class="n">changeFile</span><span class="p">(</span><span class="s1">&#39;/tmp/logfile.txt&#39;</span><span class="p">)</span>

<span class="c1"># now all log messages go into /tmp/logfile.txt</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;this is an informational message&#39;</span><span class="p">)</span>

<span class="c1"># now let&#39;s define a function to be called in a child process</span>
<span class="c1"># and print some log messages</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;this is a message in child process&#39;</span><span class="p">)</span>

<span class="c1"># turn on enableForked()</span>
<span class="n">log</span><span class="o">.</span><span class="n">managed_handlers</span><span class="o">.</span><span class="n">tasklog</span><span class="o">.</span><span class="n">enableForked</span><span class="p">()</span>

<span class="c1"># call the function using multiprocessing fork</span>
<span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># if you run the above code, here is the resulting logfiles &amp; content:</span>
<span class="c1">#</span>
<span class="c1"># /tmp/logfile.txt</span>
<span class="c1"># ----------------</span>
<span class="c1"># 1: jarvis-lnx: 2015-09-13T22:39:06: %ROOT-6-INFO: %[pname=MainProcess][pid=9323][tid=MainThread]: this is an informational message</span>
<span class="c1"># 2: jarvis-lnx: 2015-09-13T22:39:07: %LOG-6-INFO: %[pname=Process-1][pid=9324][tid=MainThread]: Forked process 9324 started, log: /tmp/logfile.txt:pid-9324</span>
<span class="c1">#</span>
<span class="c1"># /tmp/logfile.txt:pid-9324</span>
<span class="c1"># -------------------------</span>
<span class="c1"># 3: jarvis-lnx: 2015-09-13T22:39:07: %ROOT-6-INFO: %[pname=Process-1][pid=9324][tid=MainThread]: this is a message in child process</span>
</pre></div>
</div>
<p>Notice above that a new logfile was created by the child-process automatically
after forking, inheriting all of its parent’s configuration and logging to a new
file with <code class="docutils literal notranslate"><span class="pre">pid-&lt;pid&gt;</span></code> post-fixed to the original logfile name.</p>
<p>This beahvior can be disabled by calling <code class="docutils literal notranslate"><span class="pre">disableForked()</span></code> on the managed
<code class="docutils literal notranslate"><span class="pre">TaskLogHandler</span></code>.</p>
</section>
<section id="various-package-behaviors">
<h2>Various Package Behaviors<a class="headerlink" href="#various-package-behaviors" title="Permalink to this heading">¶</a></h2>
<dl class="simple">
<dt>EasyPy</dt><dd><p>on startup, the managed handlers are added to the root logger as default
handlers. If print-to-screen is disabled, then the screen handler is removed
from the root logger (but not removed/closed from managed handlers dict).
When a test script is run in the job file, a new TaskLog is created by using
the managed tasklog handler’s <code class="docutils literal notranslate"><span class="pre">changeFile</span></code> API.</p>
</dd>
<dt>AEtest</dt><dd><p>when running in stand-alone mode, AEtest adds the managed screen handler to
root logger in order to allow print-to-screen. Otherwise, AEtest does not
touch logging configurations.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="implementation.html" class="btn btn-neutral float-left" title="Implementation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="utilities.html" class="btn btn-neutral float-right" title="Logging Utilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>