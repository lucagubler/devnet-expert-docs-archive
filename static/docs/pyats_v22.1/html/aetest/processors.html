<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Section Processors &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Datafile Inputs" href="datafile.html" />
    <link rel="prev" title="Running TestScripts" href="run.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">AEtest - Test Infrastructure</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="structure.html">Script Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Object Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="behavior.html">Runtime Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Test Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="loop.html">Looping Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="results.html">Section Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="steps.html">Section Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">Running TestScripts</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Section Processors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#definition-arguments">Definition &amp; Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#results">Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#context-processors">Context Processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-processors">Global Processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-behaviors">Runtime Behaviors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-apis">Additional APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reporting">Reporting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="datafile.html">Datafile Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="control.html">Flow Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html">Report Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tcl/index.html">Tcl Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">AEtest - Test Infrastructure</a></li>
      <li class="breadcrumb-item active">Section Processors</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="section-processors">
<span id="aetest-processors"></span><h1>Section Processors<a class="headerlink" href="#section-processors" title="Permalink to this heading">¶</a></h1>
<aside class="sidebar">
<p class="sidebar-title">Helpful Reading</p>
<ul class="simple">
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/Preprocessor">Preprocessors</a></p></li>
<li><p><a class="reference external" href="https://wiki.python.org/moin/PythonDecorators">Decorators</a></p></li>
<li><p><a class="reference internal" href="objects.html#object-model"><span class="std std-ref">Object Model</span></a></p></li>
</ul>
</aside>
<p>In <code class="docutils literal notranslate"><span class="pre">aetest</span></code>, functions and methods scheduled to run immediately before and
after testscript sections are called <strong>pre-processors</strong>, <strong>post-processors</strong>,
<strong>exception-processors</strong>.
These programs possess the ability to <em>process</em> the given section based on its
id, parameters and results, dynamically and directly affecting the outcome of
testing.</p>
<p>Because of this unique inline execution trait, pre/post/exception processors may
also be used as means to perform common, routine checks before and after each
test section. Here are some possible use cases:</p>
<dl class="simple">
<dt>Pre-Processors</dt><dd><ul class="simple">
<li><p>take snapshots of the current test environment information (eg, testbed
configuration)</p></li>
<li><p>check the test environment and determine if the current section should
run or not</p></li>
</ul>
</dd>
<dt>Post-Processors</dt><dd><ul class="simple">
<li><p>access/validate the result of the section that just finished execution</p></li>
<li><p>check current test environment against previous snapshots (eg, router
health-checking)</p></li>
<li><p>execute debug commands, collect dump files &amp; etc</p></li>
</ul>
</dd>
<dt>Exception-Processors</dt><dd><ul class="simple">
<li><p>take post exception snapshots of the current test environment information
(eg, testbed configuration) when exception occurs</p></li>
<li><p>execute debug commands, collect dump files &amp; etc when exception occurs</p></li>
<li><p>suppress a specified <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html">Exception</a> and assign a result to the section.</p></li>
</ul>
</dd>
</dl>
<p>The usage of pre/post/exception processor feature is entirely <em>optional</em>. They
can access the internals of <code class="docutils literal notranslate"><span class="pre">aetest</span></code> <a class="reference internal" href="objects.html#object-model"><span class="std std-ref">Object Model</span></a>, and can be extremely
powerful.</p>
<blockquote>
<div><p><em>With great power, comes great responsibilities</em> - use them wisely.</p>
</div></blockquote>
<section id="definition-arguments">
<h2>Definition &amp; Arguments<a class="headerlink" href="#definition-arguments" title="Permalink to this heading">¶</a></h2>
<p>Pre/post/exception processors are affixed to each script sections using
<code class="docutils literal notranslate"><span class="pre">&#64;processors</span></code> decorator, and providing it lists of objects for each condition.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Syntax
------

    @processors(pre = [list of pre-processor objects],
                post = [list of post-processor objects],
                exception = [list of exception-processor objects])
</pre></div>
</div>
<p>Processor functions support <a class="reference internal" href="parameters.html#test-parameters"><span class="std std-ref">parameter</span></a> propagation the
same way that test sections do. Parameters from parent objects, or a
<a class="reference internal" href="datafile.html#aetest-datafile"><span class="std std-ref">datafile</span></a> (eg. the testbed) can be passed to a processor
by simply declaring an argument of the same name. Some default parameters
available for all processors are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">section</span></code> for the Testcase or Test Section the processor is being applied
to</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">processor</span></code> for the running processor itself, which has a <code class="xref py py-obj docutils literal notranslate"><span class="pre">properties</span></code>
attribute, as well as result APIs (eg. <code class="xref py py-obj docutils literal notranslate"><span class="pre">processor.failed()</span></code></p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">steps</span></code> for declaring <a class="reference internal" href="steps.html#aetest-steps"><span class="std std-ref">steps</span></a> within the processor</p></li>
</ul>
</div></blockquote>
<p>Exception processors also have default parameters of <code class="xref py py-obj docutils literal notranslate"><span class="pre">exc_type</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">exc_value</span></code>,
and <code class="xref py py-obj docutils literal notranslate"><span class="pre">exc_traceback</span></code> for the exception that occurs in the parent section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   simple pre/post/exception processor example</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># define a function that prints the section&#39;s uid</span>
<span class="k">def</span> <span class="nf">print_uid</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current section: &#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>

<span class="c1"># define a function that prints the section result</span>
<span class="k">def</span> <span class="nf">print_result</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;section result: &#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># define another function that prints the exception message and suppress the</span>
<span class="c1"># exception</span>
<span class="k">def</span> <span class="nf">print_exception_message</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exception : &#39;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># use the above functions as pre/post/exception processors to a Testcase</span>
<span class="c1">#   pre-processor  : print_uid</span>
<span class="c1">#   post-processor : print_result</span>
<span class="c1">#   exception-processor : print_exception_message</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="p">(</span><span class="n">pre</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_uid</span><span class="p">],</span>
                   <span class="n">post</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_result</span><span class="p">],</span>
                   <span class="n">exception</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_exception_message</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running testcase test section&#39;</span><span class="p">)</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">testException</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;running testcase testException section&#39;</span><span class="p">)</span>

<span class="c1"># define a function that fails when a section does not set a parameter, this</span>
<span class="c1"># will propagate the failure to the parent section</span>
<span class="k">def</span> <span class="nf">fail_if_not_a</span><span class="p">(</span><span class="n">processor</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">processor</span><span class="o">.</span><span class="n">failed</span><span class="p">(</span><span class="s1">&#39;a was not set to True&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Testcase2</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="c1"># use fail_if_not_a as a post-processor on only this test section</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">fail_if_not_a</span><span class="p">)</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># script output</span>
<span class="c1">#   - notice that the processors ran immediately before and after the</span>
<span class="c1">#     testcase execution.</span>
<span class="c1">#</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                          Starting testcase Testcase                          |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  |                     Starting PreProcessor-1 &#39;print_uid&#39;                      |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  current section:  Testcase</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                            Starting section test                             |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     running testcase test section</span>
<span class="c1">#     The result of section test is =&gt; PASSED</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                        Starting section testException                        |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  |           Starting ExceptionProcessor-1 &#39;print_exception_message&#39;            |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  exception :  &lt;class &#39;Exception&#39;&gt; running testcase testException section</span>
<span class="c1"># -&gt;  The result of section testException is =&gt; PASSED</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  |                   Starting PostProcessor-1 &#39;print_result&#39;                    |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  section result:  passed</span>
<span class="c1">#     The result of testcase Testcase is =&gt; PASSED</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                         Starting testcase Testcase2                          |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                            Starting section test                             |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  |                   Starting PostProcessor-1 &#39;fail_if_not_a&#39;                   |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     The result of PostProcessor-1 &#39;fail_if_not_a&#39; is =&gt; FAILED</span>
<span class="c1">#     The result of section test is =&gt; FAILED</span>
<span class="c1">#     The result of testcase Testcase2 is =&gt; FAILED</span>
</pre></div>
</div>
<p>Since parameters are only passed when there is an argument of the same name, any
functions &amp; methods that require zero arguments to invoke are useable as
pre/post processors. However making use of the arguments to access parameters
provides many options. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">section</span></code> parameter can be passed as an argument,
which references the current running section object that the processor has been
applied to. This enables the processor function to access within the current
executing object, reference its <a class="reference internal" href="parameters.html#test-parameters"><span class="std std-ref">Test Parameters</span></a> and act accordingly.
Refer to <a class="reference internal" href="objects.html#object-model"><span class="std std-ref">Object Model</span></a> for section object details.</p>
<p>Pre/post/exception processors can be applied independently towards both test
containers (<code class="docutils literal notranslate"><span class="pre">CommonSetup</span></code>, <code class="docutils literal notranslate"><span class="pre">Testcase</span></code>, <code class="docutils literal notranslate"><span class="pre">CommonCleanup</span></code>) and test sections
(<code class="docutils literal notranslate"><span class="pre">subsections</span></code>, <code class="docutils literal notranslate"><span class="pre">setup</span></code>, <code class="docutils literal notranslate"><span class="pre">test</span></code>, <code class="docutils literal notranslate"><span class="pre">cleanup</span></code>). Each section may receive
an arbitrary number of processor functions, run in the order of appearance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A section can have multiple processors all trying to set the result through
APIs. The final result set for the section will be the ‘rolled-up’ result
from all of the processors of that type. (see <a class="reference internal" href="objects.html#object-model"><span class="std std-ref">Object Model</span></a> for rules
about roll-up).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <strong>pre-processors</strong> block a section from executing, the
<strong>post-processors</strong> will not be executed.</p>
</div>
<p>The decorator <code class="docutils literal notranslate"><span class="pre">&#64;processors</span></code> can be used to define both <strong>pre-processors</strong>,
<strong>post-processors</strong> and <strong>exception-processors</strong> at the same time. The following
alternatives allows the definition of one specific type using <code class="docutils literal notranslate"><span class="pre">*varargs</span></code> style
input.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Alternative Syntax
------------------

    @processor.pre(*list of pre-processors)
    @processor.post(*list of post-processors)
    @processor.exception(*list of exception-processors)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   extended pre/post processor/exception examples</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># assuming we had a library full of readily defined processor functions</span>
<span class="c1"># import all of them for the sake of this example</span>
<span class="kn">from</span> <span class="nn">pre_processors</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">post_processors</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">exception_processors</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">common_setup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>

    <span class="c1"># attach some pre-processors to subsection</span>
    <span class="c1"># using @aetest.processors.pre(x, y, z, ...) shortcut definition</span>
    <span class="c1"># this is equivalent to:</span>
    <span class="c1">#   @aetest.processors(pre = [x, y, z, ...])</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">pre</span><span class="p">(</span><span class="n">collect_snapshot</span><span class="p">)</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c1"># attach multiple processors to testcase</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="p">(</span><span class="n">pre</span> <span class="o">=</span> <span class="p">[</span><span class="n">check_environment</span><span class="p">,</span> <span class="n">collect_snapshot</span><span class="p">,</span> <span class="n">check_uid</span><span class="p">],</span>
                   <span class="n">post</span> <span class="o">=</span> <span class="p">[</span><span class="n">router_health_check</span><span class="p">,</span> <span class="n">restore_snapshot</span><span class="p">],</span>
                   <span class="n">exception</span> <span class="o">=</span> <span class="p">[</span><span class="n">unexpected_exception_snapshot</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># attach some post-processors to test section</span>
    <span class="c1"># using @aetest.processors.post(x, y, z, ...) shortcut definition</span>
    <span class="c1"># this is equivalent to:</span>
    <span class="c1">#   @aetest.processors(post = [x, y, z, ...])</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">run_debug_commands</span><span class="p">,</span> <span class="n">check_memory_leak</span><span class="p">)</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this heading">¶</a></h2>
<p>Processors also have a result, which can be set in multiple ways. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">section</span></code>
object and the <code class="xref py py-obj docutils literal notranslate"><span class="pre">processor</span></code> object both have <a class="reference internal" href="results.html#result-apis"><span class="std std-ref">Result APIs</span></a> which act in
slightly different ways. Any result apis called from the <code class="xref py py-obj docutils literal notranslate"><span class="pre">processor</span></code> object
behave as expected, setting a result for that processor before moving on with
execution. This result rolls up to the result of the parent section, so failing
a processor will also mark a Testcase as failed. Calling a result api from the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">section</span></code> object will apply that result to the section directly, instead of the
normal roll up behavior. For <strong>pre-processors</strong>, this will block the execution
of the section entirely, just setting the result instead. For
<strong>post-processors</strong>, this can override existing results occurring in that
section.</p>
<p>For example, result apis from either <code class="xref py py-obj docutils literal notranslate"><span class="pre">processor</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">section</span></code> could declare a
section as failed with a <strong>post-processor</strong> even if it already passed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">section_failed</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="n">section</span><span class="o">.</span><span class="n">failed</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">section_failed</span><span class="p">)</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="c1"># This test section would regularly pass, but the processor will cause</span>
    <span class="c1"># the result to be Failed</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>However, only the <code class="xref py py-obj docutils literal notranslate"><span class="pre">section</span></code> apis could mark a failed section as passed,
since this goes against <a class="reference internal" href="../results/rollup.html#result-rollup"><span class="std std-ref">Results Rollups</span></a></p>
</div>
<p>There are some other ways to impact the section result with processors.
<strong>Pre-processors</strong> that return <code class="docutils literal notranslate"><span class="pre">False</span></code>, will cause the section to be
<code class="docutils literal notranslate"><span class="pre">Skipped</span></code>, <strong>pre-processors</strong> that have an assertion failure will be
<code class="docutils literal notranslate"><span class="pre">Blocked``and</span> <span class="pre">**Exception-processors**</span> <span class="pre">that</span> <span class="pre">return</span> <span class="pre">``True</span></code> will suppress the
exception and prevent an <code class="docutils literal notranslate"><span class="pre">Errored</span></code> result.</p>
</section>
<section id="context-processors">
<h2>Context Processors<a class="headerlink" href="#context-processors" title="Permalink to this heading">¶</a></h2>
<p>Typical pre/post/exception-processors are just functions with a specific
purpose. <strong>Context-processors</strong>, on the other hand, are similar to Python’s
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#typecontextmanager">context managers</a> in the sense that they can handle the before, after, and
exceptions within a single class.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>think of a <strong>context-processor</strong> as pre + post + exception processor
all-in-one</p>
</div>
<p>There are two methods of defining <strong>context-processors</strong>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>by subclassing from <code class="docutils literal notranslate"><span class="pre">aetest.processors.bases.BaseContextProcessor</span></code></p></li>
<li><p>using <code class="docutils literal notranslate"><span class="pre">&#64;aetest.processors.context</span></code> decorator on a generator factory
function.</p></li>
</ol>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   simple context processor example</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>
<span class="kn">from</span> <span class="nn">pyats.aetest.processors.bases</span> <span class="kn">import</span> <span class="n">BaseContextProcessor</span>

<span class="c1"># define a context processor that:</span>
<span class="c1">#   - print the section uid before testcase</span>
<span class="c1">#   - prints the section result after testcase in normal conditions</span>
<span class="c1">#   - prints the exception when an exception occurs</span>

<span class="k">class</span> <span class="nc">ContextProcessor</span><span class="p">(</span><span class="n">BaseContextProcessor</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current section: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
        <span class="c1"># can also access parameters</span>
        <span class="n">testbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;testbed&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">type_</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An exception occured!&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exception : &#39;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;section result: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># attach above context processor to a Testcase</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="p">(</span><span class="n">ContextProcessor</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running testcase test section&#39;</span><span class="p">)</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">testException</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;running testcase testException section&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In essense, a basic, class-based <strong>context-processor</strong> is basically a Python
Context Manager, with its <code class="docutils literal notranslate"><span class="pre">__enter__()</span></code> called as the section
<strong>pre-processor</strong>, and <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code> called as the
<strong>post+exception-processor</strong>. If an exception occurs, <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code> is called
after the exception but before the section result is set, just like an
<strong>exception-processor</strong>. If no exception occurs, <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code> is called later
after the exception is set, like a <strong>post-processor</strong>. Additionally, the result
apis are still available from the class itself. So a call of <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.failed()</span></code>
would be equivalent to <code class="xref py py-obj docutils literal notranslate"><span class="pre">processor.failed()</span></code> in a <strong>pre-processor</strong>.</p>
<p>You can also opt to define generator-style <strong>context-processors</strong>, similar to
Python’s <code class="docutils literal notranslate"><span class="pre">contextlib.contextmanager</span></code> functionality:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   simple context processor example using generator</span>
<span class="c1">#   (same functionality as above)</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">context</span>
<span class="k">def</span> <span class="nf">context_processor</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">processor</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current section: &#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
    <span class="c1"># accessing parameters</span>
    <span class="n">testbed</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;testbed&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An exception occurred!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exception : &#39;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
        <span class="c1"># we are not raising e, so it will be suppressed</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;section result: &#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>


<span class="c1"># attach above context processor to a Testcase</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="p">(</span><span class="n">context_processor</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running testcase test section&#39;</span><span class="p">)</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">testException</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;running testcase testException section&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Generator-style <strong>context-processors</strong> do not return a boolean value to
determine whether or not to suppress an exception. Instead, they suppress
exceptions by default and must raise the same exception again in order to
let it propagate.</p>
</div>
</section>
<section id="global-processors">
<span id="aetest-global-processors"></span><h2>Global Processors<a class="headerlink" href="#global-processors" title="Permalink to this heading">¶</a></h2>
<p>In addition to the ability to attach processors to classes &amp; sections, it is
also possible to define processors that run <strong>globally</strong>: before and after
each and every defined script section (common setup/cleanup, subsection,
testcases, setup/cleanup/tests), or on <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html">Exception</a> occurance.</p>
<p>Global processors are no different than the ones affixed to each section using
the <code class="docutils literal notranslate"><span class="pre">&#64;processors</span></code> decorator, except that they always run automatically. To
use global processors in your testscript, define a script-level dictionary named
<code class="docutils literal notranslate"><span class="pre">global_processors</span></code> with <code class="docutils literal notranslate"><span class="pre">pre</span></code>, <code class="docutils literal notranslate"><span class="pre">post</span></code> and <code class="docutils literal notranslate"><span class="pre">exception</span></code> as the keys, and
the values being a list of processor functions.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Global Processors Syntax
------------------------

    global_processors = {
        &#39;pre&#39;: [list of global pre-processor objects],
        &#39;post&#39;: [list of global post-processor objects],
        &#39;exception&#39;: [list of global exception-processor objects],
        &#39;context&#39;: [list of global context processor classes/functions]
    }
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   script using global processors</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># define a function that prints the section&#39;s uid</span>
<span class="k">def</span> <span class="nf">print_uid</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current section: &#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>

<span class="c1"># define a function that prints the section result</span>
<span class="k">def</span> <span class="nf">print_result</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;section result: &#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># define another function that prints the exception message and suppress the</span>
<span class="c1"># exception</span>
<span class="k">def</span> <span class="nf">print_exception_message</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exception : &#39;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># use the above functions global pre/post processors</span>
<span class="c1">#   global pre-processor  : print_uid</span>
<span class="c1">#   global post-processor : print_result</span>
<span class="c1">#   global exception-processor : print_exception_message</span>
<span class="n">global_processors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;pre&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">print_uid</span><span class="p">,],</span>
    <span class="s1">&#39;post&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">print_result</span><span class="p">,],</span>
    <span class="s1">&#39;exception&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">print_exception_message</span><span class="p">,],</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running testcase test section&#39;</span><span class="p">)</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">testException</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pyATS</span><span class="p">()</span>

<span class="c1"># script output</span>
<span class="c1">#   - notice that the processors ran immediately before and after each</span>
<span class="c1">#     section (testcase &amp; test) execution.</span>
<span class="c1">#   - note that section test result is null - because it hasn&#39;t been given</span>
<span class="c1">#     a result by the executer yet.</span>
<span class="c1">#</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                          Starting testcase Testcase                          |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  Running pre-processor: &#39;print_uid&#39;</span>
<span class="c1"># -&gt;  current section:  Testcase</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                            Starting section test                             |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  Running pre-processor: &#39;print_uid&#39;</span>
<span class="c1"># -&gt;  current section:  test</span>
<span class="c1">#     running testcase test section</span>
<span class="c1"># -&gt;  Running post-processor: &#39;print_result&#39;</span>
<span class="c1"># -&gt;  section result:  null</span>
<span class="c1">#     The result of section test is =&gt; PASSED</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1">#     |                        Starting section testException                        |</span>
<span class="c1">#     +------------------------------------------------------------------------------+</span>
<span class="c1"># -&gt;  Running pre-processor: &#39;print_uid&#39;</span>
<span class="c1"># -&gt;  current section:  testException</span>
<span class="c1">#     Running exception-processor: &#39;print_exception_message&#39;</span>
<span class="c1">#     exception :  NameError name &#39;pyATS&#39; is not defined</span>
<span class="c1">#     section result:  null</span>
<span class="c1"># -&gt;  Running post-processor: &#39;print_result&#39;</span>
<span class="c1"># -&gt;  section result:  null</span>
<span class="c1">#     The result of section testException is =&gt; PASSED</span>
<span class="c1"># -&gt;  Running post-processor: &#39;print_result&#39;</span>
<span class="c1"># -&gt;  section result:  passed</span>
<span class="c1">#     The result of testcase Testcase is =&gt; PASSED</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>global processors may be extremely useful in cases where you wish to run
some functions before and after everything - for example, collecting
code coverages (Cflow), and router healths (router health check), etc.</p>
</div>
</section>
<section id="runtime-behaviors">
<h2>Runtime Behaviors<a class="headerlink" href="#runtime-behaviors" title="Permalink to this heading">¶</a></h2>
<p>The following rules describes the behavior of pre/post/exception processors when
defined.</p>
<ul>
<li><p><strong>pre-processors</strong> are run immediately <em>before</em> test section execution</p></li>
<li><p><strong>post-processors</strong> are run immediately <em>after</em> test section execution</p></li>
<li><p><strong>exception-processors</strong> are run immediately <em>after</em> test section raised
<a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html">Exception</a></p>
<ul class="simple">
<li><p><strong>exception-processors</strong> will be skipped if there is no Exceptions occurred
during test section execution</p></li>
</ul>
</li>
<li><p><strong>context-processors</strong> run before function-based processors. Eg:</p>
<ul class="simple">
<li><p>before a section, any attached context-processor <code class="docutils literal notranslate"><span class="pre">__enter__()</span></code> will run
before all other pre-processors</p></li>
<li><p>after a section, any attached context-processor’s <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code> will run,
before all other exception processors and post-processors</p></li>
</ul>
</li>
<li><p><strong>global processors</strong> are always run before local processors.</p></li>
<li><p>if a processor requires an argument named <code class="docutils literal notranslate"><span class="pre">section</span></code>, the current
executing section is provided to that argument value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">processorFunc</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</li>
<li><p>while executing <strong>pre-processor</strong> functions or context-processor’s
<code class="docutils literal notranslate"><span class="pre">__enter__()</span></code> api, if any <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> is caught, or if the function
returns <code class="docutils literal notranslate"><span class="pre">False</span></code>, all remainining <strong>pre-processor</strong> and context-processors
will be skipped, and the test section is skipped over with a
result of <code class="docutils literal notranslate"><span class="pre">Skipped</span></code>. All <strong>post-processors</strong> are also skipped. Otherwise,
execution continues as originally scheduled.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocessorAssertionError</span><span class="p">():</span>
    <span class="c1"># assertion error causes all remaining pre-processors to be skipped</span>
    <span class="c1"># and the test section also receives a result of Skipped</span>
    <span class="k">assert</span> <span class="s1">&#39;vim&#39;</span> <span class="ow">is</span> <span class="s1">&#39;great&#39;</span>

<span class="k">def</span> <span class="nf">preprocessorReturnFalse</span><span class="p">()</span>
    <span class="c1"># if a pre-processor returns False, all remaining pre-processors</span>
    <span class="c1"># are skipped, and the test section is skipped also.</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</li>
<li><p>when returning <code class="docutils literal notranslate"><span class="pre">False</span></code> in <strong>pre-processors</strong> or context processor’s
<code class="docutils literal notranslate"><span class="pre">__enter__()</span></code>, an optional <em>reason</em> message may also be returned. This is
printed as the reason for skipping the current section in the log file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocessorReturnFalseWithReason</span><span class="p">()</span>
    <span class="c1"># return false along with a reason (as a tuple)</span>
    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;murphy&#39;s law :-(&quot;</span>
</pre></div>
</div>
</li>
<li><p>if any <code class="docutils literal notranslate"><span class="pre">Exceptions</span></code> are caught while executing processor functions, all
remaining processors functions are skipped over, and the test section
receives a result of <code class="docutils literal notranslate"><span class="pre">Errored</span></code>. If that <code class="docutils literal notranslate"><span class="pre">Exception</span></code> occured within a
<strong>pre-processor</strong>, the test section is skipped with a result of
<code class="docutils literal notranslate"><span class="pre">Errored</span></code>.</p></li>
<li><p>if a section has any attached <strong>exception-processors</strong> or
<strong>context-processors</strong>, any unhandled exception will be passed to the
processor, with exception type, value and traceback.</p>
<ul class="simple">
<li><p>in the case of generator-based context processors, the exception will be
thrown into the generator using <code class="docutils literal notranslate"><span class="pre">gen.throw()</span></code> mechanism</p></li>
</ul>
</li>
<li><p><strong>exception-processors</strong> will handle <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html">Exception</a> in the following order:
global, testcase, local.</p></li>
<li><p>if any <strong>exception-processors</strong> or context-processor <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code> returns
<code class="docutils literal notranslate"><span class="pre">True</span></code>, the <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html">Exception</a> from executed test section will be suppressed.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>exception-processors</strong> does not support <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#AssertionError">AssertionError</a> raised from
<a class="reference internal" href="steps.html#aetest-steps"><span class="std std-ref">Section Steps</span></a>. Other types of <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html">Exception</a> raised from
<a class="reference internal" href="steps.html#aetest-steps"><span class="std std-ref">Section Steps</span></a> would be handled accordingly.</p>
</div>
</section>
<section id="additional-apis">
<h2>Additional APIs<a class="headerlink" href="#additional-apis" title="Permalink to this heading">¶</a></h2>
<p>The list of pre/post/exception processors affixed to each test script section
can be dynamically accessed and queried during runtime, using the following
functions:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">processors.get(section,</span> <span class="pre">type_,</span> <span class="pre">incl_globals=False)</span></code></dt><dd><p>returns the list of pre/post/exception processors affixed to a section
object. By default, get only returns the processors applied to that section.
Using the <code class="docutils literal notranslate"><span class="pre">incl_globals</span> <span class="pre">=</span> <span class="pre">True</span></code> argument also includes current known
global processors of that type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   processors.get function</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># create a global processor</span>
<span class="n">global_processors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pre</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">])</span>

<span class="c1"># testcase with two lambda functions as pre-processors</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">pre</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Testcase</span><span class="p">,</span> <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;pre&#39;</span><span class="p">)</span>
<span class="c1"># [&lt;function &lt;lambda&gt; at 0xf758e734&gt;,</span>
<span class="c1">#  &lt;function &lt;lambda&gt; at 0xf769e0bc&gt;]</span>

<span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Testcase</span><span class="p">,</span> <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="c1"># []</span>

<span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Testcase</span><span class="p">,</span> <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;exception&#39;</span><span class="p">)</span>
<span class="c1"># []</span>

<span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Testcase</span><span class="p">,</span> <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="n">incl_globals</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1"># [&lt;function &lt;lambda&gt; at 0xf756b305&gt;</span>
<span class="c1">#  &lt;function &lt;lambda&gt; at 0xf758e734&gt;,</span>
<span class="c1">#  &lt;function &lt;lambda&gt; at 0xf769e0bc&gt;]</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">processors.affix(section,</span> <span class="pre">context</span> <span class="pre">=</span> <span class="pre">[],</span> <span class="pre">pre</span> <span class="pre">=</span> <span class="pre">[],</span> <span class="pre">post</span> <span class="pre">=</span> <span class="pre">[],</span> <span class="pre">exception</span> <span class="pre">=</span> <span class="pre">[])</span></code></dt><dd><p>dynamically affix pre/post/exception processors to a given section object.
Any previously defined pre/post/exception/context processor functions are
overwritten.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   processors.add function</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># testcase with two lambda functions as pre-processors (false)</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">pre</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># replace the two functions to Testcase</span>
<span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">affix</span><span class="p">(</span><span class="n">Testcase</span><span class="p">,</span> <span class="n">pre</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">])</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">processors.add(section,</span> <span class="pre">context</span> <span class="pre">=</span> <span class="pre">[],</span> <span class="pre">pre</span> <span class="pre">=</span> <span class="pre">[],</span> <span class="pre">post</span> <span class="pre">=</span> <span class="pre">[],</span> <span class="pre">exception</span> <span class="pre">=</span> <span class="pre">[])</span></code></dt><dd><p>add more pre/post/exception/context processors to a given section object.
This appends to the list of existing processors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   processors.add function</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># add two lambda functions to Testcase as post-processors</span>
<span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Testcase</span><span class="p">,</span> <span class="n">post</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">])</span>
</pre></div>
</div>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   using additional pre/post/exception processor APIs</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="k">def</span> <span class="nf">print_parameters</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_exception_message</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exception : &#39;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">CommonSetup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># affix pre-processors and exception-processors to testcase</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">affix</span><span class="p">(</span><span class="n">Testcase</span><span class="p">,</span> <span class="n">pre</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_parameters</span><span class="p">],</span>
                                <span class="n">exception</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_exception_message</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">setup</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># check if testcase has processors</span>
        <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;exception&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testcase has </span><span class="si">%s</span><span class="s1">-processors&#39;</span> <span class="o">%</span> <span class="n">type_</span><span class="p">)</span>

        <span class="c1"># affix post-processors to test function</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">affix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">post</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_parameters</span><span class="p">])</span>

        <span class="c1"># affix exception-processors to testException function</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">affix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testException</span><span class="p">,</span>
                                <span class="n">exception</span> <span class="o">=</span> <span class="p">[</span><span class="n">print_exception_message</span><span class="p">])</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">testException</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pyATS</span><span class="p">()</span>

<span class="c1"># the above example probably didn&#39;t make much sense.</span>
<span class="c1"># the goal is to show you what can be done.</span>
</pre></div>
</div>
</section>
<section id="reporting">
<h2>Reporting<a class="headerlink" href="#reporting" title="Permalink to this heading">¶</a></h2>
<p>Processors dy default are not reported as sections of a test. This can be
changed using the <a class="reference internal" href="../configuration/index.html#pyats-configuration"><span class="std std-ref">configuration</span></a> option, or by using
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">processor.report</span></code> decorator on the processor function itself</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@aetest</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">report</span>
<span class="k">def</span> <span class="nf">my_post_processor</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Each processor appears as a child section of the Testcase/Test Section it is
being applied to, similar to adding another Test Section to a Testcase, or a
Step to a Test Section.</p>
<p>Even if reporting for a processor is disabled, any results raised will still be
propagated to the parent section, so the processor retains all functionality.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="run.html" class="btn btn-neutral float-left" title="Running TestScripts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="datafile.html" class="btn btn-neutral float-right" title="Datafile Inputs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>