<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Looping Sections &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Section Results" href="results.html" />
    <link rel="prev" title="Test Parameters" href="parameters.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">AEtest - Test Infrastructure</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="structure.html">Script Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Object Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="behavior.html">Runtime Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Test Parameters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Looping Sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-loops">Defining Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loop-parameters">Loop Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-loop-usages">Advanced Loop Usages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-loop-marking">Dynamic Loop Marking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loop-internals">Loop Internals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="results.html">Section Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="steps.html">Section Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">Running TestScripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="processors.html">Section Processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="datafile.html">Datafile Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="control.html">Flow Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html">Report Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tcl/index.html">Tcl Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">AEtest - Test Infrastructure</a></li>
      <li class="breadcrumb-item active">Looping Sections</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="looping-sections">
<span id="aetest-looping"></span><h1>Looping Sections<a class="headerlink" href="#looping-sections" title="Permalink to this heading">¶</a></h1>
<aside class="sidebar">
<p class="sidebar-title">Helpful Reading</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3.4/tutorial/classes.html">Classes Tutorial</a></p></li>
<li><p><a class="reference external" href="https://wiki.python.org/moin/PythonDecorators">Decorators</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3.4/tutorial/classes.html#python-scopes-and-namespaces">Scopes and Namespaces</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#typeiter">Iterator Types</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3.4/reference/expressions.html#yieldexpr">Yield Expressions</a></p></li>
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/Factory_%28object-oriented_programming%29">Factory Design</a></p></li>
</ul>
</aside>
<blockquote>
<div><p><em>What are loops? Refer to the end of this section.</em></p>
</div></blockquote>
<p>As an integral extension of <a class="reference internal" href="parameters.html#test-parameters"><span class="std std-ref">Test Parameters</span></a> data-driven testing concept,
<code class="docutils literal notranslate"><span class="pre">aetest</span></code> also supports section looping: reusing section code body by providing
it with different parameters during each loop iteration.</p>
<p>The following describes each section and their loop capability and behaviors:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">CommonSetup</span></code>/<code class="docutils literal notranslate"><span class="pre">CommonCleanup</span></code></dt><dd><p>Common setup and cleanup sections are unique within each testscript. They
are run only once per testscript execution, and are not loopable.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">subsection</span></code></dt><dd><p>Subsections within <code class="docutils literal notranslate"><span class="pre">CommonSetup</span></code> and <code class="docutils literal notranslate"><span class="pre">CommonCleanup</span></code> are loopable.
When a <code class="docutils literal notranslate"><span class="pre">subsection</span></code> is marked for looping, each of its iterations is
reported as a new subsection.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Testcase</span></code></dt><dd><p>Testcases are loopable. Each iteration of a looping <code class="docutils literal notranslate"><span class="pre">Testcase</span></code> is reported
individually as new testcase instances with different <code class="docutils literal notranslate"><span class="pre">uid</span></code>. When a
<code class="docutils literal notranslate"><span class="pre">Testcase</span></code> is looped, all of its contents (setup, tests and cleanup) are
run fully per each iteration.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">setup</span></code>/<code class="docutils literal notranslate"><span class="pre">cleanup</span></code></dt><dd><p>Setup and cleanup sections within each testcase is unique, and are run
only once per <code class="docutils literal notranslate"><span class="pre">Testcase</span></code>. They cannot be looped individually, but
if their parent <code class="docutils literal notranslate"><span class="pre">Testcase</span></code> is looped, then they are run once per
<code class="docutils literal notranslate"><span class="pre">Testcase</span></code> iteration.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test</span></code></dt><dd><p>Test sections within <code class="docutils literal notranslate"><span class="pre">Testcase</span></code> are loopable individually. Each
iteration has its own unique id, and is reported as a new test
section. When a looping <code class="docutils literal notranslate"><span class="pre">test</span></code> section’s parent <code class="docutils literal notranslate"><span class="pre">Testcase</span></code> is also
looped, the resulting loops are multiplicative. Eg: if a testcase is
looped <code class="docutils literal notranslate"><span class="pre">2x</span></code>, and contains a test that is also looped <code class="docutils literal notranslate"><span class="pre">2x</span></code>, that
test would loop <code class="docutils literal notranslate"><span class="pre">2x</span></code> per testcase loop iteration.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>in other words, <code class="docutils literal notranslate"><span class="pre">subsection</span></code>, <code class="docutils literal notranslate"><span class="pre">Testcase</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> sections are the
only loopable sections.</p>
</div>
<section id="defining-loops">
<h2>Defining Loops<a class="headerlink" href="#defining-loops" title="Permalink to this heading">¶</a></h2>
<p>Sections are marked for looping when they are decorated with <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code>, and its
looping parameters provided as decorator arguments. During runtime, when
<code class="docutils literal notranslate"><span class="pre">aetest</span></code> infrastructure detects looped section code, their corresponding
section object is then instantiated once for each of its iterations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   defining loops on sections</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># defining a common setup section</span>
<span class="c1"># contains a subsection that is looped twice.</span>
<span class="k">class</span> <span class="nc">CommonSetup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>

    <span class="c1"># defining a subsection</span>
    <span class="c1"># this subsection is marked to be looped twice</span>
    <span class="c1"># the first time having a uid of &quot;subsection_one&quot;, and</span>
    <span class="c1"># the second time having a uid of &quot;subsection_two&quot;</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subsection_one&#39;</span><span class="p">,</span> <span class="s1">&#39;subsection_two&#39;</span><span class="p">])</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">looped_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c1"># defining a testcase that loops</span>
<span class="c1"># this testcase also contains a test section that is looped twice</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;testcase_one&#39;</span><span class="p">,</span> <span class="s1">&#39;testcase_two&#39;</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># setup section of this testcase is run once</span>
    <span class="c1"># every time the testcase is looped.</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">setup</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># looped test section</span>
    <span class="c1"># both iterations are run per testcase iteration</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test_one&#39;</span><span class="p">,</span> <span class="s1">&#39;test_two&#39;</span><span class="p">])</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># cleanup section of this testcase is run once</span>
    <span class="c1"># every time the testcase is looped.</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">cleanup</span>
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c1"># this testscript&#39;s resulting sections would look like this below</span>
<span class="c1">#</span>
<span class="c1"># SECTIONS/TESTCASES                                             RESULT</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  |-- CommonSetup                                               PASSED</span>
<span class="c1">#  |   |-- subsection_one                                        PASSED</span>
<span class="c1">#  |   `-- subsection_two                                        PASSED</span>
<span class="c1">#  |-- testcase_one                                              PASSED</span>
<span class="c1">#  |   |-- setup                                                 PASSED</span>
<span class="c1">#  |   |-- test_one                                              PASSED</span>
<span class="c1">#  |   |-- test_two                                              PASSED</span>
<span class="c1">#  |   `-- cleanup                                               PASSED</span>
<span class="c1">#  `-- testcase_two                                              PASSED</span>
<span class="c1">#      |-- setup                                                 PASSED</span>
<span class="c1">#      |-- test_one                                              PASSED</span>
<span class="c1">#      |-- test_two                                              PASSED</span>
<span class="c1">#      `-- cleanup                                               PASSED</span>
</pre></div>
</div>
<p>As shown above, the minimum requirement to loop a section (eg, to run its code
1+ times) is to decorate the section with <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code>, and provide a list of loop
iteration uids using <code class="docutils literal notranslate"><span class="pre">uids</span></code> argument. This controls the number of iterations
this section is looped: each unique item in the <code class="docutils literal notranslate"><span class="pre">uids</span></code> list generates to
a new section with that uid.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> is used on a <code class="docutils literal notranslate"><span class="pre">&#64;subsection</span></code> or <code class="docutils literal notranslate"><span class="pre">&#64;test</span></code>, the section method
is effectively decorated twice, and even though the order does not matter, it
make more sense to use <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> as the outermost decorator, signifying that
this method is first marked as a section, then this section is looped.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>decorators are executed in the order of “innermost” to “outermost”.</p>
</div>
<p>In addition, in an effort to make the script more aesthetically pleasing,
<code class="docutils literal notranslate"><span class="pre">aetest</span></code> also features a shortcut to avoid the double decorators:
<code class="docutils literal notranslate"><span class="pre">&#64;subsection.loop</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;test.loop</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   demonstration the double decorator shortcut for test and subsections</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="k">class</span> <span class="nc">CommonSetup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>

    <span class="c1"># marking this as both a subsection, and being looped</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subsection_one&#39;</span><span class="p">,</span> <span class="s1">&#39;subsection_two&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">looped_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># marking this as both a test section and being looped</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">uids</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;test_one&#39;</span><span class="p">,</span> <span class="s1">&#39;test_two&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;subsection.loop</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;test.loop</span></code> are convenience features. They are
not a python decorator compression technique. <code class="docutils literal notranslate"><span class="pre">.loop</span></code> is an attribute to
<code class="docutils literal notranslate"><span class="pre">subsection</span></code>/<code class="docutils literal notranslate"><span class="pre">test</span></code> that are implemented in <code class="docutils literal notranslate"><span class="pre">aetest</span></code>. It is
effectively a new decorator that shoots two birds with one stone.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>python <code class="docutils literal notranslate"><span class="pre">&#64;decorators</span></code> are evaluated at import time. Thus, decorator
arguments may only be static. If you need to reference runtime and/or
dynamic information information as part of your loop declaration, eg,
accessing parameters &amp; etc, refer to <a class="reference internal" href="#dynamic-looping"><span class="std std-ref">Dynamic Loop Marking</span></a>.</p>
</div>
</section>
<section id="loop-parameters">
<h2>Loop Parameters<a class="headerlink" href="#loop-parameters" title="Permalink to this heading">¶</a></h2>
<p>Looping the same section again and again is not very useful. Even if each
section has a unique uid as demonstrated above, the usefulness of a test
that repeatedly perform the same actions is questionable. This is where <strong>loop
parameters</strong> comes in.</p>
<p>Loop parameters feature allows each loop iteration to receive new, distinct
<a class="reference internal" href="parameters.html#test-parameters"><span class="std std-ref">Test Parameters</span></a>. These parameters are specified as part of the <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code>
decorator, processed and propagated to each section instance as their
<em>local parameters</em>. Combined with <a class="reference internal" href="parameters.html#parameters-as-funcargs"><span class="std std-ref">Parameters as Function Arguments</span></a> feature, each
looped section is then driven to potentially do something different.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   loop parameters demonstration</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># loop this testcast with a loop parameter named &quot;a&quot;</span>
<span class="c1"># and set it to value 2 for the first iteration,</span>
<span class="c1"># and 3 for the second iteration</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># loop this test with loop parameter named &quot;b&quot;</span>
    <span class="c1"># and set it to 8 for the first iteration, 9 for the second.</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># this test prints the exponential of two inputs, a and b</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ^ </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">**</span><span class="n">b</span><span class="p">))</span>


<span class="c1"># the output of the testcase would look like this:</span>
<span class="c1">#   2 ^ 8 = 256</span>
<span class="c1">#   2 ^ 9 = 512</span>
<span class="c1">#   3 ^ 8 = 6561</span>
<span class="c1">#   3 ^ 9 = 19683</span>
<span class="c1">#</span>
<span class="c1"># and since no uids were provided as part of the loop decorator, new uids</span>
<span class="c1"># are generated based on the original section name and the input parameters</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                               RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  |-- Testcase[a=2]                                                PASSED</span>
<span class="c1">#  |   |-- test[b=8]                                                PASSED</span>
<span class="c1">#  |   `-- test[b=9]                                                PASSED</span>
<span class="c1">#  `-- Testcase[a=3]                                                PASSED</span>
<span class="c1">#      |-- test[b=8]                                                PASSED</span>
<span class="c1">#      `-- test[b=9]                                                PASSED</span>
</pre></div>
</div>
<p>In effect, loop parameters allows users to create and/or modify the looped
section’s local parameters on the fly, per iteration. It is an extension of the
dynamic parameter concept, where section parameters are being generated and fed
to each section during runtime.</p>
<p>The use of loop parameters also makes <code class="docutils literal notranslate"><span class="pre">uids</span></code> argument optional: if <code class="docutils literal notranslate"><span class="pre">uids</span></code>
are not provided, the infrastructure generates unique section uids by combining
the original section name with each of its current loop parameters as postfix
in square backets. Otherwise, the provided <code class="docutils literal notranslate"><span class="pre">uids</span></code> are used as section uids.</p>
<p>There are two methods of providing loop parameters to the <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> decorator:</p>
<blockquote>
<div><ul class="simple">
<li><p>by providing a list of parameters, and a list of parameter values for
each iteration (eg, using <code class="docutils literal notranslate"><span class="pre">args</span></code> and <code class="docutils literal notranslate"><span class="pre">argvs</span></code>)</p></li>
<li><p>by providing each parameter as a keyword argument, and a list of its
corresponding argument values. (eg, <code class="docutils literal notranslate"><span class="pre">a=[1,</span> <span class="pre">2,</span> <span class="pre">3],</span> <span class="pre">b=[4,</span> <span class="pre">5,</span> <span class="pre">6]</span></code>)</p></li>
</ul>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   providing loop parameters</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># loop this test with arguments &quot;a&quot;, &quot;b&quot;, and &quot;c&quot;</span>
    <span class="c1"># provide all of its iteration arguments together using method one</span>
    <span class="c1"># the positions of each value in argvs corresponds to its args name</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span>
                      <span class="n">argvs</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                             <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
    <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a=</span><span class="si">%s</span><span class="s2">, b=</span><span class="si">%s</span><span class="s2">, c=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="c1"># loop this test with the same arguments as above, but</span>
    <span class="c1"># provide each of its iteration arguments independently using method two</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
                      <span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                      <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a=</span><span class="si">%s</span><span class="s2">, b=</span><span class="si">%s</span><span class="s2">, c=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>


<span class="c1"># testcase output:</span>
<span class="c1">#   a=1, b=2, c=3</span>
<span class="c1">#   a=4, b=5, c=6</span>
<span class="c1">#   a=1, b=2, c=3</span>
<span class="c1">#   a=4, b=5, c=6</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                               RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  `-- Testcase                                                     PASSED</span>
<span class="c1">#      |-- test_one[a=1,b=2,c=3]                                    PASSED</span>
<span class="c1">#      |-- test_one[a=4,b=5,c=6]                                    PASSED</span>
<span class="c1">#      |-- test_two[a=1,b=2,c=3]                                    PASSED</span>
<span class="c1">#      `-- test_two[a=4,b=5,c=6]                                    PASSED</span>
</pre></div>
</div>
<p>As shown above, there were no difference in the outcome of the results. The only
difference was how the loop parameters were provided. One method may be superior
to the other depending on the situation, the number of arguments, etc.</p>
<p>When using loop parameters, the following rules determines the actual number
of iterations:</p>
<blockquote>
<div><ul class="simple">
<li><p>if <code class="docutils literal notranslate"><span class="pre">uids</span></code> were provided, the number of iterations is equal to the number
of <code class="docutils literal notranslate"><span class="pre">uids</span></code> provided.</p>
<ul>
<li><p>if the number of parameter values exceeds the number of <code class="docutils literal notranslate"><span class="pre">uids</span></code>, all
extra values are discarded.</p></li>
</ul>
</li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">uids</span></code> are not provided, the number of iterations is equal to the
number of loop parameter values. Eg, if <code class="docutils literal notranslate"><span class="pre">&#64;loop(a=[1,2,3])</span></code>, then there
would be 3 loop instances, each taking on one distinct value: <code class="docutils literal notranslate"><span class="pre">a=1</span></code>,
<code class="docutils literal notranslate"><span class="pre">a=2</span></code>, <code class="docutils literal notranslate"><span class="pre">a=3</span></code>.</p>
<ul>
<li><p>if there are multiple parameters and the number of their values do not
agree, or if the number of parameter values is less than the number of
provided <code class="docutils literal notranslate"><span class="pre">uids</span></code>, a <code class="docutils literal notranslate"><span class="pre">filler</span></code> is used to fill empty spots.
<code class="docutils literal notranslate"><span class="pre">filler</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, and only 1 filler can be provided.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   loop parameter combinations</span>
<span class="c1">#   (pseudo code for demonstration only)</span>

<span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">loop</span>

<span class="c1"># loop with 2 iterations using uids argument</span>
<span class="c1"># ------------------------------------------</span>
<span class="c1">#   iteration 1: uid=&#39;id_one&#39;</span>
<span class="c1">#   iteration 2: uid=&#39;id_two&#39;</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id_one&#39;</span><span class="p">,</span> <span class="s1">&#39;id_two&#39;</span><span class="p">])</span>

<span class="c1"># loop with 2 iterations using parameters argument</span>
<span class="c1"># ------------------------------------------------</span>
<span class="c1">#   iteration 1: a=1, b=4</span>
<span class="c1">#   iteration 2: a=2, b=5</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="c1"># same as above, using args and argvs</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">argvs</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)])</span>

<span class="c1"># loop with 2 iterations, and extra arguments are discarded due to uids</span>
<span class="c1"># ---------------------------------------------------------------------</span>
<span class="c1">#   iteration 1: uid=&#39;id_one&#39;, a=1, b=2</span>
<span class="c1">#   iteration 2: uid=&#39;id_two&#39;, a=3, b=4</span>
<span class="c1"># extra argument values 5/6 are discarded because there are no matching uids</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id_one&#39;</span><span class="p">,</span> <span class="s1">&#39;id_two&#39;</span><span class="p">],</span>
      <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
      <span class="n">argvs</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
             <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
             <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)])</span>
<span class="c1"># same example as above but using per-parameter values</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id_one&#39;</span><span class="p">,</span> <span class="s1">&#39;id_two&#39;</span><span class="p">],</span>
      <span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="c1"># loop with 3 iterations, and their number of parameters values do not agree</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#   iteration 1: a=1, b=4</span>
<span class="c1">#   iteration 2: a=2, b=5</span>
<span class="c1">#   iteration 3: a=3, b=None ---&gt; default filler comes in to fill the blanks</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="c1"># same as above, using args and argvs</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
      <span class="n">argvs</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
             <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
             <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">)])</span>

<span class="c1"># loop with more uids than parameters, and custom filler</span>
<span class="c1"># ------------------------------------------------------</span>
<span class="c1">#   iteration 1: uid=&#39;id_one&#39;, a=1, b=3</span>
<span class="c1">#   iteration 2: uid=&#39;id_two&#39;, a=2, b=4</span>
<span class="c1">#   iteration 1: uid=&#39;id_three&#39;, a=999, b=999  ---&gt; custom filler</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">uids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id_one&#39;</span><span class="p">,</span> <span class="s1">&#39;id_two&#39;</span><span class="p">,</span> <span class="s1">&#39;id_three&#39;</span><span class="p">],</span>
      <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">filler</span> <span class="o">=</span> <span class="mi">999</span><span class="p">)</span>
<span class="c1"># same as above, using args and argvs</span>
<span class="nd">@loop</span><span class="p">(</span><span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id_one&#39;</span><span class="p">,</span> <span class="s1">&#39;id_two&#39;</span><span class="p">,</span> <span class="s1">&#39;id_three&#39;</span><span class="p">],</span>
      <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">argvs</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span> <span class="n">filler</span><span class="o">=</span><span class="mi">999</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-loop-usages">
<h2>Advanced Loop Usages<a class="headerlink" href="#advanced-loop-usages" title="Permalink to this heading">¶</a></h2>
<p>Arguments to the <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> decorator may also be <a class="reference external" href="https://docs.python.org/3.4/library/functions.html#callable">callable</a>, <a class="reference external" href="https://docs.python.org/3.4/glossary.html#term-iterable">iterable</a>, or a
<a class="reference external" href="https://docs.python.org/3.4/glossary.html#term-generator">generator</a>. The infrastructure is able to distinguish and treat each as you
would normally expect it to:</p>
<blockquote>
<div><ul class="simple">
<li><p>if an argument value is a <a class="reference external" href="https://docs.python.org/3.4/library/functions.html#callable">callable</a>, it is called, and its returns
are then used as the actual loop argument value.</p></li>
<li><p>if an argument value is an <a class="reference external" href="https://docs.python.org/3.4/glossary.html#term-iterable">iterable</a> or a <a class="reference external" href="https://docs.python.org/3.4/glossary.html#term-generator">generator</a>, the loop engine
picks only one element from it at a time to build the next iteration,
until it is exhausted.</p></li>
</ul>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   demonstrating advanced loop parameter behaviors</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># defining a function</span>
<span class="c1"># functions are callable</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;returning </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="c1"># defining a generator</span>
<span class="k">def</span> <span class="nf">my_generator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generating </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">i</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># creating test section with parameter &quot;a&quot; as a function</span>
    <span class="c1"># note that the function object is passed, not its values</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">my_function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">a</span><span class="p">)</span>

    <span class="c1"># creating a test section with parameter &quot;b&quot; as a generator</span>
    <span class="c1"># note that the generator is a result of calling my_generator(), not</span>
    <span class="c1"># the function itself.</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">my_generator</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># the output of the testcase would be:</span>
<span class="c1">#   returning [1, 2, 3]</span>
<span class="c1">#   a = 1</span>
<span class="c1">#   a = 2</span>
<span class="c1">#   a = 3</span>
<span class="c1">#   generating 4</span>
<span class="c1">#   b = 4</span>
<span class="c1">#   generating 5</span>
<span class="c1">#   b = 5</span>
<span class="c1">#   generating 6</span>
<span class="c1">#   b = 6</span>
</pre></div>
</div>
<p>In the above example, pay close attention to the output lines:</p>
<blockquote>
<div><ul class="simple">
<li><p>Callable arguments are called and converted into their return values
before their looped sections are created and run.</p></li>
<li><p>Iterators and generators are only queried before the next section needs to
be created.</p></li>
</ul>
</div></blockquote>
<p>This behavior enables the use of custom generator as input values to your loop
parameters. For example, a generator state machine that queries the current
testbed device status and creates iterations based on that information. Since
the generator is not polled until right before the next iteration, your custom
function is only run in-between test sections, thus dynamically generating the
loop iterations based current test environments.</p>
</section>
<section id="dynamic-loop-marking">
<span id="dynamic-looping"></span><h2>Dynamic Loop Marking<a class="headerlink" href="#dynamic-loop-marking" title="Permalink to this heading">¶</a></h2>
<p>So far, all loop examples focused on defining <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> directly within the
testscripts. Eg, the <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> decorators are coded as part of the testscript.
In addition, it is also possible to dynamically mark sections for looping during
runtime, eg, creating loops based on information that is only available during
a script run. To do this, use the <code class="docutils literal notranslate"><span class="pre">loop.mark()</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   dynamically marking sections for looping</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">setup</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># mark the next test for looping</span>
        <span class="c1"># provide it with two unique test uids.</span>
        <span class="c1"># (self.simple_test is the next test method)</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_test</span><span class="p">,</span> <span class="n">uids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test_one&#39;</span><span class="p">,</span> <span class="s1">&#39;test_two&#39;</span><span class="p">])</span>

    <span class="c1"># note: the simple_test section is not directly marked for looping</span>
    <span class="c1"># instead, during runtime, its testcase&#39;s setup section marks it for</span>
    <span class="c1"># looping dynamically.</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">simple_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="c1"># print the current section uid</span>
        <span class="c1"># by using the internal parameter &quot;section&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current section: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">section</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>


<span class="c1"># output of this testcase</span>
<span class="c1">#   current section: test_one</span>
<span class="c1">#   current section: test_two</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                                RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  `-- Testcase                                                      PASSED</span>
<span class="c1">#      |-- setup                                                     PASSED</span>
<span class="c1">#      |-- test_one                                                  PASSED</span>
<span class="c1">#      `-- test_two                                                  PASSED</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">loop.mark()</span></code> arguments &amp; behaviors (including loop parameters &amp; etc) are
exactly identical to its sibling <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> decorator, with the only exception
that its first input argument must be the target section method/class. Eg:
<code class="docutils literal notranslate"><span class="pre">loop.mark(Testcase_Two,</span> <span class="pre">a=[1,2,3])</span></code>.</p>
<p>The benefit of this approach is simple: dynamic information, parameters and
variables such as <a class="reference internal" href="parameters.html#script-args"><span class="std std-ref">Script Arguments</span></a>, <a class="reference internal" href="behavior.html#parent"><span class="std std-ref">parent</span></a> etc, are only available
during runtime. This information and its corresponding variables are not
available when the script is written, and delaying variable references (while
using <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> decorator) in Python is very difficult, if not impossible.</p>
</section>
<hr class="docutils" />
<section id="loop-internals">
<h2>Loop Internals<a class="headerlink" href="#loop-internals" title="Permalink to this heading">¶</a></h2>
<aside class="sidebar">
<p class="sidebar-title">Confucius Say…</p>
<p>The information here onwards is for users interested in <code class="docutils literal notranslate"><span class="pre">aetest</span></code>
internals &amp; extensions only.</p>
<p>If you are new to this, do not read on. These advanced topics may
further fuel your confusion.</p>
</aside>
<p>The previous sections focused on the “how to use” aspect of <code class="docutils literal notranslate"><span class="pre">aetest</span></code> looping
functionality. From here onwards, we’ll dig deeper into loop internals, look at
how it functions, and how to deviate from its default behaviors.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">aetest</span></code> looping behavior &amp; how its arguments are processed is actually
highly customizable. This was not highlighted in previous sections for the sake
of serializing the training &amp; simplifying the learning curve.</p>
<p>In reality, consider <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> decorator and <code class="docutils literal notranslate"><span class="pre">loop.mark()</span></code> function as only
markers: they only mark the given section for looping. The details (parameters)
of each iterations is actually generated from <strong>loop generators</strong>, where all
arguments to <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> and <code class="docutils literal notranslate"><span class="pre">loop.mark()</span></code> propagates to. Eg:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   pseudo code demonstrating @loop decorator functionality</span>

<span class="c1"># what the loop decorator definition sort-of looks like</span>
<span class="c1"># note where the generator defaults to &quot;DefaultLooper&quot;</span>
<span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">DefaultLooper</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="c1"># the actual loop generator gets called with all of the arguments</span>
    <span class="c1"># to loop decorator, and generates each section iteration</span>
    <span class="k">return</span> <span class="n">generator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># pseudo code here onwards, demonstrating internals</span>
<span class="c1"># -------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># during runtime, the looped is expanded to create each iteration</span>

<span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># create a section from iteration information and run it</span>
    <span class="c1"># ...</span>

    <span class="c1"># eg, instantiate Subsection</span>
    <span class="n">subsection</span> <span class="o">=</span> <span class="n">Subsection</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="n">iteration</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="o">=</span><span class="n">iteration</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="c1"># and add to common setup&#39;s subsections list</span>
    <span class="n">common_setup</span><span class="o">.</span><span class="n">subsections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subsection</span><span class="p">)</span>

    <span class="c1"># etc ...</span>
</pre></div>
</div>
<p>Behind the scenes, <strong>loop generators</strong> are the actual classes that does the
heavy lifting: creating each iteration based on <code class="docutils literal notranslate"><span class="pre">&#64;loop</span></code> and <code class="docutils literal notranslate"><span class="pre">loop.mark()</span></code>
decorator arguments. Loop generators are <a class="reference external" href="https://docs.python.org/3.4/glossary.html#term-iterable">iterable</a>. Each of its returned
member is an instance of  <code class="docutils literal notranslate"><span class="pre">Iteration</span></code> class, containing the uid &amp; parameters
information unique to this loop, and used by the infrastructure to create the
next section instance.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Iteration class (collections.namedtuple)</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>Attribute</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">uid</span></code></p></th>
<td><p>iteration uid</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">parameters</span></code></p></th>
<td><p>a dictionary of <a class="reference internal" href="parameters.html#test-parameters"><span class="std std-ref">Test Parameters</span></a> to be applied to
the next looped section</p></td>
</tr>
</tbody>
</table>
<p>In other words, <strong>loop generator</strong> is the object that ultimately controls how
loops are generated, and what parameters each iteration is associated with. The
looping behavior and arguments described in topics above are actually that of
<code class="docutils literal notranslate"><span class="pre">DefaultLooper</span></code>, the default <strong>loop generator</strong> provided by <code class="docutils literal notranslate"><span class="pre">aetest</span></code> loop
infrastructure. Its features are sufficient for most use cases. However, if you
wish to customize loop behavior, it is possible to extend and/or override it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   demonstrating how to write and pass your own loop generator</span>

<span class="c1"># loop generators must return Iterations</span>
<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>
<span class="kn">from</span> <span class="nn">pyats.aetest.loop</span> <span class="kn">import</span> <span class="n">Iteration</span>

<span class="c1"># let&#39;s write a custom loop generator</span>
<span class="c1"># it generates integers between a and b as loop iterations</span>
<span class="c1"># and pass the integer as &quot;number&quot; parameter of the executed section.</span>
<span class="c1"># each iteration uid is named &quot;iteration_uid&quot; + number</span>
<span class="k">class</span> <span class="nc">DemoGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c1"># at minimum, the loop generator needs to accept an argument called</span>
    <span class="c1"># &quot;loopee&quot;, which is the actual object being looped. This allows the</span>
    <span class="c1"># loop generator to know what it is looping on, and build information</span>
    <span class="c1"># based on it.</span>
    <span class="c1"># in this example, we&#39;re ignoring that argument, as our loop genrator</span>
    <span class="c1"># is simple and straightforward.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loopee</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbers</span><span class="p">:</span>
            <span class="c1"># each generated member is an instance of Iteration</span>
            <span class="c1"># each Iteration must have a unique id</span>
            <span class="c1"># and all of its parameters stored in a dictionary</span>
            <span class="k">yield</span> <span class="n">Iteration</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s1">&#39;iteration_uid_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">})</span>


<span class="c1"># this loop generator can be used as @loop and loop.mark() argument.</span>
<span class="c1"># let&#39;s define a looped testcase with it.</span>

<span class="c1"># looping this testcase with custom generator, and a=1, b=5</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">DemoGenerator</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># since our generator generates a parameter named &quot;number&quot;</span>
    <span class="c1"># let&#39;s print it in this simple test.</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current number: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">number</span><span class="p">)</span>

<span class="c1"># output of this testcase</span>
<span class="c1">#   current number: 1</span>
<span class="c1">#   current number: 2</span>
<span class="c1">#   current number: 3</span>
<span class="c1">#   current number: 4</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                                RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  |-- iteration_uid_1                                               PASSED</span>
<span class="c1">#  |   `-- test                                                      PASSED</span>
<span class="c1">#  |-- iteration_uid_2                                               PASSED</span>
<span class="c1">#  |   `-- test                                                      PASSED</span>
<span class="c1">#  |-- iteration_uid_3                                               PASSED</span>
<span class="c1">#  |   `-- test                                                      PASSED</span>
<span class="c1">#  `-- iteration_uid_4                                               PASSED</span>
<span class="c1">#      `-- test                                                      PASSED</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>the above examples may be simple, the demonstrated underlying principles
are not.</p>
<p><em>“Do not try and bend the spoon. That’s impossible. Instead… only try to
realize the truth…”</em></p>
</div>
<p>And voila. Custom <strong>loop generators</strong> like above is immensely powerful: by
extending and/or overriding the default loop generation behavior, and defining
custom test sections entirely driven by parameter inputs, users can effectively
overload the loop functionality into a dynamic generator of highly abstracted
test executor.</p>
<hr class="docutils" />
<blockquote>
<div><p><em>Looking for loop definition? Refer to the top of this section.</em></p>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="parameters.html" class="btn btn-neutral float-left" title="Test Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="results.html" class="btn btn-neutral float-right" title="Section Results" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>