<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flow Control &mdash; pyATS Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Report Details" href="reports.html" />
    <link rel="prev" title="Datafile Inputs" href="datafile.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyATS
          </a>
              <div class="version">
                24.11
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">AEtest - Test Infrastructure</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="structure.html">Script Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Object Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="behavior.html">Runtime Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Test Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="loop.html">Looping Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="results.html">Section Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="steps.html">Section Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">Running TestScripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="processors.html">Section Processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="datafile.html">Datafile Inputs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Flow Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#skip-conditions">Skip Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-ids">Run IDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testcase-grouping">Testcase Grouping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requisite-testcase">Requisite Testcase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testcase-randomization">Testcase Randomization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maximum-failures">Maximum Failures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#goto">Goto</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-discovery-and-order">Custom Discovery and Order</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-discovery">Custom Discovery</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-do-discovery-classes-work">How do discovery classes work?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-ordering">Custom Ordering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reports.html">Report Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../easypy/index.html">Easypy - Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Testbed &amp; Topology Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kleenex/index.html">Testbed &amp; Device Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connections/index.html">Connection Meta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../async/index.html">Asynchronous Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/index.html">Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tcl/index.html">Tcl Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log/index.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results/index.html">Result Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporter/index.html">Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot/index.html">RobotFramework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manifest/index.html">Manifest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Terminologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Doc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">AEtest - Test Infrastructure</a></li>
      <li class="breadcrumb-item active">Flow Control</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="flow-control">
<span id="aetest-control"></span><h1>Flow Control<a class="headerlink" href="#flow-control" title="Permalink to this heading">¶</a></h1>
<p>This section focuses on script execution control features offered in <code class="docutils literal notranslate"><span class="pre">aetest</span></code>.</p>
<p>Control features allows users to master the flow of the testscript, performing
actions such as breaking the execution continuity and jumping ahead, skipping
or only executing specific testcases by <code class="docutils literal notranslate"><span class="pre">uid</span></code>, grouping testcases together,
etc.</p>
<p>Control features described in this section are entirely <em>optional</em>.</p>
<section id="skip-conditions">
<span id="aetest-skip-conditions"></span><h2>Skip Conditions<a class="headerlink" href="#skip-conditions" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">aetest</span></code> comes out-of-box with a few built-in <strong>preprocessors</strong> defined using
<a class="reference internal" href="processors.html#aetest-processors"><span class="std std-ref">Section Processors</span></a> feature, intended to be used as shortcuts to skipping
test sections.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&#64;aetest.skip(reason</span> <span class="pre">=</span> <span class="pre">'message')</span></code></dt><dd><p>unconditionally skip the decorated section. <em>reason</em> should describe why
that section is being skipped.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aetest.skip.affix(testcase,</span> <span class="pre">reason)</span></code></dt><dd><p>Same as the skip decorator, but can be used on the fly. So depending on one
testcase result, the other testcases can be skipped.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&#64;aetest.skipIf(condition,</span> <span class="pre">reason</span> <span class="pre">=</span> <span class="pre">'message')</span></code></dt><dd><p>skip the decorated test section if <em>condition</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aetest.skipIf.affix(testcase,</span> <span class="pre">condition,</span> <span class="pre">reason)</span></code></dt><dd><p>It can be used to assign skipIf decorator to the testcases, condition can
be a callable or a boolean.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&#64;aetest.skipUnless(condition,</span> <span class="pre">reason</span> <span class="pre">=</span> <span class="pre">'message')</span></code></dt><dd><p>skip the decorated test section unless <em>condition</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aetest.skipUnless.affix(testcase,</span> <span class="pre">condition,</span> <span class="pre">reason)</span></code></dt><dd><p>Can be used on the fly to assign decorators to the testcases</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   skip/skipIf/skipUnless examples</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># skip testcase intentionally</span>
<span class="nd">@aetest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s1">&#39;because we had to&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TestcaseTwo</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># skip test section using if library version &lt; some number</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="n">mylibrary</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                   <span class="s1">&#39;not supported in this library version&#39;</span><span class="p">)</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># skip unless library version &gt; some number</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">skipUnless</span><span class="p">(</span><span class="n">mylibrary</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                       <span class="s1">&#39;not supported in this library version&#39;</span><span class="p">)</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_three</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">skip</span><span class="o">.</span><span class="n">affix</span><span class="p">(</span><span class="n">section</span> <span class="o">=</span> <span class="n">TestcaseTwo</span><span class="o">.</span><span class="n">test_four</span><span class="p">,</span>
                          <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;message&quot;</span><span class="p">)</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">skipIf</span><span class="o">.</span><span class="n">affix</span><span class="p">(</span><span class="n">section</span> <span class="o">=</span> <span class="n">TestcaseTwo</span><span class="o">.</span><span class="n">test_five</span><span class="p">,</span>
                            <span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;message&quot;</span><span class="p">)</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">skipUnless</span><span class="o">.</span><span class="n">affix</span><span class="p">(</span><span class="n">section</span> <span class="o">=</span> <span class="n">TestcaseThree</span><span class="p">,</span>
                                <span class="n">condition</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;message&quot;</span><span class="p">)</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_four</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># will be skipped because of test_three</span>
        <span class="k">pass</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_five</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># will be skipped because of test_three</span>
        <span class="k">pass</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_six</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># will be skipped because of test_three</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TestcaseThree</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="c1"># will be skipped because of TestcaseTwo.test_three</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>the above skip decorators only support boolean conditions. Use the full
<a class="reference internal" href="processors.html#aetest-processors"><span class="std std-ref">Section Processors</span></a> feature if your skip condition are functions that
requires access to <code class="docutils literal notranslate"><span class="pre">section</span></code> objects.</p>
</div>
</section>
<section id="run-ids">
<span id="aetest-uids"></span><h2>Run IDS<a class="headerlink" href="#run-ids" title="Permalink to this heading">¶</a></h2>
<p>Run <code class="docutils literal notranslate"><span class="pre">uids</span></code> is the concept of only executing testcases &amp; sections with uids
that matches up to a particular requirement. It provides users direct, finer
control before and during execution, over which sections to run, and which
sections to skip over.</p>
<p>There are two methods of providing <code class="docutils literal notranslate"><span class="pre">aetest</span></code> with this requirement:</p>
<blockquote>
<div><ul class="simple">
<li><p>through <a class="reference internal" href="run.html#aetest-standard-arguments"><span class="std std-ref">Standard Arguments</span></a> as part of script run arguments,
or,</p></li>
<li><p>by setting <a class="reference internal" href="behavior.html#aetest-runtime"><span class="std std-ref">runtime</span></a> variable, <code class="docutils literal notranslate"><span class="pre">runtime.uids</span></code> dynamically
during execution.</p></li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">uids</span></code> accepts a python <code class="docutils literal notranslate"><span class="pre">callable</span></code> (eg, a function). The list of currently
running section uids are provided as inputs to this <code class="docutils literal notranslate"><span class="pre">callable</span></code>, and if the
function evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the section is run, otherwise, the section is
not run and ignored completely so that it’s not displayed in the report.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   setting from jobfile example</span>

<span class="kn">from</span> <span class="nn">pyats.easypy</span> <span class="kn">import</span> <span class="n">run</span>

<span class="c1"># function determining whether we should run testcase_A</span>
<span class="c1"># currently executing uids is always a list of:</span>
<span class="c1">#       [ &lt;container uid&gt;, &lt;section uid&gt;]</span>
<span class="c1"># eg, [&#39;common_setup&#39;, &#39;subsection_one&#39;]</span>
<span class="c1"># thus varargs (using *) is required for the function input.</span>
<span class="k">def</span> <span class="nf">run_only_testcase_A</span><span class="p">(</span><span class="o">*</span><span class="n">ids</span><span class="p">):</span>
    <span class="c1"># check that we are running testcase_A</span>
    <span class="k">return</span> <span class="s1">&#39;testcase_A&#39;</span> <span class="ow">in</span> <span class="n">uids</span>

<span class="c1"># run only testcase_A and its contents (using callable)</span>
<span class="c1"># executing uids has testcase_A:</span>
<span class="n">run</span><span class="p">(</span><span class="s1">&#39;example_script.py&#39;</span><span class="p">,</span> <span class="n">uids</span> <span class="o">=</span> <span class="n">run_only_testcase_A</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">callable</span></code> provided to <code class="docutils literal notranslate"><span class="pre">uids</span></code> feature is evaluated against the list of
current run ids, using varargs (eg, <code class="docutils literal notranslate"><span class="pre">*uids</span></code>). This feature combined with
<a class="reference internal" href="../datastructures/logic.html#logic-tests"><span class="std std-ref">Logic Testing</span></a> objects can provide quite a bit of control over which
testcases to run and which not to.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   setting from jobfile example, using logics</span>

<span class="kn">from</span> <span class="nn">pyats.easypy</span> <span class="kn">import</span> <span class="n">run</span>

<span class="c1"># import the logic objects</span>
<span class="kn">from</span> <span class="nn">pyats.datastructures.logic</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">Or</span><span class="p">,</span> <span class="n">Not</span>

<span class="c1"># run the testscript with a bunch of logic involved</span>
<span class="c1"># eg: both common_setup and common_cleanup,</span>
<span class="c1">#     and all bgp and ospf non-sanity traffic tests.</span>
<span class="n">run</span><span class="p">(</span><span class="s1">&#39;example_script.py&#39;</span><span class="p">,</span> <span class="n">uids</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="s1">&#39;common_setup&#39;</span><span class="p">,</span>
                                   <span class="n">And</span><span class="p">(</span><span class="s1">&#39;^bgp.+&#39;</span><span class="p">,</span> <span class="s1">&#39;.*traffic.*&#39;</span><span class="p">,</span> <span class="n">Not</span><span class="p">(</span><span class="s1">&#39;sanity&#39;</span><span class="p">)),</span>
                                   <span class="n">And</span><span class="p">(</span><span class="s1">&#39;^ospf.+&#39;</span><span class="p">,</span> <span class="s1">&#39;.*traffic.*&#39;</span><span class="p">,</span> <span class="n">Not</span><span class="p">(</span><span class="s1">&#39;sanity&#39;</span><span class="p">)),</span>
                                   <span class="s1">&#39;common_cleanup&#39;</span><span class="p">))</span>

<span class="c1"># or, when this testscript is run, call it with -uids argument</span>
<span class="c1">#   python example.py -uids=&quot;Or(&#39;common_setup&#39;, \</span>
<span class="c1">#                               And(&#39;^bgp.+&#39;, &#39;.*traffic.*&#39;, Not(&#39;sanity&#39;)),\</span>
<span class="c1">#                               And(&#39;^ospf.+&#39;, &#39;.*traffic.*&#39;, Not(&#39;sanity&#39;)),\</span>
<span class="c1">#                               &#39;common_cleanup&#39;)&quot;</span>
</pre></div>
</div>
<p>Current <code class="docutils literal notranslate"><span class="pre">uids</span></code> requirements is stored and accessible using
<a class="reference internal" href="behavior.html#aetest-runtime"><span class="std std-ref">runtime</span></a> feature as <code class="docutils literal notranslate"><span class="pre">runtime.uids</span></code>. This value is write enabled:
when dynamically set during runtime, it takes effect immediately starting
from the next section onwards.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   setting uids dynamically in testscript</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># using logics</span>
<span class="kn">from</span> <span class="nn">pyats.datastructures.logic</span> <span class="kn">import</span> <span class="n">Not</span><span class="p">,</span> <span class="n">And</span>

<span class="k">class</span> <span class="nc">CommonSetup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># set uids dynamically during runtime</span>
        <span class="c1"># eg, run all tests with bgp in the name, but not traffic.</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">uids</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="s1">&#39;.*bgp.*&#39;</span><span class="p">,</span> <span class="n">Not</span><span class="p">(</span><span class="s1">&#39;traffic&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>If both methods of providing <code class="docutils literal notranslate"><span class="pre">uids</span></code> is used, then the engine first
starts up by following the list provided using
<a class="reference internal" href="run.html#aetest-standard-arguments"><span class="std std-ref">Standard Arguments</span></a>, until the <a class="reference internal" href="behavior.html#aetest-runtime"><span class="std std-ref">runtime</span></a> variable
<code class="docutils literal notranslate"><span class="pre">runtime.uids</span></code> is updated.</p>
</section>
<section id="testcase-grouping">
<span id="aetest-groups"></span><h2>Testcase Grouping<a class="headerlink" href="#testcase-grouping" title="Permalink to this heading">¶</a></h2>
<p>Testcase grouping feature enables testcases to be “associated” together by
certain keywords, allowing a testscript execution be limited to only running
testcases of one or more particular <strong>groups</strong> that matches up to input
criterion.</p>
<p>To use this feature, testcases needs to be labelled first with corresponding
groups by setting their <code class="docutils literal notranslate"><span class="pre">groups</span></code> attribute. By default, testscases do not
belong to any groups (<code class="docutils literal notranslate"><span class="pre">groups</span> <span class="pre">=</span> <span class="pre">[]</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   associating testcases to run groups</span>

<span class="c1"># syntax</span>
<span class="c1">#</span>
<span class="c1">#   groups = [ &lt;list of group names in str. no spaces&gt; ]</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="c1"># associating this testcase to 3 separate groups</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;group_A&#39;</span><span class="p">,</span> <span class="s1">&#39;group_B&#39;</span><span class="p">,</span> <span class="s1">&#39;group_C&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>After labelling testcases to one or more groups, use one of the following
methods to control which testcase groups are run:</p>
<blockquote>
<div><ul class="simple">
<li><p>using <a class="reference internal" href="run.html#aetest-standard-arguments"><span class="std std-ref">Standard Arguments</span></a> <code class="docutils literal notranslate"><span class="pre">-groups</span></code>, or,</p></li>
<li><p>by setting <a class="reference internal" href="behavior.html#aetest-runtime"><span class="std std-ref">runtime</span></a> variable, <code class="docutils literal notranslate"><span class="pre">runtime.groups</span></code> dynamically.</p></li>
</ul>
</div></blockquote>
<p>Like <a class="reference internal" href="#aetest-uids"><span class="std std-ref">Run IDS</span></a> feature, <code class="docutils literal notranslate"><span class="pre">groups</span></code> also accepts a python <code class="docutils literal notranslate"><span class="pre">callable</span></code>
(eg, a function). Each testcase’s groups values are provided as inputs to this
<code class="docutils literal notranslate"><span class="pre">callable</span></code>, and if the return value is <code class="docutils literal notranslate"><span class="pre">True</span></code>, the testcase is run.
Otherwise, the testcase is not run and ignored completely so that it’s not
displayed in the report.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   setting groups from jobfile example</span>

<span class="kn">from</span> <span class="nn">pyats.easypy</span> <span class="kn">import</span> <span class="n">run</span>

<span class="c1"># create a function that tests for testcase groups</span>
<span class="c1"># this api tests that a testcase belongs to sanity but not traffic.</span>
<span class="c1"># note that varargs (using *) is required, as the list of groups to each</span>
<span class="c1"># testcase is unknown.</span>
<span class="k">def</span> <span class="nf">non_traffic_sanities</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;sanity&#39;</span> <span class="ow">in</span> <span class="n">groups</span> <span class="ow">and</span> <span class="s1">&#39;traffic&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">groups</span>

<span class="c1"># run the testscript by providing the above function to test groups</span>
<span class="n">run</span><span class="p">(</span><span class="s1">&#39;example_script.py&#39;</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">non_traffic_sanities</span><span class="p">)</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># behind the scenes (pseudo code)</span>
<span class="c1"># for each testcase:</span>
<span class="c1">#     if non_traffic_sanities(testcase.groups):</span>
<span class="c1">#         run testcase</span>
<span class="c1">#     else:</span>
<span class="c1">#         pass</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">callable</span></code> provided to groups feature is evaluated against the list of
groups each testcase belongs to, using <em>varargs</em> (eg, <code class="docutils literal notranslate"><span class="pre">*groups</span></code>). This feature
is intended to be used in conjunction with <a class="reference internal" href="../datastructures/logic.html#logic-tests"><span class="std std-ref">Logic Testing</span></a> objects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   setting groups from jobfile example, using logics</span>

<span class="kn">from</span> <span class="nn">pyats.easypy</span> <span class="kn">import</span> <span class="n">run</span>

<span class="c1"># import the logic objects</span>
<span class="kn">from</span> <span class="nn">pyats.datastructures.logic</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">Not</span>

<span class="c1"># same as above, run sanity non-traffic testcases</span>
<span class="n">run</span><span class="p">(</span><span class="s1">&#39;example_script.py&#39;</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="s1">&#39;sanity&#39;</span><span class="p">,</span> <span class="n">Not</span><span class="p">(</span><span class="s1">&#39;traffic&#39;</span><span class="p">)))</span>

<span class="c1"># or, from command line:</span>
<span class="c1"># python example.py -groups=&quot;And(&#39;sanity&#39;, Not(&#39;traffic&#39;))&quot;</span>
</pre></div>
</div>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">groups</span></code> can also be set dynamically during runtime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   setting groups dynamically</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>
<span class="kn">from</span> <span class="nn">pyats.datastructures.logic</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">Not</span>

<span class="k">class</span> <span class="nc">CommonSetup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># set groups dynamically during runtime</span>
        <span class="n">aetest</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="s1">&#39;sanity&#39;</span><span class="p">,</span> <span class="n">Not</span><span class="p">(</span><span class="s1">&#39;traffic&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>And takes effect immediately.</p>
<p>Grouping feature is only applicable to testcases. In essence, the control of
whether testcases are run based on their grouping is handed entirely to the
user via boolean truth testing. Users can read the current executing groups
via <a class="reference internal" href="behavior.html#aetest-runtime"><span class="std std-ref">runtime</span></a> variable, and manipulate it based on a variety of
other factors, etc.</p>
</section>
<section id="requisite-testcase">
<span id="aetest-requisite-testcase"></span><h2>Requisite Testcase<a class="headerlink" href="#requisite-testcase" title="Permalink to this heading">¶</a></h2>
<p>Requisite testcase feature allows users to mark important testcases as
<em>must pass</em>: if such testcases failed, the current script execution is
aborted automatically by jumping forward to <code class="docutils literal notranslate"><span class="pre">CommonCleanup</span></code> section using
<a class="reference internal" href="#aetest-goto"><span class="std std-ref">Goto</span></a>.</p>
<p>To mark testcases as <em>requisite</em> or <em>must pass</em>, set its attribute <code class="docutils literal notranslate"><span class="pre">must_pass</span></code>
to <code class="docutils literal notranslate"><span class="pre">True</span></code>. By default, no testcase is “requisite”, eg, <code class="docutils literal notranslate"><span class="pre">must_pass</span> <span class="pre">=</span> <span class="pre">False</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   must_pass feature demonstration</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>


<span class="k">class</span> <span class="nc">TestcaseOne</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="n">must_pass</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">(</span><span class="s1">&#39;boom!&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TestcaseTwo</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">CommonCleanup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonCleanup</span><span class="p">)</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c1"># output result</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                                RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  |-- TestcaseOne                                                   FAILED</span>
<span class="c1">#  |   `-- test                                                      FAILED</span>
<span class="c1">#  |-- TestcaseTwo                                                  BLOCKED</span>
<span class="c1">#  `-- common_cleanup                                                PASSED</span>
<span class="c1">#      `-- subsection                                                PASSED</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the use of testcase <code class="docutils literal notranslate"><span class="pre">must_pass</span></code> flag does not imply testcase dependency
It only marks a testcase as “critical” in terms of importance, where, if it
failed then the rest of the execution should be abandoned.</p>
</div>
</section>
<section id="testcase-randomization">
<span id="aetest-testcase-randomization"></span><h2>Testcase Randomization<a class="headerlink" href="#testcase-randomization" title="Permalink to this heading">¶</a></h2>
<p>Testcase randomization feature allows testcases within each testscript to be
executed in <a class="reference external" href="https://en.wikipedia.org/wiki/Pseudorandomness">pseudo-random</a> order. This allows for mixed script coverage
trails, yielding to better overall testing over time.</p>
<p>By default, testcase randomization is turned off, and all testcases are executed
in the order described by <a class="reference internal" href="behavior.html#aetest-section-ordering"><span class="std std-ref">Section Ordering</span></a>. To turn on
randomization, set <a class="reference internal" href="run.html#aetest-standard-arguments"><span class="std std-ref">Standard Arguments</span></a> <code class="docutils literal notranslate"><span class="pre">random=True</span></code>. This
causes all testcases within the current testscript to be shuffled before
execution.</p>
<p>Normally, the system automatically picks a random integer value to seed the
python randomizer. This value is always printed in the log. This behavior can be
averted by setting the optional argument <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> to a integer value,
fixing the outcome. This might be highly useful when trying to reproduce an
issue caused by a particular randomized testcase order: simply reuse the
seed value as shown in the logfile, and the same “randomized” order is
repeated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1"># randomization of testcases feature demonstration</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># define a couple testcases</span>
<span class="k">class</span> <span class="nc">TestcaseOne</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TestcaseTwo</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TestcaseThree</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># run it</span>
<span class="n">aetest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">random</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># output result</span>
<span class="c1">#</span>
<span class="c1">#  Testcase randomization is enabled, seed: 1461425170</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                                RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  |-- TestcaseTwo                                                   PASSED</span>
<span class="c1">#  |-- TestcaseOne                                                   PASSED</span>
<span class="c1">#  `-- TestcaseThree                                                 PASSED</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>testcase randomization only affects the order of <code class="docutils literal notranslate"><span class="pre">Testcases</span></code>.
<code class="docutils literal notranslate"><span class="pre">CommonSetup</span></code> and <code class="docutils literal notranslate"><span class="pre">CommonCleanup</span></code> continue to run before and after
all testcases, respectively.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>testcase randomization feature should be turned off before submitting
testscript to regression.</p>
</div>
</section>
<section id="maximum-failures">
<span id="aetest-max-failures"></span><h2>Maximum Failures<a class="headerlink" href="#maximum-failures" title="Permalink to this heading">¶</a></h2>
<p>The maximum failures feature allows users to put a limit to the number of testcase
failures in a testscript before the script auto-aborts. This feature is intended to
safeguard against massive failures in long-running scripts, and avoids wasting
valuable testbed runtime when something goes horribly wrong.</p>
<p>To use this feature, set <a class="reference internal" href="run.html#aetest-standard-arguments"><span class="std std-ref">Standard Arguments</span></a> <code class="docutils literal notranslate"><span class="pre">max_failures</span></code> to an
integer value. During execution, if the total number of failed <code class="docutils literal notranslate"><span class="pre">Testcases</span></code>
reaches the provided value, the script auto-aborts by jumping forward to
<code class="docutils literal notranslate"><span class="pre">CommonCleanup</span></code> section using <a class="reference internal" href="#aetest-goto"><span class="std std-ref">Goto</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1"># maximum failures feature demonstration</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="k">class</span> <span class="nc">TestcaseOne</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">TestcaseTwo</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">TestcaseThree</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">CommonCleanup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonCleanup</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># run it</span>
<span class="n">aetest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">max_failures</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># output result</span>
<span class="c1">#</span>
<span class="c1"># Max failure reached: aborting script execution</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                                RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  |-- TestcaseOne                                                   FAILED</span>
<span class="c1">#  |-- TestcaseTwo                                                  BLOCKED</span>
<span class="c1">#  |-- TestcaseThree                                                BLOCKED</span>
<span class="c1">#  `-- common_cleanup                                                PASSED</span>
</pre></div>
</div>
<p>As demonstrated above, when the total number of testcases failed reaches the
given value, the testscript is aborted with the remaining testcases blocked.</p>
</section>
<section id="goto">
<span id="aetest-goto"></span><h2>Goto<a class="headerlink" href="#goto" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Goto">Goto</a> is the concept found in many programming languages that allows a
<strong>one-way transfer</strong> of control to another line of code. To this day, there are
still considerable debates with the academia and industry on its merits.</p>
<p><code class="docutils literal notranslate"><span class="pre">aetest</span></code> supports the concept of <em>goto</em> on the simple basis that testscripts,
while still a piece of software, is mostly linear in execution &amp; logic. Adding
to it the support for <em>goto</em> grants users a higher order of control, and enables
<strong>early flow termination</strong>: exiting out of current section and skipping ahead
for the sole purpose of saving execution/testbed time. This was born out of pure
necessity: router testing is a heavily time-consuming process, and any time
saving measures is a plus.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">aetest</span></code>, <em>goto jumps</em> can be invoked as optional arguments to
<a class="reference internal" href="results.html#result-apis"><span class="std std-ref">Result APIs</span></a>. This <a class="reference external" href="https://www.python.org/dev/peps/pep-3102/">keyword-only argument</a> accepts a list of <strong>targets</strong>
to jump to. Upon activation:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>the test engine jumps to and executes each listed <strong>target</strong> location
in sequence.</p></li>
<li><p>any by-passed sections receive a result based on the following
criterion:</p>
<ol class="loweralpha simple">
<li><p>if the section that initiated the jump has a result of <code class="docutils literal notranslate"><span class="pre">Passed</span></code>, any
by-passed section receives result <code class="docutils literal notranslate"><span class="pre">Skipped</span></code>: eg, they were
skipped over intentionally.</p></li>
<li><p>if the section that initiated the jump has a result other than
<code class="docutils literal notranslate"><span class="pre">Passed</span></code>, any by-passed section receives result <code class="docutils literal notranslate"><span class="pre">Blocked</span></code>: eg,
they were blocked due to “x” reasons.</p></li>
</ol>
</li>
<li><p>after the <strong>targets</strong> list is exhausted, execution continues as
normally expected.</p></li>
</ol>
</div></blockquote>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code class="docutils literal notranslate"><span class="pre">aetest</span></code> only allows <strong>forward</strong> jumping. All <em>goto</em> targets must be valid
and in-line of current execution.</p>
</div>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Available Goto Targets</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Target</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cleanup</span></code></p></td>
<td><p>jumps to the testcase cleanup section, by-passing all other
test sections</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">next_tc</span></code></p></td>
<td><p>jumps to the next testcase in line</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">common_cleanup</span></code></p></td>
<td><p>jumps to the script’s <code class="docutils literal notranslate"><span class="pre">CommonCleanup</span></code> section.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exit</span></code></p></td>
<td><p>terminates the testscript immediately without going further.</p></td>
</tr>
</tbody>
</table>
<p>If a goto target is invalid or does not exist, the test engine gives the
current section a result of <code class="docutils literal notranslate"><span class="pre">Errored</span></code> and continues executing. If there are no
more testcases, and goto <code class="docutils literal notranslate"><span class="pre">next_tc</span></code> is called, no error is given and
<code class="docutils literal notranslate"><span class="pre">common_cleanup</span></code> is executed to finalize the testscript.</p>
<blockquote>
<div><p><em>This is by design: make sure your goto targets actually exist.</em></p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   goto syntax</span>
<span class="c1">#   (pseudo code, not showing the entire testcase)</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># Syntax:</span>
<span class="c1">#   &lt;resultAPI&gt;(goto = [&#39;target_1&#39;, &#39;target_2&#39;, ... , &#39;target_x&#39;])</span>

<span class="k">class</span> <span class="nc">CommonSetup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># goto with a message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errored</span><span class="p">(</span><span class="s1">&#39;setup error, abandoning script&#39;</span><span class="p">,</span> <span class="n">goto</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">])</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="k">class</span> <span class="nc">TestcaseOne</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">setup</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># setup failed, go to cleanup of testcase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">(</span><span class="s1">&#39;test failed&#39;</span><span class="p">,</span> <span class="n">goto</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cleanup&#39;</span><span class="p">])</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="k">class</span> <span class="nc">TestcaseTwo</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="c1"># test failed, move onto next testcase</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">(</span><span class="n">goto</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;next_tc&#39;</span><span class="p">])</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="k">class</span> <span class="nc">TestcaseThree</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">setup</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># setup failed, move onto cleanup of this testcase, then</span>
        <span class="c1"># jump to common_cleanup directly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">(</span><span class="n">goto</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cleanup&#39;</span><span class="p">,</span><span class="s1">&#39;common_cleanup&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Essentially, <strong>goto</strong> is an optional step after providing a test section with an
appropriate result. For example, users may leverage this feature to skip to the
testcase’s <code class="docutils literal notranslate"><span class="pre">cleanup</span></code> section after a dramatic failure in a <code class="docutils literal notranslate"><span class="pre">test</span></code> section,
or skip all testcases directly and go to <code class="docutils literal notranslate"><span class="pre">common_cleanup</span></code> instead. It allows
controlled skip-aheads during execution in favor of reducing script execution
time, avoiding expected errors/failures, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example</span>
<span class="c1"># -------</span>
<span class="c1">#</span>
<span class="c1">#   goto testscript demonstration</span>

<span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># this testcase defines two tests</span>
<span class="c1"># in the first test, we&#39;ll give it a result and</span>
<span class="c1"># immediately skip forward to cleanup</span>
<span class="k">class</span> <span class="nc">Testcase</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># skip ahead and go to cleanup instead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passed</span><span class="p">(</span><span class="n">goto</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cleanup&#39;</span><span class="p">])</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">cleanup</span>
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c1"># output result</span>
<span class="c1">#</span>
<span class="c1">#  SECTIONS/TESTCASES                                                RESULT</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1">#  .</span>
<span class="c1">#  `-- Testcase                                                      PASSED</span>
<span class="c1">#      |-- test_one                                                  PASSED</span>
<span class="c1">#      |-- test_two                                                 SKIPPED</span>
<span class="c1">#      `-- cleanup                                                   PASSED</span>
</pre></div>
</div>
</section>
<section id="custom-discovery-and-order">
<span id="aetest-discovery-class"></span><h2>Custom Discovery and Order<a class="headerlink" href="#custom-discovery-and-order" title="Permalink to this heading">¶</a></h2>
<p>Normally, testcases are discovered by the default discovery class,
<code class="docutils literal notranslate"><span class="pre">ScriptDiscovery</span></code> which is located under <code class="docutils literal notranslate"><span class="pre">discovery</span></code> module of <code class="docutils literal notranslate"><span class="pre">aetest</span></code>
package. This class implements the default behavior of testcase discovery and
ordering discussed throughout this user guide. For example, <code class="docutils literal notranslate"><span class="pre">common_setup</span></code> has
to be run first, and then other testcases. Finally <code class="docutils literal notranslate"><span class="pre">common_cleanup</span></code> runs as
the last testcase of the script.</p>
<p>Advanced users may want to extend and enhance this built-in discovery mechanism,
eg, dynamic testcase/section generation, and/or alternative testcase ordering.</p>
<section id="custom-discovery">
<span id="aetest-custom-discovery"></span><h3>Custom Discovery<a class="headerlink" href="#custom-discovery" title="Permalink to this heading">¶</a></h3>
<p>Users may overload discovery behavior at the following levels:</p>
<blockquote>
<div><ul class="simple">
<li><p>Script Discovery</p></li>
<li><p>Testcase Discovery</p></li>
<li><p>Common Discovery</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>ScriptDiscovery</strong> finds <code class="docutils literal notranslate"><span class="pre">testcases</span></code> within a <code class="docutils literal notranslate"><span class="pre">testscript</span></code>.
<strong>TestcaseDiscovery</strong> finds <code class="docutils literal notranslate"><span class="pre">testsections</span></code> within a <code class="docutils literal notranslate"><span class="pre">testcase</span></code>
<strong>CommonDiscovery</strong> finds <code class="docutils literal notranslate"><span class="pre">subsections</span></code> within a common section</p>
</div>
<p>Rules:</p>
<ul class="simple">
<li><p><strong>pyats.aetest.discovery.ScriptDiscovery</strong> is the default discovery class
for testcases and, it can be changed as shown in the following example:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>
<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">MyCustomScriptDiscovery</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>User defined custom script discovery class has to be inherited from
<a class="reference internal" href="../apidoc/aetest/index.html#pyats.aetest.discovery.ScriptDiscovery" title="pyats.aetest.discovery.ScriptDiscovery"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ScriptDiscovery</span></code></a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>
<span class="kn">from</span> <span class="nn">pyats.aetest.discovery</span> <span class="kn">import</span> <span class="n">ScriptDiscovery</span>

<span class="k">class</span> <span class="nc">MyCustomScriptDiscovery</span><span class="p">(</span><span class="n">ScriptDiscovery</span><span class="p">)</span>
    <span class="k">pass</span>

<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">MyCustomScriptDiscovery</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>pyats.aetest.discovery.TestcaseDiscovery</strong> is the default discovery class
for testsections and, it can be changed as shown in the following example:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>
<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">testcase</span> <span class="o">=</span> <span class="n">MyCustomTestcaseDiscovery</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>User defined custom test discovery class has to be inherited from
<a class="reference internal" href="../apidoc/aetest/index.html#pyats.aetest.discovery.TestcaseDiscovery" title="pyats.aetest.discovery.TestcaseDiscovery"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TestcaseDiscovery</span></code></a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>
<span class="kn">from</span> <span class="nn">pyats.aetest.discovery</span> <span class="kn">import</span> <span class="n">TestcaseDiscovery</span>

<span class="k">class</span> <span class="nc">MyCustomTestcaseDiscovery</span><span class="p">(</span><span class="n">TestcaseDiscovery</span><span class="p">)</span>
    <span class="k">pass</span>

<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">testcase</span> <span class="o">=</span> <span class="n">MyCustomTestcaseDiscovery</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">runtime.discoverer</span></code> properties sets the default discovery
classes.</p></li>
<li><p>As shown in the following example, It is possible to provide different
discovery classes to different testcases by using the <code class="docutils literal notranslate"><span class="pre">discoverer</span></code>
attribute.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>
<span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>

<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">testcase</span> <span class="o">=</span> <span class="n">MyDefaultDiscovery</span>

<span class="k">class</span> <span class="nc">my_testcase1</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="n">discoverer</span> <span class="o">=</span> <span class="n">MyTestcaseDiscovery1</span>

<span class="k">class</span> <span class="nc">my_testcase2</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="n">discoverer</span> <span class="o">=</span> <span class="n">MyTestcaseDiscovery2</span>

<span class="k">class</span> <span class="nc">my_testcase3</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">my_testcase1</span></code> uses <code class="docutils literal notranslate"><span class="pre">MyTestcaseDiscovery1</span></code> class,
<code class="docutils literal notranslate"><span class="pre">my_testcase2</span></code> uses <code class="docutils literal notranslate"><span class="pre">MyTestcaseDiscovery2</span></code> and <code class="docutils literal notranslate"><span class="pre">my_testcase3</span></code> uses
<code class="docutils literal notranslate"><span class="pre">MyDefaultDiscovery</span></code> class</p>
<ul class="simple">
<li><p><strong>pyats.aetest.discovery.CommonDiscovery</strong> is the default discovery class for
subsections and, it can be changed as shown in the following example:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>
<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">common</span> <span class="o">=</span> <span class="n">MyCustomCommonDiscovery</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>User defined custom common test discovery class has to be inherited from
<a class="reference internal" href="../apidoc/aetest/index.html#pyats.aetest.discovery.CommonDiscovery" title="pyats.aetest.discovery.CommonDiscovery"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CommonDiscovery</span></code></a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>
<span class="kn">from</span> <span class="nn">pyats.aetest.discovery</span> <span class="kn">import</span> <span class="n">CommonDiscovery</span>

<span class="k">class</span> <span class="nc">MyCustomCommonDiscovery</span><span class="p">(</span><span class="n">CommonDiscovery</span><span class="p">)</span>
    <span class="k">pass</span>

<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">common</span> <span class="o">=</span> <span class="n">MyCustomCommonDiscovery</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">runtime.discoverer</span></code> properties sets the default discovery
classes.</p></li>
<li><p>As shown in the following example, It is possible to provide different
discovery classes to different common sections by using the <code class="docutils literal notranslate"><span class="pre">discoverer</span></code>
attribute.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>
<span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>

<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">common</span> <span class="o">=</span> <span class="n">MyDefaultDiscovery</span>

<span class="k">class</span> <span class="nc">common_setup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">common_cleanup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonCleanup</span><span class="p">):</span>
    <span class="n">discoverer</span> <span class="o">=</span> <span class="n">MyCommonDiscovery1</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">common_cleanup</span></code> uses <code class="docutils literal notranslate"><span class="pre">MyCommonDiscovery1</span></code> class,
and <code class="docutils literal notranslate"><span class="pre">common_setup</span></code> uses <code class="docutils literal notranslate"><span class="pre">MyDefaultDiscovery</span></code> class</p>
</section>
<section id="how-do-discovery-classes-work">
<h3>How do discovery classes work?<a class="headerlink" href="#how-do-discovery-classes-work" title="Permalink to this heading">¶</a></h3>
<p>There are 3 main methods that users need to know.</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">discover()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">order()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__iter__()</span></code></p></li>
</ol>
<p>Rules:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">discover()</span></code> method “discoveres” all child sections defined in the
current target</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">order()</span></code> method re-orders all sections according to rules of ordering
and execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">discover()</span></code> always calls <code class="docutils literal notranslate"><span class="pre">order()</span></code> before it returns value</p></li>
<li><p>Finally, the result comes from the order is passed to the execution engine</p></li>
<li><p>Custom script discovery classes must be inherited from <strong>ScriptDiscovery</strong></p></li>
<li><p>Custom testcase discovery classes must be inherited from
<strong>TestcaseDiscovery</strong></p></li>
<li><p>Custom common subsection discovery classes must be inherited from
<strong>CommonDiscovery</strong></p></li>
<li><p>Custom methods must follow the same structure with the default discovery
methods</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__</span></code> method has to accept a parameter called <code class="docutils literal notranslate"><span class="pre">target</span></code> for
all classes, containing the object to be discovered</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__iter__</span></code> method instantiates all child sections defined in the current
target and makes discovery class instance <a class="reference external" href="https://docs.python.org/3.4/glossary.html#term-iterable">iterable</a>.</p></li>
</ul>
</div></blockquote>
<p><strong>ScriptDiscovery Implementation</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ScriptDiscovery</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">for</span> <span class="n">testcase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover</span><span class="p">():</span>
            <span class="n">yeild</span> <span class="n">instantiated_testcase</span>

    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">testcases</span><span class="p">,</span> <span class="n">cleanup</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testcases</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">ordered_testcases</span>
</pre></div>
</div>
<p><strong>TestcaseDiscovery Implementation</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestcaseDiscovery</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover</span><span class="p">():</span>
            <span class="n">yeild</span> <span class="n">instantiated_test</span>

    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">testcases</span><span class="p">,</span> <span class="n">cleanup</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">ordered_tests</span>
</pre></div>
</div>
<p><strong>CommonDiscovery Implementation</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CommonDiscovery</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover</span><span class="p">():</span>
            <span class="n">yeild</span> <span class="n">instantiated_test</span>

    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sections</span><span class="p">):</span>
        <span class="c1"># some default logic written here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">ordered_tests</span>
</pre></div>
</div>
<p><strong>Custom Discovery Class Examples</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCustomScriptDiscovery</span><span class="p">(</span><span class="n">ScriptDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some logic</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tc_one</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">common_cleanup</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MyCustomTestcaseDiscovery</span><span class="p">(</span><span class="n">TestcaseDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#some logic</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">my_section1</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MyCustomCommonDiscovery</span><span class="p">(</span><span class="n">CommonDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># some logic</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">subsection1</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="custom-ordering">
<span id="aetest-custom-ordering"></span><h3>Custom Ordering<a class="headerlink" href="#custom-ordering" title="Permalink to this heading">¶</a></h3>
<p>There are 3 levels of custom ordering just like in the custom discovery,</p>
<ol class="arabic simple">
<li><p>Script Level</p></li>
<li><p>Testcase level</p></li>
<li><p>Common Level</p></li>
</ol>
<p>In order to use <strong>Script level ordering</strong> a custom discovery class has to be
provided to the <code class="docutils literal notranslate"><span class="pre">runtime.discoverer.script</span></code> of <code class="docutils literal notranslate"><span class="pre">aetest</span></code>. For more
information on how to provide a custom ScriptDiscovery class to the
<code class="docutils literal notranslate"><span class="pre">runtime.discoverer.script</span></code> please refer <a class="reference internal" href="#aetest-custom-discovery"><span class="std std-ref">Custom Discovery</span></a></p>
<p>Rules:</p>
<blockquote>
<div><ul class="simple">
<li><p>Providing <code class="docutils literal notranslate"><span class="pre">order</span></code> method will replace the default ordering logic with
the user defined one</p></li>
</ul>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCustomScriptDiscovery</span><span class="p">(</span><span class="n">ScriptDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testcases</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># some logic</span>
        <span class="k">return</span> <span class="p">[</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">common_setup</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tc_two</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tc_one</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">common_cleanup</span><span class="p">]</span>
</pre></div>
</div>
<p>Rules:</p>
<blockquote>
<div><ul class="simple">
<li><p>The rules that applies to the <code class="docutils literal notranslate"><span class="pre">discover</span></code> method also applies for
<code class="docutils literal notranslate"><span class="pre">order</span></code> method as well.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">discoverer</span></code> attribute can be used in order to define <code class="docutils literal notranslate"><span class="pre">testcase</span></code>
specific discovery classes for testsections and subsections.</p></li>
<li><p>For more information about how to provide discovery classes, please
check <a class="reference internal" href="#aetest-custom-discovery"><span class="std std-ref">Custom Discovery</span></a></p></li>
</ul>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCustomTestcaseDiscovery</span><span class="p">(</span><span class="n">TestcaseDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># some logic</span>
        <span class="k">return</span> <span class="p">[</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">common_setup</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tc_two</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tc_one</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">common_cleanup</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCustomCommonDiscovery</span><span class="p">(</span><span class="n">CommonDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sections</span><span class="p">):</span>
        <span class="c1"># some logic</span>
        <span class="k">return</span> <span class="p">[</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">subsection1</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">subsection2</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h3>
<p><strong>Demonstration of how to provide custom Script, Testcase and Common Discovery
classes and how they work</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyats</span> <span class="kn">import</span> <span class="n">aetest</span>

<span class="c1"># importing the runtime to have access to the runtime.discoverer</span>
<span class="kn">from</span> <span class="nn">pyats.aetest</span> <span class="kn">import</span> <span class="n">runtime</span>

<span class="c1"># importing ScriptDiscovery, TestcaseDiscovery and CommonDiscovery classes</span>
<span class="c1"># for inheritance</span>
<span class="kn">from</span> <span class="nn">pyats.aetest.discovery</span> <span class="kn">import</span> <span class="n">ScriptDiscovery</span><span class="p">,</span> <span class="n">TestcaseDiscovery</span><span class="p">,</span>\
                                 <span class="n">CommonDiscovery</span>

<span class="c1"># Custom Script Discovery class that changes only the discover method</span>
<span class="c1"># which will return common_setup and tc_one</span>
<span class="k">class</span> <span class="nc">CustomScriptDiscovery</span><span class="p">(</span><span class="n">ScriptDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">common_setup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tc_one</span><span class="p">]</span>

<span class="c1"># Custom Testcase Discovery Class that changes both discover and order</span>
<span class="c1"># classes. This class returns nothing from the discover method to the order</span>
<span class="c1"># so, nothing will run in the provided tetscase</span>
<span class="k">class</span> <span class="nc">CustomTestcaseDiscovery_1</span><span class="p">(</span><span class="n">TestcaseDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testcases</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">setup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">testcases</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">setup</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cleanup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">testcases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">testcases</span>

<span class="c1"># Common Discovery Class that returns nothing to be run</span>
<span class="k">class</span> <span class="nc">CustomCommonDiscovery_1</span><span class="p">(</span><span class="n">CommonDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sections</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sections</span>

<span class="c1"># Custom Common Discovery Class, order method returns sample_subsection_1</span>
<span class="c1"># so it&#39;s the only test section that will run for the provided testcase</span>
<span class="k">class</span> <span class="nc">CustomCommonDiscovery_2</span><span class="p">(</span><span class="n">CommonDiscovery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sections</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">sample_subsection_1</span><span class="p">]</span>

<span class="c1"># setting runtime.discoverer properties so that default discovery classes</span>
<span class="c1"># will change to user defined ones.</span>
<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">CustomScriptDiscovery</span>
<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">testcase</span> <span class="o">=</span> <span class="n">CustomTestcaseDiscovery_1</span>
<span class="n">runtime</span><span class="o">.</span><span class="n">discoverer</span><span class="o">.</span><span class="n">common</span> <span class="o">=</span> <span class="n">CustomCommonDiscovery_1</span>

<span class="c1"># This testcase has discoverer attribte so that, runtime.discoverer.common</span>
<span class="c1">#  will be ignored</span>
<span class="k">class</span> <span class="nc">common_setup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>
    <span class="n">discoverer</span> <span class="o">=</span> <span class="n">CustomCommonDiscovery_2</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">sample_subsection_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">sample_subsection_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">tc_one</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">Testcase</span><span class="p">):</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">setup</span>
    <span class="k">def</span> <span class="nf">prepare_testcase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span> <span class="n">aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">simple_test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span> <span class="n">aetest</span><span class="o">.</span><span class="n">test</span>
    <span class="k">def</span> <span class="nf">simple_test_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@aetest</span><span class="o">.</span><span class="n">cleanup</span>
    <span class="k">def</span> <span class="nf">clean_testcase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">common_cleanup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonCleanup</span><span class="p">):</span>
    <span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
    <span class="k">def</span> <span class="nf">clean_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">CustomScriptDiscovery</span></code> class was passed as the default
discovery class to the <code class="docutils literal notranslate"><span class="pre">runtime.discoverer.script</span></code>. It only has <code class="docutils literal notranslate"><span class="pre">discover</span></code>
method and this method returns only <code class="docutils literal notranslate"><span class="pre">common_setup</span></code> and <code class="docutils literal notranslate"><span class="pre">tc_one</span></code>. Therefore,
only these 2 testcases runs.</p>
<p><code class="docutils literal notranslate"><span class="pre">CustomTestDiscovery_1</span></code> class was also provided as default testcase discovery
class so all the testcases within this script is going to use this class unless
there is <code class="docutils literal notranslate"><span class="pre">discoverer</span></code> parameter is provided. Nothing should be run as it
doesn’t return any test section.</p>
<p><code class="docutils literal notranslate"><span class="pre">CustomCommonDiscovery_1</span></code> class was also provided as default common discovery
class so all the common sections within this script is going to use this class
unless there is <code class="docutils literal notranslate"><span class="pre">discoverer</span></code> parameter is provided like in <code class="docutils literal notranslate"><span class="pre">common_setup</span></code>.
The output of <code class="docutils literal notranslate"><span class="pre">order</span></code> and <code class="docutils literal notranslate"><span class="pre">discover</span></code> calls from this class will return empty
list. So, none of the testcases, should run any testsection except
<code class="docutils literal notranslate"><span class="pre">common_setup</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">discoverer</span></code> was provided within the <code class="docutils literal notranslate"><span class="pre">common_setup</span></code> section so, this
parameter will be applied over <code class="docutils literal notranslate"><span class="pre">runtime.discoverer.commmon</span></code> for this section.
<code class="docutils literal notranslate"><span class="pre">CustomCommonDiscovery_2</span></code> class was used and it returns only
<code class="docutils literal notranslate"><span class="pre">sample_subsection_1</span></code>.</p>
<p><strong>Output</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>%EASYPY-INFO: +------------------------------------------------------------------------------+
%EASYPY-INFO: |                             Task Result Details                              |
%EASYPY-INFO: +------------------------------------------------------------------------------+
%EASYPY-INFO: Task-1: basic_example_script
%EASYPY-INFO: |-- commonSetup                                                           PASSED
%EASYPY-INFO: |   `-- sample_subsection_1                                               PASSED
%EASYPY-INFO: `-- tc_one                                                                PASSED
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="datafile.html" class="btn btn-neutral float-left" title="Datafile Inputs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reports.html" class="btn btn-neutral float-right" title="Report Details" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2024, Cisco Systems Inc..
      <span class="lastupdated">Last updated on Dec 27, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>