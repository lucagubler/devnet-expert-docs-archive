<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Anthon van der Neut" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Details - yaml</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        
        
    
      <script>
        // Current page data
        var mkdocs_page_name = "Details";
        var mkdocs_page_input_path = "detail.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
<script async type="text/javascript" src="../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="yaml" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/detail/" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> yaml
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="https://yaml.readthedocs.io/en/latest/search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../basicuse/index.html">Basic Usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../dumpcls/index.html">Working with Python classes</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="index.html">Details</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="index.html#indentation-of-block-sequences">Indentation of block sequences</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="index.html#inconsistently-indented-yaml">Inconsistently indented YAML</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="index.html#indenting-using-typsafe">Indenting using typ="safe"</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="index.html#positioning-in-top-level-mappings-prefixing">Positioning ':' in top level mappings, prefixing ':'</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="index.html#document-version-support">Document version support</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="index.html#round-trip-including-comments">Round trip including comments</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="index.html#addingreplacing-comments">adding/replacing comments</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/index.html">Departure from previous API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pyyaml/index.html">Differences with PyYAML</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">yaml</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Details</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="details">Details<a class="headerlink" href="index.html#details" title="Permanent link">&para;</a></h1>
<ul>
<li>support for simple lists as mapping keys by transforming these to
    tuples</li>
<li><code>!!omap</code> generates ordereddict (C) on Python 2,
    collections.OrderedDict on Python 3, and <code>!!omap</code> is generated for
    these types.</li>
<li>Tests whether the C yaml library is installed as well as the header
    files. That library doesn\'t generate CommentTokens, so it cannot be
    used to do round trip editing on comments. It can be used to speed
    up normal processing (so you don\'t need to install <code>ruamel.yaml</code>
    and <code>PyYaml</code>). See the section <em>Optional requirements</em>.</li>
<li>Basic support for multiline strings with preserved newlines and
    chomping ( \'<code>|</code>\', \'<code>|+</code>\', \'<code>|-</code>\' ). As this subclasses the
    string type the information is lost on reassignment. (This might be
    changed in the future so that the preservation/folding/chomping is
    part of the parent container, like comments).</li>
<li>anchors names that are hand-crafted (not of the form<code>idNNN</code>) are
    preserved</li>
<li><a href="http://yaml.org/type/merge.html">merges</a> in dictionaries are
    preserved</li>
<li>adding/replacing comments on block-style sequences and mappings with
    smart column positioning</li>
<li>collection objects (when read in via RoundTripParser) have an <code>lc</code>
    property that contains line and column info <code>lc.line</code> and <code>lc.col</code>.
    Individual positions for mappings and sequences can also be
    retrieved (<code>lc.key('a')</code>, <code>lc.value('a')</code> resp. <code>lc.item(3)</code>)</li>
<li>preservation of whitelines after block scalars. Contributed by Sam
    Thursfield.</li>
</ul>
<p><em>In the following examples it is assumed you have done something like:</em>:</p>
<pre><code>from ruamel.yaml import YAML
yaml = YAML()
</code></pre>
<p><em>if not explicitly specified.</em></p>
<h2 id="indentation-of-block-sequences">Indentation of block sequences<a class="headerlink" href="index.html#indentation-of-block-sequences" title="Permanent link">&para;</a></h2>
<p>Although ruamel.yaml doesn\'t preserve individual indentations of block
sequence items, it does properly dump:</p>
<pre><code>x:
- b: 1
- 2
</code></pre>
<p>back to:</p>
<pre><code>x:
-   b: 1
-   2
</code></pre>
<p>if you specify <code>yaml.indent(sequence=4)</code> (indentation is counted to the
beginning of the sequence element).</p>
<p>PyYAML (and older versions of ruamel.yaml) gives you non-indented
scalars (when specifying default_flow_style=False):</p>
<pre><code>x:
-   b: 1
- 2
</code></pre>
<p>You can use <code>mapping=4</code> to also have the mappings values indented. The
dump also observes an additional <code>offset=2</code> setting that can be used to
push the dash inwards, <em>within the space defined by</em> <code>sequence</code>.</p>
<p>The above example with the often seen
<code>yaml.indent(mapping=2, sequence=4, offset=2)</code> indentation:</p>
<pre><code>x:
  y:
    - b: 1
    - 2
</code></pre>
<p>The defaults are as if you specified
<code>yaml.indent(mapping=2, sequence=2, offset=0)</code>.</p>
<p>If the <code>offset</code> equals <code>sequence</code>, there is not enough room for the dash
and the space that has to follow it. In that case the element itself
would normally be pushed to the next line (and older versions of
<code>ruamel.yaml</code> did so). But this is prevented from happening. However the
<code>indent</code> level is what is used for calculating the cumulative indent for
deeper levels and specifying <code>sequence=3</code> resp. <code>offset=2</code>, might give
correct, but counter-intuitive results.</p>
<p><strong>It is best to always have</strong> <code>sequence &gt;= offset + 2</code> <strong>but this is not
enforced</strong>. Depending on your structure, not following this advice
<strong>might lead to invalid output</strong>.</p>
<h3 id="inconsistently-indented-yaml">Inconsistently indented YAML<a class="headerlink" href="index.html#inconsistently-indented-yaml" title="Permanent link">&para;</a></h3>
<p>If your input is inconsistently indented, such indentation cannot be
preserved. The first round-trip will make it consistent/normalize it.
Here are some inconsistently indented YAML examples.</p>
<p><code>b</code> indented 3, <code>c</code> indented 4 positions:</p>
<pre><code>a:
   b:
       c: 1
</code></pre>
<p>Top level sequence is indented 2 without offset, the other sequence 4
(with offset 2):</p>
<pre><code>- key:
    - foo
    - bar
</code></pre>
<h3 id="indenting-using-typsafe">Indenting using <code>typ="safe"</code><a class="headerlink" href="index.html#indenting-using-typsafe" title="Permanent link">&para;</a></h3>
<p>The C based emitter doesn't have the fine control, distinguishing between
block mappings and sequences. Do only use the <code>pure</code> Python versions
of the dumper if you want to have that sort of control.</p>
<h2 id="positioning-in-top-level-mappings-prefixing">Positioning ':' in top level mappings, prefixing ':'<a class="headerlink" href="index.html#positioning-in-top-level-mappings-prefixing" title="Permanent link">&para;</a></h2>
<p>If you want your toplevel mappings to look like:</p>
<pre><code>library version: 1
comment        : |
    this is just a first try
</code></pre>
<p>then set <code>yaml.top_level_colon_align = True</code> (and <code>yaml.indent = 4</code>).
<code>True</code> causes calculation based on the longest key, but you can also
explicitly set a number.</p>
<p>If you want an extra space between a mapping key and the colon specify
<code>yaml.prefix_colon = ' '</code>:</p>
<pre><code>- https://myurl/abc.tar.xz : 23445
#                         ^ extra space here
- https://myurl/def.tar.xz : 944
</code></pre>
<p>If you combine <code>prefix_colon</code> with <code>top_level_colon_align</code>, the top
level mapping doesn\'t get the extra prefix. If you want that anyway,
specify <code>yaml.top_level_colon_align = 12</code> where <code>12</code> has to be an
integer that is one more than length of the widest key.</p>
<h3 id="document-version-support">Document version support<a class="headerlink" href="index.html#document-version-support" title="Permanent link">&para;</a></h3>
<p>In YAML a document version can be explicitly set by using:</p>
<pre><code>%YAML 1.x
</code></pre>
<p>before the document start (at the top or before a <code>---</code>). For
<code>ruamel.yaml</code> x has to be 1 or 2. If no explicit version is set <a href="http://www.yaml.org/spec/1.2/spec.html">version
1.2</a> is assumed (which has been
released in 2009).</p>
<p>The 1.2 version does <strong>not</strong> support:</p>
<ul>
<li>sexagesimals like <code>12:34:56</code></li>
<li>octals that start with 0 only: like <code>012</code> for number 10 (<code>0o12</code>
    <strong>is</strong> supported by YAML 1.2)</li>
<li>Unquoted Yes and On as alternatives for True and No and Off for
    False.</li>
</ul>
<p>If you cannot change your YAML files and you need them to load as 1.1
you can load with <code>yaml.version = (1, 1)</code>, or the equivalent (version
can be a tuple, list or string) <code>yaml.version = "1.1"</code></p>
<p><em>If you cannot change your code, stick with ruamel.yaml==0.10.23 and let
me know if it would help to be able to set an environment variable.</em></p>
<p>This does not affect dump as ruamel.yaml never emitted sexagesimals, nor
octal numbers, and emitted booleans always as true resp. false</p>
<h3 id="round-trip-including-comments">Round trip including comments<a class="headerlink" href="index.html#round-trip-including-comments" title="Permanent link">&para;</a></h3>
<p>The major motivation for this fork is the round-trip capability for
comments. The integration of the sources was just an initial step to
make this easier.</p>
<h4 id="addingreplacing-comments">adding/replacing comments<a class="headerlink" href="index.html#addingreplacing-comments" title="Permanent link">&para;</a></h4>
<p>Starting with version 0.8, you can add/replace comments on block style
collections (mappings/sequences resuting in Python dict/list). The basic
for for this is:</p>
<pre><code class="language-python">from __future__ import print_function

import sys
import ruamel.yaml

yaml = ruamel.yaml.YAML()  # defaults to round-trip

inp = &quot;&quot;&quot;\
abc:
  - a     # comment 1
xyz:
  a: 1    # comment 2
  b: 2
  c: 3
  d: 4
  e: 5
  f: 6 # comment 3
&quot;&quot;&quot;

data = yaml.load(inp)
data['abc'].append('b')
data['abc'].yaml_add_eol_comment('comment 4', 1)  # takes column of comment 1
data['xyz'].yaml_add_eol_comment('comment 5', 'c')  # takes column of comment 2
data['xyz'].yaml_add_eol_comment('comment 6', 'e')  # takes column of comment 3
data['xyz'].yaml_add_eol_comment('comment 7\n\n# that\'s all folks', 'd', column=20)

yaml.dump(data, sys.stdout)
</code></pre>
<p>Resulting in::</p>
<pre><code class="language-lang-none">abc:
- a       # comment 1
- b       # comment 4
xyz:
  a: 1    # comment 2
  b: 2
  c: 3    # comment 5
  d: 4              # comment 7

# that's all folks
  e: 5 # comment 6
  f: 6 # comment 3
</code></pre>
<p>If the comment doesn\'t start with \'#\', this will be added. The key is
the element index for list, the actual key for dictionaries. As can be
seen from the example, the column to choose for a comment is derived
from the previous, next or preceding comment column (picking the first
one found).</p>
<p>Make sure that the added comment is correct, in the sense that when it
contains newlines, the following is either an empty line or a line with
only spaces, or the first non-space is a <code>#</code>.</p>
<h1 id="config-file-formats">Config file formats<a class="headerlink" href="index.html#config-file-formats" title="Permanent link">&para;</a></h1>
<p>There are only a few configuration file formats that are easily readable
and editable: JSON, INI/ConfigParser, YAML (XML is to cluttered to be
called easily readable).</p>
<p>Unfortunately <a href="http://www.json.org/">JSON</a> doesn\'t support comments,
and although there are some solutions with pre-processed filtering of
comments, there are no libraries that support round trip updating of
such commented files.</p>
<p>INI files support comments, and the excellent
<a href="http://www.voidspace.org.uk/python/configobj.html">ConfigObj</a> library
by Foord and Larosa even supports round trip editing with comment
preservation, nesting of sections and limited lists (within a value).
Retrieval of particular value format is explicit (and extensible).</p>
<p>YAML has basic mapping and sequence structures as well as support for
ordered mappings and sets. It supports scalars various types including
dates and datetimes (missing in JSON). YAML has comments, but these are
normally thrown away.</p>
<p>Block structured YAML is a clean and very human readable format. By
extending the Python YAML parser to support round trip preservation of
comments, it makes YAML a very good choice for configuration files that
are human readable and editable while at the same time interpretable and
modifiable by a program.</p>
<h1 id="extending">Extending<a class="headerlink" href="index.html#extending" title="Permanent link">&para;</a></h1>
<p>There are normally six files involved when extending the roundtrip
capabilities: the reader, parser, composer and constructor to go from
YAML to Python and the resolver, representer, serializer and emitter to
go the other way.</p>
<p>Extending involves keeping extra data around for the next process step,
eventuallly resulting in a different Python object (subclass or
alternative), that should behave like the original, but on the way from
Python to YAML generates the original (or at least something much
closer).</p>
<h1 id="smartening">Smartening<a class="headerlink" href="index.html#smartening" title="Permanent link">&para;</a></h1>
<p>When you use round-tripping, then the complex data you get are already
subclasses of the built-in types. So you can patch in extra methods or
override existing ones. Some methods are already included and you can
do:</p>
<pre><code>yaml_str = """\
a:
- b:
  c: 42
- d:
    f: 196
  e:
    g: 3.14
"""


data = yaml.load(yaml_str)

assert data.mlget(['a', 1, 'd', 'f'], list_ok=True) == 196
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../dumpcls/index.html" class="btn btn-neutral float-left" title="Working with Python classes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../example/index.html" class="btn btn-neutral float-right" title="Examples">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../readthedocs-data.js"></script>
      
      
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
